var tI=Object.defineProperty;var nI=(t,e,n)=>e in t?tI(t,e,{enumerable:!0,configurable:!0,writable:!0,value:n}):t[e]=n;var p=(t,e,n)=>(nI(t,typeof e!="symbol"?e+"":e,n),n);function sI(t,e){for(var n=0;n<e.length;n++){const s=e[n];if(typeof s!="string"&&!Array.isArray(s)){for(const r in s)if(r!=="default"&&!(r in t)){const i=Object.getOwnPropertyDescriptor(s,r);i&&Object.defineProperty(t,r,i.get?i:{enumerable:!0,get:()=>s[r]})}}}return Object.freeze(Object.defineProperty(t,Symbol.toStringTag,{value:"Module"}))}(function(){const e=document.createElement("link").relList;if(e&&e.supports&&e.supports("modulepreload"))return;for(const r of document.querySelectorAll('link[rel="modulepreload"]'))s(r);new MutationObserver(r=>{for(const i of r)if(i.type==="childList")for(const o of i.addedNodes)o.tagName==="LINK"&&o.rel==="modulepreload"&&s(o)}).observe(document,{childList:!0,subtree:!0});function n(r){const i={};return r.integrity&&(i.integrity=r.integrity),r.referrerPolicy&&(i.referrerPolicy=r.referrerPolicy),r.crossOrigin==="use-credentials"?i.credentials="include":r.crossOrigin==="anonymous"?i.credentials="omit":i.credentials="same-origin",i}function s(r){if(r.ep)return;r.ep=!0;const i=n(r);fetch(r.href,i)}})();function i_(t){return t&&t.__esModule&&Object.prototype.hasOwnProperty.call(t,"default")?t.default:t}var MS={exports:{}},ee={};/**
 * @license React
 * react.production.min.js
 *
 * Copyright (c) Facebook, Inc. and its affiliates.
 *
 * This source code is licensed under the MIT license found in the
 * LICENSE file in the root directory of this source tree.
 */var Xa=Symbol.for("react.element"),rI=Symbol.for("react.portal"),iI=Symbol.for("react.fragment"),oI=Symbol.for("react.strict_mode"),aI=Symbol.for("react.profiler"),cI=Symbol.for("react.provider"),lI=Symbol.for("react.context"),uI=Symbol.for("react.forward_ref"),hI=Symbol.for("react.suspense"),fI=Symbol.for("react.memo"),dI=Symbol.for("react.lazy"),Sy=Symbol.iterator;function pI(t){return t===null||typeof t!="object"?null:(t=Sy&&t[Sy]||t["@@iterator"],typeof t=="function"?t:null)}var BS={isMounted:function(){return!1},enqueueForceUpdate:function(){},enqueueReplaceState:function(){},enqueueSetState:function(){}},OS=Object.assign,NS={};function to(t,e,n){this.props=t,this.context=e,this.refs=NS,this.updater=n||BS}to.prototype.isReactComponent={};to.prototype.setState=function(t,e){if(typeof t!="object"&&typeof t!="function"&&t!=null)throw Error("setState(...): takes an object of state variables to update or a function which returns an object of state variables.");this.updater.enqueueSetState(this,t,e,"setState")};to.prototype.forceUpdate=function(t){this.updater.enqueueForceUpdate(this,t,"forceUpdate")};function FS(){}FS.prototype=to.prototype;function o_(t,e,n){this.props=t,this.context=e,this.refs=NS,this.updater=n||BS}var a_=o_.prototype=new FS;a_.constructor=o_;OS(a_,to.prototype);a_.isPureReactComponent=!0;var Cy=Array.isArray,DS=Object.prototype.hasOwnProperty,c_={current:null},LS={key:!0,ref:!0,__self:!0,__source:!0};function US(t,e,n){var s,r={},i=null,o=null;if(e!=null)for(s in e.ref!==void 0&&(o=e.ref),e.key!==void 0&&(i=""+e.key),e)DS.call(e,s)&&!LS.hasOwnProperty(s)&&(r[s]=e[s]);var a=arguments.length-2;if(a===1)r.children=n;else if(1<a){for(var c=Array(a),l=0;l<a;l++)c[l]=arguments[l+2];r.children=c}if(t&&t.defaultProps)for(s in a=t.defaultProps,a)r[s]===void 0&&(r[s]=a[s]);return{$$typeof:Xa,type:t,key:i,ref:o,props:r,_owner:c_.current}}function gI(t,e){return{$$typeof:Xa,type:t.type,key:e,ref:t.ref,props:t.props,_owner:t._owner}}function l_(t){return typeof t=="object"&&t!==null&&t.$$typeof===Xa}function _I(t){var e={"=":"=0",":":"=2"};return"$"+t.replace(/[=:]/g,function(n){return e[n]})}var vy=/\/+/g;function uf(t,e){return typeof t=="object"&&t!==null&&t.key!=null?_I(""+t.key):e.toString(36)}function gl(t,e,n,s,r){var i=typeof t;(i==="undefined"||i==="boolean")&&(t=null);var o=!1;if(t===null)o=!0;else switch(i){case"string":case"number":o=!0;break;case"object":switch(t.$$typeof){case Xa:case rI:o=!0}}if(o)return o=t,r=r(o),t=s===""?"."+uf(o,0):s,Cy(r)?(n="",t!=null&&(n=t.replace(vy,"$&/")+"/"),gl(r,e,n,"",function(l){return l})):r!=null&&(l_(r)&&(r=gI(r,n+(!r.key||o&&o.key===r.key?"":(""+r.key).replace(vy,"$&/")+"/")+t)),e.push(r)),1;if(o=0,s=s===""?".":s+":",Cy(t))for(var a=0;a<t.length;a++){i=t[a];var c=s+uf(i,a);o+=gl(i,e,n,c,r)}else if(c=pI(t),typeof c=="function")for(t=c.call(t),a=0;!(i=t.next()).done;)i=i.value,c=s+uf(i,a++),o+=gl(i,e,n,c,r);else if(i==="object")throw e=String(t),Error("Objects are not valid as a React child (found: "+(e==="[object Object]"?"object with keys {"+Object.keys(t).join(", ")+"}":e)+"). If you meant to render a collection of children, use an array instead.");return o}function gc(t,e,n){if(t==null)return t;var s=[],r=0;return gl(t,s,"","",function(i){return e.call(n,i,r++)}),s}function mI(t){if(t._status===-1){var e=t._result;e=e(),e.then(function(n){(t._status===0||t._status===-1)&&(t._status=1,t._result=n)},function(n){(t._status===0||t._status===-1)&&(t._status=2,t._result=n)}),t._status===-1&&(t._status=0,t._result=e)}if(t._status===1)return t._result.default;throw t._result}var lt={current:null},_l={transition:null},yI={ReactCurrentDispatcher:lt,ReactCurrentBatchConfig:_l,ReactCurrentOwner:c_};ee.Children={map:gc,forEach:function(t,e,n){gc(t,function(){e.apply(this,arguments)},n)},count:function(t){var e=0;return gc(t,function(){e++}),e},toArray:function(t){return gc(t,function(e){return e})||[]},only:function(t){if(!l_(t))throw Error("React.Children.only expected to receive a single React element child.");return t}};ee.Component=to;ee.Fragment=iI;ee.Profiler=aI;ee.PureComponent=o_;ee.StrictMode=oI;ee.Suspense=hI;ee.__SECRET_INTERNALS_DO_NOT_USE_OR_YOU_WILL_BE_FIRED=yI;ee.cloneElement=function(t,e,n){if(t==null)throw Error("React.cloneElement(...): The argument must be a React element, but you passed "+t+".");var s=OS({},t.props),r=t.key,i=t.ref,o=t._owner;if(e!=null){if(e.ref!==void 0&&(i=e.ref,o=c_.current),e.key!==void 0&&(r=""+e.key),t.type&&t.type.defaultProps)var a=t.type.defaultProps;for(c in e)DS.call(e,c)&&!LS.hasOwnProperty(c)&&(s[c]=e[c]===void 0&&a!==void 0?a[c]:e[c])}var c=arguments.length-2;if(c===1)s.children=n;else if(1<c){a=Array(c);for(var l=0;l<c;l++)a[l]=arguments[l+2];s.children=a}return{$$typeof:Xa,type:t.type,key:r,ref:i,props:s,_owner:o}};ee.createContext=function(t){return t={$$typeof:lI,_currentValue:t,_currentValue2:t,_threadCount:0,Provider:null,Consumer:null,_defaultValue:null,_globalName:null},t.Provider={$$typeof:cI,_context:t},t.Consumer=t};ee.createElement=US;ee.createFactory=function(t){var e=US.bind(null,t);return e.type=t,e};ee.createRef=function(){return{current:null}};ee.forwardRef=function(t){return{$$typeof:uI,render:t}};ee.isValidElement=l_;ee.lazy=function(t){return{$$typeof:dI,_payload:{_status:-1,_result:t},_init:mI}};ee.memo=function(t,e){return{$$typeof:fI,type:t,compare:e===void 0?null:e}};ee.startTransition=function(t){var e=_l.transition;_l.transition={};try{t()}finally{_l.transition=e}};ee.unstable_act=function(){throw Error("act(...) is not supported in production builds of React.")};ee.useCallback=function(t,e){return lt.current.useCallback(t,e)};ee.useContext=function(t){return lt.current.useContext(t)};ee.useDebugValue=function(){};ee.useDeferredValue=function(t){return lt.current.useDeferredValue(t)};ee.useEffect=function(t,e){return lt.current.useEffect(t,e)};ee.useId=function(){return lt.current.useId()};ee.useImperativeHandle=function(t,e,n){return lt.current.useImperativeHandle(t,e,n)};ee.useInsertionEffect=function(t,e){return lt.current.useInsertionEffect(t,e)};ee.useLayoutEffect=function(t,e){return lt.current.useLayoutEffect(t,e)};ee.useMemo=function(t,e){return lt.current.useMemo(t,e)};ee.useReducer=function(t,e,n){return lt.current.useReducer(t,e,n)};ee.useRef=function(t){return lt.current.useRef(t)};ee.useState=function(t){return lt.current.useState(t)};ee.useSyncExternalStore=function(t,e,n){return lt.current.useSyncExternalStore(t,e,n)};ee.useTransition=function(){return lt.current.useTransition()};ee.version="18.2.0";MS.exports=ee;var Ee=MS.exports;const kS=i_(Ee);var zS={exports:{}},Bt={},VS={exports:{}},HS={};/**
 * @license React
 * scheduler.production.min.js
 *
 * Copyright (c) Facebook, Inc. and its affiliates.
 *
 * This source code is licensed under the MIT license found in the
 * LICENSE file in the root directory of this source tree.
 */(function(t){function e(V,K){var Y=V.length;V.push(K);e:for(;0<Y;){var se=Y-1>>>1,ae=V[se];if(0<r(ae,K))V[se]=K,V[Y]=ae,Y=se;else break e}}function n(V){return V.length===0?null:V[0]}function s(V){if(V.length===0)return null;var K=V[0],Y=V.pop();if(Y!==K){V[0]=Y;e:for(var se=0,ae=V.length,us=ae>>>1;se<us;){var Ft=2*(se+1)-1,Qs=V[Ft],kn=Ft+1,Me=V[kn];if(0>r(Qs,Y))kn<ae&&0>r(Me,Qs)?(V[se]=Me,V[kn]=Y,se=kn):(V[se]=Qs,V[Ft]=Y,se=Ft);else if(kn<ae&&0>r(Me,Y))V[se]=Me,V[kn]=Y,se=kn;else break e}}return K}function r(V,K){var Y=V.sortIndex-K.sortIndex;return Y!==0?Y:V.id-K.id}if(typeof performance=="object"&&typeof performance.now=="function"){var i=performance;t.unstable_now=function(){return i.now()}}else{var o=Date,a=o.now();t.unstable_now=function(){return o.now()-a}}var c=[],l=[],u=1,h=null,f=3,d=!1,g=!1,_=!1,E=typeof setTimeout=="function"?setTimeout:null,m=typeof clearTimeout=="function"?clearTimeout:null,y=typeof setImmediate<"u"?setImmediate:null;typeof navigator<"u"&&navigator.scheduling!==void 0&&navigator.scheduling.isInputPending!==void 0&&navigator.scheduling.isInputPending.bind(navigator.scheduling);function A(V){for(var K=n(l);K!==null;){if(K.callback===null)s(l);else if(K.startTime<=V)s(l),K.sortIndex=K.expirationTime,e(c,K);else break;K=n(l)}}function C(V){if(_=!1,A(V),!g)if(n(c)!==null)g=!0,Nt(b);else{var K=n(l);K!==null&&Et(C,K.startTime-V)}}function b(V,K){g=!1,_&&(_=!1,m(O),O=-1),d=!0;var Y=f;try{for(A(K),h=n(c);h!==null&&(!(h.expirationTime>K)||V&&!H());){var se=h.callback;if(typeof se=="function"){h.callback=null,f=h.priorityLevel;var ae=se(h.expirationTime<=K);K=t.unstable_now(),typeof ae=="function"?h.callback=ae:h===n(c)&&s(c),A(K)}else s(c);h=n(c)}if(h!==null)var us=!0;else{var Ft=n(l);Ft!==null&&Et(C,Ft.startTime-K),us=!1}return us}finally{h=null,f=Y,d=!1}}var P=!1,B=null,O=-1,N=5,F=-1;function H(){return!(t.unstable_now()-F<N)}function X(){if(B!==null){var V=t.unstable_now();F=V;var K=!0;try{K=B(!0,V)}finally{K?G():(P=!1,B=null)}}else P=!1}var G;if(typeof y=="function")G=function(){y(X)};else if(typeof MessageChannel<"u"){var $=new MessageChannel,Te=$.port2;$.port1.onmessage=X,G=function(){Te.postMessage(null)}}else G=function(){E(X,0)};function Nt(V){B=V,P||(P=!0,G())}function Et(V,K){O=E(function(){V(t.unstable_now())},K)}t.unstable_IdlePriority=5,t.unstable_ImmediatePriority=1,t.unstable_LowPriority=4,t.unstable_NormalPriority=3,t.unstable_Profiling=null,t.unstable_UserBlockingPriority=2,t.unstable_cancelCallback=function(V){V.callback=null},t.unstable_continueExecution=function(){g||d||(g=!0,Nt(b))},t.unstable_forceFrameRate=function(V){0>V||125<V?console.error("forceFrameRate takes a positive int between 0 and 125, forcing frame rates higher than 125 fps is not supported"):N=0<V?Math.floor(1e3/V):5},t.unstable_getCurrentPriorityLevel=function(){return f},t.unstable_getFirstCallbackNode=function(){return n(c)},t.unstable_next=function(V){switch(f){case 1:case 2:case 3:var K=3;break;default:K=f}var Y=f;f=K;try{return V()}finally{f=Y}},t.unstable_pauseExecution=function(){},t.unstable_requestPaint=function(){},t.unstable_runWithPriority=function(V,K){switch(V){case 1:case 2:case 3:case 4:case 5:break;default:V=3}var Y=f;f=V;try{return K()}finally{f=Y}},t.unstable_scheduleCallback=function(V,K,Y){var se=t.unstable_now();switch(typeof Y=="object"&&Y!==null?(Y=Y.delay,Y=typeof Y=="number"&&0<Y?se+Y:se):Y=se,V){case 1:var ae=-1;break;case 2:ae=250;break;case 5:ae=1073741823;break;case 4:ae=1e4;break;default:ae=5e3}return ae=Y+ae,V={id:u++,callback:K,priorityLevel:V,startTime:Y,expirationTime:ae,sortIndex:-1},Y>se?(V.sortIndex=Y,e(l,V),n(c)===null&&V===n(l)&&(_?(m(O),O=-1):_=!0,Et(C,Y-se))):(V.sortIndex=ae,e(c,V),g||d||(g=!0,Nt(b))),V},t.unstable_shouldYield=H,t.unstable_wrapCallback=function(V){var K=f;return function(){var Y=f;f=K;try{return V.apply(this,arguments)}finally{f=Y}}}})(HS);VS.exports=HS;var AI=VS.exports;/**
 * @license React
 * react-dom.production.min.js
 *
 * Copyright (c) Facebook, Inc. and its affiliates.
 *
 * This source code is licensed under the MIT license found in the
 * LICENSE file in the root directory of this source tree.
 */var jS=Ee,Mt=AI;function k(t){for(var e="https://reactjs.org/docs/error-decoder.html?invariant="+t,n=1;n<arguments.length;n++)e+="&args[]="+encodeURIComponent(arguments[n]);return"Minified React error #"+t+"; visit "+e+" for the full message or use the non-minified dev environment for full errors and additional helpful warnings."}var WS=new Set,_a={};function Fr(t,e){Li(t,e),Li(t+"Capture",e)}function Li(t,e){for(_a[t]=e,t=0;t<e.length;t++)WS.add(e[t])}var ts=!(typeof window>"u"||typeof window.document>"u"||typeof window.document.createElement>"u"),Xd=Object.prototype.hasOwnProperty,TI=/^[:A-Z_a-z\u00C0-\u00D6\u00D8-\u00F6\u00F8-\u02FF\u0370-\u037D\u037F-\u1FFF\u200C-\u200D\u2070-\u218F\u2C00-\u2FEF\u3001-\uD7FF\uF900-\uFDCF\uFDF0-\uFFFD][:A-Z_a-z\u00C0-\u00D6\u00D8-\u00F6\u00F8-\u02FF\u0370-\u037D\u037F-\u1FFF\u200C-\u200D\u2070-\u218F\u2C00-\u2FEF\u3001-\uD7FF\uF900-\uFDCF\uFDF0-\uFFFD\-.0-9\u00B7\u0300-\u036F\u203F-\u2040]*$/,wy={},by={};function EI(t){return Xd.call(by,t)?!0:Xd.call(wy,t)?!1:TI.test(t)?by[t]=!0:(wy[t]=!0,!1)}function SI(t,e,n,s){if(n!==null&&n.type===0)return!1;switch(typeof e){case"function":case"symbol":return!0;case"boolean":return s?!1:n!==null?!n.acceptsBooleans:(t=t.toLowerCase().slice(0,5),t!=="data-"&&t!=="aria-");default:return!1}}function CI(t,e,n,s){if(e===null||typeof e>"u"||SI(t,e,n,s))return!0;if(s)return!1;if(n!==null)switch(n.type){case 3:return!e;case 4:return e===!1;case 5:return isNaN(e);case 6:return isNaN(e)||1>e}return!1}function ut(t,e,n,s,r,i,o){this.acceptsBooleans=e===2||e===3||e===4,this.attributeName=s,this.attributeNamespace=r,this.mustUseProperty=n,this.propertyName=t,this.type=e,this.sanitizeURL=i,this.removeEmptyString=o}var Ke={};"children dangerouslySetInnerHTML defaultValue defaultChecked innerHTML suppressContentEditableWarning suppressHydrationWarning style".split(" ").forEach(function(t){Ke[t]=new ut(t,0,!1,t,null,!1,!1)});[["acceptCharset","accept-charset"],["className","class"],["htmlFor","for"],["httpEquiv","http-equiv"]].forEach(function(t){var e=t[0];Ke[e]=new ut(e,1,!1,t[1],null,!1,!1)});["contentEditable","draggable","spellCheck","value"].forEach(function(t){Ke[t]=new ut(t,2,!1,t.toLowerCase(),null,!1,!1)});["autoReverse","externalResourcesRequired","focusable","preserveAlpha"].forEach(function(t){Ke[t]=new ut(t,2,!1,t,null,!1,!1)});"allowFullScreen async autoFocus autoPlay controls default defer disabled disablePictureInPicture disableRemotePlayback formNoValidate hidden loop noModule noValidate open playsInline readOnly required reversed scoped seamless itemScope".split(" ").forEach(function(t){Ke[t]=new ut(t,3,!1,t.toLowerCase(),null,!1,!1)});["checked","multiple","muted","selected"].forEach(function(t){Ke[t]=new ut(t,3,!0,t,null,!1,!1)});["capture","download"].forEach(function(t){Ke[t]=new ut(t,4,!1,t,null,!1,!1)});["cols","rows","size","span"].forEach(function(t){Ke[t]=new ut(t,6,!1,t,null,!1,!1)});["rowSpan","start"].forEach(function(t){Ke[t]=new ut(t,5,!1,t.toLowerCase(),null,!1,!1)});var u_=/[\-:]([a-z])/g;function h_(t){return t[1].toUpperCase()}"accent-height alignment-baseline arabic-form baseline-shift cap-height clip-path clip-rule color-interpolation color-interpolation-filters color-profile color-rendering dominant-baseline enable-background fill-opacity fill-rule flood-color flood-opacity font-family font-size font-size-adjust font-stretch font-style font-variant font-weight glyph-name glyph-orientation-horizontal glyph-orientation-vertical horiz-adv-x horiz-origin-x image-rendering letter-spacing lighting-color marker-end marker-mid marker-start overline-position overline-thickness paint-order panose-1 pointer-events rendering-intent shape-rendering stop-color stop-opacity strikethrough-position strikethrough-thickness stroke-dasharray stroke-dashoffset stroke-linecap stroke-linejoin stroke-miterlimit stroke-opacity stroke-width text-anchor text-decoration text-rendering underline-position underline-thickness unicode-bidi unicode-range units-per-em v-alphabetic v-hanging v-ideographic v-mathematical vector-effect vert-adv-y vert-origin-x vert-origin-y word-spacing writing-mode xmlns:xlink x-height".split(" ").forEach(function(t){var e=t.replace(u_,h_);Ke[e]=new ut(e,1,!1,t,null,!1,!1)});"xlink:actuate xlink:arcrole xlink:role xlink:show xlink:title xlink:type".split(" ").forEach(function(t){var e=t.replace(u_,h_);Ke[e]=new ut(e,1,!1,t,"http://www.w3.org/1999/xlink",!1,!1)});["xml:base","xml:lang","xml:space"].forEach(function(t){var e=t.replace(u_,h_);Ke[e]=new ut(e,1,!1,t,"http://www.w3.org/XML/1998/namespace",!1,!1)});["tabIndex","crossOrigin"].forEach(function(t){Ke[t]=new ut(t,1,!1,t.toLowerCase(),null,!1,!1)});Ke.xlinkHref=new ut("xlinkHref",1,!1,"xlink:href","http://www.w3.org/1999/xlink",!0,!1);["src","href","action","formAction"].forEach(function(t){Ke[t]=new ut(t,1,!1,t.toLowerCase(),null,!0,!0)});function f_(t,e,n,s){var r=Ke.hasOwnProperty(e)?Ke[e]:null;(r!==null?r.type!==0:s||!(2<e.length)||e[0]!=="o"&&e[0]!=="O"||e[1]!=="n"&&e[1]!=="N")&&(CI(e,n,r,s)&&(n=null),s||r===null?EI(e)&&(n===null?t.removeAttribute(e):t.setAttribute(e,""+n)):r.mustUseProperty?t[r.propertyName]=n===null?r.type===3?!1:"":n:(e=r.attributeName,s=r.attributeNamespace,n===null?t.removeAttribute(e):(r=r.type,n=r===3||r===4&&n===!0?"":""+n,s?t.setAttributeNS(s,e,n):t.setAttribute(e,n))))}var ls=jS.__SECRET_INTERNALS_DO_NOT_USE_OR_YOU_WILL_BE_FIRED,_c=Symbol.for("react.element"),ni=Symbol.for("react.portal"),si=Symbol.for("react.fragment"),d_=Symbol.for("react.strict_mode"),$d=Symbol.for("react.profiler"),GS=Symbol.for("react.provider"),XS=Symbol.for("react.context"),p_=Symbol.for("react.forward_ref"),Kd=Symbol.for("react.suspense"),Yd=Symbol.for("react.suspense_list"),g_=Symbol.for("react.memo"),As=Symbol.for("react.lazy"),$S=Symbol.for("react.offscreen"),Ry=Symbol.iterator;function mo(t){return t===null||typeof t!="object"?null:(t=Ry&&t[Ry]||t["@@iterator"],typeof t=="function"?t:null)}var we=Object.assign,hf;function Lo(t){if(hf===void 0)try{throw Error()}catch(n){var e=n.stack.trim().match(/\n( *(at )?)/);hf=e&&e[1]||""}return`
`+hf+t}var ff=!1;function df(t,e){if(!t||ff)return"";ff=!0;var n=Error.prepareStackTrace;Error.prepareStackTrace=void 0;try{if(e)if(e=function(){throw Error()},Object.defineProperty(e.prototype,"props",{set:function(){throw Error()}}),typeof Reflect=="object"&&Reflect.construct){try{Reflect.construct(e,[])}catch(l){var s=l}Reflect.construct(t,[],e)}else{try{e.call()}catch(l){s=l}t.call(e.prototype)}else{try{throw Error()}catch(l){s=l}t()}}catch(l){if(l&&s&&typeof l.stack=="string"){for(var r=l.stack.split(`
`),i=s.stack.split(`
`),o=r.length-1,a=i.length-1;1<=o&&0<=a&&r[o]!==i[a];)a--;for(;1<=o&&0<=a;o--,a--)if(r[o]!==i[a]){if(o!==1||a!==1)do if(o--,a--,0>a||r[o]!==i[a]){var c=`
`+r[o].replace(" at new "," at ");return t.displayName&&c.includes("<anonymous>")&&(c=c.replace("<anonymous>",t.displayName)),c}while(1<=o&&0<=a);break}}}finally{ff=!1,Error.prepareStackTrace=n}return(t=t?t.displayName||t.name:"")?Lo(t):""}function vI(t){switch(t.tag){case 5:return Lo(t.type);case 16:return Lo("Lazy");case 13:return Lo("Suspense");case 19:return Lo("SuspenseList");case 0:case 2:case 15:return t=df(t.type,!1),t;case 11:return t=df(t.type.render,!1),t;case 1:return t=df(t.type,!0),t;default:return""}}function Jd(t){if(t==null)return null;if(typeof t=="function")return t.displayName||t.name||null;if(typeof t=="string")return t;switch(t){case si:return"Fragment";case ni:return"Portal";case $d:return"Profiler";case d_:return"StrictMode";case Kd:return"Suspense";case Yd:return"SuspenseList"}if(typeof t=="object")switch(t.$$typeof){case XS:return(t.displayName||"Context")+".Consumer";case GS:return(t._context.displayName||"Context")+".Provider";case p_:var e=t.render;return t=t.displayName,t||(t=e.displayName||e.name||"",t=t!==""?"ForwardRef("+t+")":"ForwardRef"),t;case g_:return e=t.displayName||null,e!==null?e:Jd(t.type)||"Memo";case As:e=t._payload,t=t._init;try{return Jd(t(e))}catch{}}return null}function wI(t){var e=t.type;switch(t.tag){case 24:return"Cache";case 9:return(e.displayName||"Context")+".Consumer";case 10:return(e._context.displayName||"Context")+".Provider";case 18:return"DehydratedFragment";case 11:return t=e.render,t=t.displayName||t.name||"",e.displayName||(t!==""?"ForwardRef("+t+")":"ForwardRef");case 7:return"Fragment";case 5:return e;case 4:return"Portal";case 3:return"Root";case 6:return"Text";case 16:return Jd(e);case 8:return e===d_?"StrictMode":"Mode";case 22:return"Offscreen";case 12:return"Profiler";case 21:return"Scope";case 13:return"Suspense";case 19:return"SuspenseList";case 25:return"TracingMarker";case 1:case 0:case 17:case 2:case 14:case 15:if(typeof e=="function")return e.displayName||e.name||null;if(typeof e=="string")return e}return null}function zs(t){switch(typeof t){case"boolean":case"number":case"string":case"undefined":return t;case"object":return t;default:return""}}function KS(t){var e=t.type;return(t=t.nodeName)&&t.toLowerCase()==="input"&&(e==="checkbox"||e==="radio")}function bI(t){var e=KS(t)?"checked":"value",n=Object.getOwnPropertyDescriptor(t.constructor.prototype,e),s=""+t[e];if(!t.hasOwnProperty(e)&&typeof n<"u"&&typeof n.get=="function"&&typeof n.set=="function"){var r=n.get,i=n.set;return Object.defineProperty(t,e,{configurable:!0,get:function(){return r.call(this)},set:function(o){s=""+o,i.call(this,o)}}),Object.defineProperty(t,e,{enumerable:n.enumerable}),{getValue:function(){return s},setValue:function(o){s=""+o},stopTracking:function(){t._valueTracker=null,delete t[e]}}}}function mc(t){t._valueTracker||(t._valueTracker=bI(t))}function YS(t){if(!t)return!1;var e=t._valueTracker;if(!e)return!0;var n=e.getValue(),s="";return t&&(s=KS(t)?t.checked?"true":"false":t.value),t=s,t!==n?(e.setValue(t),!0):!1}function kl(t){if(t=t||(typeof document<"u"?document:void 0),typeof t>"u")return null;try{return t.activeElement||t.body}catch{return t.body}}function qd(t,e){var n=e.checked;return we({},e,{defaultChecked:void 0,defaultValue:void 0,value:void 0,checked:n??t._wrapperState.initialChecked})}function Iy(t,e){var n=e.defaultValue==null?"":e.defaultValue,s=e.checked!=null?e.checked:e.defaultChecked;n=zs(e.value!=null?e.value:n),t._wrapperState={initialChecked:s,initialValue:n,controlled:e.type==="checkbox"||e.type==="radio"?e.checked!=null:e.value!=null}}function JS(t,e){e=e.checked,e!=null&&f_(t,"checked",e,!1)}function Zd(t,e){JS(t,e);var n=zs(e.value),s=e.type;if(n!=null)s==="number"?(n===0&&t.value===""||t.value!=n)&&(t.value=""+n):t.value!==""+n&&(t.value=""+n);else if(s==="submit"||s==="reset"){t.removeAttribute("value");return}e.hasOwnProperty("value")?Qd(t,e.type,n):e.hasOwnProperty("defaultValue")&&Qd(t,e.type,zs(e.defaultValue)),e.checked==null&&e.defaultChecked!=null&&(t.defaultChecked=!!e.defaultChecked)}function Py(t,e,n){if(e.hasOwnProperty("value")||e.hasOwnProperty("defaultValue")){var s=e.type;if(!(s!=="submit"&&s!=="reset"||e.value!==void 0&&e.value!==null))return;e=""+t._wrapperState.initialValue,n||e===t.value||(t.value=e),t.defaultValue=e}n=t.name,n!==""&&(t.name=""),t.defaultChecked=!!t._wrapperState.initialChecked,n!==""&&(t.name=n)}function Qd(t,e,n){(e!=="number"||kl(t.ownerDocument)!==t)&&(n==null?t.defaultValue=""+t._wrapperState.initialValue:t.defaultValue!==""+n&&(t.defaultValue=""+n))}var Uo=Array.isArray;function bi(t,e,n,s){if(t=t.options,e){e={};for(var r=0;r<n.length;r++)e["$"+n[r]]=!0;for(n=0;n<t.length;n++)r=e.hasOwnProperty("$"+t[n].value),t[n].selected!==r&&(t[n].selected=r),r&&s&&(t[n].defaultSelected=!0)}else{for(n=""+zs(n),e=null,r=0;r<t.length;r++){if(t[r].value===n){t[r].selected=!0,s&&(t[r].defaultSelected=!0);return}e!==null||t[r].disabled||(e=t[r])}e!==null&&(e.selected=!0)}}function ep(t,e){if(e.dangerouslySetInnerHTML!=null)throw Error(k(91));return we({},e,{value:void 0,defaultValue:void 0,children:""+t._wrapperState.initialValue})}function xy(t,e){var n=e.value;if(n==null){if(n=e.children,e=e.defaultValue,n!=null){if(e!=null)throw Error(k(92));if(Uo(n)){if(1<n.length)throw Error(k(93));n=n[0]}e=n}e==null&&(e=""),n=e}t._wrapperState={initialValue:zs(n)}}function qS(t,e){var n=zs(e.value),s=zs(e.defaultValue);n!=null&&(n=""+n,n!==t.value&&(t.value=n),e.defaultValue==null&&t.defaultValue!==n&&(t.defaultValue=n)),s!=null&&(t.defaultValue=""+s)}function My(t){var e=t.textContent;e===t._wrapperState.initialValue&&e!==""&&e!==null&&(t.value=e)}function ZS(t){switch(t){case"svg":return"http://www.w3.org/2000/svg";case"math":return"http://www.w3.org/1998/Math/MathML";default:return"http://www.w3.org/1999/xhtml"}}function tp(t,e){return t==null||t==="http://www.w3.org/1999/xhtml"?ZS(e):t==="http://www.w3.org/2000/svg"&&e==="foreignObject"?"http://www.w3.org/1999/xhtml":t}var yc,QS=function(t){return typeof MSApp<"u"&&MSApp.execUnsafeLocalFunction?function(e,n,s,r){MSApp.execUnsafeLocalFunction(function(){return t(e,n,s,r)})}:t}(function(t,e){if(t.namespaceURI!=="http://www.w3.org/2000/svg"||"innerHTML"in t)t.innerHTML=e;else{for(yc=yc||document.createElement("div"),yc.innerHTML="<svg>"+e.valueOf().toString()+"</svg>",e=yc.firstChild;t.firstChild;)t.removeChild(t.firstChild);for(;e.firstChild;)t.appendChild(e.firstChild)}});function ma(t,e){if(e){var n=t.firstChild;if(n&&n===t.lastChild&&n.nodeType===3){n.nodeValue=e;return}}t.textContent=e}var Yo={animationIterationCount:!0,aspectRatio:!0,borderImageOutset:!0,borderImageSlice:!0,borderImageWidth:!0,boxFlex:!0,boxFlexGroup:!0,boxOrdinalGroup:!0,columnCount:!0,columns:!0,flex:!0,flexGrow:!0,flexPositive:!0,flexShrink:!0,flexNegative:!0,flexOrder:!0,gridArea:!0,gridRow:!0,gridRowEnd:!0,gridRowSpan:!0,gridRowStart:!0,gridColumn:!0,gridColumnEnd:!0,gridColumnSpan:!0,gridColumnStart:!0,fontWeight:!0,lineClamp:!0,lineHeight:!0,opacity:!0,order:!0,orphans:!0,tabSize:!0,widows:!0,zIndex:!0,zoom:!0,fillOpacity:!0,floodOpacity:!0,stopOpacity:!0,strokeDasharray:!0,strokeDashoffset:!0,strokeMiterlimit:!0,strokeOpacity:!0,strokeWidth:!0},RI=["Webkit","ms","Moz","O"];Object.keys(Yo).forEach(function(t){RI.forEach(function(e){e=e+t.charAt(0).toUpperCase()+t.substring(1),Yo[e]=Yo[t]})});function eC(t,e,n){return e==null||typeof e=="boolean"||e===""?"":n||typeof e!="number"||e===0||Yo.hasOwnProperty(t)&&Yo[t]?(""+e).trim():e+"px"}function tC(t,e){t=t.style;for(var n in e)if(e.hasOwnProperty(n)){var s=n.indexOf("--")===0,r=eC(n,e[n],s);n==="float"&&(n="cssFloat"),s?t.setProperty(n,r):t[n]=r}}var II=we({menuitem:!0},{area:!0,base:!0,br:!0,col:!0,embed:!0,hr:!0,img:!0,input:!0,keygen:!0,link:!0,meta:!0,param:!0,source:!0,track:!0,wbr:!0});function np(t,e){if(e){if(II[t]&&(e.children!=null||e.dangerouslySetInnerHTML!=null))throw Error(k(137,t));if(e.dangerouslySetInnerHTML!=null){if(e.children!=null)throw Error(k(60));if(typeof e.dangerouslySetInnerHTML!="object"||!("__html"in e.dangerouslySetInnerHTML))throw Error(k(61))}if(e.style!=null&&typeof e.style!="object")throw Error(k(62))}}function sp(t,e){if(t.indexOf("-")===-1)return typeof e.is=="string";switch(t){case"annotation-xml":case"color-profile":case"font-face":case"font-face-src":case"font-face-uri":case"font-face-format":case"font-face-name":case"missing-glyph":return!1;default:return!0}}var rp=null;function __(t){return t=t.target||t.srcElement||window,t.correspondingUseElement&&(t=t.correspondingUseElement),t.nodeType===3?t.parentNode:t}var ip=null,Ri=null,Ii=null;function By(t){if(t=Ya(t)){if(typeof ip!="function")throw Error(k(280));var e=t.stateNode;e&&(e=Sh(e),ip(t.stateNode,t.type,e))}}function nC(t){Ri?Ii?Ii.push(t):Ii=[t]:Ri=t}function sC(){if(Ri){var t=Ri,e=Ii;if(Ii=Ri=null,By(t),e)for(t=0;t<e.length;t++)By(e[t])}}function rC(t,e){return t(e)}function iC(){}var pf=!1;function oC(t,e,n){if(pf)return t(e,n);pf=!0;try{return rC(t,e,n)}finally{pf=!1,(Ri!==null||Ii!==null)&&(iC(),sC())}}function ya(t,e){var n=t.stateNode;if(n===null)return null;var s=Sh(n);if(s===null)return null;n=s[e];e:switch(e){case"onClick":case"onClickCapture":case"onDoubleClick":case"onDoubleClickCapture":case"onMouseDown":case"onMouseDownCapture":case"onMouseMove":case"onMouseMoveCapture":case"onMouseUp":case"onMouseUpCapture":case"onMouseEnter":(s=!s.disabled)||(t=t.type,s=!(t==="button"||t==="input"||t==="select"||t==="textarea")),t=!s;break e;default:t=!1}if(t)return null;if(n&&typeof n!="function")throw Error(k(231,e,typeof n));return n}var op=!1;if(ts)try{var yo={};Object.defineProperty(yo,"passive",{get:function(){op=!0}}),window.addEventListener("test",yo,yo),window.removeEventListener("test",yo,yo)}catch{op=!1}function PI(t,e,n,s,r,i,o,a,c){var l=Array.prototype.slice.call(arguments,3);try{e.apply(n,l)}catch(u){this.onError(u)}}var Jo=!1,zl=null,Vl=!1,ap=null,xI={onError:function(t){Jo=!0,zl=t}};function MI(t,e,n,s,r,i,o,a,c){Jo=!1,zl=null,PI.apply(xI,arguments)}function BI(t,e,n,s,r,i,o,a,c){if(MI.apply(this,arguments),Jo){if(Jo){var l=zl;Jo=!1,zl=null}else throw Error(k(198));Vl||(Vl=!0,ap=l)}}function Dr(t){var e=t,n=t;if(t.alternate)for(;e.return;)e=e.return;else{t=e;do e=t,e.flags&4098&&(n=e.return),t=e.return;while(t)}return e.tag===3?n:null}function aC(t){if(t.tag===13){var e=t.memoizedState;if(e===null&&(t=t.alternate,t!==null&&(e=t.memoizedState)),e!==null)return e.dehydrated}return null}function Oy(t){if(Dr(t)!==t)throw Error(k(188))}function OI(t){var e=t.alternate;if(!e){if(e=Dr(t),e===null)throw Error(k(188));return e!==t?null:t}for(var n=t,s=e;;){var r=n.return;if(r===null)break;var i=r.alternate;if(i===null){if(s=r.return,s!==null){n=s;continue}break}if(r.child===i.child){for(i=r.child;i;){if(i===n)return Oy(r),t;if(i===s)return Oy(r),e;i=i.sibling}throw Error(k(188))}if(n.return!==s.return)n=r,s=i;else{for(var o=!1,a=r.child;a;){if(a===n){o=!0,n=r,s=i;break}if(a===s){o=!0,s=r,n=i;break}a=a.sibling}if(!o){for(a=i.child;a;){if(a===n){o=!0,n=i,s=r;break}if(a===s){o=!0,s=i,n=r;break}a=a.sibling}if(!o)throw Error(k(189))}}if(n.alternate!==s)throw Error(k(190))}if(n.tag!==3)throw Error(k(188));return n.stateNode.current===n?t:e}function cC(t){return t=OI(t),t!==null?lC(t):null}function lC(t){if(t.tag===5||t.tag===6)return t;for(t=t.child;t!==null;){var e=lC(t);if(e!==null)return e;t=t.sibling}return null}var uC=Mt.unstable_scheduleCallback,Ny=Mt.unstable_cancelCallback,NI=Mt.unstable_shouldYield,FI=Mt.unstable_requestPaint,xe=Mt.unstable_now,DI=Mt.unstable_getCurrentPriorityLevel,m_=Mt.unstable_ImmediatePriority,hC=Mt.unstable_UserBlockingPriority,Hl=Mt.unstable_NormalPriority,LI=Mt.unstable_LowPriority,fC=Mt.unstable_IdlePriority,yh=null,Dn=null;function UI(t){if(Dn&&typeof Dn.onCommitFiberRoot=="function")try{Dn.onCommitFiberRoot(yh,t,void 0,(t.current.flags&128)===128)}catch{}}var pn=Math.clz32?Math.clz32:VI,kI=Math.log,zI=Math.LN2;function VI(t){return t>>>=0,t===0?32:31-(kI(t)/zI|0)|0}var Ac=64,Tc=4194304;function ko(t){switch(t&-t){case 1:return 1;case 2:return 2;case 4:return 4;case 8:return 8;case 16:return 16;case 32:return 32;case 64:case 128:case 256:case 512:case 1024:case 2048:case 4096:case 8192:case 16384:case 32768:case 65536:case 131072:case 262144:case 524288:case 1048576:case 2097152:return t&4194240;case 4194304:case 8388608:case 16777216:case 33554432:case 67108864:return t&130023424;case 134217728:return 134217728;case 268435456:return 268435456;case 536870912:return 536870912;case 1073741824:return 1073741824;default:return t}}function jl(t,e){var n=t.pendingLanes;if(n===0)return 0;var s=0,r=t.suspendedLanes,i=t.pingedLanes,o=n&268435455;if(o!==0){var a=o&~r;a!==0?s=ko(a):(i&=o,i!==0&&(s=ko(i)))}else o=n&~r,o!==0?s=ko(o):i!==0&&(s=ko(i));if(s===0)return 0;if(e!==0&&e!==s&&!(e&r)&&(r=s&-s,i=e&-e,r>=i||r===16&&(i&4194240)!==0))return e;if(s&4&&(s|=n&16),e=t.entangledLanes,e!==0)for(t=t.entanglements,e&=s;0<e;)n=31-pn(e),r=1<<n,s|=t[n],e&=~r;return s}function HI(t,e){switch(t){case 1:case 2:case 4:return e+250;case 8:case 16:case 32:case 64:case 128:case 256:case 512:case 1024:case 2048:case 4096:case 8192:case 16384:case 32768:case 65536:case 131072:case 262144:case 524288:case 1048576:case 2097152:return e+5e3;case 4194304:case 8388608:case 16777216:case 33554432:case 67108864:return-1;case 134217728:case 268435456:case 536870912:case 1073741824:return-1;default:return-1}}function jI(t,e){for(var n=t.suspendedLanes,s=t.pingedLanes,r=t.expirationTimes,i=t.pendingLanes;0<i;){var o=31-pn(i),a=1<<o,c=r[o];c===-1?(!(a&n)||a&s)&&(r[o]=HI(a,e)):c<=e&&(t.expiredLanes|=a),i&=~a}}function cp(t){return t=t.pendingLanes&-1073741825,t!==0?t:t&1073741824?1073741824:0}function dC(){var t=Ac;return Ac<<=1,!(Ac&4194240)&&(Ac=64),t}function gf(t){for(var e=[],n=0;31>n;n++)e.push(t);return e}function $a(t,e,n){t.pendingLanes|=e,e!==536870912&&(t.suspendedLanes=0,t.pingedLanes=0),t=t.eventTimes,e=31-pn(e),t[e]=n}function WI(t,e){var n=t.pendingLanes&~e;t.pendingLanes=e,t.suspendedLanes=0,t.pingedLanes=0,t.expiredLanes&=e,t.mutableReadLanes&=e,t.entangledLanes&=e,e=t.entanglements;var s=t.eventTimes;for(t=t.expirationTimes;0<n;){var r=31-pn(n),i=1<<r;e[r]=0,s[r]=-1,t[r]=-1,n&=~i}}function y_(t,e){var n=t.entangledLanes|=e;for(t=t.entanglements;n;){var s=31-pn(n),r=1<<s;r&e|t[s]&e&&(t[s]|=e),n&=~r}}var ce=0;function pC(t){return t&=-t,1<t?4<t?t&268435455?16:536870912:4:1}var gC,A_,_C,mC,yC,lp=!1,Ec=[],xs=null,Ms=null,Bs=null,Aa=new Map,Ta=new Map,Cs=[],GI="mousedown mouseup touchcancel touchend touchstart auxclick dblclick pointercancel pointerdown pointerup dragend dragstart drop compositionend compositionstart keydown keypress keyup input textInput copy cut paste click change contextmenu reset submit".split(" ");function Fy(t,e){switch(t){case"focusin":case"focusout":xs=null;break;case"dragenter":case"dragleave":Ms=null;break;case"mouseover":case"mouseout":Bs=null;break;case"pointerover":case"pointerout":Aa.delete(e.pointerId);break;case"gotpointercapture":case"lostpointercapture":Ta.delete(e.pointerId)}}function Ao(t,e,n,s,r,i){return t===null||t.nativeEvent!==i?(t={blockedOn:e,domEventName:n,eventSystemFlags:s,nativeEvent:i,targetContainers:[r]},e!==null&&(e=Ya(e),e!==null&&A_(e)),t):(t.eventSystemFlags|=s,e=t.targetContainers,r!==null&&e.indexOf(r)===-1&&e.push(r),t)}function XI(t,e,n,s,r){switch(e){case"focusin":return xs=Ao(xs,t,e,n,s,r),!0;case"dragenter":return Ms=Ao(Ms,t,e,n,s,r),!0;case"mouseover":return Bs=Ao(Bs,t,e,n,s,r),!0;case"pointerover":var i=r.pointerId;return Aa.set(i,Ao(Aa.get(i)||null,t,e,n,s,r)),!0;case"gotpointercapture":return i=r.pointerId,Ta.set(i,Ao(Ta.get(i)||null,t,e,n,s,r)),!0}return!1}function AC(t){var e=fr(t.target);if(e!==null){var n=Dr(e);if(n!==null){if(e=n.tag,e===13){if(e=aC(n),e!==null){t.blockedOn=e,yC(t.priority,function(){_C(n)});return}}else if(e===3&&n.stateNode.current.memoizedState.isDehydrated){t.blockedOn=n.tag===3?n.stateNode.containerInfo:null;return}}}t.blockedOn=null}function ml(t){if(t.blockedOn!==null)return!1;for(var e=t.targetContainers;0<e.length;){var n=up(t.domEventName,t.eventSystemFlags,e[0],t.nativeEvent);if(n===null){n=t.nativeEvent;var s=new n.constructor(n.type,n);rp=s,n.target.dispatchEvent(s),rp=null}else return e=Ya(n),e!==null&&A_(e),t.blockedOn=n,!1;e.shift()}return!0}function Dy(t,e,n){ml(t)&&n.delete(e)}function $I(){lp=!1,xs!==null&&ml(xs)&&(xs=null),Ms!==null&&ml(Ms)&&(Ms=null),Bs!==null&&ml(Bs)&&(Bs=null),Aa.forEach(Dy),Ta.forEach(Dy)}function To(t,e){t.blockedOn===e&&(t.blockedOn=null,lp||(lp=!0,Mt.unstable_scheduleCallback(Mt.unstable_NormalPriority,$I)))}function Ea(t){function e(r){return To(r,t)}if(0<Ec.length){To(Ec[0],t);for(var n=1;n<Ec.length;n++){var s=Ec[n];s.blockedOn===t&&(s.blockedOn=null)}}for(xs!==null&&To(xs,t),Ms!==null&&To(Ms,t),Bs!==null&&To(Bs,t),Aa.forEach(e),Ta.forEach(e),n=0;n<Cs.length;n++)s=Cs[n],s.blockedOn===t&&(s.blockedOn=null);for(;0<Cs.length&&(n=Cs[0],n.blockedOn===null);)AC(n),n.blockedOn===null&&Cs.shift()}var Pi=ls.ReactCurrentBatchConfig,Wl=!0;function KI(t,e,n,s){var r=ce,i=Pi.transition;Pi.transition=null;try{ce=1,T_(t,e,n,s)}finally{ce=r,Pi.transition=i}}function YI(t,e,n,s){var r=ce,i=Pi.transition;Pi.transition=null;try{ce=4,T_(t,e,n,s)}finally{ce=r,Pi.transition=i}}function T_(t,e,n,s){if(Wl){var r=up(t,e,n,s);if(r===null)wf(t,e,s,Gl,n),Fy(t,s);else if(XI(r,t,e,n,s))s.stopPropagation();else if(Fy(t,s),e&4&&-1<GI.indexOf(t)){for(;r!==null;){var i=Ya(r);if(i!==null&&gC(i),i=up(t,e,n,s),i===null&&wf(t,e,s,Gl,n),i===r)break;r=i}r!==null&&s.stopPropagation()}else wf(t,e,s,null,n)}}var Gl=null;function up(t,e,n,s){if(Gl=null,t=__(s),t=fr(t),t!==null)if(e=Dr(t),e===null)t=null;else if(n=e.tag,n===13){if(t=aC(e),t!==null)return t;t=null}else if(n===3){if(e.stateNode.current.memoizedState.isDehydrated)return e.tag===3?e.stateNode.containerInfo:null;t=null}else e!==t&&(t=null);return Gl=t,null}function TC(t){switch(t){case"cancel":case"click":case"close":case"contextmenu":case"copy":case"cut":case"auxclick":case"dblclick":case"dragend":case"dragstart":case"drop":case"focusin":case"focusout":case"input":case"invalid":case"keydown":case"keypress":case"keyup":case"mousedown":case"mouseup":case"paste":case"pause":case"play":case"pointercancel":case"pointerdown":case"pointerup":case"ratechange":case"reset":case"resize":case"seeked":case"submit":case"touchcancel":case"touchend":case"touchstart":case"volumechange":case"change":case"selectionchange":case"textInput":case"compositionstart":case"compositionend":case"compositionupdate":case"beforeblur":case"afterblur":case"beforeinput":case"blur":case"fullscreenchange":case"focus":case"hashchange":case"popstate":case"select":case"selectstart":return 1;case"drag":case"dragenter":case"dragexit":case"dragleave":case"dragover":case"mousemove":case"mouseout":case"mouseover":case"pointermove":case"pointerout":case"pointerover":case"scroll":case"toggle":case"touchmove":case"wheel":case"mouseenter":case"mouseleave":case"pointerenter":case"pointerleave":return 4;case"message":switch(DI()){case m_:return 1;case hC:return 4;case Hl:case LI:return 16;case fC:return 536870912;default:return 16}default:return 16}}var ws=null,E_=null,yl=null;function EC(){if(yl)return yl;var t,e=E_,n=e.length,s,r="value"in ws?ws.value:ws.textContent,i=r.length;for(t=0;t<n&&e[t]===r[t];t++);var o=n-t;for(s=1;s<=o&&e[n-s]===r[i-s];s++);return yl=r.slice(t,1<s?1-s:void 0)}function Al(t){var e=t.keyCode;return"charCode"in t?(t=t.charCode,t===0&&e===13&&(t=13)):t=e,t===10&&(t=13),32<=t||t===13?t:0}function Sc(){return!0}function Ly(){return!1}function Ot(t){function e(n,s,r,i,o){this._reactName=n,this._targetInst=r,this.type=s,this.nativeEvent=i,this.target=o,this.currentTarget=null;for(var a in t)t.hasOwnProperty(a)&&(n=t[a],this[a]=n?n(i):i[a]);return this.isDefaultPrevented=(i.defaultPrevented!=null?i.defaultPrevented:i.returnValue===!1)?Sc:Ly,this.isPropagationStopped=Ly,this}return we(e.prototype,{preventDefault:function(){this.defaultPrevented=!0;var n=this.nativeEvent;n&&(n.preventDefault?n.preventDefault():typeof n.returnValue!="unknown"&&(n.returnValue=!1),this.isDefaultPrevented=Sc)},stopPropagation:function(){var n=this.nativeEvent;n&&(n.stopPropagation?n.stopPropagation():typeof n.cancelBubble!="unknown"&&(n.cancelBubble=!0),this.isPropagationStopped=Sc)},persist:function(){},isPersistent:Sc}),e}var no={eventPhase:0,bubbles:0,cancelable:0,timeStamp:function(t){return t.timeStamp||Date.now()},defaultPrevented:0,isTrusted:0},S_=Ot(no),Ka=we({},no,{view:0,detail:0}),JI=Ot(Ka),_f,mf,Eo,Ah=we({},Ka,{screenX:0,screenY:0,clientX:0,clientY:0,pageX:0,pageY:0,ctrlKey:0,shiftKey:0,altKey:0,metaKey:0,getModifierState:C_,button:0,buttons:0,relatedTarget:function(t){return t.relatedTarget===void 0?t.fromElement===t.srcElement?t.toElement:t.fromElement:t.relatedTarget},movementX:function(t){return"movementX"in t?t.movementX:(t!==Eo&&(Eo&&t.type==="mousemove"?(_f=t.screenX-Eo.screenX,mf=t.screenY-Eo.screenY):mf=_f=0,Eo=t),_f)},movementY:function(t){return"movementY"in t?t.movementY:mf}}),Uy=Ot(Ah),qI=we({},Ah,{dataTransfer:0}),ZI=Ot(qI),QI=we({},Ka,{relatedTarget:0}),yf=Ot(QI),eP=we({},no,{animationName:0,elapsedTime:0,pseudoElement:0}),tP=Ot(eP),nP=we({},no,{clipboardData:function(t){return"clipboardData"in t?t.clipboardData:window.clipboardData}}),sP=Ot(nP),rP=we({},no,{data:0}),ky=Ot(rP),iP={Esc:"Escape",Spacebar:" ",Left:"ArrowLeft",Up:"ArrowUp",Right:"ArrowRight",Down:"ArrowDown",Del:"Delete",Win:"OS",Menu:"ContextMenu",Apps:"ContextMenu",Scroll:"ScrollLock",MozPrintableKey:"Unidentified"},oP={8:"Backspace",9:"Tab",12:"Clear",13:"Enter",16:"Shift",17:"Control",18:"Alt",19:"Pause",20:"CapsLock",27:"Escape",32:" ",33:"PageUp",34:"PageDown",35:"End",36:"Home",37:"ArrowLeft",38:"ArrowUp",39:"ArrowRight",40:"ArrowDown",45:"Insert",46:"Delete",112:"F1",113:"F2",114:"F3",115:"F4",116:"F5",117:"F6",118:"F7",119:"F8",120:"F9",121:"F10",122:"F11",123:"F12",144:"NumLock",145:"ScrollLock",224:"Meta"},aP={Alt:"altKey",Control:"ctrlKey",Meta:"metaKey",Shift:"shiftKey"};function cP(t){var e=this.nativeEvent;return e.getModifierState?e.getModifierState(t):(t=aP[t])?!!e[t]:!1}function C_(){return cP}var lP=we({},Ka,{key:function(t){if(t.key){var e=iP[t.key]||t.key;if(e!=="Unidentified")return e}return t.type==="keypress"?(t=Al(t),t===13?"Enter":String.fromCharCode(t)):t.type==="keydown"||t.type==="keyup"?oP[t.keyCode]||"Unidentified":""},code:0,location:0,ctrlKey:0,shiftKey:0,altKey:0,metaKey:0,repeat:0,locale:0,getModifierState:C_,charCode:function(t){return t.type==="keypress"?Al(t):0},keyCode:function(t){return t.type==="keydown"||t.type==="keyup"?t.keyCode:0},which:function(t){return t.type==="keypress"?Al(t):t.type==="keydown"||t.type==="keyup"?t.keyCode:0}}),uP=Ot(lP),hP=we({},Ah,{pointerId:0,width:0,height:0,pressure:0,tangentialPressure:0,tiltX:0,tiltY:0,twist:0,pointerType:0,isPrimary:0}),zy=Ot(hP),fP=we({},Ka,{touches:0,targetTouches:0,changedTouches:0,altKey:0,metaKey:0,ctrlKey:0,shiftKey:0,getModifierState:C_}),dP=Ot(fP),pP=we({},no,{propertyName:0,elapsedTime:0,pseudoElement:0}),gP=Ot(pP),_P=we({},Ah,{deltaX:function(t){return"deltaX"in t?t.deltaX:"wheelDeltaX"in t?-t.wheelDeltaX:0},deltaY:function(t){return"deltaY"in t?t.deltaY:"wheelDeltaY"in t?-t.wheelDeltaY:"wheelDelta"in t?-t.wheelDelta:0},deltaZ:0,deltaMode:0}),mP=Ot(_P),yP=[9,13,27,32],v_=ts&&"CompositionEvent"in window,qo=null;ts&&"documentMode"in document&&(qo=document.documentMode);var AP=ts&&"TextEvent"in window&&!qo,SC=ts&&(!v_||qo&&8<qo&&11>=qo),Vy=String.fromCharCode(32),Hy=!1;function CC(t,e){switch(t){case"keyup":return yP.indexOf(e.keyCode)!==-1;case"keydown":return e.keyCode!==229;case"keypress":case"mousedown":case"focusout":return!0;default:return!1}}function vC(t){return t=t.detail,typeof t=="object"&&"data"in t?t.data:null}var ri=!1;function TP(t,e){switch(t){case"compositionend":return vC(e);case"keypress":return e.which!==32?null:(Hy=!0,Vy);case"textInput":return t=e.data,t===Vy&&Hy?null:t;default:return null}}function EP(t,e){if(ri)return t==="compositionend"||!v_&&CC(t,e)?(t=EC(),yl=E_=ws=null,ri=!1,t):null;switch(t){case"paste":return null;case"keypress":if(!(e.ctrlKey||e.altKey||e.metaKey)||e.ctrlKey&&e.altKey){if(e.char&&1<e.char.length)return e.char;if(e.which)return String.fromCharCode(e.which)}return null;case"compositionend":return SC&&e.locale!=="ko"?null:e.data;default:return null}}var SP={color:!0,date:!0,datetime:!0,"datetime-local":!0,email:!0,month:!0,number:!0,password:!0,range:!0,search:!0,tel:!0,text:!0,time:!0,url:!0,week:!0};function jy(t){var e=t&&t.nodeName&&t.nodeName.toLowerCase();return e==="input"?!!SP[t.type]:e==="textarea"}function wC(t,e,n,s){nC(s),e=Xl(e,"onChange"),0<e.length&&(n=new S_("onChange","change",null,n,s),t.push({event:n,listeners:e}))}var Zo=null,Sa=null;function CP(t){DC(t,0)}function Th(t){var e=ai(t);if(YS(e))return t}function vP(t,e){if(t==="change")return e}var bC=!1;if(ts){var Af;if(ts){var Tf="oninput"in document;if(!Tf){var Wy=document.createElement("div");Wy.setAttribute("oninput","return;"),Tf=typeof Wy.oninput=="function"}Af=Tf}else Af=!1;bC=Af&&(!document.documentMode||9<document.documentMode)}function Gy(){Zo&&(Zo.detachEvent("onpropertychange",RC),Sa=Zo=null)}function RC(t){if(t.propertyName==="value"&&Th(Sa)){var e=[];wC(e,Sa,t,__(t)),oC(CP,e)}}function wP(t,e,n){t==="focusin"?(Gy(),Zo=e,Sa=n,Zo.attachEvent("onpropertychange",RC)):t==="focusout"&&Gy()}function bP(t){if(t==="selectionchange"||t==="keyup"||t==="keydown")return Th(Sa)}function RP(t,e){if(t==="click")return Th(e)}function IP(t,e){if(t==="input"||t==="change")return Th(e)}function PP(t,e){return t===e&&(t!==0||1/t===1/e)||t!==t&&e!==e}var mn=typeof Object.is=="function"?Object.is:PP;function Ca(t,e){if(mn(t,e))return!0;if(typeof t!="object"||t===null||typeof e!="object"||e===null)return!1;var n=Object.keys(t),s=Object.keys(e);if(n.length!==s.length)return!1;for(s=0;s<n.length;s++){var r=n[s];if(!Xd.call(e,r)||!mn(t[r],e[r]))return!1}return!0}function Xy(t){for(;t&&t.firstChild;)t=t.firstChild;return t}function $y(t,e){var n=Xy(t);t=0;for(var s;n;){if(n.nodeType===3){if(s=t+n.textContent.length,t<=e&&s>=e)return{node:n,offset:e-t};t=s}e:{for(;n;){if(n.nextSibling){n=n.nextSibling;break e}n=n.parentNode}n=void 0}n=Xy(n)}}function IC(t,e){return t&&e?t===e?!0:t&&t.nodeType===3?!1:e&&e.nodeType===3?IC(t,e.parentNode):"contains"in t?t.contains(e):t.compareDocumentPosition?!!(t.compareDocumentPosition(e)&16):!1:!1}function PC(){for(var t=window,e=kl();e instanceof t.HTMLIFrameElement;){try{var n=typeof e.contentWindow.location.href=="string"}catch{n=!1}if(n)t=e.contentWindow;else break;e=kl(t.document)}return e}function w_(t){var e=t&&t.nodeName&&t.nodeName.toLowerCase();return e&&(e==="input"&&(t.type==="text"||t.type==="search"||t.type==="tel"||t.type==="url"||t.type==="password")||e==="textarea"||t.contentEditable==="true")}function xP(t){var e=PC(),n=t.focusedElem,s=t.selectionRange;if(e!==n&&n&&n.ownerDocument&&IC(n.ownerDocument.documentElement,n)){if(s!==null&&w_(n)){if(e=s.start,t=s.end,t===void 0&&(t=e),"selectionStart"in n)n.selectionStart=e,n.selectionEnd=Math.min(t,n.value.length);else if(t=(e=n.ownerDocument||document)&&e.defaultView||window,t.getSelection){t=t.getSelection();var r=n.textContent.length,i=Math.min(s.start,r);s=s.end===void 0?i:Math.min(s.end,r),!t.extend&&i>s&&(r=s,s=i,i=r),r=$y(n,i);var o=$y(n,s);r&&o&&(t.rangeCount!==1||t.anchorNode!==r.node||t.anchorOffset!==r.offset||t.focusNode!==o.node||t.focusOffset!==o.offset)&&(e=e.createRange(),e.setStart(r.node,r.offset),t.removeAllRanges(),i>s?(t.addRange(e),t.extend(o.node,o.offset)):(e.setEnd(o.node,o.offset),t.addRange(e)))}}for(e=[],t=n;t=t.parentNode;)t.nodeType===1&&e.push({element:t,left:t.scrollLeft,top:t.scrollTop});for(typeof n.focus=="function"&&n.focus(),n=0;n<e.length;n++)t=e[n],t.element.scrollLeft=t.left,t.element.scrollTop=t.top}}var MP=ts&&"documentMode"in document&&11>=document.documentMode,ii=null,hp=null,Qo=null,fp=!1;function Ky(t,e,n){var s=n.window===n?n.document:n.nodeType===9?n:n.ownerDocument;fp||ii==null||ii!==kl(s)||(s=ii,"selectionStart"in s&&w_(s)?s={start:s.selectionStart,end:s.selectionEnd}:(s=(s.ownerDocument&&s.ownerDocument.defaultView||window).getSelection(),s={anchorNode:s.anchorNode,anchorOffset:s.anchorOffset,focusNode:s.focusNode,focusOffset:s.focusOffset}),Qo&&Ca(Qo,s)||(Qo=s,s=Xl(hp,"onSelect"),0<s.length&&(e=new S_("onSelect","select",null,e,n),t.push({event:e,listeners:s}),e.target=ii)))}function Cc(t,e){var n={};return n[t.toLowerCase()]=e.toLowerCase(),n["Webkit"+t]="webkit"+e,n["Moz"+t]="moz"+e,n}var oi={animationend:Cc("Animation","AnimationEnd"),animationiteration:Cc("Animation","AnimationIteration"),animationstart:Cc("Animation","AnimationStart"),transitionend:Cc("Transition","TransitionEnd")},Ef={},xC={};ts&&(xC=document.createElement("div").style,"AnimationEvent"in window||(delete oi.animationend.animation,delete oi.animationiteration.animation,delete oi.animationstart.animation),"TransitionEvent"in window||delete oi.transitionend.transition);function Eh(t){if(Ef[t])return Ef[t];if(!oi[t])return t;var e=oi[t],n;for(n in e)if(e.hasOwnProperty(n)&&n in xC)return Ef[t]=e[n];return t}var MC=Eh("animationend"),BC=Eh("animationiteration"),OC=Eh("animationstart"),NC=Eh("transitionend"),FC=new Map,Yy="abort auxClick cancel canPlay canPlayThrough click close contextMenu copy cut drag dragEnd dragEnter dragExit dragLeave dragOver dragStart drop durationChange emptied encrypted ended error gotPointerCapture input invalid keyDown keyPress keyUp load loadedData loadedMetadata loadStart lostPointerCapture mouseDown mouseMove mouseOut mouseOver mouseUp paste pause play playing pointerCancel pointerDown pointerMove pointerOut pointerOver pointerUp progress rateChange reset resize seeked seeking stalled submit suspend timeUpdate touchCancel touchEnd touchStart volumeChange scroll toggle touchMove waiting wheel".split(" ");function Xs(t,e){FC.set(t,e),Fr(e,[t])}for(var Sf=0;Sf<Yy.length;Sf++){var Cf=Yy[Sf],BP=Cf.toLowerCase(),OP=Cf[0].toUpperCase()+Cf.slice(1);Xs(BP,"on"+OP)}Xs(MC,"onAnimationEnd");Xs(BC,"onAnimationIteration");Xs(OC,"onAnimationStart");Xs("dblclick","onDoubleClick");Xs("focusin","onFocus");Xs("focusout","onBlur");Xs(NC,"onTransitionEnd");Li("onMouseEnter",["mouseout","mouseover"]);Li("onMouseLeave",["mouseout","mouseover"]);Li("onPointerEnter",["pointerout","pointerover"]);Li("onPointerLeave",["pointerout","pointerover"]);Fr("onChange","change click focusin focusout input keydown keyup selectionchange".split(" "));Fr("onSelect","focusout contextmenu dragend focusin keydown keyup mousedown mouseup selectionchange".split(" "));Fr("onBeforeInput",["compositionend","keypress","textInput","paste"]);Fr("onCompositionEnd","compositionend focusout keydown keypress keyup mousedown".split(" "));Fr("onCompositionStart","compositionstart focusout keydown keypress keyup mousedown".split(" "));Fr("onCompositionUpdate","compositionupdate focusout keydown keypress keyup mousedown".split(" "));var zo="abort canplay canplaythrough durationchange emptied encrypted ended error loadeddata loadedmetadata loadstart pause play playing progress ratechange resize seeked seeking stalled suspend timeupdate volumechange waiting".split(" "),NP=new Set("cancel close invalid load scroll toggle".split(" ").concat(zo));function Jy(t,e,n){var s=t.type||"unknown-event";t.currentTarget=n,BI(s,e,void 0,t),t.currentTarget=null}function DC(t,e){e=(e&4)!==0;for(var n=0;n<t.length;n++){var s=t[n],r=s.event;s=s.listeners;e:{var i=void 0;if(e)for(var o=s.length-1;0<=o;o--){var a=s[o],c=a.instance,l=a.currentTarget;if(a=a.listener,c!==i&&r.isPropagationStopped())break e;Jy(r,a,l),i=c}else for(o=0;o<s.length;o++){if(a=s[o],c=a.instance,l=a.currentTarget,a=a.listener,c!==i&&r.isPropagationStopped())break e;Jy(r,a,l),i=c}}}if(Vl)throw t=ap,Vl=!1,ap=null,t}function _e(t,e){var n=e[mp];n===void 0&&(n=e[mp]=new Set);var s=t+"__bubble";n.has(s)||(LC(e,t,2,!1),n.add(s))}function vf(t,e,n){var s=0;e&&(s|=4),LC(n,t,s,e)}var vc="_reactListening"+Math.random().toString(36).slice(2);function va(t){if(!t[vc]){t[vc]=!0,WS.forEach(function(n){n!=="selectionchange"&&(NP.has(n)||vf(n,!1,t),vf(n,!0,t))});var e=t.nodeType===9?t:t.ownerDocument;e===null||e[vc]||(e[vc]=!0,vf("selectionchange",!1,e))}}function LC(t,e,n,s){switch(TC(e)){case 1:var r=KI;break;case 4:r=YI;break;default:r=T_}n=r.bind(null,e,n,t),r=void 0,!op||e!=="touchstart"&&e!=="touchmove"&&e!=="wheel"||(r=!0),s?r!==void 0?t.addEventListener(e,n,{capture:!0,passive:r}):t.addEventListener(e,n,!0):r!==void 0?t.addEventListener(e,n,{passive:r}):t.addEventListener(e,n,!1)}function wf(t,e,n,s,r){var i=s;if(!(e&1)&&!(e&2)&&s!==null)e:for(;;){if(s===null)return;var o=s.tag;if(o===3||o===4){var a=s.stateNode.containerInfo;if(a===r||a.nodeType===8&&a.parentNode===r)break;if(o===4)for(o=s.return;o!==null;){var c=o.tag;if((c===3||c===4)&&(c=o.stateNode.containerInfo,c===r||c.nodeType===8&&c.parentNode===r))return;o=o.return}for(;a!==null;){if(o=fr(a),o===null)return;if(c=o.tag,c===5||c===6){s=i=o;continue e}a=a.parentNode}}s=s.return}oC(function(){var l=i,u=__(n),h=[];e:{var f=FC.get(t);if(f!==void 0){var d=S_,g=t;switch(t){case"keypress":if(Al(n)===0)break e;case"keydown":case"keyup":d=uP;break;case"focusin":g="focus",d=yf;break;case"focusout":g="blur",d=yf;break;case"beforeblur":case"afterblur":d=yf;break;case"click":if(n.button===2)break e;case"auxclick":case"dblclick":case"mousedown":case"mousemove":case"mouseup":case"mouseout":case"mouseover":case"contextmenu":d=Uy;break;case"drag":case"dragend":case"dragenter":case"dragexit":case"dragleave":case"dragover":case"dragstart":case"drop":d=ZI;break;case"touchcancel":case"touchend":case"touchmove":case"touchstart":d=dP;break;case MC:case BC:case OC:d=tP;break;case NC:d=gP;break;case"scroll":d=JI;break;case"wheel":d=mP;break;case"copy":case"cut":case"paste":d=sP;break;case"gotpointercapture":case"lostpointercapture":case"pointercancel":case"pointerdown":case"pointermove":case"pointerout":case"pointerover":case"pointerup":d=zy}var _=(e&4)!==0,E=!_&&t==="scroll",m=_?f!==null?f+"Capture":null:f;_=[];for(var y=l,A;y!==null;){A=y;var C=A.stateNode;if(A.tag===5&&C!==null&&(A=C,m!==null&&(C=ya(y,m),C!=null&&_.push(wa(y,C,A)))),E)break;y=y.return}0<_.length&&(f=new d(f,g,null,n,u),h.push({event:f,listeners:_}))}}if(!(e&7)){e:{if(f=t==="mouseover"||t==="pointerover",d=t==="mouseout"||t==="pointerout",f&&n!==rp&&(g=n.relatedTarget||n.fromElement)&&(fr(g)||g[ns]))break e;if((d||f)&&(f=u.window===u?u:(f=u.ownerDocument)?f.defaultView||f.parentWindow:window,d?(g=n.relatedTarget||n.toElement,d=l,g=g?fr(g):null,g!==null&&(E=Dr(g),g!==E||g.tag!==5&&g.tag!==6)&&(g=null)):(d=null,g=l),d!==g)){if(_=Uy,C="onMouseLeave",m="onMouseEnter",y="mouse",(t==="pointerout"||t==="pointerover")&&(_=zy,C="onPointerLeave",m="onPointerEnter",y="pointer"),E=d==null?f:ai(d),A=g==null?f:ai(g),f=new _(C,y+"leave",d,n,u),f.target=E,f.relatedTarget=A,C=null,fr(u)===l&&(_=new _(m,y+"enter",g,n,u),_.target=A,_.relatedTarget=E,C=_),E=C,d&&g)t:{for(_=d,m=g,y=0,A=_;A;A=jr(A))y++;for(A=0,C=m;C;C=jr(C))A++;for(;0<y-A;)_=jr(_),y--;for(;0<A-y;)m=jr(m),A--;for(;y--;){if(_===m||m!==null&&_===m.alternate)break t;_=jr(_),m=jr(m)}_=null}else _=null;d!==null&&qy(h,f,d,_,!1),g!==null&&E!==null&&qy(h,E,g,_,!0)}}e:{if(f=l?ai(l):window,d=f.nodeName&&f.nodeName.toLowerCase(),d==="select"||d==="input"&&f.type==="file")var b=vP;else if(jy(f))if(bC)b=IP;else{b=bP;var P=wP}else(d=f.nodeName)&&d.toLowerCase()==="input"&&(f.type==="checkbox"||f.type==="radio")&&(b=RP);if(b&&(b=b(t,l))){wC(h,b,n,u);break e}P&&P(t,f,l),t==="focusout"&&(P=f._wrapperState)&&P.controlled&&f.type==="number"&&Qd(f,"number",f.value)}switch(P=l?ai(l):window,t){case"focusin":(jy(P)||P.contentEditable==="true")&&(ii=P,hp=l,Qo=null);break;case"focusout":Qo=hp=ii=null;break;case"mousedown":fp=!0;break;case"contextmenu":case"mouseup":case"dragend":fp=!1,Ky(h,n,u);break;case"selectionchange":if(MP)break;case"keydown":case"keyup":Ky(h,n,u)}var B;if(v_)e:{switch(t){case"compositionstart":var O="onCompositionStart";break e;case"compositionend":O="onCompositionEnd";break e;case"compositionupdate":O="onCompositionUpdate";break e}O=void 0}else ri?CC(t,n)&&(O="onCompositionEnd"):t==="keydown"&&n.keyCode===229&&(O="onCompositionStart");O&&(SC&&n.locale!=="ko"&&(ri||O!=="onCompositionStart"?O==="onCompositionEnd"&&ri&&(B=EC()):(ws=u,E_="value"in ws?ws.value:ws.textContent,ri=!0)),P=Xl(l,O),0<P.length&&(O=new ky(O,t,null,n,u),h.push({event:O,listeners:P}),B?O.data=B:(B=vC(n),B!==null&&(O.data=B)))),(B=AP?TP(t,n):EP(t,n))&&(l=Xl(l,"onBeforeInput"),0<l.length&&(u=new ky("onBeforeInput","beforeinput",null,n,u),h.push({event:u,listeners:l}),u.data=B))}DC(h,e)})}function wa(t,e,n){return{instance:t,listener:e,currentTarget:n}}function Xl(t,e){for(var n=e+"Capture",s=[];t!==null;){var r=t,i=r.stateNode;r.tag===5&&i!==null&&(r=i,i=ya(t,n),i!=null&&s.unshift(wa(t,i,r)),i=ya(t,e),i!=null&&s.push(wa(t,i,r))),t=t.return}return s}function jr(t){if(t===null)return null;do t=t.return;while(t&&t.tag!==5);return t||null}function qy(t,e,n,s,r){for(var i=e._reactName,o=[];n!==null&&n!==s;){var a=n,c=a.alternate,l=a.stateNode;if(c!==null&&c===s)break;a.tag===5&&l!==null&&(a=l,r?(c=ya(n,i),c!=null&&o.unshift(wa(n,c,a))):r||(c=ya(n,i),c!=null&&o.push(wa(n,c,a)))),n=n.return}o.length!==0&&t.push({event:e,listeners:o})}var FP=/\r\n?/g,DP=/\u0000|\uFFFD/g;function Zy(t){return(typeof t=="string"?t:""+t).replace(FP,`
`).replace(DP,"")}function wc(t,e,n){if(e=Zy(e),Zy(t)!==e&&n)throw Error(k(425))}function $l(){}var dp=null,pp=null;function gp(t,e){return t==="textarea"||t==="noscript"||typeof e.children=="string"||typeof e.children=="number"||typeof e.dangerouslySetInnerHTML=="object"&&e.dangerouslySetInnerHTML!==null&&e.dangerouslySetInnerHTML.__html!=null}var _p=typeof setTimeout=="function"?setTimeout:void 0,LP=typeof clearTimeout=="function"?clearTimeout:void 0,Qy=typeof Promise=="function"?Promise:void 0,UP=typeof queueMicrotask=="function"?queueMicrotask:typeof Qy<"u"?function(t){return Qy.resolve(null).then(t).catch(kP)}:_p;function kP(t){setTimeout(function(){throw t})}function bf(t,e){var n=e,s=0;do{var r=n.nextSibling;if(t.removeChild(n),r&&r.nodeType===8)if(n=r.data,n==="/$"){if(s===0){t.removeChild(r),Ea(e);return}s--}else n!=="$"&&n!=="$?"&&n!=="$!"||s++;n=r}while(n);Ea(e)}function Os(t){for(;t!=null;t=t.nextSibling){var e=t.nodeType;if(e===1||e===3)break;if(e===8){if(e=t.data,e==="$"||e==="$!"||e==="$?")break;if(e==="/$")return null}}return t}function eA(t){t=t.previousSibling;for(var e=0;t;){if(t.nodeType===8){var n=t.data;if(n==="$"||n==="$!"||n==="$?"){if(e===0)return t;e--}else n==="/$"&&e++}t=t.previousSibling}return null}var so=Math.random().toString(36).slice(2),Mn="__reactFiber$"+so,ba="__reactProps$"+so,ns="__reactContainer$"+so,mp="__reactEvents$"+so,zP="__reactListeners$"+so,VP="__reactHandles$"+so;function fr(t){var e=t[Mn];if(e)return e;for(var n=t.parentNode;n;){if(e=n[ns]||n[Mn]){if(n=e.alternate,e.child!==null||n!==null&&n.child!==null)for(t=eA(t);t!==null;){if(n=t[Mn])return n;t=eA(t)}return e}t=n,n=t.parentNode}return null}function Ya(t){return t=t[Mn]||t[ns],!t||t.tag!==5&&t.tag!==6&&t.tag!==13&&t.tag!==3?null:t}function ai(t){if(t.tag===5||t.tag===6)return t.stateNode;throw Error(k(33))}function Sh(t){return t[ba]||null}var yp=[],ci=-1;function $s(t){return{current:t}}function me(t){0>ci||(t.current=yp[ci],yp[ci]=null,ci--)}function ge(t,e){ci++,yp[ci]=t.current,t.current=e}var Vs={},nt=$s(Vs),yt=$s(!1),br=Vs;function Ui(t,e){var n=t.type.contextTypes;if(!n)return Vs;var s=t.stateNode;if(s&&s.__reactInternalMemoizedUnmaskedChildContext===e)return s.__reactInternalMemoizedMaskedChildContext;var r={},i;for(i in n)r[i]=e[i];return s&&(t=t.stateNode,t.__reactInternalMemoizedUnmaskedChildContext=e,t.__reactInternalMemoizedMaskedChildContext=r),r}function At(t){return t=t.childContextTypes,t!=null}function Kl(){me(yt),me(nt)}function tA(t,e,n){if(nt.current!==Vs)throw Error(k(168));ge(nt,e),ge(yt,n)}function UC(t,e,n){var s=t.stateNode;if(e=e.childContextTypes,typeof s.getChildContext!="function")return n;s=s.getChildContext();for(var r in s)if(!(r in e))throw Error(k(108,wI(t)||"Unknown",r));return we({},n,s)}function Yl(t){return t=(t=t.stateNode)&&t.__reactInternalMemoizedMergedChildContext||Vs,br=nt.current,ge(nt,t),ge(yt,yt.current),!0}function nA(t,e,n){var s=t.stateNode;if(!s)throw Error(k(169));n?(t=UC(t,e,br),s.__reactInternalMemoizedMergedChildContext=t,me(yt),me(nt),ge(nt,t)):me(yt),ge(yt,n)}var $n=null,Ch=!1,Rf=!1;function kC(t){$n===null?$n=[t]:$n.push(t)}function HP(t){Ch=!0,kC(t)}function Ks(){if(!Rf&&$n!==null){Rf=!0;var t=0,e=ce;try{var n=$n;for(ce=1;t<n.length;t++){var s=n[t];do s=s(!0);while(s!==null)}$n=null,Ch=!1}catch(r){throw $n!==null&&($n=$n.slice(t+1)),uC(m_,Ks),r}finally{ce=e,Rf=!1}}return null}var li=[],ui=0,Jl=null,ql=0,kt=[],zt=0,Rr=null,Kn=1,Yn="";function ar(t,e){li[ui++]=ql,li[ui++]=Jl,Jl=t,ql=e}function zC(t,e,n){kt[zt++]=Kn,kt[zt++]=Yn,kt[zt++]=Rr,Rr=t;var s=Kn;t=Yn;var r=32-pn(s)-1;s&=~(1<<r),n+=1;var i=32-pn(e)+r;if(30<i){var o=r-r%5;i=(s&(1<<o)-1).toString(32),s>>=o,r-=o,Kn=1<<32-pn(e)+r|n<<r|s,Yn=i+t}else Kn=1<<i|n<<r|s,Yn=t}function b_(t){t.return!==null&&(ar(t,1),zC(t,1,0))}function R_(t){for(;t===Jl;)Jl=li[--ui],li[ui]=null,ql=li[--ui],li[ui]=null;for(;t===Rr;)Rr=kt[--zt],kt[zt]=null,Yn=kt[--zt],kt[zt]=null,Kn=kt[--zt],kt[zt]=null}var xt=null,bt=null,ye=!1,sn=null;function VC(t,e){var n=Vt(5,null,null,0);n.elementType="DELETED",n.stateNode=e,n.return=t,e=t.deletions,e===null?(t.deletions=[n],t.flags|=16):e.push(n)}function sA(t,e){switch(t.tag){case 5:var n=t.type;return e=e.nodeType!==1||n.toLowerCase()!==e.nodeName.toLowerCase()?null:e,e!==null?(t.stateNode=e,xt=t,bt=Os(e.firstChild),!0):!1;case 6:return e=t.pendingProps===""||e.nodeType!==3?null:e,e!==null?(t.stateNode=e,xt=t,bt=null,!0):!1;case 13:return e=e.nodeType!==8?null:e,e!==null?(n=Rr!==null?{id:Kn,overflow:Yn}:null,t.memoizedState={dehydrated:e,treeContext:n,retryLane:1073741824},n=Vt(18,null,null,0),n.stateNode=e,n.return=t,t.child=n,xt=t,bt=null,!0):!1;default:return!1}}function Ap(t){return(t.mode&1)!==0&&(t.flags&128)===0}function Tp(t){if(ye){var e=bt;if(e){var n=e;if(!sA(t,e)){if(Ap(t))throw Error(k(418));e=Os(n.nextSibling);var s=xt;e&&sA(t,e)?VC(s,n):(t.flags=t.flags&-4097|2,ye=!1,xt=t)}}else{if(Ap(t))throw Error(k(418));t.flags=t.flags&-4097|2,ye=!1,xt=t}}}function rA(t){for(t=t.return;t!==null&&t.tag!==5&&t.tag!==3&&t.tag!==13;)t=t.return;xt=t}function bc(t){if(t!==xt)return!1;if(!ye)return rA(t),ye=!0,!1;var e;if((e=t.tag!==3)&&!(e=t.tag!==5)&&(e=t.type,e=e!=="head"&&e!=="body"&&!gp(t.type,t.memoizedProps)),e&&(e=bt)){if(Ap(t))throw HC(),Error(k(418));for(;e;)VC(t,e),e=Os(e.nextSibling)}if(rA(t),t.tag===13){if(t=t.memoizedState,t=t!==null?t.dehydrated:null,!t)throw Error(k(317));e:{for(t=t.nextSibling,e=0;t;){if(t.nodeType===8){var n=t.data;if(n==="/$"){if(e===0){bt=Os(t.nextSibling);break e}e--}else n!=="$"&&n!=="$!"&&n!=="$?"||e++}t=t.nextSibling}bt=null}}else bt=xt?Os(t.stateNode.nextSibling):null;return!0}function HC(){for(var t=bt;t;)t=Os(t.nextSibling)}function ki(){bt=xt=null,ye=!1}function I_(t){sn===null?sn=[t]:sn.push(t)}var jP=ls.ReactCurrentBatchConfig;function tn(t,e){if(t&&t.defaultProps){e=we({},e),t=t.defaultProps;for(var n in t)e[n]===void 0&&(e[n]=t[n]);return e}return e}var Zl=$s(null),Ql=null,hi=null,P_=null;function x_(){P_=hi=Ql=null}function M_(t){var e=Zl.current;me(Zl),t._currentValue=e}function Ep(t,e,n){for(;t!==null;){var s=t.alternate;if((t.childLanes&e)!==e?(t.childLanes|=e,s!==null&&(s.childLanes|=e)):s!==null&&(s.childLanes&e)!==e&&(s.childLanes|=e),t===n)break;t=t.return}}function xi(t,e){Ql=t,P_=hi=null,t=t.dependencies,t!==null&&t.firstContext!==null&&(t.lanes&e&&(_t=!0),t.firstContext=null)}function Yt(t){var e=t._currentValue;if(P_!==t)if(t={context:t,memoizedValue:e,next:null},hi===null){if(Ql===null)throw Error(k(308));hi=t,Ql.dependencies={lanes:0,firstContext:t}}else hi=hi.next=t;return e}var dr=null;function B_(t){dr===null?dr=[t]:dr.push(t)}function jC(t,e,n,s){var r=e.interleaved;return r===null?(n.next=n,B_(e)):(n.next=r.next,r.next=n),e.interleaved=n,ss(t,s)}function ss(t,e){t.lanes|=e;var n=t.alternate;for(n!==null&&(n.lanes|=e),n=t,t=t.return;t!==null;)t.childLanes|=e,n=t.alternate,n!==null&&(n.childLanes|=e),n=t,t=t.return;return n.tag===3?n.stateNode:null}var Ts=!1;function O_(t){t.updateQueue={baseState:t.memoizedState,firstBaseUpdate:null,lastBaseUpdate:null,shared:{pending:null,interleaved:null,lanes:0},effects:null}}function WC(t,e){t=t.updateQueue,e.updateQueue===t&&(e.updateQueue={baseState:t.baseState,firstBaseUpdate:t.firstBaseUpdate,lastBaseUpdate:t.lastBaseUpdate,shared:t.shared,effects:t.effects})}function es(t,e){return{eventTime:t,lane:e,tag:0,payload:null,callback:null,next:null}}function Ns(t,e,n){var s=t.updateQueue;if(s===null)return null;if(s=s.shared,ne&2){var r=s.pending;return r===null?e.next=e:(e.next=r.next,r.next=e),s.pending=e,ss(t,n)}return r=s.interleaved,r===null?(e.next=e,B_(s)):(e.next=r.next,r.next=e),s.interleaved=e,ss(t,n)}function Tl(t,e,n){if(e=e.updateQueue,e!==null&&(e=e.shared,(n&4194240)!==0)){var s=e.lanes;s&=t.pendingLanes,n|=s,e.lanes=n,y_(t,n)}}function iA(t,e){var n=t.updateQueue,s=t.alternate;if(s!==null&&(s=s.updateQueue,n===s)){var r=null,i=null;if(n=n.firstBaseUpdate,n!==null){do{var o={eventTime:n.eventTime,lane:n.lane,tag:n.tag,payload:n.payload,callback:n.callback,next:null};i===null?r=i=o:i=i.next=o,n=n.next}while(n!==null);i===null?r=i=e:i=i.next=e}else r=i=e;n={baseState:s.baseState,firstBaseUpdate:r,lastBaseUpdate:i,shared:s.shared,effects:s.effects},t.updateQueue=n;return}t=n.lastBaseUpdate,t===null?n.firstBaseUpdate=e:t.next=e,n.lastBaseUpdate=e}function eu(t,e,n,s){var r=t.updateQueue;Ts=!1;var i=r.firstBaseUpdate,o=r.lastBaseUpdate,a=r.shared.pending;if(a!==null){r.shared.pending=null;var c=a,l=c.next;c.next=null,o===null?i=l:o.next=l,o=c;var u=t.alternate;u!==null&&(u=u.updateQueue,a=u.lastBaseUpdate,a!==o&&(a===null?u.firstBaseUpdate=l:a.next=l,u.lastBaseUpdate=c))}if(i!==null){var h=r.baseState;o=0,u=l=c=null,a=i;do{var f=a.lane,d=a.eventTime;if((s&f)===f){u!==null&&(u=u.next={eventTime:d,lane:0,tag:a.tag,payload:a.payload,callback:a.callback,next:null});e:{var g=t,_=a;switch(f=e,d=n,_.tag){case 1:if(g=_.payload,typeof g=="function"){h=g.call(d,h,f);break e}h=g;break e;case 3:g.flags=g.flags&-65537|128;case 0:if(g=_.payload,f=typeof g=="function"?g.call(d,h,f):g,f==null)break e;h=we({},h,f);break e;case 2:Ts=!0}}a.callback!==null&&a.lane!==0&&(t.flags|=64,f=r.effects,f===null?r.effects=[a]:f.push(a))}else d={eventTime:d,lane:f,tag:a.tag,payload:a.payload,callback:a.callback,next:null},u===null?(l=u=d,c=h):u=u.next=d,o|=f;if(a=a.next,a===null){if(a=r.shared.pending,a===null)break;f=a,a=f.next,f.next=null,r.lastBaseUpdate=f,r.shared.pending=null}}while(1);if(u===null&&(c=h),r.baseState=c,r.firstBaseUpdate=l,r.lastBaseUpdate=u,e=r.shared.interleaved,e!==null){r=e;do o|=r.lane,r=r.next;while(r!==e)}else i===null&&(r.shared.lanes=0);Pr|=o,t.lanes=o,t.memoizedState=h}}function oA(t,e,n){if(t=e.effects,e.effects=null,t!==null)for(e=0;e<t.length;e++){var s=t[e],r=s.callback;if(r!==null){if(s.callback=null,s=n,typeof r!="function")throw Error(k(191,r));r.call(s)}}}var GC=new jS.Component().refs;function Sp(t,e,n,s){e=t.memoizedState,n=n(s,e),n=n==null?e:we({},e,n),t.memoizedState=n,t.lanes===0&&(t.updateQueue.baseState=n)}var vh={isMounted:function(t){return(t=t._reactInternals)?Dr(t)===t:!1},enqueueSetState:function(t,e,n){t=t._reactInternals;var s=at(),r=Ds(t),i=es(s,r);i.payload=e,n!=null&&(i.callback=n),e=Ns(t,i,r),e!==null&&(gn(e,t,r,s),Tl(e,t,r))},enqueueReplaceState:function(t,e,n){t=t._reactInternals;var s=at(),r=Ds(t),i=es(s,r);i.tag=1,i.payload=e,n!=null&&(i.callback=n),e=Ns(t,i,r),e!==null&&(gn(e,t,r,s),Tl(e,t,r))},enqueueForceUpdate:function(t,e){t=t._reactInternals;var n=at(),s=Ds(t),r=es(n,s);r.tag=2,e!=null&&(r.callback=e),e=Ns(t,r,s),e!==null&&(gn(e,t,s,n),Tl(e,t,s))}};function aA(t,e,n,s,r,i,o){return t=t.stateNode,typeof t.shouldComponentUpdate=="function"?t.shouldComponentUpdate(s,i,o):e.prototype&&e.prototype.isPureReactComponent?!Ca(n,s)||!Ca(r,i):!0}function XC(t,e,n){var s=!1,r=Vs,i=e.contextType;return typeof i=="object"&&i!==null?i=Yt(i):(r=At(e)?br:nt.current,s=e.contextTypes,i=(s=s!=null)?Ui(t,r):Vs),e=new e(n,i),t.memoizedState=e.state!==null&&e.state!==void 0?e.state:null,e.updater=vh,t.stateNode=e,e._reactInternals=t,s&&(t=t.stateNode,t.__reactInternalMemoizedUnmaskedChildContext=r,t.__reactInternalMemoizedMaskedChildContext=i),e}function cA(t,e,n,s){t=e.state,typeof e.componentWillReceiveProps=="function"&&e.componentWillReceiveProps(n,s),typeof e.UNSAFE_componentWillReceiveProps=="function"&&e.UNSAFE_componentWillReceiveProps(n,s),e.state!==t&&vh.enqueueReplaceState(e,e.state,null)}function Cp(t,e,n,s){var r=t.stateNode;r.props=n,r.state=t.memoizedState,r.refs=GC,O_(t);var i=e.contextType;typeof i=="object"&&i!==null?r.context=Yt(i):(i=At(e)?br:nt.current,r.context=Ui(t,i)),r.state=t.memoizedState,i=e.getDerivedStateFromProps,typeof i=="function"&&(Sp(t,e,i,n),r.state=t.memoizedState),typeof e.getDerivedStateFromProps=="function"||typeof r.getSnapshotBeforeUpdate=="function"||typeof r.UNSAFE_componentWillMount!="function"&&typeof r.componentWillMount!="function"||(e=r.state,typeof r.componentWillMount=="function"&&r.componentWillMount(),typeof r.UNSAFE_componentWillMount=="function"&&r.UNSAFE_componentWillMount(),e!==r.state&&vh.enqueueReplaceState(r,r.state,null),eu(t,n,r,s),r.state=t.memoizedState),typeof r.componentDidMount=="function"&&(t.flags|=4194308)}function So(t,e,n){if(t=n.ref,t!==null&&typeof t!="function"&&typeof t!="object"){if(n._owner){if(n=n._owner,n){if(n.tag!==1)throw Error(k(309));var s=n.stateNode}if(!s)throw Error(k(147,t));var r=s,i=""+t;return e!==null&&e.ref!==null&&typeof e.ref=="function"&&e.ref._stringRef===i?e.ref:(e=function(o){var a=r.refs;a===GC&&(a=r.refs={}),o===null?delete a[i]:a[i]=o},e._stringRef=i,e)}if(typeof t!="string")throw Error(k(284));if(!n._owner)throw Error(k(290,t))}return t}function Rc(t,e){throw t=Object.prototype.toString.call(e),Error(k(31,t==="[object Object]"?"object with keys {"+Object.keys(e).join(", ")+"}":t))}function lA(t){var e=t._init;return e(t._payload)}function $C(t){function e(m,y){if(t){var A=m.deletions;A===null?(m.deletions=[y],m.flags|=16):A.push(y)}}function n(m,y){if(!t)return null;for(;y!==null;)e(m,y),y=y.sibling;return null}function s(m,y){for(m=new Map;y!==null;)y.key!==null?m.set(y.key,y):m.set(y.index,y),y=y.sibling;return m}function r(m,y){return m=Ls(m,y),m.index=0,m.sibling=null,m}function i(m,y,A){return m.index=A,t?(A=m.alternate,A!==null?(A=A.index,A<y?(m.flags|=2,y):A):(m.flags|=2,y)):(m.flags|=1048576,y)}function o(m){return t&&m.alternate===null&&(m.flags|=2),m}function a(m,y,A,C){return y===null||y.tag!==6?(y=Nf(A,m.mode,C),y.return=m,y):(y=r(y,A),y.return=m,y)}function c(m,y,A,C){var b=A.type;return b===si?u(m,y,A.props.children,C,A.key):y!==null&&(y.elementType===b||typeof b=="object"&&b!==null&&b.$$typeof===As&&lA(b)===y.type)?(C=r(y,A.props),C.ref=So(m,y,A),C.return=m,C):(C=bl(A.type,A.key,A.props,null,m.mode,C),C.ref=So(m,y,A),C.return=m,C)}function l(m,y,A,C){return y===null||y.tag!==4||y.stateNode.containerInfo!==A.containerInfo||y.stateNode.implementation!==A.implementation?(y=Ff(A,m.mode,C),y.return=m,y):(y=r(y,A.children||[]),y.return=m,y)}function u(m,y,A,C,b){return y===null||y.tag!==7?(y=Tr(A,m.mode,C,b),y.return=m,y):(y=r(y,A),y.return=m,y)}function h(m,y,A){if(typeof y=="string"&&y!==""||typeof y=="number")return y=Nf(""+y,m.mode,A),y.return=m,y;if(typeof y=="object"&&y!==null){switch(y.$$typeof){case _c:return A=bl(y.type,y.key,y.props,null,m.mode,A),A.ref=So(m,null,y),A.return=m,A;case ni:return y=Ff(y,m.mode,A),y.return=m,y;case As:var C=y._init;return h(m,C(y._payload),A)}if(Uo(y)||mo(y))return y=Tr(y,m.mode,A,null),y.return=m,y;Rc(m,y)}return null}function f(m,y,A,C){var b=y!==null?y.key:null;if(typeof A=="string"&&A!==""||typeof A=="number")return b!==null?null:a(m,y,""+A,C);if(typeof A=="object"&&A!==null){switch(A.$$typeof){case _c:return A.key===b?c(m,y,A,C):null;case ni:return A.key===b?l(m,y,A,C):null;case As:return b=A._init,f(m,y,b(A._payload),C)}if(Uo(A)||mo(A))return b!==null?null:u(m,y,A,C,null);Rc(m,A)}return null}function d(m,y,A,C,b){if(typeof C=="string"&&C!==""||typeof C=="number")return m=m.get(A)||null,a(y,m,""+C,b);if(typeof C=="object"&&C!==null){switch(C.$$typeof){case _c:return m=m.get(C.key===null?A:C.key)||null,c(y,m,C,b);case ni:return m=m.get(C.key===null?A:C.key)||null,l(y,m,C,b);case As:var P=C._init;return d(m,y,A,P(C._payload),b)}if(Uo(C)||mo(C))return m=m.get(A)||null,u(y,m,C,b,null);Rc(y,C)}return null}function g(m,y,A,C){for(var b=null,P=null,B=y,O=y=0,N=null;B!==null&&O<A.length;O++){B.index>O?(N=B,B=null):N=B.sibling;var F=f(m,B,A[O],C);if(F===null){B===null&&(B=N);break}t&&B&&F.alternate===null&&e(m,B),y=i(F,y,O),P===null?b=F:P.sibling=F,P=F,B=N}if(O===A.length)return n(m,B),ye&&ar(m,O),b;if(B===null){for(;O<A.length;O++)B=h(m,A[O],C),B!==null&&(y=i(B,y,O),P===null?b=B:P.sibling=B,P=B);return ye&&ar(m,O),b}for(B=s(m,B);O<A.length;O++)N=d(B,m,O,A[O],C),N!==null&&(t&&N.alternate!==null&&B.delete(N.key===null?O:N.key),y=i(N,y,O),P===null?b=N:P.sibling=N,P=N);return t&&B.forEach(function(H){return e(m,H)}),ye&&ar(m,O),b}function _(m,y,A,C){var b=mo(A);if(typeof b!="function")throw Error(k(150));if(A=b.call(A),A==null)throw Error(k(151));for(var P=b=null,B=y,O=y=0,N=null,F=A.next();B!==null&&!F.done;O++,F=A.next()){B.index>O?(N=B,B=null):N=B.sibling;var H=f(m,B,F.value,C);if(H===null){B===null&&(B=N);break}t&&B&&H.alternate===null&&e(m,B),y=i(H,y,O),P===null?b=H:P.sibling=H,P=H,B=N}if(F.done)return n(m,B),ye&&ar(m,O),b;if(B===null){for(;!F.done;O++,F=A.next())F=h(m,F.value,C),F!==null&&(y=i(F,y,O),P===null?b=F:P.sibling=F,P=F);return ye&&ar(m,O),b}for(B=s(m,B);!F.done;O++,F=A.next())F=d(B,m,O,F.value,C),F!==null&&(t&&F.alternate!==null&&B.delete(F.key===null?O:F.key),y=i(F,y,O),P===null?b=F:P.sibling=F,P=F);return t&&B.forEach(function(X){return e(m,X)}),ye&&ar(m,O),b}function E(m,y,A,C){if(typeof A=="object"&&A!==null&&A.type===si&&A.key===null&&(A=A.props.children),typeof A=="object"&&A!==null){switch(A.$$typeof){case _c:e:{for(var b=A.key,P=y;P!==null;){if(P.key===b){if(b=A.type,b===si){if(P.tag===7){n(m,P.sibling),y=r(P,A.props.children),y.return=m,m=y;break e}}else if(P.elementType===b||typeof b=="object"&&b!==null&&b.$$typeof===As&&lA(b)===P.type){n(m,P.sibling),y=r(P,A.props),y.ref=So(m,P,A),y.return=m,m=y;break e}n(m,P);break}else e(m,P);P=P.sibling}A.type===si?(y=Tr(A.props.children,m.mode,C,A.key),y.return=m,m=y):(C=bl(A.type,A.key,A.props,null,m.mode,C),C.ref=So(m,y,A),C.return=m,m=C)}return o(m);case ni:e:{for(P=A.key;y!==null;){if(y.key===P)if(y.tag===4&&y.stateNode.containerInfo===A.containerInfo&&y.stateNode.implementation===A.implementation){n(m,y.sibling),y=r(y,A.children||[]),y.return=m,m=y;break e}else{n(m,y);break}else e(m,y);y=y.sibling}y=Ff(A,m.mode,C),y.return=m,m=y}return o(m);case As:return P=A._init,E(m,y,P(A._payload),C)}if(Uo(A))return g(m,y,A,C);if(mo(A))return _(m,y,A,C);Rc(m,A)}return typeof A=="string"&&A!==""||typeof A=="number"?(A=""+A,y!==null&&y.tag===6?(n(m,y.sibling),y=r(y,A),y.return=m,m=y):(n(m,y),y=Nf(A,m.mode,C),y.return=m,m=y),o(m)):n(m,y)}return E}var zi=$C(!0),KC=$C(!1),Ja={},Ln=$s(Ja),Ra=$s(Ja),Ia=$s(Ja);function pr(t){if(t===Ja)throw Error(k(174));return t}function N_(t,e){switch(ge(Ia,e),ge(Ra,t),ge(Ln,Ja),t=e.nodeType,t){case 9:case 11:e=(e=e.documentElement)?e.namespaceURI:tp(null,"");break;default:t=t===8?e.parentNode:e,e=t.namespaceURI||null,t=t.tagName,e=tp(e,t)}me(Ln),ge(Ln,e)}function Vi(){me(Ln),me(Ra),me(Ia)}function YC(t){pr(Ia.current);var e=pr(Ln.current),n=tp(e,t.type);e!==n&&(ge(Ra,t),ge(Ln,n))}function F_(t){Ra.current===t&&(me(Ln),me(Ra))}var Se=$s(0);function tu(t){for(var e=t;e!==null;){if(e.tag===13){var n=e.memoizedState;if(n!==null&&(n=n.dehydrated,n===null||n.data==="$?"||n.data==="$!"))return e}else if(e.tag===19&&e.memoizedProps.revealOrder!==void 0){if(e.flags&128)return e}else if(e.child!==null){e.child.return=e,e=e.child;continue}if(e===t)break;for(;e.sibling===null;){if(e.return===null||e.return===t)return null;e=e.return}e.sibling.return=e.return,e=e.sibling}return null}var If=[];function D_(){for(var t=0;t<If.length;t++)If[t]._workInProgressVersionPrimary=null;If.length=0}var El=ls.ReactCurrentDispatcher,Pf=ls.ReactCurrentBatchConfig,Ir=0,ve=null,De=null,Ve=null,nu=!1,ea=!1,Pa=0,WP=0;function Ye(){throw Error(k(321))}function L_(t,e){if(e===null)return!1;for(var n=0;n<e.length&&n<t.length;n++)if(!mn(t[n],e[n]))return!1;return!0}function U_(t,e,n,s,r,i){if(Ir=i,ve=e,e.memoizedState=null,e.updateQueue=null,e.lanes=0,El.current=t===null||t.memoizedState===null?KP:YP,t=n(s,r),ea){i=0;do{if(ea=!1,Pa=0,25<=i)throw Error(k(301));i+=1,Ve=De=null,e.updateQueue=null,El.current=JP,t=n(s,r)}while(ea)}if(El.current=su,e=De!==null&&De.next!==null,Ir=0,Ve=De=ve=null,nu=!1,e)throw Error(k(300));return t}function k_(){var t=Pa!==0;return Pa=0,t}function xn(){var t={memoizedState:null,baseState:null,baseQueue:null,queue:null,next:null};return Ve===null?ve.memoizedState=Ve=t:Ve=Ve.next=t,Ve}function Jt(){if(De===null){var t=ve.alternate;t=t!==null?t.memoizedState:null}else t=De.next;var e=Ve===null?ve.memoizedState:Ve.next;if(e!==null)Ve=e,De=t;else{if(t===null)throw Error(k(310));De=t,t={memoizedState:De.memoizedState,baseState:De.baseState,baseQueue:De.baseQueue,queue:De.queue,next:null},Ve===null?ve.memoizedState=Ve=t:Ve=Ve.next=t}return Ve}function xa(t,e){return typeof e=="function"?e(t):e}function xf(t){var e=Jt(),n=e.queue;if(n===null)throw Error(k(311));n.lastRenderedReducer=t;var s=De,r=s.baseQueue,i=n.pending;if(i!==null){if(r!==null){var o=r.next;r.next=i.next,i.next=o}s.baseQueue=r=i,n.pending=null}if(r!==null){i=r.next,s=s.baseState;var a=o=null,c=null,l=i;do{var u=l.lane;if((Ir&u)===u)c!==null&&(c=c.next={lane:0,action:l.action,hasEagerState:l.hasEagerState,eagerState:l.eagerState,next:null}),s=l.hasEagerState?l.eagerState:t(s,l.action);else{var h={lane:u,action:l.action,hasEagerState:l.hasEagerState,eagerState:l.eagerState,next:null};c===null?(a=c=h,o=s):c=c.next=h,ve.lanes|=u,Pr|=u}l=l.next}while(l!==null&&l!==i);c===null?o=s:c.next=a,mn(s,e.memoizedState)||(_t=!0),e.memoizedState=s,e.baseState=o,e.baseQueue=c,n.lastRenderedState=s}if(t=n.interleaved,t!==null){r=t;do i=r.lane,ve.lanes|=i,Pr|=i,r=r.next;while(r!==t)}else r===null&&(n.lanes=0);return[e.memoizedState,n.dispatch]}function Mf(t){var e=Jt(),n=e.queue;if(n===null)throw Error(k(311));n.lastRenderedReducer=t;var s=n.dispatch,r=n.pending,i=e.memoizedState;if(r!==null){n.pending=null;var o=r=r.next;do i=t(i,o.action),o=o.next;while(o!==r);mn(i,e.memoizedState)||(_t=!0),e.memoizedState=i,e.baseQueue===null&&(e.baseState=i),n.lastRenderedState=i}return[i,s]}function JC(){}function qC(t,e){var n=ve,s=Jt(),r=e(),i=!mn(s.memoizedState,r);if(i&&(s.memoizedState=r,_t=!0),s=s.queue,z_(e1.bind(null,n,s,t),[t]),s.getSnapshot!==e||i||Ve!==null&&Ve.memoizedState.tag&1){if(n.flags|=2048,Ma(9,QC.bind(null,n,s,r,e),void 0,null),He===null)throw Error(k(349));Ir&30||ZC(n,e,r)}return r}function ZC(t,e,n){t.flags|=16384,t={getSnapshot:e,value:n},e=ve.updateQueue,e===null?(e={lastEffect:null,stores:null},ve.updateQueue=e,e.stores=[t]):(n=e.stores,n===null?e.stores=[t]:n.push(t))}function QC(t,e,n,s){e.value=n,e.getSnapshot=s,t1(e)&&n1(t)}function e1(t,e,n){return n(function(){t1(e)&&n1(t)})}function t1(t){var e=t.getSnapshot;t=t.value;try{var n=e();return!mn(t,n)}catch{return!0}}function n1(t){var e=ss(t,1);e!==null&&gn(e,t,1,-1)}function uA(t){var e=xn();return typeof t=="function"&&(t=t()),e.memoizedState=e.baseState=t,t={pending:null,interleaved:null,lanes:0,dispatch:null,lastRenderedReducer:xa,lastRenderedState:t},e.queue=t,t=t.dispatch=$P.bind(null,ve,t),[e.memoizedState,t]}function Ma(t,e,n,s){return t={tag:t,create:e,destroy:n,deps:s,next:null},e=ve.updateQueue,e===null?(e={lastEffect:null,stores:null},ve.updateQueue=e,e.lastEffect=t.next=t):(n=e.lastEffect,n===null?e.lastEffect=t.next=t:(s=n.next,n.next=t,t.next=s,e.lastEffect=t)),t}function s1(){return Jt().memoizedState}function Sl(t,e,n,s){var r=xn();ve.flags|=t,r.memoizedState=Ma(1|e,n,void 0,s===void 0?null:s)}function wh(t,e,n,s){var r=Jt();s=s===void 0?null:s;var i=void 0;if(De!==null){var o=De.memoizedState;if(i=o.destroy,s!==null&&L_(s,o.deps)){r.memoizedState=Ma(e,n,i,s);return}}ve.flags|=t,r.memoizedState=Ma(1|e,n,i,s)}function hA(t,e){return Sl(8390656,8,t,e)}function z_(t,e){return wh(2048,8,t,e)}function r1(t,e){return wh(4,2,t,e)}function i1(t,e){return wh(4,4,t,e)}function o1(t,e){if(typeof e=="function")return t=t(),e(t),function(){e(null)};if(e!=null)return t=t(),e.current=t,function(){e.current=null}}function a1(t,e,n){return n=n!=null?n.concat([t]):null,wh(4,4,o1.bind(null,e,t),n)}function V_(){}function c1(t,e){var n=Jt();e=e===void 0?null:e;var s=n.memoizedState;return s!==null&&e!==null&&L_(e,s[1])?s[0]:(n.memoizedState=[t,e],t)}function l1(t,e){var n=Jt();e=e===void 0?null:e;var s=n.memoizedState;return s!==null&&e!==null&&L_(e,s[1])?s[0]:(t=t(),n.memoizedState=[t,e],t)}function u1(t,e,n){return Ir&21?(mn(n,e)||(n=dC(),ve.lanes|=n,Pr|=n,t.baseState=!0),e):(t.baseState&&(t.baseState=!1,_t=!0),t.memoizedState=n)}function GP(t,e){var n=ce;ce=n!==0&&4>n?n:4,t(!0);var s=Pf.transition;Pf.transition={};try{t(!1),e()}finally{ce=n,Pf.transition=s}}function h1(){return Jt().memoizedState}function XP(t,e,n){var s=Ds(t);if(n={lane:s,action:n,hasEagerState:!1,eagerState:null,next:null},f1(t))d1(e,n);else if(n=jC(t,e,n,s),n!==null){var r=at();gn(n,t,s,r),p1(n,e,s)}}function $P(t,e,n){var s=Ds(t),r={lane:s,action:n,hasEagerState:!1,eagerState:null,next:null};if(f1(t))d1(e,r);else{var i=t.alternate;if(t.lanes===0&&(i===null||i.lanes===0)&&(i=e.lastRenderedReducer,i!==null))try{var o=e.lastRenderedState,a=i(o,n);if(r.hasEagerState=!0,r.eagerState=a,mn(a,o)){var c=e.interleaved;c===null?(r.next=r,B_(e)):(r.next=c.next,c.next=r),e.interleaved=r;return}}catch{}finally{}n=jC(t,e,r,s),n!==null&&(r=at(),gn(n,t,s,r),p1(n,e,s))}}function f1(t){var e=t.alternate;return t===ve||e!==null&&e===ve}function d1(t,e){ea=nu=!0;var n=t.pending;n===null?e.next=e:(e.next=n.next,n.next=e),t.pending=e}function p1(t,e,n){if(n&4194240){var s=e.lanes;s&=t.pendingLanes,n|=s,e.lanes=n,y_(t,n)}}var su={readContext:Yt,useCallback:Ye,useContext:Ye,useEffect:Ye,useImperativeHandle:Ye,useInsertionEffect:Ye,useLayoutEffect:Ye,useMemo:Ye,useReducer:Ye,useRef:Ye,useState:Ye,useDebugValue:Ye,useDeferredValue:Ye,useTransition:Ye,useMutableSource:Ye,useSyncExternalStore:Ye,useId:Ye,unstable_isNewReconciler:!1},KP={readContext:Yt,useCallback:function(t,e){return xn().memoizedState=[t,e===void 0?null:e],t},useContext:Yt,useEffect:hA,useImperativeHandle:function(t,e,n){return n=n!=null?n.concat([t]):null,Sl(4194308,4,o1.bind(null,e,t),n)},useLayoutEffect:function(t,e){return Sl(4194308,4,t,e)},useInsertionEffect:function(t,e){return Sl(4,2,t,e)},useMemo:function(t,e){var n=xn();return e=e===void 0?null:e,t=t(),n.memoizedState=[t,e],t},useReducer:function(t,e,n){var s=xn();return e=n!==void 0?n(e):e,s.memoizedState=s.baseState=e,t={pending:null,interleaved:null,lanes:0,dispatch:null,lastRenderedReducer:t,lastRenderedState:e},s.queue=t,t=t.dispatch=XP.bind(null,ve,t),[s.memoizedState,t]},useRef:function(t){var e=xn();return t={current:t},e.memoizedState=t},useState:uA,useDebugValue:V_,useDeferredValue:function(t){return xn().memoizedState=t},useTransition:function(){var t=uA(!1),e=t[0];return t=GP.bind(null,t[1]),xn().memoizedState=t,[e,t]},useMutableSource:function(){},useSyncExternalStore:function(t,e,n){var s=ve,r=xn();if(ye){if(n===void 0)throw Error(k(407));n=n()}else{if(n=e(),He===null)throw Error(k(349));Ir&30||ZC(s,e,n)}r.memoizedState=n;var i={value:n,getSnapshot:e};return r.queue=i,hA(e1.bind(null,s,i,t),[t]),s.flags|=2048,Ma(9,QC.bind(null,s,i,n,e),void 0,null),n},useId:function(){var t=xn(),e=He.identifierPrefix;if(ye){var n=Yn,s=Kn;n=(s&~(1<<32-pn(s)-1)).toString(32)+n,e=":"+e+"R"+n,n=Pa++,0<n&&(e+="H"+n.toString(32)),e+=":"}else n=WP++,e=":"+e+"r"+n.toString(32)+":";return t.memoizedState=e},unstable_isNewReconciler:!1},YP={readContext:Yt,useCallback:c1,useContext:Yt,useEffect:z_,useImperativeHandle:a1,useInsertionEffect:r1,useLayoutEffect:i1,useMemo:l1,useReducer:xf,useRef:s1,useState:function(){return xf(xa)},useDebugValue:V_,useDeferredValue:function(t){var e=Jt();return u1(e,De.memoizedState,t)},useTransition:function(){var t=xf(xa)[0],e=Jt().memoizedState;return[t,e]},useMutableSource:JC,useSyncExternalStore:qC,useId:h1,unstable_isNewReconciler:!1},JP={readContext:Yt,useCallback:c1,useContext:Yt,useEffect:z_,useImperativeHandle:a1,useInsertionEffect:r1,useLayoutEffect:i1,useMemo:l1,useReducer:Mf,useRef:s1,useState:function(){return Mf(xa)},useDebugValue:V_,useDeferredValue:function(t){var e=Jt();return De===null?e.memoizedState=t:u1(e,De.memoizedState,t)},useTransition:function(){var t=Mf(xa)[0],e=Jt().memoizedState;return[t,e]},useMutableSource:JC,useSyncExternalStore:qC,useId:h1,unstable_isNewReconciler:!1};function Hi(t,e){try{var n="",s=e;do n+=vI(s),s=s.return;while(s);var r=n}catch(i){r=`
Error generating stack: `+i.message+`
`+i.stack}return{value:t,source:e,stack:r,digest:null}}function Bf(t,e,n){return{value:t,source:null,stack:n??null,digest:e??null}}function vp(t,e){try{console.error(e.value)}catch(n){setTimeout(function(){throw n})}}var qP=typeof WeakMap=="function"?WeakMap:Map;function g1(t,e,n){n=es(-1,n),n.tag=3,n.payload={element:null};var s=e.value;return n.callback=function(){iu||(iu=!0,Np=s),vp(t,e)},n}function _1(t,e,n){n=es(-1,n),n.tag=3;var s=t.type.getDerivedStateFromError;if(typeof s=="function"){var r=e.value;n.payload=function(){return s(r)},n.callback=function(){vp(t,e)}}var i=t.stateNode;return i!==null&&typeof i.componentDidCatch=="function"&&(n.callback=function(){vp(t,e),typeof s!="function"&&(Fs===null?Fs=new Set([this]):Fs.add(this));var o=e.stack;this.componentDidCatch(e.value,{componentStack:o!==null?o:""})}),n}function fA(t,e,n){var s=t.pingCache;if(s===null){s=t.pingCache=new qP;var r=new Set;s.set(e,r)}else r=s.get(e),r===void 0&&(r=new Set,s.set(e,r));r.has(n)||(r.add(n),t=h3.bind(null,t,e,n),e.then(t,t))}function dA(t){do{var e;if((e=t.tag===13)&&(e=t.memoizedState,e=e!==null?e.dehydrated!==null:!0),e)return t;t=t.return}while(t!==null);return null}function pA(t,e,n,s,r){return t.mode&1?(t.flags|=65536,t.lanes=r,t):(t===e?t.flags|=65536:(t.flags|=128,n.flags|=131072,n.flags&=-52805,n.tag===1&&(n.alternate===null?n.tag=17:(e=es(-1,1),e.tag=2,Ns(n,e,1))),n.lanes|=1),t)}var ZP=ls.ReactCurrentOwner,_t=!1;function ot(t,e,n,s){e.child=t===null?KC(e,null,n,s):zi(e,t.child,n,s)}function gA(t,e,n,s,r){n=n.render;var i=e.ref;return xi(e,r),s=U_(t,e,n,s,i,r),n=k_(),t!==null&&!_t?(e.updateQueue=t.updateQueue,e.flags&=-2053,t.lanes&=~r,rs(t,e,r)):(ye&&n&&b_(e),e.flags|=1,ot(t,e,s,r),e.child)}function _A(t,e,n,s,r){if(t===null){var i=n.type;return typeof i=="function"&&!Y_(i)&&i.defaultProps===void 0&&n.compare===null&&n.defaultProps===void 0?(e.tag=15,e.type=i,m1(t,e,i,s,r)):(t=bl(n.type,null,s,e,e.mode,r),t.ref=e.ref,t.return=e,e.child=t)}if(i=t.child,!(t.lanes&r)){var o=i.memoizedProps;if(n=n.compare,n=n!==null?n:Ca,n(o,s)&&t.ref===e.ref)return rs(t,e,r)}return e.flags|=1,t=Ls(i,s),t.ref=e.ref,t.return=e,e.child=t}function m1(t,e,n,s,r){if(t!==null){var i=t.memoizedProps;if(Ca(i,s)&&t.ref===e.ref)if(_t=!1,e.pendingProps=s=i,(t.lanes&r)!==0)t.flags&131072&&(_t=!0);else return e.lanes=t.lanes,rs(t,e,r)}return wp(t,e,n,s,r)}function y1(t,e,n){var s=e.pendingProps,r=s.children,i=t!==null?t.memoizedState:null;if(s.mode==="hidden")if(!(e.mode&1))e.memoizedState={baseLanes:0,cachePool:null,transitions:null},ge(di,wt),wt|=n;else{if(!(n&1073741824))return t=i!==null?i.baseLanes|n:n,e.lanes=e.childLanes=1073741824,e.memoizedState={baseLanes:t,cachePool:null,transitions:null},e.updateQueue=null,ge(di,wt),wt|=t,null;e.memoizedState={baseLanes:0,cachePool:null,transitions:null},s=i!==null?i.baseLanes:n,ge(di,wt),wt|=s}else i!==null?(s=i.baseLanes|n,e.memoizedState=null):s=n,ge(di,wt),wt|=s;return ot(t,e,r,n),e.child}function A1(t,e){var n=e.ref;(t===null&&n!==null||t!==null&&t.ref!==n)&&(e.flags|=512,e.flags|=2097152)}function wp(t,e,n,s,r){var i=At(n)?br:nt.current;return i=Ui(e,i),xi(e,r),n=U_(t,e,n,s,i,r),s=k_(),t!==null&&!_t?(e.updateQueue=t.updateQueue,e.flags&=-2053,t.lanes&=~r,rs(t,e,r)):(ye&&s&&b_(e),e.flags|=1,ot(t,e,n,r),e.child)}function mA(t,e,n,s,r){if(At(n)){var i=!0;Yl(e)}else i=!1;if(xi(e,r),e.stateNode===null)Cl(t,e),XC(e,n,s),Cp(e,n,s,r),s=!0;else if(t===null){var o=e.stateNode,a=e.memoizedProps;o.props=a;var c=o.context,l=n.contextType;typeof l=="object"&&l!==null?l=Yt(l):(l=At(n)?br:nt.current,l=Ui(e,l));var u=n.getDerivedStateFromProps,h=typeof u=="function"||typeof o.getSnapshotBeforeUpdate=="function";h||typeof o.UNSAFE_componentWillReceiveProps!="function"&&typeof o.componentWillReceiveProps!="function"||(a!==s||c!==l)&&cA(e,o,s,l),Ts=!1;var f=e.memoizedState;o.state=f,eu(e,s,o,r),c=e.memoizedState,a!==s||f!==c||yt.current||Ts?(typeof u=="function"&&(Sp(e,n,u,s),c=e.memoizedState),(a=Ts||aA(e,n,a,s,f,c,l))?(h||typeof o.UNSAFE_componentWillMount!="function"&&typeof o.componentWillMount!="function"||(typeof o.componentWillMount=="function"&&o.componentWillMount(),typeof o.UNSAFE_componentWillMount=="function"&&o.UNSAFE_componentWillMount()),typeof o.componentDidMount=="function"&&(e.flags|=4194308)):(typeof o.componentDidMount=="function"&&(e.flags|=4194308),e.memoizedProps=s,e.memoizedState=c),o.props=s,o.state=c,o.context=l,s=a):(typeof o.componentDidMount=="function"&&(e.flags|=4194308),s=!1)}else{o=e.stateNode,WC(t,e),a=e.memoizedProps,l=e.type===e.elementType?a:tn(e.type,a),o.props=l,h=e.pendingProps,f=o.context,c=n.contextType,typeof c=="object"&&c!==null?c=Yt(c):(c=At(n)?br:nt.current,c=Ui(e,c));var d=n.getDerivedStateFromProps;(u=typeof d=="function"||typeof o.getSnapshotBeforeUpdate=="function")||typeof o.UNSAFE_componentWillReceiveProps!="function"&&typeof o.componentWillReceiveProps!="function"||(a!==h||f!==c)&&cA(e,o,s,c),Ts=!1,f=e.memoizedState,o.state=f,eu(e,s,o,r);var g=e.memoizedState;a!==h||f!==g||yt.current||Ts?(typeof d=="function"&&(Sp(e,n,d,s),g=e.memoizedState),(l=Ts||aA(e,n,l,s,f,g,c)||!1)?(u||typeof o.UNSAFE_componentWillUpdate!="function"&&typeof o.componentWillUpdate!="function"||(typeof o.componentWillUpdate=="function"&&o.componentWillUpdate(s,g,c),typeof o.UNSAFE_componentWillUpdate=="function"&&o.UNSAFE_componentWillUpdate(s,g,c)),typeof o.componentDidUpdate=="function"&&(e.flags|=4),typeof o.getSnapshotBeforeUpdate=="function"&&(e.flags|=1024)):(typeof o.componentDidUpdate!="function"||a===t.memoizedProps&&f===t.memoizedState||(e.flags|=4),typeof o.getSnapshotBeforeUpdate!="function"||a===t.memoizedProps&&f===t.memoizedState||(e.flags|=1024),e.memoizedProps=s,e.memoizedState=g),o.props=s,o.state=g,o.context=c,s=l):(typeof o.componentDidUpdate!="function"||a===t.memoizedProps&&f===t.memoizedState||(e.flags|=4),typeof o.getSnapshotBeforeUpdate!="function"||a===t.memoizedProps&&f===t.memoizedState||(e.flags|=1024),s=!1)}return bp(t,e,n,s,i,r)}function bp(t,e,n,s,r,i){A1(t,e);var o=(e.flags&128)!==0;if(!s&&!o)return r&&nA(e,n,!1),rs(t,e,i);s=e.stateNode,ZP.current=e;var a=o&&typeof n.getDerivedStateFromError!="function"?null:s.render();return e.flags|=1,t!==null&&o?(e.child=zi(e,t.child,null,i),e.child=zi(e,null,a,i)):ot(t,e,a,i),e.memoizedState=s.state,r&&nA(e,n,!0),e.child}function T1(t){var e=t.stateNode;e.pendingContext?tA(t,e.pendingContext,e.pendingContext!==e.context):e.context&&tA(t,e.context,!1),N_(t,e.containerInfo)}function yA(t,e,n,s,r){return ki(),I_(r),e.flags|=256,ot(t,e,n,s),e.child}var Rp={dehydrated:null,treeContext:null,retryLane:0};function Ip(t){return{baseLanes:t,cachePool:null,transitions:null}}function E1(t,e,n){var s=e.pendingProps,r=Se.current,i=!1,o=(e.flags&128)!==0,a;if((a=o)||(a=t!==null&&t.memoizedState===null?!1:(r&2)!==0),a?(i=!0,e.flags&=-129):(t===null||t.memoizedState!==null)&&(r|=1),ge(Se,r&1),t===null)return Tp(e),t=e.memoizedState,t!==null&&(t=t.dehydrated,t!==null)?(e.mode&1?t.data==="$!"?e.lanes=8:e.lanes=1073741824:e.lanes=1,null):(o=s.children,t=s.fallback,i?(s=e.mode,i=e.child,o={mode:"hidden",children:o},!(s&1)&&i!==null?(i.childLanes=0,i.pendingProps=o):i=Ih(o,s,0,null),t=Tr(t,s,n,null),i.return=e,t.return=e,i.sibling=t,e.child=i,e.child.memoizedState=Ip(n),e.memoizedState=Rp,t):H_(e,o));if(r=t.memoizedState,r!==null&&(a=r.dehydrated,a!==null))return QP(t,e,o,s,a,r,n);if(i){i=s.fallback,o=e.mode,r=t.child,a=r.sibling;var c={mode:"hidden",children:s.children};return!(o&1)&&e.child!==r?(s=e.child,s.childLanes=0,s.pendingProps=c,e.deletions=null):(s=Ls(r,c),s.subtreeFlags=r.subtreeFlags&14680064),a!==null?i=Ls(a,i):(i=Tr(i,o,n,null),i.flags|=2),i.return=e,s.return=e,s.sibling=i,e.child=s,s=i,i=e.child,o=t.child.memoizedState,o=o===null?Ip(n):{baseLanes:o.baseLanes|n,cachePool:null,transitions:o.transitions},i.memoizedState=o,i.childLanes=t.childLanes&~n,e.memoizedState=Rp,s}return i=t.child,t=i.sibling,s=Ls(i,{mode:"visible",children:s.children}),!(e.mode&1)&&(s.lanes=n),s.return=e,s.sibling=null,t!==null&&(n=e.deletions,n===null?(e.deletions=[t],e.flags|=16):n.push(t)),e.child=s,e.memoizedState=null,s}function H_(t,e){return e=Ih({mode:"visible",children:e},t.mode,0,null),e.return=t,t.child=e}function Ic(t,e,n,s){return s!==null&&I_(s),zi(e,t.child,null,n),t=H_(e,e.pendingProps.children),t.flags|=2,e.memoizedState=null,t}function QP(t,e,n,s,r,i,o){if(n)return e.flags&256?(e.flags&=-257,s=Bf(Error(k(422))),Ic(t,e,o,s)):e.memoizedState!==null?(e.child=t.child,e.flags|=128,null):(i=s.fallback,r=e.mode,s=Ih({mode:"visible",children:s.children},r,0,null),i=Tr(i,r,o,null),i.flags|=2,s.return=e,i.return=e,s.sibling=i,e.child=s,e.mode&1&&zi(e,t.child,null,o),e.child.memoizedState=Ip(o),e.memoizedState=Rp,i);if(!(e.mode&1))return Ic(t,e,o,null);if(r.data==="$!"){if(s=r.nextSibling&&r.nextSibling.dataset,s)var a=s.dgst;return s=a,i=Error(k(419)),s=Bf(i,s,void 0),Ic(t,e,o,s)}if(a=(o&t.childLanes)!==0,_t||a){if(s=He,s!==null){switch(o&-o){case 4:r=2;break;case 16:r=8;break;case 64:case 128:case 256:case 512:case 1024:case 2048:case 4096:case 8192:case 16384:case 32768:case 65536:case 131072:case 262144:case 524288:case 1048576:case 2097152:case 4194304:case 8388608:case 16777216:case 33554432:case 67108864:r=32;break;case 536870912:r=268435456;break;default:r=0}r=r&(s.suspendedLanes|o)?0:r,r!==0&&r!==i.retryLane&&(i.retryLane=r,ss(t,r),gn(s,t,r,-1))}return K_(),s=Bf(Error(k(421))),Ic(t,e,o,s)}return r.data==="$?"?(e.flags|=128,e.child=t.child,e=f3.bind(null,t),r._reactRetry=e,null):(t=i.treeContext,bt=Os(r.nextSibling),xt=e,ye=!0,sn=null,t!==null&&(kt[zt++]=Kn,kt[zt++]=Yn,kt[zt++]=Rr,Kn=t.id,Yn=t.overflow,Rr=e),e=H_(e,s.children),e.flags|=4096,e)}function AA(t,e,n){t.lanes|=e;var s=t.alternate;s!==null&&(s.lanes|=e),Ep(t.return,e,n)}function Of(t,e,n,s,r){var i=t.memoizedState;i===null?t.memoizedState={isBackwards:e,rendering:null,renderingStartTime:0,last:s,tail:n,tailMode:r}:(i.isBackwards=e,i.rendering=null,i.renderingStartTime=0,i.last=s,i.tail=n,i.tailMode=r)}function S1(t,e,n){var s=e.pendingProps,r=s.revealOrder,i=s.tail;if(ot(t,e,s.children,n),s=Se.current,s&2)s=s&1|2,e.flags|=128;else{if(t!==null&&t.flags&128)e:for(t=e.child;t!==null;){if(t.tag===13)t.memoizedState!==null&&AA(t,n,e);else if(t.tag===19)AA(t,n,e);else if(t.child!==null){t.child.return=t,t=t.child;continue}if(t===e)break e;for(;t.sibling===null;){if(t.return===null||t.return===e)break e;t=t.return}t.sibling.return=t.return,t=t.sibling}s&=1}if(ge(Se,s),!(e.mode&1))e.memoizedState=null;else switch(r){case"forwards":for(n=e.child,r=null;n!==null;)t=n.alternate,t!==null&&tu(t)===null&&(r=n),n=n.sibling;n=r,n===null?(r=e.child,e.child=null):(r=n.sibling,n.sibling=null),Of(e,!1,r,n,i);break;case"backwards":for(n=null,r=e.child,e.child=null;r!==null;){if(t=r.alternate,t!==null&&tu(t)===null){e.child=r;break}t=r.sibling,r.sibling=n,n=r,r=t}Of(e,!0,n,null,i);break;case"together":Of(e,!1,null,null,void 0);break;default:e.memoizedState=null}return e.child}function Cl(t,e){!(e.mode&1)&&t!==null&&(t.alternate=null,e.alternate=null,e.flags|=2)}function rs(t,e,n){if(t!==null&&(e.dependencies=t.dependencies),Pr|=e.lanes,!(n&e.childLanes))return null;if(t!==null&&e.child!==t.child)throw Error(k(153));if(e.child!==null){for(t=e.child,n=Ls(t,t.pendingProps),e.child=n,n.return=e;t.sibling!==null;)t=t.sibling,n=n.sibling=Ls(t,t.pendingProps),n.return=e;n.sibling=null}return e.child}function e3(t,e,n){switch(e.tag){case 3:T1(e),ki();break;case 5:YC(e);break;case 1:At(e.type)&&Yl(e);break;case 4:N_(e,e.stateNode.containerInfo);break;case 10:var s=e.type._context,r=e.memoizedProps.value;ge(Zl,s._currentValue),s._currentValue=r;break;case 13:if(s=e.memoizedState,s!==null)return s.dehydrated!==null?(ge(Se,Se.current&1),e.flags|=128,null):n&e.child.childLanes?E1(t,e,n):(ge(Se,Se.current&1),t=rs(t,e,n),t!==null?t.sibling:null);ge(Se,Se.current&1);break;case 19:if(s=(n&e.childLanes)!==0,t.flags&128){if(s)return S1(t,e,n);e.flags|=128}if(r=e.memoizedState,r!==null&&(r.rendering=null,r.tail=null,r.lastEffect=null),ge(Se,Se.current),s)break;return null;case 22:case 23:return e.lanes=0,y1(t,e,n)}return rs(t,e,n)}var C1,Pp,v1,w1;C1=function(t,e){for(var n=e.child;n!==null;){if(n.tag===5||n.tag===6)t.appendChild(n.stateNode);else if(n.tag!==4&&n.child!==null){n.child.return=n,n=n.child;continue}if(n===e)break;for(;n.sibling===null;){if(n.return===null||n.return===e)return;n=n.return}n.sibling.return=n.return,n=n.sibling}};Pp=function(){};v1=function(t,e,n,s){var r=t.memoizedProps;if(r!==s){t=e.stateNode,pr(Ln.current);var i=null;switch(n){case"input":r=qd(t,r),s=qd(t,s),i=[];break;case"select":r=we({},r,{value:void 0}),s=we({},s,{value:void 0}),i=[];break;case"textarea":r=ep(t,r),s=ep(t,s),i=[];break;default:typeof r.onClick!="function"&&typeof s.onClick=="function"&&(t.onclick=$l)}np(n,s);var o;n=null;for(l in r)if(!s.hasOwnProperty(l)&&r.hasOwnProperty(l)&&r[l]!=null)if(l==="style"){var a=r[l];for(o in a)a.hasOwnProperty(o)&&(n||(n={}),n[o]="")}else l!=="dangerouslySetInnerHTML"&&l!=="children"&&l!=="suppressContentEditableWarning"&&l!=="suppressHydrationWarning"&&l!=="autoFocus"&&(_a.hasOwnProperty(l)?i||(i=[]):(i=i||[]).push(l,null));for(l in s){var c=s[l];if(a=r!=null?r[l]:void 0,s.hasOwnProperty(l)&&c!==a&&(c!=null||a!=null))if(l==="style")if(a){for(o in a)!a.hasOwnProperty(o)||c&&c.hasOwnProperty(o)||(n||(n={}),n[o]="");for(o in c)c.hasOwnProperty(o)&&a[o]!==c[o]&&(n||(n={}),n[o]=c[o])}else n||(i||(i=[]),i.push(l,n)),n=c;else l==="dangerouslySetInnerHTML"?(c=c?c.__html:void 0,a=a?a.__html:void 0,c!=null&&a!==c&&(i=i||[]).push(l,c)):l==="children"?typeof c!="string"&&typeof c!="number"||(i=i||[]).push(l,""+c):l!=="suppressContentEditableWarning"&&l!=="suppressHydrationWarning"&&(_a.hasOwnProperty(l)?(c!=null&&l==="onScroll"&&_e("scroll",t),i||a===c||(i=[])):(i=i||[]).push(l,c))}n&&(i=i||[]).push("style",n);var l=i;(e.updateQueue=l)&&(e.flags|=4)}};w1=function(t,e,n,s){n!==s&&(e.flags|=4)};function Co(t,e){if(!ye)switch(t.tailMode){case"hidden":e=t.tail;for(var n=null;e!==null;)e.alternate!==null&&(n=e),e=e.sibling;n===null?t.tail=null:n.sibling=null;break;case"collapsed":n=t.tail;for(var s=null;n!==null;)n.alternate!==null&&(s=n),n=n.sibling;s===null?e||t.tail===null?t.tail=null:t.tail.sibling=null:s.sibling=null}}function Je(t){var e=t.alternate!==null&&t.alternate.child===t.child,n=0,s=0;if(e)for(var r=t.child;r!==null;)n|=r.lanes|r.childLanes,s|=r.subtreeFlags&14680064,s|=r.flags&14680064,r.return=t,r=r.sibling;else for(r=t.child;r!==null;)n|=r.lanes|r.childLanes,s|=r.subtreeFlags,s|=r.flags,r.return=t,r=r.sibling;return t.subtreeFlags|=s,t.childLanes=n,e}function t3(t,e,n){var s=e.pendingProps;switch(R_(e),e.tag){case 2:case 16:case 15:case 0:case 11:case 7:case 8:case 12:case 9:case 14:return Je(e),null;case 1:return At(e.type)&&Kl(),Je(e),null;case 3:return s=e.stateNode,Vi(),me(yt),me(nt),D_(),s.pendingContext&&(s.context=s.pendingContext,s.pendingContext=null),(t===null||t.child===null)&&(bc(e)?e.flags|=4:t===null||t.memoizedState.isDehydrated&&!(e.flags&256)||(e.flags|=1024,sn!==null&&(Lp(sn),sn=null))),Pp(t,e),Je(e),null;case 5:F_(e);var r=pr(Ia.current);if(n=e.type,t!==null&&e.stateNode!=null)v1(t,e,n,s,r),t.ref!==e.ref&&(e.flags|=512,e.flags|=2097152);else{if(!s){if(e.stateNode===null)throw Error(k(166));return Je(e),null}if(t=pr(Ln.current),bc(e)){s=e.stateNode,n=e.type;var i=e.memoizedProps;switch(s[Mn]=e,s[ba]=i,t=(e.mode&1)!==0,n){case"dialog":_e("cancel",s),_e("close",s);break;case"iframe":case"object":case"embed":_e("load",s);break;case"video":case"audio":for(r=0;r<zo.length;r++)_e(zo[r],s);break;case"source":_e("error",s);break;case"img":case"image":case"link":_e("error",s),_e("load",s);break;case"details":_e("toggle",s);break;case"input":Iy(s,i),_e("invalid",s);break;case"select":s._wrapperState={wasMultiple:!!i.multiple},_e("invalid",s);break;case"textarea":xy(s,i),_e("invalid",s)}np(n,i),r=null;for(var o in i)if(i.hasOwnProperty(o)){var a=i[o];o==="children"?typeof a=="string"?s.textContent!==a&&(i.suppressHydrationWarning!==!0&&wc(s.textContent,a,t),r=["children",a]):typeof a=="number"&&s.textContent!==""+a&&(i.suppressHydrationWarning!==!0&&wc(s.textContent,a,t),r=["children",""+a]):_a.hasOwnProperty(o)&&a!=null&&o==="onScroll"&&_e("scroll",s)}switch(n){case"input":mc(s),Py(s,i,!0);break;case"textarea":mc(s),My(s);break;case"select":case"option":break;default:typeof i.onClick=="function"&&(s.onclick=$l)}s=r,e.updateQueue=s,s!==null&&(e.flags|=4)}else{o=r.nodeType===9?r:r.ownerDocument,t==="http://www.w3.org/1999/xhtml"&&(t=ZS(n)),t==="http://www.w3.org/1999/xhtml"?n==="script"?(t=o.createElement("div"),t.innerHTML="<script><\/script>",t=t.removeChild(t.firstChild)):typeof s.is=="string"?t=o.createElement(n,{is:s.is}):(t=o.createElement(n),n==="select"&&(o=t,s.multiple?o.multiple=!0:s.size&&(o.size=s.size))):t=o.createElementNS(t,n),t[Mn]=e,t[ba]=s,C1(t,e,!1,!1),e.stateNode=t;e:{switch(o=sp(n,s),n){case"dialog":_e("cancel",t),_e("close",t),r=s;break;case"iframe":case"object":case"embed":_e("load",t),r=s;break;case"video":case"audio":for(r=0;r<zo.length;r++)_e(zo[r],t);r=s;break;case"source":_e("error",t),r=s;break;case"img":case"image":case"link":_e("error",t),_e("load",t),r=s;break;case"details":_e("toggle",t),r=s;break;case"input":Iy(t,s),r=qd(t,s),_e("invalid",t);break;case"option":r=s;break;case"select":t._wrapperState={wasMultiple:!!s.multiple},r=we({},s,{value:void 0}),_e("invalid",t);break;case"textarea":xy(t,s),r=ep(t,s),_e("invalid",t);break;default:r=s}np(n,r),a=r;for(i in a)if(a.hasOwnProperty(i)){var c=a[i];i==="style"?tC(t,c):i==="dangerouslySetInnerHTML"?(c=c?c.__html:void 0,c!=null&&QS(t,c)):i==="children"?typeof c=="string"?(n!=="textarea"||c!=="")&&ma(t,c):typeof c=="number"&&ma(t,""+c):i!=="suppressContentEditableWarning"&&i!=="suppressHydrationWarning"&&i!=="autoFocus"&&(_a.hasOwnProperty(i)?c!=null&&i==="onScroll"&&_e("scroll",t):c!=null&&f_(t,i,c,o))}switch(n){case"input":mc(t),Py(t,s,!1);break;case"textarea":mc(t),My(t);break;case"option":s.value!=null&&t.setAttribute("value",""+zs(s.value));break;case"select":t.multiple=!!s.multiple,i=s.value,i!=null?bi(t,!!s.multiple,i,!1):s.defaultValue!=null&&bi(t,!!s.multiple,s.defaultValue,!0);break;default:typeof r.onClick=="function"&&(t.onclick=$l)}switch(n){case"button":case"input":case"select":case"textarea":s=!!s.autoFocus;break e;case"img":s=!0;break e;default:s=!1}}s&&(e.flags|=4)}e.ref!==null&&(e.flags|=512,e.flags|=2097152)}return Je(e),null;case 6:if(t&&e.stateNode!=null)w1(t,e,t.memoizedProps,s);else{if(typeof s!="string"&&e.stateNode===null)throw Error(k(166));if(n=pr(Ia.current),pr(Ln.current),bc(e)){if(s=e.stateNode,n=e.memoizedProps,s[Mn]=e,(i=s.nodeValue!==n)&&(t=xt,t!==null))switch(t.tag){case 3:wc(s.nodeValue,n,(t.mode&1)!==0);break;case 5:t.memoizedProps.suppressHydrationWarning!==!0&&wc(s.nodeValue,n,(t.mode&1)!==0)}i&&(e.flags|=4)}else s=(n.nodeType===9?n:n.ownerDocument).createTextNode(s),s[Mn]=e,e.stateNode=s}return Je(e),null;case 13:if(me(Se),s=e.memoizedState,t===null||t.memoizedState!==null&&t.memoizedState.dehydrated!==null){if(ye&&bt!==null&&e.mode&1&&!(e.flags&128))HC(),ki(),e.flags|=98560,i=!1;else if(i=bc(e),s!==null&&s.dehydrated!==null){if(t===null){if(!i)throw Error(k(318));if(i=e.memoizedState,i=i!==null?i.dehydrated:null,!i)throw Error(k(317));i[Mn]=e}else ki(),!(e.flags&128)&&(e.memoizedState=null),e.flags|=4;Je(e),i=!1}else sn!==null&&(Lp(sn),sn=null),i=!0;if(!i)return e.flags&65536?e:null}return e.flags&128?(e.lanes=n,e):(s=s!==null,s!==(t!==null&&t.memoizedState!==null)&&s&&(e.child.flags|=8192,e.mode&1&&(t===null||Se.current&1?Le===0&&(Le=3):K_())),e.updateQueue!==null&&(e.flags|=4),Je(e),null);case 4:return Vi(),Pp(t,e),t===null&&va(e.stateNode.containerInfo),Je(e),null;case 10:return M_(e.type._context),Je(e),null;case 17:return At(e.type)&&Kl(),Je(e),null;case 19:if(me(Se),i=e.memoizedState,i===null)return Je(e),null;if(s=(e.flags&128)!==0,o=i.rendering,o===null)if(s)Co(i,!1);else{if(Le!==0||t!==null&&t.flags&128)for(t=e.child;t!==null;){if(o=tu(t),o!==null){for(e.flags|=128,Co(i,!1),s=o.updateQueue,s!==null&&(e.updateQueue=s,e.flags|=4),e.subtreeFlags=0,s=n,n=e.child;n!==null;)i=n,t=s,i.flags&=14680066,o=i.alternate,o===null?(i.childLanes=0,i.lanes=t,i.child=null,i.subtreeFlags=0,i.memoizedProps=null,i.memoizedState=null,i.updateQueue=null,i.dependencies=null,i.stateNode=null):(i.childLanes=o.childLanes,i.lanes=o.lanes,i.child=o.child,i.subtreeFlags=0,i.deletions=null,i.memoizedProps=o.memoizedProps,i.memoizedState=o.memoizedState,i.updateQueue=o.updateQueue,i.type=o.type,t=o.dependencies,i.dependencies=t===null?null:{lanes:t.lanes,firstContext:t.firstContext}),n=n.sibling;return ge(Se,Se.current&1|2),e.child}t=t.sibling}i.tail!==null&&xe()>ji&&(e.flags|=128,s=!0,Co(i,!1),e.lanes=4194304)}else{if(!s)if(t=tu(o),t!==null){if(e.flags|=128,s=!0,n=t.updateQueue,n!==null&&(e.updateQueue=n,e.flags|=4),Co(i,!0),i.tail===null&&i.tailMode==="hidden"&&!o.alternate&&!ye)return Je(e),null}else 2*xe()-i.renderingStartTime>ji&&n!==1073741824&&(e.flags|=128,s=!0,Co(i,!1),e.lanes=4194304);i.isBackwards?(o.sibling=e.child,e.child=o):(n=i.last,n!==null?n.sibling=o:e.child=o,i.last=o)}return i.tail!==null?(e=i.tail,i.rendering=e,i.tail=e.sibling,i.renderingStartTime=xe(),e.sibling=null,n=Se.current,ge(Se,s?n&1|2:n&1),e):(Je(e),null);case 22:case 23:return $_(),s=e.memoizedState!==null,t!==null&&t.memoizedState!==null!==s&&(e.flags|=8192),s&&e.mode&1?wt&1073741824&&(Je(e),e.subtreeFlags&6&&(e.flags|=8192)):Je(e),null;case 24:return null;case 25:return null}throw Error(k(156,e.tag))}function n3(t,e){switch(R_(e),e.tag){case 1:return At(e.type)&&Kl(),t=e.flags,t&65536?(e.flags=t&-65537|128,e):null;case 3:return Vi(),me(yt),me(nt),D_(),t=e.flags,t&65536&&!(t&128)?(e.flags=t&-65537|128,e):null;case 5:return F_(e),null;case 13:if(me(Se),t=e.memoizedState,t!==null&&t.dehydrated!==null){if(e.alternate===null)throw Error(k(340));ki()}return t=e.flags,t&65536?(e.flags=t&-65537|128,e):null;case 19:return me(Se),null;case 4:return Vi(),null;case 10:return M_(e.type._context),null;case 22:case 23:return $_(),null;case 24:return null;default:return null}}var Pc=!1,tt=!1,s3=typeof WeakSet=="function"?WeakSet:Set,W=null;function fi(t,e){var n=t.ref;if(n!==null)if(typeof n=="function")try{n(null)}catch(s){Re(t,e,s)}else n.current=null}function xp(t,e,n){try{n()}catch(s){Re(t,e,s)}}var TA=!1;function r3(t,e){if(dp=Wl,t=PC(),w_(t)){if("selectionStart"in t)var n={start:t.selectionStart,end:t.selectionEnd};else e:{n=(n=t.ownerDocument)&&n.defaultView||window;var s=n.getSelection&&n.getSelection();if(s&&s.rangeCount!==0){n=s.anchorNode;var r=s.anchorOffset,i=s.focusNode;s=s.focusOffset;try{n.nodeType,i.nodeType}catch{n=null;break e}var o=0,a=-1,c=-1,l=0,u=0,h=t,f=null;t:for(;;){for(var d;h!==n||r!==0&&h.nodeType!==3||(a=o+r),h!==i||s!==0&&h.nodeType!==3||(c=o+s),h.nodeType===3&&(o+=h.nodeValue.length),(d=h.firstChild)!==null;)f=h,h=d;for(;;){if(h===t)break t;if(f===n&&++l===r&&(a=o),f===i&&++u===s&&(c=o),(d=h.nextSibling)!==null)break;h=f,f=h.parentNode}h=d}n=a===-1||c===-1?null:{start:a,end:c}}else n=null}n=n||{start:0,end:0}}else n=null;for(pp={focusedElem:t,selectionRange:n},Wl=!1,W=e;W!==null;)if(e=W,t=e.child,(e.subtreeFlags&1028)!==0&&t!==null)t.return=e,W=t;else for(;W!==null;){e=W;try{var g=e.alternate;if(e.flags&1024)switch(e.tag){case 0:case 11:case 15:break;case 1:if(g!==null){var _=g.memoizedProps,E=g.memoizedState,m=e.stateNode,y=m.getSnapshotBeforeUpdate(e.elementType===e.type?_:tn(e.type,_),E);m.__reactInternalSnapshotBeforeUpdate=y}break;case 3:var A=e.stateNode.containerInfo;A.nodeType===1?A.textContent="":A.nodeType===9&&A.documentElement&&A.removeChild(A.documentElement);break;case 5:case 6:case 4:case 17:break;default:throw Error(k(163))}}catch(C){Re(e,e.return,C)}if(t=e.sibling,t!==null){t.return=e.return,W=t;break}W=e.return}return g=TA,TA=!1,g}function ta(t,e,n){var s=e.updateQueue;if(s=s!==null?s.lastEffect:null,s!==null){var r=s=s.next;do{if((r.tag&t)===t){var i=r.destroy;r.destroy=void 0,i!==void 0&&xp(e,n,i)}r=r.next}while(r!==s)}}function bh(t,e){if(e=e.updateQueue,e=e!==null?e.lastEffect:null,e!==null){var n=e=e.next;do{if((n.tag&t)===t){var s=n.create;n.destroy=s()}n=n.next}while(n!==e)}}function Mp(t){var e=t.ref;if(e!==null){var n=t.stateNode;switch(t.tag){case 5:t=n;break;default:t=n}typeof e=="function"?e(t):e.current=t}}function b1(t){var e=t.alternate;e!==null&&(t.alternate=null,b1(e)),t.child=null,t.deletions=null,t.sibling=null,t.tag===5&&(e=t.stateNode,e!==null&&(delete e[Mn],delete e[ba],delete e[mp],delete e[zP],delete e[VP])),t.stateNode=null,t.return=null,t.dependencies=null,t.memoizedProps=null,t.memoizedState=null,t.pendingProps=null,t.stateNode=null,t.updateQueue=null}function R1(t){return t.tag===5||t.tag===3||t.tag===4}function EA(t){e:for(;;){for(;t.sibling===null;){if(t.return===null||R1(t.return))return null;t=t.return}for(t.sibling.return=t.return,t=t.sibling;t.tag!==5&&t.tag!==6&&t.tag!==18;){if(t.flags&2||t.child===null||t.tag===4)continue e;t.child.return=t,t=t.child}if(!(t.flags&2))return t.stateNode}}function Bp(t,e,n){var s=t.tag;if(s===5||s===6)t=t.stateNode,e?n.nodeType===8?n.parentNode.insertBefore(t,e):n.insertBefore(t,e):(n.nodeType===8?(e=n.parentNode,e.insertBefore(t,n)):(e=n,e.appendChild(t)),n=n._reactRootContainer,n!=null||e.onclick!==null||(e.onclick=$l));else if(s!==4&&(t=t.child,t!==null))for(Bp(t,e,n),t=t.sibling;t!==null;)Bp(t,e,n),t=t.sibling}function Op(t,e,n){var s=t.tag;if(s===5||s===6)t=t.stateNode,e?n.insertBefore(t,e):n.appendChild(t);else if(s!==4&&(t=t.child,t!==null))for(Op(t,e,n),t=t.sibling;t!==null;)Op(t,e,n),t=t.sibling}var Ge=null,nn=!1;function fs(t,e,n){for(n=n.child;n!==null;)I1(t,e,n),n=n.sibling}function I1(t,e,n){if(Dn&&typeof Dn.onCommitFiberUnmount=="function")try{Dn.onCommitFiberUnmount(yh,n)}catch{}switch(n.tag){case 5:tt||fi(n,e);case 6:var s=Ge,r=nn;Ge=null,fs(t,e,n),Ge=s,nn=r,Ge!==null&&(nn?(t=Ge,n=n.stateNode,t.nodeType===8?t.parentNode.removeChild(n):t.removeChild(n)):Ge.removeChild(n.stateNode));break;case 18:Ge!==null&&(nn?(t=Ge,n=n.stateNode,t.nodeType===8?bf(t.parentNode,n):t.nodeType===1&&bf(t,n),Ea(t)):bf(Ge,n.stateNode));break;case 4:s=Ge,r=nn,Ge=n.stateNode.containerInfo,nn=!0,fs(t,e,n),Ge=s,nn=r;break;case 0:case 11:case 14:case 15:if(!tt&&(s=n.updateQueue,s!==null&&(s=s.lastEffect,s!==null))){r=s=s.next;do{var i=r,o=i.destroy;i=i.tag,o!==void 0&&(i&2||i&4)&&xp(n,e,o),r=r.next}while(r!==s)}fs(t,e,n);break;case 1:if(!tt&&(fi(n,e),s=n.stateNode,typeof s.componentWillUnmount=="function"))try{s.props=n.memoizedProps,s.state=n.memoizedState,s.componentWillUnmount()}catch(a){Re(n,e,a)}fs(t,e,n);break;case 21:fs(t,e,n);break;case 22:n.mode&1?(tt=(s=tt)||n.memoizedState!==null,fs(t,e,n),tt=s):fs(t,e,n);break;default:fs(t,e,n)}}function SA(t){var e=t.updateQueue;if(e!==null){t.updateQueue=null;var n=t.stateNode;n===null&&(n=t.stateNode=new s3),e.forEach(function(s){var r=d3.bind(null,t,s);n.has(s)||(n.add(s),s.then(r,r))})}}function Qt(t,e){var n=e.deletions;if(n!==null)for(var s=0;s<n.length;s++){var r=n[s];try{var i=t,o=e,a=o;e:for(;a!==null;){switch(a.tag){case 5:Ge=a.stateNode,nn=!1;break e;case 3:Ge=a.stateNode.containerInfo,nn=!0;break e;case 4:Ge=a.stateNode.containerInfo,nn=!0;break e}a=a.return}if(Ge===null)throw Error(k(160));I1(i,o,r),Ge=null,nn=!1;var c=r.alternate;c!==null&&(c.return=null),r.return=null}catch(l){Re(r,e,l)}}if(e.subtreeFlags&12854)for(e=e.child;e!==null;)P1(e,t),e=e.sibling}function P1(t,e){var n=t.alternate,s=t.flags;switch(t.tag){case 0:case 11:case 14:case 15:if(Qt(e,t),Cn(t),s&4){try{ta(3,t,t.return),bh(3,t)}catch(_){Re(t,t.return,_)}try{ta(5,t,t.return)}catch(_){Re(t,t.return,_)}}break;case 1:Qt(e,t),Cn(t),s&512&&n!==null&&fi(n,n.return);break;case 5:if(Qt(e,t),Cn(t),s&512&&n!==null&&fi(n,n.return),t.flags&32){var r=t.stateNode;try{ma(r,"")}catch(_){Re(t,t.return,_)}}if(s&4&&(r=t.stateNode,r!=null)){var i=t.memoizedProps,o=n!==null?n.memoizedProps:i,a=t.type,c=t.updateQueue;if(t.updateQueue=null,c!==null)try{a==="input"&&i.type==="radio"&&i.name!=null&&JS(r,i),sp(a,o);var l=sp(a,i);for(o=0;o<c.length;o+=2){var u=c[o],h=c[o+1];u==="style"?tC(r,h):u==="dangerouslySetInnerHTML"?QS(r,h):u==="children"?ma(r,h):f_(r,u,h,l)}switch(a){case"input":Zd(r,i);break;case"textarea":qS(r,i);break;case"select":var f=r._wrapperState.wasMultiple;r._wrapperState.wasMultiple=!!i.multiple;var d=i.value;d!=null?bi(r,!!i.multiple,d,!1):f!==!!i.multiple&&(i.defaultValue!=null?bi(r,!!i.multiple,i.defaultValue,!0):bi(r,!!i.multiple,i.multiple?[]:"",!1))}r[ba]=i}catch(_){Re(t,t.return,_)}}break;case 6:if(Qt(e,t),Cn(t),s&4){if(t.stateNode===null)throw Error(k(162));r=t.stateNode,i=t.memoizedProps;try{r.nodeValue=i}catch(_){Re(t,t.return,_)}}break;case 3:if(Qt(e,t),Cn(t),s&4&&n!==null&&n.memoizedState.isDehydrated)try{Ea(e.containerInfo)}catch(_){Re(t,t.return,_)}break;case 4:Qt(e,t),Cn(t);break;case 13:Qt(e,t),Cn(t),r=t.child,r.flags&8192&&(i=r.memoizedState!==null,r.stateNode.isHidden=i,!i||r.alternate!==null&&r.alternate.memoizedState!==null||(G_=xe())),s&4&&SA(t);break;case 22:if(u=n!==null&&n.memoizedState!==null,t.mode&1?(tt=(l=tt)||u,Qt(e,t),tt=l):Qt(e,t),Cn(t),s&8192){if(l=t.memoizedState!==null,(t.stateNode.isHidden=l)&&!u&&t.mode&1)for(W=t,u=t.child;u!==null;){for(h=W=u;W!==null;){switch(f=W,d=f.child,f.tag){case 0:case 11:case 14:case 15:ta(4,f,f.return);break;case 1:fi(f,f.return);var g=f.stateNode;if(typeof g.componentWillUnmount=="function"){s=f,n=f.return;try{e=s,g.props=e.memoizedProps,g.state=e.memoizedState,g.componentWillUnmount()}catch(_){Re(s,n,_)}}break;case 5:fi(f,f.return);break;case 22:if(f.memoizedState!==null){vA(h);continue}}d!==null?(d.return=f,W=d):vA(h)}u=u.sibling}e:for(u=null,h=t;;){if(h.tag===5){if(u===null){u=h;try{r=h.stateNode,l?(i=r.style,typeof i.setProperty=="function"?i.setProperty("display","none","important"):i.display="none"):(a=h.stateNode,c=h.memoizedProps.style,o=c!=null&&c.hasOwnProperty("display")?c.display:null,a.style.display=eC("display",o))}catch(_){Re(t,t.return,_)}}}else if(h.tag===6){if(u===null)try{h.stateNode.nodeValue=l?"":h.memoizedProps}catch(_){Re(t,t.return,_)}}else if((h.tag!==22&&h.tag!==23||h.memoizedState===null||h===t)&&h.child!==null){h.child.return=h,h=h.child;continue}if(h===t)break e;for(;h.sibling===null;){if(h.return===null||h.return===t)break e;u===h&&(u=null),h=h.return}u===h&&(u=null),h.sibling.return=h.return,h=h.sibling}}break;case 19:Qt(e,t),Cn(t),s&4&&SA(t);break;case 21:break;default:Qt(e,t),Cn(t)}}function Cn(t){var e=t.flags;if(e&2){try{e:{for(var n=t.return;n!==null;){if(R1(n)){var s=n;break e}n=n.return}throw Error(k(160))}switch(s.tag){case 5:var r=s.stateNode;s.flags&32&&(ma(r,""),s.flags&=-33);var i=EA(t);Op(t,i,r);break;case 3:case 4:var o=s.stateNode.containerInfo,a=EA(t);Bp(t,a,o);break;default:throw Error(k(161))}}catch(c){Re(t,t.return,c)}t.flags&=-3}e&4096&&(t.flags&=-4097)}function i3(t,e,n){W=t,x1(t)}function x1(t,e,n){for(var s=(t.mode&1)!==0;W!==null;){var r=W,i=r.child;if(r.tag===22&&s){var o=r.memoizedState!==null||Pc;if(!o){var a=r.alternate,c=a!==null&&a.memoizedState!==null||tt;a=Pc;var l=tt;if(Pc=o,(tt=c)&&!l)for(W=r;W!==null;)o=W,c=o.child,o.tag===22&&o.memoizedState!==null?wA(r):c!==null?(c.return=o,W=c):wA(r);for(;i!==null;)W=i,x1(i),i=i.sibling;W=r,Pc=a,tt=l}CA(t)}else r.subtreeFlags&8772&&i!==null?(i.return=r,W=i):CA(t)}}function CA(t){for(;W!==null;){var e=W;if(e.flags&8772){var n=e.alternate;try{if(e.flags&8772)switch(e.tag){case 0:case 11:case 15:tt||bh(5,e);break;case 1:var s=e.stateNode;if(e.flags&4&&!tt)if(n===null)s.componentDidMount();else{var r=e.elementType===e.type?n.memoizedProps:tn(e.type,n.memoizedProps);s.componentDidUpdate(r,n.memoizedState,s.__reactInternalSnapshotBeforeUpdate)}var i=e.updateQueue;i!==null&&oA(e,i,s);break;case 3:var o=e.updateQueue;if(o!==null){if(n=null,e.child!==null)switch(e.child.tag){case 5:n=e.child.stateNode;break;case 1:n=e.child.stateNode}oA(e,o,n)}break;case 5:var a=e.stateNode;if(n===null&&e.flags&4){n=a;var c=e.memoizedProps;switch(e.type){case"button":case"input":case"select":case"textarea":c.autoFocus&&n.focus();break;case"img":c.src&&(n.src=c.src)}}break;case 6:break;case 4:break;case 12:break;case 13:if(e.memoizedState===null){var l=e.alternate;if(l!==null){var u=l.memoizedState;if(u!==null){var h=u.dehydrated;h!==null&&Ea(h)}}}break;case 19:case 17:case 21:case 22:case 23:case 25:break;default:throw Error(k(163))}tt||e.flags&512&&Mp(e)}catch(f){Re(e,e.return,f)}}if(e===t){W=null;break}if(n=e.sibling,n!==null){n.return=e.return,W=n;break}W=e.return}}function vA(t){for(;W!==null;){var e=W;if(e===t){W=null;break}var n=e.sibling;if(n!==null){n.return=e.return,W=n;break}W=e.return}}function wA(t){for(;W!==null;){var e=W;try{switch(e.tag){case 0:case 11:case 15:var n=e.return;try{bh(4,e)}catch(c){Re(e,n,c)}break;case 1:var s=e.stateNode;if(typeof s.componentDidMount=="function"){var r=e.return;try{s.componentDidMount()}catch(c){Re(e,r,c)}}var i=e.return;try{Mp(e)}catch(c){Re(e,i,c)}break;case 5:var o=e.return;try{Mp(e)}catch(c){Re(e,o,c)}}}catch(c){Re(e,e.return,c)}if(e===t){W=null;break}var a=e.sibling;if(a!==null){a.return=e.return,W=a;break}W=e.return}}var o3=Math.ceil,ru=ls.ReactCurrentDispatcher,j_=ls.ReactCurrentOwner,Wt=ls.ReactCurrentBatchConfig,ne=0,He=null,Fe=null,$e=0,wt=0,di=$s(0),Le=0,Ba=null,Pr=0,Rh=0,W_=0,na=null,gt=null,G_=0,ji=1/0,Wn=null,iu=!1,Np=null,Fs=null,xc=!1,bs=null,ou=0,sa=0,Fp=null,vl=-1,wl=0;function at(){return ne&6?xe():vl!==-1?vl:vl=xe()}function Ds(t){return t.mode&1?ne&2&&$e!==0?$e&-$e:jP.transition!==null?(wl===0&&(wl=dC()),wl):(t=ce,t!==0||(t=window.event,t=t===void 0?16:TC(t.type)),t):1}function gn(t,e,n,s){if(50<sa)throw sa=0,Fp=null,Error(k(185));$a(t,n,s),(!(ne&2)||t!==He)&&(t===He&&(!(ne&2)&&(Rh|=n),Le===4&&vs(t,$e)),Tt(t,s),n===1&&ne===0&&!(e.mode&1)&&(ji=xe()+500,Ch&&Ks()))}function Tt(t,e){var n=t.callbackNode;jI(t,e);var s=jl(t,t===He?$e:0);if(s===0)n!==null&&Ny(n),t.callbackNode=null,t.callbackPriority=0;else if(e=s&-s,t.callbackPriority!==e){if(n!=null&&Ny(n),e===1)t.tag===0?HP(bA.bind(null,t)):kC(bA.bind(null,t)),UP(function(){!(ne&6)&&Ks()}),n=null;else{switch(pC(s)){case 1:n=m_;break;case 4:n=hC;break;case 16:n=Hl;break;case 536870912:n=fC;break;default:n=Hl}n=U1(n,M1.bind(null,t))}t.callbackPriority=e,t.callbackNode=n}}function M1(t,e){if(vl=-1,wl=0,ne&6)throw Error(k(327));var n=t.callbackNode;if(Mi()&&t.callbackNode!==n)return null;var s=jl(t,t===He?$e:0);if(s===0)return null;if(s&30||s&t.expiredLanes||e)e=au(t,s);else{e=s;var r=ne;ne|=2;var i=O1();(He!==t||$e!==e)&&(Wn=null,ji=xe()+500,Ar(t,e));do try{l3();break}catch(a){B1(t,a)}while(1);x_(),ru.current=i,ne=r,Fe!==null?e=0:(He=null,$e=0,e=Le)}if(e!==0){if(e===2&&(r=cp(t),r!==0&&(s=r,e=Dp(t,r))),e===1)throw n=Ba,Ar(t,0),vs(t,s),Tt(t,xe()),n;if(e===6)vs(t,s);else{if(r=t.current.alternate,!(s&30)&&!a3(r)&&(e=au(t,s),e===2&&(i=cp(t),i!==0&&(s=i,e=Dp(t,i))),e===1))throw n=Ba,Ar(t,0),vs(t,s),Tt(t,xe()),n;switch(t.finishedWork=r,t.finishedLanes=s,e){case 0:case 1:throw Error(k(345));case 2:cr(t,gt,Wn);break;case 3:if(vs(t,s),(s&130023424)===s&&(e=G_+500-xe(),10<e)){if(jl(t,0)!==0)break;if(r=t.suspendedLanes,(r&s)!==s){at(),t.pingedLanes|=t.suspendedLanes&r;break}t.timeoutHandle=_p(cr.bind(null,t,gt,Wn),e);break}cr(t,gt,Wn);break;case 4:if(vs(t,s),(s&4194240)===s)break;for(e=t.eventTimes,r=-1;0<s;){var o=31-pn(s);i=1<<o,o=e[o],o>r&&(r=o),s&=~i}if(s=r,s=xe()-s,s=(120>s?120:480>s?480:1080>s?1080:1920>s?1920:3e3>s?3e3:4320>s?4320:1960*o3(s/1960))-s,10<s){t.timeoutHandle=_p(cr.bind(null,t,gt,Wn),s);break}cr(t,gt,Wn);break;case 5:cr(t,gt,Wn);break;default:throw Error(k(329))}}}return Tt(t,xe()),t.callbackNode===n?M1.bind(null,t):null}function Dp(t,e){var n=na;return t.current.memoizedState.isDehydrated&&(Ar(t,e).flags|=256),t=au(t,e),t!==2&&(e=gt,gt=n,e!==null&&Lp(e)),t}function Lp(t){gt===null?gt=t:gt.push.apply(gt,t)}function a3(t){for(var e=t;;){if(e.flags&16384){var n=e.updateQueue;if(n!==null&&(n=n.stores,n!==null))for(var s=0;s<n.length;s++){var r=n[s],i=r.getSnapshot;r=r.value;try{if(!mn(i(),r))return!1}catch{return!1}}}if(n=e.child,e.subtreeFlags&16384&&n!==null)n.return=e,e=n;else{if(e===t)break;for(;e.sibling===null;){if(e.return===null||e.return===t)return!0;e=e.return}e.sibling.return=e.return,e=e.sibling}}return!0}function vs(t,e){for(e&=~W_,e&=~Rh,t.suspendedLanes|=e,t.pingedLanes&=~e,t=t.expirationTimes;0<e;){var n=31-pn(e),s=1<<n;t[n]=-1,e&=~s}}function bA(t){if(ne&6)throw Error(k(327));Mi();var e=jl(t,0);if(!(e&1))return Tt(t,xe()),null;var n=au(t,e);if(t.tag!==0&&n===2){var s=cp(t);s!==0&&(e=s,n=Dp(t,s))}if(n===1)throw n=Ba,Ar(t,0),vs(t,e),Tt(t,xe()),n;if(n===6)throw Error(k(345));return t.finishedWork=t.current.alternate,t.finishedLanes=e,cr(t,gt,Wn),Tt(t,xe()),null}function X_(t,e){var n=ne;ne|=1;try{return t(e)}finally{ne=n,ne===0&&(ji=xe()+500,Ch&&Ks())}}function xr(t){bs!==null&&bs.tag===0&&!(ne&6)&&Mi();var e=ne;ne|=1;var n=Wt.transition,s=ce;try{if(Wt.transition=null,ce=1,t)return t()}finally{ce=s,Wt.transition=n,ne=e,!(ne&6)&&Ks()}}function $_(){wt=di.current,me(di)}function Ar(t,e){t.finishedWork=null,t.finishedLanes=0;var n=t.timeoutHandle;if(n!==-1&&(t.timeoutHandle=-1,LP(n)),Fe!==null)for(n=Fe.return;n!==null;){var s=n;switch(R_(s),s.tag){case 1:s=s.type.childContextTypes,s!=null&&Kl();break;case 3:Vi(),me(yt),me(nt),D_();break;case 5:F_(s);break;case 4:Vi();break;case 13:me(Se);break;case 19:me(Se);break;case 10:M_(s.type._context);break;case 22:case 23:$_()}n=n.return}if(He=t,Fe=t=Ls(t.current,null),$e=wt=e,Le=0,Ba=null,W_=Rh=Pr=0,gt=na=null,dr!==null){for(e=0;e<dr.length;e++)if(n=dr[e],s=n.interleaved,s!==null){n.interleaved=null;var r=s.next,i=n.pending;if(i!==null){var o=i.next;i.next=r,s.next=o}n.pending=s}dr=null}return t}function B1(t,e){do{var n=Fe;try{if(x_(),El.current=su,nu){for(var s=ve.memoizedState;s!==null;){var r=s.queue;r!==null&&(r.pending=null),s=s.next}nu=!1}if(Ir=0,Ve=De=ve=null,ea=!1,Pa=0,j_.current=null,n===null||n.return===null){Le=1,Ba=e,Fe=null;break}e:{var i=t,o=n.return,a=n,c=e;if(e=$e,a.flags|=32768,c!==null&&typeof c=="object"&&typeof c.then=="function"){var l=c,u=a,h=u.tag;if(!(u.mode&1)&&(h===0||h===11||h===15)){var f=u.alternate;f?(u.updateQueue=f.updateQueue,u.memoizedState=f.memoizedState,u.lanes=f.lanes):(u.updateQueue=null,u.memoizedState=null)}var d=dA(o);if(d!==null){d.flags&=-257,pA(d,o,a,i,e),d.mode&1&&fA(i,l,e),e=d,c=l;var g=e.updateQueue;if(g===null){var _=new Set;_.add(c),e.updateQueue=_}else g.add(c);break e}else{if(!(e&1)){fA(i,l,e),K_();break e}c=Error(k(426))}}else if(ye&&a.mode&1){var E=dA(o);if(E!==null){!(E.flags&65536)&&(E.flags|=256),pA(E,o,a,i,e),I_(Hi(c,a));break e}}i=c=Hi(c,a),Le!==4&&(Le=2),na===null?na=[i]:na.push(i),i=o;do{switch(i.tag){case 3:i.flags|=65536,e&=-e,i.lanes|=e;var m=g1(i,c,e);iA(i,m);break e;case 1:a=c;var y=i.type,A=i.stateNode;if(!(i.flags&128)&&(typeof y.getDerivedStateFromError=="function"||A!==null&&typeof A.componentDidCatch=="function"&&(Fs===null||!Fs.has(A)))){i.flags|=65536,e&=-e,i.lanes|=e;var C=_1(i,a,e);iA(i,C);break e}}i=i.return}while(i!==null)}F1(n)}catch(b){e=b,Fe===n&&n!==null&&(Fe=n=n.return);continue}break}while(1)}function O1(){var t=ru.current;return ru.current=su,t===null?su:t}function K_(){(Le===0||Le===3||Le===2)&&(Le=4),He===null||!(Pr&268435455)&&!(Rh&268435455)||vs(He,$e)}function au(t,e){var n=ne;ne|=2;var s=O1();(He!==t||$e!==e)&&(Wn=null,Ar(t,e));do try{c3();break}catch(r){B1(t,r)}while(1);if(x_(),ne=n,ru.current=s,Fe!==null)throw Error(k(261));return He=null,$e=0,Le}function c3(){for(;Fe!==null;)N1(Fe)}function l3(){for(;Fe!==null&&!NI();)N1(Fe)}function N1(t){var e=L1(t.alternate,t,wt);t.memoizedProps=t.pendingProps,e===null?F1(t):Fe=e,j_.current=null}function F1(t){var e=t;do{var n=e.alternate;if(t=e.return,e.flags&32768){if(n=n3(n,e),n!==null){n.flags&=32767,Fe=n;return}if(t!==null)t.flags|=32768,t.subtreeFlags=0,t.deletions=null;else{Le=6,Fe=null;return}}else if(n=t3(n,e,wt),n!==null){Fe=n;return}if(e=e.sibling,e!==null){Fe=e;return}Fe=e=t}while(e!==null);Le===0&&(Le=5)}function cr(t,e,n){var s=ce,r=Wt.transition;try{Wt.transition=null,ce=1,u3(t,e,n,s)}finally{Wt.transition=r,ce=s}return null}function u3(t,e,n,s){do Mi();while(bs!==null);if(ne&6)throw Error(k(327));n=t.finishedWork;var r=t.finishedLanes;if(n===null)return null;if(t.finishedWork=null,t.finishedLanes=0,n===t.current)throw Error(k(177));t.callbackNode=null,t.callbackPriority=0;var i=n.lanes|n.childLanes;if(WI(t,i),t===He&&(Fe=He=null,$e=0),!(n.subtreeFlags&2064)&&!(n.flags&2064)||xc||(xc=!0,U1(Hl,function(){return Mi(),null})),i=(n.flags&15990)!==0,n.subtreeFlags&15990||i){i=Wt.transition,Wt.transition=null;var o=ce;ce=1;var a=ne;ne|=4,j_.current=null,r3(t,n),P1(n,t),xP(pp),Wl=!!dp,pp=dp=null,t.current=n,i3(n),FI(),ne=a,ce=o,Wt.transition=i}else t.current=n;if(xc&&(xc=!1,bs=t,ou=r),i=t.pendingLanes,i===0&&(Fs=null),UI(n.stateNode),Tt(t,xe()),e!==null)for(s=t.onRecoverableError,n=0;n<e.length;n++)r=e[n],s(r.value,{componentStack:r.stack,digest:r.digest});if(iu)throw iu=!1,t=Np,Np=null,t;return ou&1&&t.tag!==0&&Mi(),i=t.pendingLanes,i&1?t===Fp?sa++:(sa=0,Fp=t):sa=0,Ks(),null}function Mi(){if(bs!==null){var t=pC(ou),e=Wt.transition,n=ce;try{if(Wt.transition=null,ce=16>t?16:t,bs===null)var s=!1;else{if(t=bs,bs=null,ou=0,ne&6)throw Error(k(331));var r=ne;for(ne|=4,W=t.current;W!==null;){var i=W,o=i.child;if(W.flags&16){var a=i.deletions;if(a!==null){for(var c=0;c<a.length;c++){var l=a[c];for(W=l;W!==null;){var u=W;switch(u.tag){case 0:case 11:case 15:ta(8,u,i)}var h=u.child;if(h!==null)h.return=u,W=h;else for(;W!==null;){u=W;var f=u.sibling,d=u.return;if(b1(u),u===l){W=null;break}if(f!==null){f.return=d,W=f;break}W=d}}}var g=i.alternate;if(g!==null){var _=g.child;if(_!==null){g.child=null;do{var E=_.sibling;_.sibling=null,_=E}while(_!==null)}}W=i}}if(i.subtreeFlags&2064&&o!==null)o.return=i,W=o;else e:for(;W!==null;){if(i=W,i.flags&2048)switch(i.tag){case 0:case 11:case 15:ta(9,i,i.return)}var m=i.sibling;if(m!==null){m.return=i.return,W=m;break e}W=i.return}}var y=t.current;for(W=y;W!==null;){o=W;var A=o.child;if(o.subtreeFlags&2064&&A!==null)A.return=o,W=A;else e:for(o=y;W!==null;){if(a=W,a.flags&2048)try{switch(a.tag){case 0:case 11:case 15:bh(9,a)}}catch(b){Re(a,a.return,b)}if(a===o){W=null;break e}var C=a.sibling;if(C!==null){C.return=a.return,W=C;break e}W=a.return}}if(ne=r,Ks(),Dn&&typeof Dn.onPostCommitFiberRoot=="function")try{Dn.onPostCommitFiberRoot(yh,t)}catch{}s=!0}return s}finally{ce=n,Wt.transition=e}}return!1}function RA(t,e,n){e=Hi(n,e),e=g1(t,e,1),t=Ns(t,e,1),e=at(),t!==null&&($a(t,1,e),Tt(t,e))}function Re(t,e,n){if(t.tag===3)RA(t,t,n);else for(;e!==null;){if(e.tag===3){RA(e,t,n);break}else if(e.tag===1){var s=e.stateNode;if(typeof e.type.getDerivedStateFromError=="function"||typeof s.componentDidCatch=="function"&&(Fs===null||!Fs.has(s))){t=Hi(n,t),t=_1(e,t,1),e=Ns(e,t,1),t=at(),e!==null&&($a(e,1,t),Tt(e,t));break}}e=e.return}}function h3(t,e,n){var s=t.pingCache;s!==null&&s.delete(e),e=at(),t.pingedLanes|=t.suspendedLanes&n,He===t&&($e&n)===n&&(Le===4||Le===3&&($e&130023424)===$e&&500>xe()-G_?Ar(t,0):W_|=n),Tt(t,e)}function D1(t,e){e===0&&(t.mode&1?(e=Tc,Tc<<=1,!(Tc&130023424)&&(Tc=4194304)):e=1);var n=at();t=ss(t,e),t!==null&&($a(t,e,n),Tt(t,n))}function f3(t){var e=t.memoizedState,n=0;e!==null&&(n=e.retryLane),D1(t,n)}function d3(t,e){var n=0;switch(t.tag){case 13:var s=t.stateNode,r=t.memoizedState;r!==null&&(n=r.retryLane);break;case 19:s=t.stateNode;break;default:throw Error(k(314))}s!==null&&s.delete(e),D1(t,n)}var L1;L1=function(t,e,n){if(t!==null)if(t.memoizedProps!==e.pendingProps||yt.current)_t=!0;else{if(!(t.lanes&n)&&!(e.flags&128))return _t=!1,e3(t,e,n);_t=!!(t.flags&131072)}else _t=!1,ye&&e.flags&1048576&&zC(e,ql,e.index);switch(e.lanes=0,e.tag){case 2:var s=e.type;Cl(t,e),t=e.pendingProps;var r=Ui(e,nt.current);xi(e,n),r=U_(null,e,s,t,r,n);var i=k_();return e.flags|=1,typeof r=="object"&&r!==null&&typeof r.render=="function"&&r.$$typeof===void 0?(e.tag=1,e.memoizedState=null,e.updateQueue=null,At(s)?(i=!0,Yl(e)):i=!1,e.memoizedState=r.state!==null&&r.state!==void 0?r.state:null,O_(e),r.updater=vh,e.stateNode=r,r._reactInternals=e,Cp(e,s,t,n),e=bp(null,e,s,!0,i,n)):(e.tag=0,ye&&i&&b_(e),ot(null,e,r,n),e=e.child),e;case 16:s=e.elementType;e:{switch(Cl(t,e),t=e.pendingProps,r=s._init,s=r(s._payload),e.type=s,r=e.tag=g3(s),t=tn(s,t),r){case 0:e=wp(null,e,s,t,n);break e;case 1:e=mA(null,e,s,t,n);break e;case 11:e=gA(null,e,s,t,n);break e;case 14:e=_A(null,e,s,tn(s.type,t),n);break e}throw Error(k(306,s,""))}return e;case 0:return s=e.type,r=e.pendingProps,r=e.elementType===s?r:tn(s,r),wp(t,e,s,r,n);case 1:return s=e.type,r=e.pendingProps,r=e.elementType===s?r:tn(s,r),mA(t,e,s,r,n);case 3:e:{if(T1(e),t===null)throw Error(k(387));s=e.pendingProps,i=e.memoizedState,r=i.element,WC(t,e),eu(e,s,null,n);var o=e.memoizedState;if(s=o.element,i.isDehydrated)if(i={element:s,isDehydrated:!1,cache:o.cache,pendingSuspenseBoundaries:o.pendingSuspenseBoundaries,transitions:o.transitions},e.updateQueue.baseState=i,e.memoizedState=i,e.flags&256){r=Hi(Error(k(423)),e),e=yA(t,e,s,n,r);break e}else if(s!==r){r=Hi(Error(k(424)),e),e=yA(t,e,s,n,r);break e}else for(bt=Os(e.stateNode.containerInfo.firstChild),xt=e,ye=!0,sn=null,n=KC(e,null,s,n),e.child=n;n;)n.flags=n.flags&-3|4096,n=n.sibling;else{if(ki(),s===r){e=rs(t,e,n);break e}ot(t,e,s,n)}e=e.child}return e;case 5:return YC(e),t===null&&Tp(e),s=e.type,r=e.pendingProps,i=t!==null?t.memoizedProps:null,o=r.children,gp(s,r)?o=null:i!==null&&gp(s,i)&&(e.flags|=32),A1(t,e),ot(t,e,o,n),e.child;case 6:return t===null&&Tp(e),null;case 13:return E1(t,e,n);case 4:return N_(e,e.stateNode.containerInfo),s=e.pendingProps,t===null?e.child=zi(e,null,s,n):ot(t,e,s,n),e.child;case 11:return s=e.type,r=e.pendingProps,r=e.elementType===s?r:tn(s,r),gA(t,e,s,r,n);case 7:return ot(t,e,e.pendingProps,n),e.child;case 8:return ot(t,e,e.pendingProps.children,n),e.child;case 12:return ot(t,e,e.pendingProps.children,n),e.child;case 10:e:{if(s=e.type._context,r=e.pendingProps,i=e.memoizedProps,o=r.value,ge(Zl,s._currentValue),s._currentValue=o,i!==null)if(mn(i.value,o)){if(i.children===r.children&&!yt.current){e=rs(t,e,n);break e}}else for(i=e.child,i!==null&&(i.return=e);i!==null;){var a=i.dependencies;if(a!==null){o=i.child;for(var c=a.firstContext;c!==null;){if(c.context===s){if(i.tag===1){c=es(-1,n&-n),c.tag=2;var l=i.updateQueue;if(l!==null){l=l.shared;var u=l.pending;u===null?c.next=c:(c.next=u.next,u.next=c),l.pending=c}}i.lanes|=n,c=i.alternate,c!==null&&(c.lanes|=n),Ep(i.return,n,e),a.lanes|=n;break}c=c.next}}else if(i.tag===10)o=i.type===e.type?null:i.child;else if(i.tag===18){if(o=i.return,o===null)throw Error(k(341));o.lanes|=n,a=o.alternate,a!==null&&(a.lanes|=n),Ep(o,n,e),o=i.sibling}else o=i.child;if(o!==null)o.return=i;else for(o=i;o!==null;){if(o===e){o=null;break}if(i=o.sibling,i!==null){i.return=o.return,o=i;break}o=o.return}i=o}ot(t,e,r.children,n),e=e.child}return e;case 9:return r=e.type,s=e.pendingProps.children,xi(e,n),r=Yt(r),s=s(r),e.flags|=1,ot(t,e,s,n),e.child;case 14:return s=e.type,r=tn(s,e.pendingProps),r=tn(s.type,r),_A(t,e,s,r,n);case 15:return m1(t,e,e.type,e.pendingProps,n);case 17:return s=e.type,r=e.pendingProps,r=e.elementType===s?r:tn(s,r),Cl(t,e),e.tag=1,At(s)?(t=!0,Yl(e)):t=!1,xi(e,n),XC(e,s,r),Cp(e,s,r,n),bp(null,e,s,!0,t,n);case 19:return S1(t,e,n);case 22:return y1(t,e,n)}throw Error(k(156,e.tag))};function U1(t,e){return uC(t,e)}function p3(t,e,n,s){this.tag=t,this.key=n,this.sibling=this.child=this.return=this.stateNode=this.type=this.elementType=null,this.index=0,this.ref=null,this.pendingProps=e,this.dependencies=this.memoizedState=this.updateQueue=this.memoizedProps=null,this.mode=s,this.subtreeFlags=this.flags=0,this.deletions=null,this.childLanes=this.lanes=0,this.alternate=null}function Vt(t,e,n,s){return new p3(t,e,n,s)}function Y_(t){return t=t.prototype,!(!t||!t.isReactComponent)}function g3(t){if(typeof t=="function")return Y_(t)?1:0;if(t!=null){if(t=t.$$typeof,t===p_)return 11;if(t===g_)return 14}return 2}function Ls(t,e){var n=t.alternate;return n===null?(n=Vt(t.tag,e,t.key,t.mode),n.elementType=t.elementType,n.type=t.type,n.stateNode=t.stateNode,n.alternate=t,t.alternate=n):(n.pendingProps=e,n.type=t.type,n.flags=0,n.subtreeFlags=0,n.deletions=null),n.flags=t.flags&14680064,n.childLanes=t.childLanes,n.lanes=t.lanes,n.child=t.child,n.memoizedProps=t.memoizedProps,n.memoizedState=t.memoizedState,n.updateQueue=t.updateQueue,e=t.dependencies,n.dependencies=e===null?null:{lanes:e.lanes,firstContext:e.firstContext},n.sibling=t.sibling,n.index=t.index,n.ref=t.ref,n}function bl(t,e,n,s,r,i){var o=2;if(s=t,typeof t=="function")Y_(t)&&(o=1);else if(typeof t=="string")o=5;else e:switch(t){case si:return Tr(n.children,r,i,e);case d_:o=8,r|=8;break;case $d:return t=Vt(12,n,e,r|2),t.elementType=$d,t.lanes=i,t;case Kd:return t=Vt(13,n,e,r),t.elementType=Kd,t.lanes=i,t;case Yd:return t=Vt(19,n,e,r),t.elementType=Yd,t.lanes=i,t;case $S:return Ih(n,r,i,e);default:if(typeof t=="object"&&t!==null)switch(t.$$typeof){case GS:o=10;break e;case XS:o=9;break e;case p_:o=11;break e;case g_:o=14;break e;case As:o=16,s=null;break e}throw Error(k(130,t==null?t:typeof t,""))}return e=Vt(o,n,e,r),e.elementType=t,e.type=s,e.lanes=i,e}function Tr(t,e,n,s){return t=Vt(7,t,s,e),t.lanes=n,t}function Ih(t,e,n,s){return t=Vt(22,t,s,e),t.elementType=$S,t.lanes=n,t.stateNode={isHidden:!1},t}function Nf(t,e,n){return t=Vt(6,t,null,e),t.lanes=n,t}function Ff(t,e,n){return e=Vt(4,t.children!==null?t.children:[],t.key,e),e.lanes=n,e.stateNode={containerInfo:t.containerInfo,pendingChildren:null,implementation:t.implementation},e}function _3(t,e,n,s,r){this.tag=e,this.containerInfo=t,this.finishedWork=this.pingCache=this.current=this.pendingChildren=null,this.timeoutHandle=-1,this.callbackNode=this.pendingContext=this.context=null,this.callbackPriority=0,this.eventTimes=gf(0),this.expirationTimes=gf(-1),this.entangledLanes=this.finishedLanes=this.mutableReadLanes=this.expiredLanes=this.pingedLanes=this.suspendedLanes=this.pendingLanes=0,this.entanglements=gf(0),this.identifierPrefix=s,this.onRecoverableError=r,this.mutableSourceEagerHydrationData=null}function J_(t,e,n,s,r,i,o,a,c){return t=new _3(t,e,n,a,c),e===1?(e=1,i===!0&&(e|=8)):e=0,i=Vt(3,null,null,e),t.current=i,i.stateNode=t,i.memoizedState={element:s,isDehydrated:n,cache:null,transitions:null,pendingSuspenseBoundaries:null},O_(i),t}function m3(t,e,n){var s=3<arguments.length&&arguments[3]!==void 0?arguments[3]:null;return{$$typeof:ni,key:s==null?null:""+s,children:t,containerInfo:e,implementation:n}}function k1(t){if(!t)return Vs;t=t._reactInternals;e:{if(Dr(t)!==t||t.tag!==1)throw Error(k(170));var e=t;do{switch(e.tag){case 3:e=e.stateNode.context;break e;case 1:if(At(e.type)){e=e.stateNode.__reactInternalMemoizedMergedChildContext;break e}}e=e.return}while(e!==null);throw Error(k(171))}if(t.tag===1){var n=t.type;if(At(n))return UC(t,n,e)}return e}function z1(t,e,n,s,r,i,o,a,c){return t=J_(n,s,!0,t,r,i,o,a,c),t.context=k1(null),n=t.current,s=at(),r=Ds(n),i=es(s,r),i.callback=e??null,Ns(n,i,r),t.current.lanes=r,$a(t,r,s),Tt(t,s),t}function Ph(t,e,n,s){var r=e.current,i=at(),o=Ds(r);return n=k1(n),e.context===null?e.context=n:e.pendingContext=n,e=es(i,o),e.payload={element:t},s=s===void 0?null:s,s!==null&&(e.callback=s),t=Ns(r,e,o),t!==null&&(gn(t,r,o,i),Tl(t,r,o)),o}function cu(t){if(t=t.current,!t.child)return null;switch(t.child.tag){case 5:return t.child.stateNode;default:return t.child.stateNode}}function IA(t,e){if(t=t.memoizedState,t!==null&&t.dehydrated!==null){var n=t.retryLane;t.retryLane=n!==0&&n<e?n:e}}function q_(t,e){IA(t,e),(t=t.alternate)&&IA(t,e)}function y3(){return null}var V1=typeof reportError=="function"?reportError:function(t){console.error(t)};function Z_(t){this._internalRoot=t}xh.prototype.render=Z_.prototype.render=function(t){var e=this._internalRoot;if(e===null)throw Error(k(409));Ph(t,e,null,null)};xh.prototype.unmount=Z_.prototype.unmount=function(){var t=this._internalRoot;if(t!==null){this._internalRoot=null;var e=t.containerInfo;xr(function(){Ph(null,t,null,null)}),e[ns]=null}};function xh(t){this._internalRoot=t}xh.prototype.unstable_scheduleHydration=function(t){if(t){var e=mC();t={blockedOn:null,target:t,priority:e};for(var n=0;n<Cs.length&&e!==0&&e<Cs[n].priority;n++);Cs.splice(n,0,t),n===0&&AC(t)}};function Q_(t){return!(!t||t.nodeType!==1&&t.nodeType!==9&&t.nodeType!==11)}function Mh(t){return!(!t||t.nodeType!==1&&t.nodeType!==9&&t.nodeType!==11&&(t.nodeType!==8||t.nodeValue!==" react-mount-point-unstable "))}function PA(){}function A3(t,e,n,s,r){if(r){if(typeof s=="function"){var i=s;s=function(){var l=cu(o);i.call(l)}}var o=z1(e,s,t,0,null,!1,!1,"",PA);return t._reactRootContainer=o,t[ns]=o.current,va(t.nodeType===8?t.parentNode:t),xr(),o}for(;r=t.lastChild;)t.removeChild(r);if(typeof s=="function"){var a=s;s=function(){var l=cu(c);a.call(l)}}var c=J_(t,0,!1,null,null,!1,!1,"",PA);return t._reactRootContainer=c,t[ns]=c.current,va(t.nodeType===8?t.parentNode:t),xr(function(){Ph(e,c,n,s)}),c}function Bh(t,e,n,s,r){var i=n._reactRootContainer;if(i){var o=i;if(typeof r=="function"){var a=r;r=function(){var c=cu(o);a.call(c)}}Ph(e,o,t,r)}else o=A3(n,e,t,r,s);return cu(o)}gC=function(t){switch(t.tag){case 3:var e=t.stateNode;if(e.current.memoizedState.isDehydrated){var n=ko(e.pendingLanes);n!==0&&(y_(e,n|1),Tt(e,xe()),!(ne&6)&&(ji=xe()+500,Ks()))}break;case 13:xr(function(){var s=ss(t,1);if(s!==null){var r=at();gn(s,t,1,r)}}),q_(t,1)}};A_=function(t){if(t.tag===13){var e=ss(t,134217728);if(e!==null){var n=at();gn(e,t,134217728,n)}q_(t,134217728)}};_C=function(t){if(t.tag===13){var e=Ds(t),n=ss(t,e);if(n!==null){var s=at();gn(n,t,e,s)}q_(t,e)}};mC=function(){return ce};yC=function(t,e){var n=ce;try{return ce=t,e()}finally{ce=n}};ip=function(t,e,n){switch(e){case"input":if(Zd(t,n),e=n.name,n.type==="radio"&&e!=null){for(n=t;n.parentNode;)n=n.parentNode;for(n=n.querySelectorAll("input[name="+JSON.stringify(""+e)+'][type="radio"]'),e=0;e<n.length;e++){var s=n[e];if(s!==t&&s.form===t.form){var r=Sh(s);if(!r)throw Error(k(90));YS(s),Zd(s,r)}}}break;case"textarea":qS(t,n);break;case"select":e=n.value,e!=null&&bi(t,!!n.multiple,e,!1)}};rC=X_;iC=xr;var T3={usingClientEntryPoint:!1,Events:[Ya,ai,Sh,nC,sC,X_]},vo={findFiberByHostInstance:fr,bundleType:0,version:"18.2.0",rendererPackageName:"react-dom"},E3={bundleType:vo.bundleType,version:vo.version,rendererPackageName:vo.rendererPackageName,rendererConfig:vo.rendererConfig,overrideHookState:null,overrideHookStateDeletePath:null,overrideHookStateRenamePath:null,overrideProps:null,overridePropsDeletePath:null,overridePropsRenamePath:null,setErrorHandler:null,setSuspenseHandler:null,scheduleUpdate:null,currentDispatcherRef:ls.ReactCurrentDispatcher,findHostInstanceByFiber:function(t){return t=cC(t),t===null?null:t.stateNode},findFiberByHostInstance:vo.findFiberByHostInstance||y3,findHostInstancesForRefresh:null,scheduleRefresh:null,scheduleRoot:null,setRefreshHandler:null,getCurrentFiber:null,reconcilerVersion:"18.2.0-next-9e3b772b8-20220608"};if(typeof __REACT_DEVTOOLS_GLOBAL_HOOK__<"u"){var Mc=__REACT_DEVTOOLS_GLOBAL_HOOK__;if(!Mc.isDisabled&&Mc.supportsFiber)try{yh=Mc.inject(E3),Dn=Mc}catch{}}Bt.__SECRET_INTERNALS_DO_NOT_USE_OR_YOU_WILL_BE_FIRED=T3;Bt.createPortal=function(t,e){var n=2<arguments.length&&arguments[2]!==void 0?arguments[2]:null;if(!Q_(e))throw Error(k(200));return m3(t,e,null,n)};Bt.createRoot=function(t,e){if(!Q_(t))throw Error(k(299));var n=!1,s="",r=V1;return e!=null&&(e.unstable_strictMode===!0&&(n=!0),e.identifierPrefix!==void 0&&(s=e.identifierPrefix),e.onRecoverableError!==void 0&&(r=e.onRecoverableError)),e=J_(t,1,!1,null,null,n,!1,s,r),t[ns]=e.current,va(t.nodeType===8?t.parentNode:t),new Z_(e)};Bt.findDOMNode=function(t){if(t==null)return null;if(t.nodeType===1)return t;var e=t._reactInternals;if(e===void 0)throw typeof t.render=="function"?Error(k(188)):(t=Object.keys(t).join(","),Error(k(268,t)));return t=cC(e),t=t===null?null:t.stateNode,t};Bt.flushSync=function(t){return xr(t)};Bt.hydrate=function(t,e,n){if(!Mh(e))throw Error(k(200));return Bh(null,t,e,!0,n)};Bt.hydrateRoot=function(t,e,n){if(!Q_(t))throw Error(k(405));var s=n!=null&&n.hydratedSources||null,r=!1,i="",o=V1;if(n!=null&&(n.unstable_strictMode===!0&&(r=!0),n.identifierPrefix!==void 0&&(i=n.identifierPrefix),n.onRecoverableError!==void 0&&(o=n.onRecoverableError)),e=z1(e,null,t,1,n??null,r,!1,i,o),t[ns]=e.current,va(t),s)for(t=0;t<s.length;t++)n=s[t],r=n._getVersion,r=r(n._source),e.mutableSourceEagerHydrationData==null?e.mutableSourceEagerHydrationData=[n,r]:e.mutableSourceEagerHydrationData.push(n,r);return new xh(e)};Bt.render=function(t,e,n){if(!Mh(e))throw Error(k(200));return Bh(null,t,e,!1,n)};Bt.unmountComponentAtNode=function(t){if(!Mh(t))throw Error(k(40));return t._reactRootContainer?(xr(function(){Bh(null,null,t,!1,function(){t._reactRootContainer=null,t[ns]=null})}),!0):!1};Bt.unstable_batchedUpdates=X_;Bt.unstable_renderSubtreeIntoContainer=function(t,e,n,s){if(!Mh(n))throw Error(k(200));if(t==null||t._reactInternals===void 0)throw Error(k(38));return Bh(t,e,n,!1,s)};Bt.version="18.2.0-next-9e3b772b8-20220608";function H1(){if(!(typeof __REACT_DEVTOOLS_GLOBAL_HOOK__>"u"||typeof __REACT_DEVTOOLS_GLOBAL_HOOK__.checkDCE!="function"))try{__REACT_DEVTOOLS_GLOBAL_HOOK__.checkDCE(H1)}catch(t){console.error(t)}}H1(),zS.exports=Bt;var S3=zS.exports,j1,xA=S3;j1=xA.createRoot,xA.hydrateRoot;async function ro(t,e,n,s){return s._parse(t,e,n,s)}function de(t,e){if(!t)throw new Error(e||"loader assertion failed.")}const Oh=!!(typeof process!="object"||String(process)!=="[object process]"||process.browser),MA=typeof process<"u"&&process.version&&/v([0-9]*)/.exec(process.version);MA&&parseFloat(MA[1]);const Bc=globalThis,Wr=globalThis.process||{},C3=globalThis.navigator||{};function W1(t){var s,r;if(typeof window<"u"&&((s=window.process)==null?void 0:s.type)==="renderer"||typeof process<"u"&&((r=process.versions)!=null&&r.electron))return!0;const e=typeof navigator<"u"&&navigator.userAgent,n=t||e;return!!(n&&n.indexOf("Electron")>=0)}function Ys(){return!(typeof process=="object"&&String(process)==="[object process]"&&!(process!=null&&process.browser))||W1()}function v3(t){return!t&&!Ys()?"Node":W1(t)?"Electron":(t||C3.userAgent||"").indexOf("Edge")>-1?"Edge":globalThis.chrome?"Chrome":globalThis.safari?"Safari":globalThis.mozInnerScreenX?"Firefox":"Unknown"}const G1="4.0.7";function w3(t){try{const e=window[t],n="__storage_test__";return e.setItem(n,n),e.removeItem(n),e}catch{return null}}class b3{constructor(e,n,s="sessionStorage"){this.storage=w3(s),this.id=e,this.config=n,this._loadConfiguration()}getConfiguration(){return this.config}setConfiguration(e){if(Object.assign(this.config,e),this.storage){const n=JSON.stringify(this.config);this.storage.setItem(this.id,n)}}_loadConfiguration(){let e={};if(this.storage){const n=this.storage.getItem(this.id);e=n?JSON.parse(n):{}}return Object.assign(this.config,e),this}}function R3(t){let e;return t<10?e=`${t.toFixed(2)}ms`:t<100?e=`${t.toFixed(1)}ms`:t<1e3?e=`${t.toFixed(0)}ms`:e=`${(t/1e3).toFixed(2)}s`,e}function I3(t,e=8){const n=Math.max(e-t.length,0);return`${" ".repeat(n)}${t}`}var lu;(function(t){t[t.BLACK=30]="BLACK",t[t.RED=31]="RED",t[t.GREEN=32]="GREEN",t[t.YELLOW=33]="YELLOW",t[t.BLUE=34]="BLUE",t[t.MAGENTA=35]="MAGENTA",t[t.CYAN=36]="CYAN",t[t.WHITE=37]="WHITE",t[t.BRIGHT_BLACK=90]="BRIGHT_BLACK",t[t.BRIGHT_RED=91]="BRIGHT_RED",t[t.BRIGHT_GREEN=92]="BRIGHT_GREEN",t[t.BRIGHT_YELLOW=93]="BRIGHT_YELLOW",t[t.BRIGHT_BLUE=94]="BRIGHT_BLUE",t[t.BRIGHT_MAGENTA=95]="BRIGHT_MAGENTA",t[t.BRIGHT_CYAN=96]="BRIGHT_CYAN",t[t.BRIGHT_WHITE=97]="BRIGHT_WHITE"})(lu||(lu={}));const P3=10;function BA(t){return typeof t!="string"?t:(t=t.toUpperCase(),lu[t]||lu.WHITE)}function x3(t,e,n){return!Ys&&typeof t=="string"&&(e&&(t=`\x1B[${BA(e)}m${t}\x1B[39m`),n&&(t=`\x1B[${BA(n)+P3}m${t}\x1B[49m`)),t}function M3(t,e=["constructor"]){const n=Object.getPrototypeOf(t),s=Object.getOwnPropertyNames(n),r=t;for(const i of s){const o=r[i];typeof o=="function"&&(e.find(a=>i===a)||(r[i]=o.bind(t)))}}function em(t,e){if(!t)throw new Error(e||"Assertion failed")}function Gr(){var e,n,s;let t;if(Ys()&&Bc.performance)t=(n=(e=Bc==null?void 0:Bc.performance)==null?void 0:e.now)==null?void 0:n.call(e);else if("hrtime"in Wr){const r=(s=Wr==null?void 0:Wr.hrtime)==null?void 0:s.call(Wr);t=r[0]*1e3+r[1]/1e6}else t=Date.now();return t}const Xr={debug:Ys()&&console.debug||console.log,log:console.log,info:console.info,warn:console.warn,error:console.error},B3={enabled:!0,level:0};function $r(){}const OA={},NA={once:!0};class io{constructor({id:e}={id:""}){this.VERSION=G1,this._startTs=Gr(),this._deltaTs=Gr(),this.userData={},this.LOG_THROTTLE_TIMEOUT=0,this.id=e,this.userData={},this._storage=new b3(`__probe-${this.id}__`,B3),this.timeStamp(`${this.id} started`),M3(this),Object.seal(this)}set level(e){this.setLevel(e)}get level(){return this.getLevel()}isEnabled(){return this._storage.config.enabled}getLevel(){return this._storage.config.level}getTotal(){return Number((Gr()-this._startTs).toPrecision(10))}getDelta(){return Number((Gr()-this._deltaTs).toPrecision(10))}set priority(e){this.level=e}get priority(){return this.level}getPriority(){return this.level}enable(e=!0){return this._storage.setConfiguration({enabled:e}),this}setLevel(e){return this._storage.setConfiguration({level:e}),this}get(e){return this._storage.config[e]}set(e,n){this._storage.setConfiguration({[e]:n})}settings(){console.table?console.table(this._storage.config):console.log(this._storage.config)}assert(e,n){if(!e)throw new Error(n||"Assertion failed")}warn(e){return this._getLogFunction(0,e,Xr.warn,arguments,NA)}error(e){return this._getLogFunction(0,e,Xr.error,arguments)}deprecated(e,n){return this.warn(`\`${e}\` is deprecated and will be removed in a later version. Use \`${n}\` instead`)}removed(e,n){return this.error(`\`${e}\` has been removed. Use \`${n}\` instead`)}probe(e,n){return this._getLogFunction(e,n,Xr.log,arguments,{time:!0,once:!0})}log(e,n){return this._getLogFunction(e,n,Xr.debug,arguments)}info(e,n){return this._getLogFunction(e,n,console.info,arguments)}once(e,n){return this._getLogFunction(e,n,Xr.debug||Xr.info,arguments,NA)}table(e,n,s){return n?this._getLogFunction(e,n,console.table||$r,s&&[s],{tag:N3(n)}):$r}time(e,n){return this._getLogFunction(e,n,console.time?console.time:console.info)}timeEnd(e,n){return this._getLogFunction(e,n,console.timeEnd?console.timeEnd:console.info)}timeStamp(e,n){return this._getLogFunction(e,n,console.timeStamp||$r)}group(e,n,s={collapsed:!1}){const r=FA({logLevel:e,message:n,opts:s}),{collapsed:i}=s;return r.method=(i?console.groupCollapsed:console.group)||console.info,this._getLogFunction(r)}groupCollapsed(e,n,s={}){return this.group(e,n,Object.assign({},s,{collapsed:!0}))}groupEnd(e){return this._getLogFunction(e,"",console.groupEnd||$r)}withGroup(e,n,s){this.group(e,n)();try{s()}finally{this.groupEnd(e)()}}trace(){console.trace&&console.trace()}_shouldLog(e){return this.isEnabled()&&this.getLevel()>=X1(e)}_getLogFunction(e,n,s,r,i){if(this._shouldLog(e)){i=FA({logLevel:e,message:n,args:r,opts:i}),s=s||i.method,em(s),i.total=this.getTotal(),i.delta=this.getDelta(),this._deltaTs=Gr();const o=i.tag||i.message;if(i.once&&o)if(!OA[o])OA[o]=Gr();else return $r;return n=O3(this.id,i.message,i),s.bind(console,n,...i.args)}return $r}}io.VERSION=G1;function X1(t){if(!t)return 0;let e;switch(typeof t){case"number":e=t;break;case"object":e=t.logLevel||t.priority||0;break;default:return 0}return em(Number.isFinite(e)&&e>=0),e}function FA(t){const{logLevel:e,message:n}=t;t.logLevel=X1(e);const s=t.args?Array.from(t.args):[];for(;s.length&&s.shift()!==n;);switch(typeof e){case"string":case"function":n!==void 0&&s.unshift(n),t.message=e;break;case"object":Object.assign(t,e);break}typeof t.message=="function"&&(t.message=t.message());const r=typeof t.message;return em(r==="string"||r==="object"),Object.assign(t,{args:s},t.opts)}function O3(t,e,n){if(typeof e=="string"){const s=n.time?I3(R3(n.total)):"";e=n.time?`${t}: ${s}  ${e}`:`${t}: ${e}`,e=x3(e,n.color,n.background)}return e}function N3(t){for(const e in t)for(const n in t[e])return n||"untitled";return"empty"}globalThis.probe={};const $1=new io({id:"@probe.gl/log"});function F3(t,e){return K1(t||{},e)}function K1(t,e,n=0){if(n>3)return e;const s={...t};for(const[r,i]of Object.entries(e))i&&typeof i=="object"&&!Array.isArray(i)?s[r]=K1(s[r]||{},e[r],n+1):s[r]=e[r];return s}function D3(t){var e;globalThis.loaders||(globalThis.loaders={}),(e=globalThis.loaders).modules||(e.modules={}),Object.assign(globalThis.loaders.modules,t)}function L3(t){var n,s;return((s=(n=globalThis.loaders)==null?void 0:n.modules)==null?void 0:s[t])||null}const U3="latest";function k3(){var t;return(t=globalThis._loadersgl_)!=null&&t.version||(globalThis._loadersgl_=globalThis._loadersgl_||{},globalThis._loadersgl_.version="4.2.0-beta.2"),globalThis._loadersgl_.version}const Y1=k3();function is(t,e){if(!t)throw new Error(e||"loaders.gl assertion failed.")}const Gt=typeof process!="object"||String(process)!=="[object process]"||process.browser,tm=typeof importScripts=="function",z3=typeof window<"u"&&typeof window.orientation<"u",DA=typeof process<"u"&&process.version&&/v([0-9]*)/.exec(process.version);DA&&parseFloat(DA[1]);class V3{constructor(e,n){p(this,"name");p(this,"workerThread");p(this,"isRunning",!0);p(this,"result");p(this,"_resolve",()=>{});p(this,"_reject",()=>{});this.name=e,this.workerThread=n,this.result=new Promise((s,r)=>{this._resolve=s,this._reject=r})}postMessage(e,n){this.workerThread.postMessage({source:"loaders.gl",type:e,payload:n})}done(e){is(this.isRunning),this.isRunning=!1,this._resolve(e)}error(e){is(this.isRunning),this.isRunning=!1,this._reject(e)}}class Df{terminate(){}}const Lf=new Map;function H3(t){is(t.source&&!t.url||!t.source&&t.url);let e=Lf.get(t.source||t.url);return e||(t.url&&(e=j3(t.url),Lf.set(t.url,e)),t.source&&(e=J1(t.source),Lf.set(t.source,e))),is(e),e}function j3(t){if(!t.startsWith("http"))return t;const e=W3(t);return J1(e)}function J1(t){const e=new Blob([t],{type:"application/javascript"});return URL.createObjectURL(e)}function W3(t){return`try {
  importScripts('${t}');
} catch (error) {
  console.error(error);
  throw error;
}`}function q1(t,e=!0,n){const s=n||new Set;if(t){if(LA(t))s.add(t);else if(LA(t.buffer))s.add(t.buffer);else if(!ArrayBuffer.isView(t)){if(e&&typeof t=="object")for(const r in t)q1(t[r],e,s)}}return n===void 0?Array.from(s):[]}function LA(t){return t?t instanceof ArrayBuffer||typeof MessagePort<"u"&&t instanceof MessagePort||typeof ImageBitmap<"u"&&t instanceof ImageBitmap||typeof OffscreenCanvas<"u"&&t instanceof OffscreenCanvas:!1}const Uf=()=>{};class Up{constructor(e){p(this,"name");p(this,"source");p(this,"url");p(this,"terminated",!1);p(this,"worker");p(this,"onMessage");p(this,"onError");p(this,"_loadableURL","");const{name:n,source:s,url:r}=e;is(s||r),this.name=n,this.source=s,this.url=r,this.onMessage=Uf,this.onError=i=>console.log(i),this.worker=Gt?this._createBrowserWorker():this._createNodeWorker()}static isSupported(){return typeof Worker<"u"&&Gt||typeof Df<"u"&&!Gt}destroy(){this.onMessage=Uf,this.onError=Uf,this.worker.terminate(),this.terminated=!0}get isRunning(){return!!this.onMessage}postMessage(e,n){n=n||q1(e),this.worker.postMessage(e,n)}_getErrorFromErrorEvent(e){let n="Failed to load ";return n+=`worker ${this.name} from ${this.url}. `,e.message&&(n+=`${e.message} in `),e.lineno&&(n+=`:${e.lineno}:${e.colno}`),new Error(n)}_createBrowserWorker(){this._loadableURL=H3({source:this.source,url:this.url});const e=new Worker(this._loadableURL,{name:this.name});return e.onmessage=n=>{n.data?this.onMessage(n.data):this.onError(new Error("No data received"))},e.onerror=n=>{this.onError(this._getErrorFromErrorEvent(n)),this.terminated=!0},e.onmessageerror=n=>console.error(n),e}_createNodeWorker(){let e;if(this.url){const s=this.url.includes(":/")||this.url.startsWith("/")?this.url:`./${this.url}`;e=new Df(s,{eval:!1})}else if(this.source)e=new Df(this.source,{eval:!0});else throw new Error("no worker");return e.on("message",n=>{this.onMessage(n)}),e.on("error",n=>{this.onError(n)}),e.on("exit",n=>{}),e}}class G3{constructor(e){p(this,"name","unnamed");p(this,"source");p(this,"url");p(this,"maxConcurrency",1);p(this,"maxMobileConcurrency",1);p(this,"onDebug",()=>{});p(this,"reuseWorkers",!0);p(this,"props",{});p(this,"jobQueue",[]);p(this,"idleQueue",[]);p(this,"count",0);p(this,"isDestroyed",!1);this.source=e.source,this.url=e.url,this.setProps(e)}static isSupported(){return Up.isSupported()}destroy(){this.idleQueue.forEach(e=>e.destroy()),this.isDestroyed=!0}setProps(e){this.props={...this.props,...e},e.name!==void 0&&(this.name=e.name),e.maxConcurrency!==void 0&&(this.maxConcurrency=e.maxConcurrency),e.maxMobileConcurrency!==void 0&&(this.maxMobileConcurrency=e.maxMobileConcurrency),e.reuseWorkers!==void 0&&(this.reuseWorkers=e.reuseWorkers),e.onDebug!==void 0&&(this.onDebug=e.onDebug)}async startJob(e,n=(r,i,o)=>r.done(o),s=(r,i)=>r.error(i)){const r=new Promise(i=>(this.jobQueue.push({name:e,onMessage:n,onError:s,onStart:i}),this));return this._startQueuedJob(),await r}async _startQueuedJob(){if(!this.jobQueue.length)return;const e=this._getAvailableWorker();if(!e)return;const n=this.jobQueue.shift();if(n){this.onDebug({message:"Starting job",name:n.name,workerThread:e,backlog:this.jobQueue.length});const s=new V3(n.name,e);e.onMessage=r=>n.onMessage(s,r.type,r.payload),e.onError=r=>n.onError(s,r),n.onStart(s);try{await s.result}catch(r){console.error(`Worker exception: ${r}`)}finally{this.returnWorkerToQueue(e)}}}returnWorkerToQueue(e){!Gt||this.isDestroyed||!this.reuseWorkers||this.count>this._getMaxConcurrency()?(e.destroy(),this.count--):this.idleQueue.push(e),this.isDestroyed||this._startQueuedJob()}_getAvailableWorker(){if(this.idleQueue.length>0)return this.idleQueue.shift()||null;if(this.count<this._getMaxConcurrency()){this.count++;const e=`${this.name.toLowerCase()} (#${this.count} of ${this.maxConcurrency})`;return new Up({name:e,source:this.source,url:this.url})}return null}_getMaxConcurrency(){return z3?this.maxMobileConcurrency:this.maxConcurrency}}const X3={maxConcurrency:3,maxMobileConcurrency:1,reuseWorkers:!0,onDebug:()=>{}},Ss=class Ss{constructor(e){p(this,"props");p(this,"workerPools",new Map);this.props={...X3},this.setProps(e),this.workerPools=new Map}static isSupported(){return Up.isSupported()}static getWorkerFarm(e={}){return Ss._workerFarm=Ss._workerFarm||new Ss({}),Ss._workerFarm.setProps(e),Ss._workerFarm}destroy(){for(const e of this.workerPools.values())e.destroy();this.workerPools=new Map}setProps(e){this.props={...this.props,...e};for(const n of this.workerPools.values())n.setProps(this._getWorkerPoolProps())}getWorkerPool(e){const{name:n,source:s,url:r}=e;let i=this.workerPools.get(n);return i||(i=new G3({name:n,source:s,url:r}),i.setProps(this._getWorkerPoolProps()),this.workerPools.set(n,i)),i}_getWorkerPoolProps(){return{maxConcurrency:this.props.maxConcurrency,maxMobileConcurrency:this.props.maxMobileConcurrency,reuseWorkers:this.props.reuseWorkers,onDebug:this.props.onDebug}}};p(Ss,"_workerFarm");let uu=Ss;function $3(t,e={}){const n=e[t.id]||{},s=Gt?`${t.id}-worker.js`:`${t.id}-worker-node.js`;let r=n.workerUrl;if(!r&&t.id==="compression"&&(r=e.workerUrl),e._workerType==="test"&&(Gt?r=`modules/${t.module}/dist/${s}`:r=`modules/${t.module}/src/workers/${t.id}-worker-node.ts`),!r){let i=t.version;i==="latest"&&(i=U3);const o=i?`@${i}`:"";r=`https://unpkg.com/@loaders.gl/${t.module}${o}/dist/${s}`}return is(r),r}function K3(t,e=Y1){is(t,"no worker provided");const n=t.version;return!(!e||!n)}const kf={};async function Er(t,e=null,n={},s=null){return e&&(t=Y3(t,e,n,s)),kf[t]=kf[t]||J3(t),await kf[t]}function Y3(t,e,n={},s=null){if(!n.useLocalLibraries&&t.startsWith("http"))return t;s=s||t;const r=n.modules||{};return r[s]?r[s]:Gt?n.CDN?(is(n.CDN.startsWith("http")),`${n.CDN}/${e}@${Y1}/dist/libs/${s}`):tm?`../src/libs/${s}`:`modules/${e}/src/libs/${s}`:`modules/${e}/dist/libs/${s}`}async function J3(t){if(t.endsWith("wasm"))return await Z3(t);if(!Gt)try{const{requireFromFile:n}=globalThis.loaders||{};return await(n==null?void 0:n(t))}catch(n){return console.error(n),null}if(tm)return importScripts(t);const e=await Q3(t);return q3(e,t)}function q3(t,e){if(!Gt){const{requireFromString:s}=globalThis.loaders||{};return s==null?void 0:s(t,e)}if(tm)return eval.call(globalThis,t),null;const n=document.createElement("script");n.id=e;try{n.appendChild(document.createTextNode(t))}catch{n.text=t}return document.body.appendChild(n),null}async function Z3(t){const{readFileAsArrayBuffer:e}=globalThis.loaders||{};return Gt||!e||t.startsWith("http")?await(await fetch(t)).arrayBuffer():await e(t)}async function Q3(t){const{readFileAsText:e}=globalThis.loaders||{};return Gt||!e||t.startsWith("http")?await(await fetch(t)).text():await e(t)}function ex(t,e){return!uu.isSupported()||!Gt&&!(e!=null&&e._nodeWorkers)?!1:t.worker&&(e==null?void 0:e.worker)}async function tx(t,e,n,s,r){const i=t.id,o=$3(t,n),c=uu.getWorkerFarm(n).getWorkerPool({name:i,url:o});n=JSON.parse(JSON.stringify(n)),s=JSON.parse(JSON.stringify(s||{}));const l=await c.startJob("process-on-worker",nx.bind(null,r));return l.postMessage("process",{input:e,options:n,context:s}),await(await l.result).result}async function nx(t,e,n,s){switch(n){case"done":e.done(s);break;case"error":e.error(new Error(s.error));break;case"process":const{id:r,input:i,options:o}=s;try{const a=await t(i,o);e.postMessage("done",{id:r,result:a})}catch(a){const c=a instanceof Error?a.message:"unknown error";e.postMessage("error",{id:r,error:c})}break;default:console.warn(`parse-with-worker unknown message ${n}`)}}function sx(t,e=5){return typeof t=="string"?t.slice(0,e):ArrayBuffer.isView(t)?UA(t.buffer,t.byteOffset,e):t instanceof ArrayBuffer?UA(t,0,e):""}function UA(t,e,n){if(t.byteLength<=e+n)return"";const s=new DataView(t);let r="";for(let i=0;i<n;i++)r+=String.fromCharCode(s.getUint8(e+i));return r}function rx(t){try{return JSON.parse(t)}catch{throw new Error(`Failed to parse JSON from data starting with "${sx(t)}"`)}}function ix(t,e,n){if(n=n||t.byteLength,t.byteLength<n||e.byteLength<n)return!1;const s=new Uint8Array(t),r=new Uint8Array(e);for(let i=0;i<s.length;++i)if(s[i]!==r[i])return!1;return!0}function ox(...t){return ax(t)}function ax(t){const e=t.map(i=>i instanceof ArrayBuffer?new Uint8Array(i):i),n=e.reduce((i,o)=>i+o.byteLength,0),s=new Uint8Array(n);let r=0;for(const i of e)s.set(i,r),r+=i.byteLength;return s.buffer}function zf(...t){const e=t,n=e&&e.length>1&&e[0].constructor||null;if(!n)throw new Error('"concatenateTypedArrays" - incorrect quantity of arguments or arguments have incompatible data types');const s=e.reduce((o,a)=>o+a.length,0),r=new n(s);let i=0;for(const o of e)r.set(o,i),i+=o.length;return r}function nm(t,e,n){const s=n!==void 0?new Uint8Array(t).subarray(e,e+n):new Uint8Array(t).subarray(e);return new Uint8Array(s).buffer}function qa(t,e){return de(t>=0),de(e>0),t+(e-1)&~(e-1)}function cx(t,e,n){let s;if(t instanceof ArrayBuffer)s=new Uint8Array(t);else{const r=t.byteOffset,i=t.byteLength;s=new Uint8Array(t.buffer||t.arrayBuffer,r,i)}return e.set(s,n),n+qa(s.byteLength,4)}async function lx(t){const e=[];for await(const n of t)e.push(n);return ox(...e)}function kA(){let t;if(typeof window<"u"&&window.performance)t=window.performance.now();else if(typeof process<"u"&&process.hrtime){const e=process.hrtime();t=e[0]*1e3+e[1]/1e6}else t=Date.now();return t}class zA{constructor(e,n){this.sampleSize=1,this.time=0,this.count=0,this.samples=0,this.lastTiming=0,this.lastSampleTime=0,this.lastSampleCount=0,this._count=0,this._time=0,this._samples=0,this._startTime=0,this._timerPending=!1,this.name=e,this.type=n,this.reset()}reset(){return this.time=0,this.count=0,this.samples=0,this.lastTiming=0,this.lastSampleTime=0,this.lastSampleCount=0,this._count=0,this._time=0,this._samples=0,this._startTime=0,this._timerPending=!1,this}setSampleSize(e){return this.sampleSize=e,this}incrementCount(){return this.addCount(1),this}decrementCount(){return this.subtractCount(1),this}addCount(e){return this._count+=e,this._samples++,this._checkSampling(),this}subtractCount(e){return this._count-=e,this._samples++,this._checkSampling(),this}addTime(e){return this._time+=e,this.lastTiming=e,this._samples++,this._checkSampling(),this}timeStart(){return this._startTime=kA(),this._timerPending=!0,this}timeEnd(){return this._timerPending?(this.addTime(kA()-this._startTime),this._timerPending=!1,this._checkSampling(),this):this}getSampleAverageCount(){return this.sampleSize>0?this.lastSampleCount/this.sampleSize:0}getSampleAverageTime(){return this.sampleSize>0?this.lastSampleTime/this.sampleSize:0}getSampleHz(){return this.lastSampleTime>0?this.sampleSize/(this.lastSampleTime/1e3):0}getAverageCount(){return this.samples>0?this.count/this.samples:0}getAverageTime(){return this.samples>0?this.time/this.samples:0}getHz(){return this.time>0?this.samples/(this.time/1e3):0}_checkSampling(){this._samples===this.sampleSize&&(this.lastSampleTime=this._time,this.lastSampleCount=this._count,this.count+=this._count,this.time+=this._time,this.samples+=this._samples,this._time=0,this._count=0,this._samples=0)}}class oo{constructor(e){this.stats={},this.id=e.id,this.stats={},this._initializeStats(e.stats),Object.seal(this)}get(e,n="count"){return this._getOrCreate({name:e,type:n})}get size(){return Object.keys(this.stats).length}reset(){for(const e of Object.values(this.stats))e.reset();return this}forEach(e){for(const n of Object.values(this.stats))e(n)}getTable(){const e={};return this.forEach(n=>{e[n.name]={time:n.time||0,count:n.count||0,average:n.getAverageTime()||0,hz:n.getHz()||0}}),e}_initializeStats(e=[]){e.forEach(n=>this._getOrCreate(n))}_getOrCreate(e){const{name:n,type:s}=e;let r=this.stats[n];return r||(e instanceof zA?r=e:r=new zA(n,s),this.stats[n]=r),r}}const ux="Queued Requests",hx="Active Requests",fx="Cancelled Requests",dx="Queued Requests Ever",px="Active Requests Ever",gx={id:"request-scheduler",throttleRequests:!0,maxRequests:6,debounceTime:0};class Z1{constructor(e={}){p(this,"props");p(this,"stats");p(this,"activeRequestCount",0);p(this,"requestQueue",[]);p(this,"requestMap",new Map);p(this,"updateTimer",null);this.props={...gx,...e},this.stats=new oo({id:this.props.id}),this.stats.get(ux),this.stats.get(hx),this.stats.get(fx),this.stats.get(dx),this.stats.get(px)}scheduleRequest(e,n=()=>0){if(!this.props.throttleRequests)return Promise.resolve({done:()=>{}});if(this.requestMap.has(e))return this.requestMap.get(e);const s={handle:e,priority:0,getPriority:n},r=new Promise(i=>(s.resolve=i,s));return this.requestQueue.push(s),this.requestMap.set(e,r),this._issueNewRequests(),r}_issueRequest(e){const{handle:n,resolve:s}=e;let r=!1;const i=()=>{r||(r=!0,this.requestMap.delete(n),this.activeRequestCount--,this._issueNewRequests())};return this.activeRequestCount++,s?s({done:i}):Promise.resolve({done:i})}_issueNewRequests(){this.updateTimer!==null&&clearTimeout(this.updateTimer),this.updateTimer=setTimeout(()=>this._issueNewRequestsAsync(),this.props.debounceTime)}_issueNewRequestsAsync(){this.updateTimer!==null&&clearTimeout(this.updateTimer),this.updateTimer=null;const e=Math.max(this.props.maxRequests-this.activeRequestCount,0);if(e!==0){this._updateAllRequests();for(let n=0;n<e;++n){const s=this.requestQueue.shift();s&&this._issueRequest(s)}}}_updateAllRequests(){const e=this.requestQueue;for(let n=0;n<e.length;++n){const s=e[n];this._updateRequest(s)||(e.splice(n,1),this.requestMap.delete(s.handle),n--)}e.sort((n,s)=>n.priority-s.priority)}_updateRequest(e){return e.priority=e.getPriority(e.handle),e.priority<0?(e.resolve(null),!1):!0}}let _x="";const VA={};function mx(t){for(const e in VA)if(t.startsWith(e)){const n=VA[e];t=t.replace(e,n)}return!t.startsWith("http://")&&!t.startsWith("https://")&&(t=`${_x}${t}`),t}function yx(t){return t&&typeof t=="object"&&t.isBuffer}function Q1(t){if(yx(t))return t;if(t instanceof ArrayBuffer)return t;if(ArrayBuffer.isView(t))return t.byteOffset===0&&t.byteLength===t.buffer.byteLength?t.buffer:t.buffer.slice(t.byteOffset,t.byteOffset+t.byteLength);if(typeof t=="string"){const e=t;return new TextEncoder().encode(e).buffer}if(t&&typeof t=="object"&&t._toArrayBuffer)return t._toArrayBuffer();throw new Error("toArrayBuffer")}function Ax(){var e;if(typeof process<"u"&&typeof process.cwd<"u")return process.cwd();const t=(e=window.location)==null?void 0:e.pathname;return(t==null?void 0:t.slice(0,t.lastIndexOf("/")+1))||""}function ev(t){const e=t?t.lastIndexOf("/"):-1;return e>=0?t.substr(e+1):""}function sm(t){const e=t?t.lastIndexOf("/"):-1;return e>=0?t.substr(0,e):""}function Tx(...t){const e=[];for(let i=0;i<t.length;i++)e[i]=t[i];let n="",s=!1,r;for(let i=e.length-1;i>=-1&&!s;i--){let o;i>=0?o=e[i]:(r===void 0&&(r=Ax()),o=r),o.length!==0&&(n=`${o}/${n}`,s=o.charCodeAt(0)===Vo)}return n=Ex(n,!s),s?`/${n}`:n.length>0?n:"."}const Vo=47,Vf=46;function Ex(t,e){let n="",s=-1,r=0,i,o=!1;for(let a=0;a<=t.length;++a){if(a<t.length)i=t.charCodeAt(a);else{if(i===Vo)break;i=Vo}if(i===Vo){if(!(s===a-1||r===1))if(s!==a-1&&r===2){if(n.length<2||!o||n.charCodeAt(n.length-1)!==Vf||n.charCodeAt(n.length-2)!==Vf){if(n.length>2){const c=n.length-1;let l=c;for(;l>=0&&n.charCodeAt(l)!==Vo;--l);if(l!==c){n=l===-1?"":n.slice(0,l),s=a,r=0,o=!1;continue}}else if(n.length===2||n.length===1){n="",s=a,r=0,o=!1;continue}}e&&(n.length>0?n+="/..":n="..",o=!0)}else{const c=t.slice(s+1,a);n.length>0?n+=`/${c}`:n=c,o=!1}s=a,r=0}else i===Vf&&r!==-1?++r:r=-1}return n}const Sx=t=>typeof t=="boolean",ra=t=>typeof t=="function",Za=t=>t!==null&&typeof t=="object",HA=t=>Za(t)&&t.constructor==={}.constructor,Cx=t=>!!t&&typeof t[Symbol.iterator]=="function",vx=t=>t&&typeof t[Symbol.asyncIterator]=="function",Lr=t=>typeof Response<"u"&&t instanceof Response||t&&t.arrayBuffer&&t.text&&t.json,Ur=t=>typeof Blob<"u"&&t instanceof Blob,wx=t=>t&&typeof t=="object"&&t.isBuffer,bx=t=>typeof ReadableStream<"u"&&t instanceof ReadableStream||Za(t)&&ra(t.tee)&&ra(t.cancel)&&ra(t.getReader),Rx=t=>Za(t)&&ra(t.read)&&ra(t.pipe)&&Sx(t.readable),tv=t=>bx(t)||Rx(t);class Ix extends Error{constructor(n,s){super(n);p(this,"reason");p(this,"url");p(this,"response");this.reason=s.reason,this.url=s.url,this.response=s.response}}const Px=/^data:([-\w.]+\/[-\w.+]+)(;|,)/,xx=/^([-\w.]+\/[-\w.+]+)/;function jA(t,e){return t.toLowerCase()===e.toLowerCase()}function Mx(t){const e=xx.exec(t);return e?e[1]:t}function WA(t){const e=Px.exec(t);return e?e[1]:""}const nv=/\?.*/;function Bx(t){const e=t.match(nv);return e&&e[0]}function rm(t){return t.replace(nv,"")}function Ox(t){if(t.length<50)return t;const e=t.slice(t.length-15);return`${t.substr(0,32)}...${e}`}function Nh(t){return Lr(t)?t.url:Ur(t)?t.name||"":typeof t=="string"?t:""}function im(t){if(Lr(t)){const e=t,n=e.headers.get("content-type")||"",s=rm(e.url);return Mx(n)||WA(s)}return Ur(t)?t.type||"":typeof t=="string"?WA(t):""}function Nx(t){return Lr(t)?t.headers["content-length"]||-1:Ur(t)?t.size:typeof t=="string"?t.length:t instanceof ArrayBuffer||ArrayBuffer.isView(t)?t.byteLength:-1}async function sv(t){if(Lr(t))return t;const e={},n=Nx(t);n>=0&&(e["content-length"]=String(n));const s=Nh(t),r=im(t);r&&(e["content-type"]=r);const i=await Lx(t);i&&(e["x-first-bytes"]=i),typeof t=="string"&&(t=new TextEncoder().encode(t));const o=new Response(t,{headers:e});return Object.defineProperty(o,"url",{value:s}),o}async function Fx(t){if(!t.ok)throw await Dx(t)}async function Dx(t){const e=Ox(t.url);let n=`Failed to fetch resource (${t.status}) ${t.statusText}: ${e}`;n=n.length>100?`${n.slice(0,100)}...`:n;const s={reason:t.statusText,url:t.url,response:t};try{const r=t.headers.get("Content-Type");s.reason=r!=null&&r.includes("application/json")?await t.json():t.text()}catch{}return new Ix(n,s)}async function Lx(t){if(typeof t=="string")return`data:,${t.slice(0,5)}`;if(t instanceof Blob){const n=t.slice(0,5);return await new Promise(s=>{const r=new FileReader;r.onload=i=>{var o;return s((o=i==null?void 0:i.target)==null?void 0:o.result)},r.readAsDataURL(n)})}if(t instanceof ArrayBuffer){const n=t.slice(0,5);return`data:base64,${Ux(n)}`}return null}function Ux(t){let e="";const n=new Uint8Array(t);for(let s=0;s<n.byteLength;s++)e+=String.fromCharCode(n[s]);return btoa(e)}function kx(t){return!zx(t)&&!Vx(t)}function zx(t){return t.startsWith("http:")||t.startsWith("https:")}function Vx(t){return t.startsWith("data:")}async function GA(t,e){var n,s;if(typeof t=="string"){const r=mx(t);return kx(r)&&(n=globalThis.loaders)!=null&&n.fetchNode?(s=globalThis.loaders)==null?void 0:s.fetchNode(r,e):await fetch(r,e)}return await sv(t)}const XA=new io({id:"loaders.gl"});class Hx{log(){return()=>{}}info(){return()=>{}}warn(){return()=>{}}error(){return()=>{}}}class jx{constructor(){p(this,"console");this.console=console}log(...e){return this.console.log.bind(this.console,...e)}info(...e){return this.console.info.bind(this.console,...e)}warn(...e){return this.console.warn.bind(this.console,...e)}error(...e){return this.console.error.bind(this.console,...e)}}const rv={fetch:null,mimeType:void 0,nothrow:!1,log:new jx,useLocalLibraries:!1,CDN:"https://unpkg.com/@loaders.gl",worker:!0,maxConcurrency:3,maxMobileConcurrency:1,reuseWorkers:Oh,_nodeWorkers:!1,_workerType:"",limit:0,_limitMB:0,batchSize:"auto",batchDebounceMs:0,metadata:!1,transforms:[]},Wx={throws:"nothrow",dataType:"(no longer used)",uri:"baseUri",method:"fetch.method",headers:"fetch.headers",body:"fetch.body",mode:"fetch.mode",credentials:"fetch.credentials",cache:"fetch.cache",redirect:"fetch.redirect",referrer:"fetch.referrer",referrerPolicy:"fetch.referrerPolicy",integrity:"fetch.integrity",keepalive:"fetch.keepalive",signal:"fetch.signal"};function iv(){globalThis.loaders=globalThis.loaders||{};const{loaders:t}=globalThis;return t._state||(t._state={}),t._state}function ov(){const t=iv();return t.globalOptions=t.globalOptions||{...rv},t.globalOptions}function Gx(t,e,n,s){return n=n||[],n=Array.isArray(n)?n:[n],Xx(t,n),Kx(e,t,s)}function Xx(t,e){$A(t,null,rv,Wx,e);for(const n of e){const s=t&&t[n.id]||{},r=n.options&&n.options[n.id]||{},i=n.deprecatedOptions&&n.deprecatedOptions[n.id]||{};$A(s,n.id,r,i,e)}}function $A(t,e,n,s,r){const i=e||"Top level",o=e?`${e}.`:"";for(const a in t){const c=!e&&Za(t[a]),l=a==="baseUri"&&!e,u=a==="workerUrl"&&e;if(!(a in n)&&!l&&!u){if(a in s)XA.warn(`${i} loader option '${o}${a}' no longer supported, use '${s[a]}'`)();else if(!c){const h=$x(a,r);XA.warn(`${i} loader option '${o}${a}' not recognized. ${h}`)()}}}}function $x(t,e){const n=t.toLowerCase();let s="";for(const r of e)for(const i in r.options){if(t===i)return`Did you mean '${r.id}.${i}'?`;const o=i.toLowerCase();(n.startsWith(o)||o.startsWith(n))&&(s=s||`Did you mean '${r.id}.${i}'?`)}return s}function Kx(t,e,n){const r={...t.options||{}};return Yx(r,n),r.log===null&&(r.log=new Hx),KA(r,ov()),KA(r,e),r}function KA(t,e){for(const n in e)if(n in e){const s=e[n];HA(s)&&HA(t[n])?t[n]={...t[n],...e[n]}:t[n]=e[n]}}function Yx(t,e){e&&!("baseUri"in t)&&(t.baseUri=e)}function om(t){return t?(Array.isArray(t)&&(t=t[0]),Array.isArray(t==null?void 0:t.extensions)):!1}function am(t){de(t,"null loader"),de(om(t),"invalid loader");let e;return Array.isArray(t)&&(e=t[1],t=t[0],t={...t,options:{...t.options,...e}}),(t!=null&&t.parseTextSync||t!=null&&t.parseText)&&(t.text=!0),t.text||(t.binary=!0),t}const av=()=>{const t=iv();return t.loaderRegistry=t.loaderRegistry||[],t.loaderRegistry};function Jx(t){const e=av();t=Array.isArray(t)?t:[t];for(const n of t){const s=am(n);e.find(r=>s===r)||e.unshift(s)}}function qx(){return av()}const Zx=new io({id:"loaders.gl"}),Qx=/\.([^.]+)$/;async function eM(t,e=[],n,s){if(!cv(t))return null;let r=YA(t,e,{...n,nothrow:!0},s);if(r)return r;if(Ur(t)&&(t=await t.slice(0,10).arrayBuffer(),r=YA(t,e,n,s)),!r&&!(n!=null&&n.nothrow))throw new Error(lv(t));return r}function YA(t,e=[],n,s){if(!cv(t))return null;if(e&&!Array.isArray(e))return am(e);let r=[];e&&(r=r.concat(e)),n!=null&&n.ignoreRegisteredLoaders||r.push(...qx()),nM(r);const i=tM(t,r,n,s);if(!i&&!(n!=null&&n.nothrow))throw new Error(lv(t));return i}function tM(t,e,n,s){const r=Nh(t),i=im(t),o=rm(r)||(s==null?void 0:s.url);let a=null,c="";return n!=null&&n.mimeType&&(a=Hf(e,n==null?void 0:n.mimeType),c=`match forced by supplied MIME type ${n==null?void 0:n.mimeType}`),a=a||sM(e,o),c=c||(a?`matched url ${o}`:""),a=a||Hf(e,i),c=c||(a?`matched MIME type ${i}`:""),a=a||iM(e,t),c=c||(a?`matched initial data ${uv(t)}`:""),n!=null&&n.fallbackMimeType&&(a=a||Hf(e,n==null?void 0:n.fallbackMimeType),c=c||(a?`matched fallback MIME type ${i}`:"")),c&&Zx.log(1,`selectLoader selected ${a==null?void 0:a.name}: ${c}.`),a}function cv(t){return!(t instanceof Response&&t.status===204)}function lv(t){const e=Nh(t),n=im(t);let s="No valid loader found (";s+=e?`${ev(e)}, `:"no url provided, ",s+=`MIME type: ${n?`"${n}"`:"not provided"}, `;const r=t?uv(t):"";return s+=r?` first bytes: "${r}"`:"first bytes: not available",s+=")",s}function nM(t){for(const e of t)am(e)}function sM(t,e){const n=e&&Qx.exec(e),s=n&&n[1];return s?rM(t,s):null}function rM(t,e){e=e.toLowerCase();for(const n of t)for(const s of n.extensions)if(s.toLowerCase()===e)return n;return null}function Hf(t,e){var n;for(const s of t)if((n=s.mimeTypes)!=null&&n.some(r=>jA(e,r))||jA(e,`application/x.${s.id}`))return s;return null}function iM(t,e){if(!e)return null;for(const n of t)if(typeof e=="string"){if(oM(e,n))return n}else if(ArrayBuffer.isView(e)){if(JA(e.buffer,e.byteOffset,n))return n}else if(e instanceof ArrayBuffer&&JA(e,0,n))return n;return null}function oM(t,e){return e.testText?e.testText(t):(Array.isArray(e.tests)?e.tests:[e.tests]).some(s=>t.startsWith(s))}function JA(t,e,n){return(Array.isArray(n.tests)?n.tests:[n.tests]).some(r=>aM(t,e,n,r))}function aM(t,e,n,s){if(s instanceof ArrayBuffer)return ix(s,t,s.byteLength);switch(typeof s){case"function":return s(t);case"string":const r=kp(t,e,s.length);return s===r;default:return!1}}function uv(t,e=5){return typeof t=="string"?t.slice(0,e):ArrayBuffer.isView(t)?kp(t.buffer,t.byteOffset,e):t instanceof ArrayBuffer?kp(t,0,e):""}function kp(t,e,n){if(t.byteLength<e+n)return"";const s=new DataView(t);let r="";for(let i=0;i<n;i++)r+=String.fromCharCode(s.getUint8(e+i));return r}const cM=256*1024;function*lM(t,e){const n=(e==null?void 0:e.chunkSize)||cM;let s=0;const r=new TextEncoder;for(;s<t.length;){const i=Math.min(t.length-s,n),o=t.slice(s,s+i);s+=i,yield r.encode(o)}}const uM=256*1024;function*hM(t,e={}){const{chunkSize:n=uM}=e;let s=0;for(;s<t.byteLength;){const r=Math.min(t.byteLength-s,n),i=new ArrayBuffer(r),o=new Uint8Array(t,s,r);new Uint8Array(i).set(o),s+=r,yield i}}const fM=1024*1024;async function*dM(t,e){const n=(e==null?void 0:e.chunkSize)||fM;let s=0;for(;s<t.size;){const r=s+n,i=await t.slice(s,r).arrayBuffer();s=r,yield i}}function qA(t,e){return Oh?pM(t,e):gM(t)}async function*pM(t,e){const n=t.getReader();let s;try{for(;;){const r=s||n.read();e!=null&&e._streamReadAhead&&(s=n.read());const{done:i,value:o}=await r;if(i)return;yield Q1(o)}}catch{n.releaseLock()}}async function*gM(t,e){for await(const n of t)yield Q1(n)}function _M(t,e){if(typeof t=="string")return lM(t,e);if(t instanceof ArrayBuffer)return hM(t,e);if(Ur(t))return dM(t,e);if(tv(t))return qA(t,e);if(Lr(t))return qA(t.body,e);throw new Error("makeIterator")}const hv="Cannot convert supplied data type";function mM(t,e,n){if(e.text&&typeof t=="string")return t;if(wx(t)&&(t=t.buffer),t instanceof ArrayBuffer){const s=t;return e.text&&!e.binary?new TextDecoder("utf8").decode(s):s}if(ArrayBuffer.isView(t)){if(e.text&&!e.binary)return new TextDecoder("utf8").decode(t);let s=t.buffer;const r=t.byteLength||t.length;return(t.byteOffset!==0||r!==s.byteLength)&&(s=s.slice(t.byteOffset,t.byteOffset+r)),s}throw new Error(hv)}async function yM(t,e,n){const s=t instanceof ArrayBuffer||ArrayBuffer.isView(t);if(typeof t=="string"||s)return mM(t,e);if(Ur(t)&&(t=await sv(t)),Lr(t)){const r=t;return await Fx(r),e.binary?await r.arrayBuffer():await r.text()}if(tv(t)&&(t=_M(t,n)),Cx(t)||vx(t))return lx(t);throw new Error(hv)}function fv(t,e){const n=ov(),s=t||n;return typeof s.fetch=="function"?s.fetch:Za(s.fetch)?r=>GA(r,s.fetch):e!=null&&e.fetch?e==null?void 0:e.fetch:GA}function AM(t,e,n){if(n)return n;const s={fetch:fv(e,t),...t};if(s.url){const r=rm(s.url);s.baseUrl=r,s.queryString=Bx(s.url),s.filename=ev(r),s.baseUrl=sm(r)}return Array.isArray(s.loaders)||(s.loaders=null),s}function TM(t,e){if(t&&!Array.isArray(t))return t;let n;if(t&&(n=Array.isArray(t)?t:[t]),e&&e.loaders){const s=Array.isArray(e.loaders)?e.loaders:[e.loaders];n=n?[...n,...s]:s}return n&&n.length?n:void 0}async function hu(t,e,n,s){e&&!Array.isArray(e)&&!om(e)&&(s=void 0,n=e,e=void 0),t=await t,n=n||{};const r=Nh(t),o=TM(e,s),a=await eM(t,o,n);return a?(n=Gx(n,a,o,r),s=AM({url:r,_parse:hu,loaders:o},n,s||null),await EM(a,t,n,s)):null}async function EM(t,e,n,s){if(K3(t),n=F3(t.options,n),Lr(e)){const i=e,{ok:o,redirected:a,status:c,statusText:l,type:u,url:h}=i,f=Object.fromEntries(i.headers.entries());s.response={headers:f,ok:o,redirected:a,status:c,statusText:l,type:u,url:h}}e=await yM(e,t,n);const r=t;if(r.parseTextSync&&typeof e=="string")return r.parseTextSync(e,n,s);if(ex(t,n))return await tx(t,e,n,s,hu);if(r.parseText&&typeof e=="string")return await r.parseText(e,n,s);if(r.parse)return await r.parse(e,n,s);throw is(!r.parseSync),new Error(`${t.id} loader - no parser found and worker is disabled`)}function SM(t){switch(t.constructor){case Int8Array:return"int8";case Uint8Array:case Uint8ClampedArray:return"uint8";case Int16Array:return"int16";case Uint16Array:return"uint16";case Int32Array:return"int32";case Uint32Array:return"uint32";case Float32Array:return"float32";case Float64Array:return"float64";default:return"null"}}function cm(t){let e=1/0,n=1/0,s=1/0,r=-1/0,i=-1/0,o=-1/0;const a=t.POSITION?t.POSITION.value:[],c=a&&a.length;for(let l=0;l<c;l+=3){const u=a[l],h=a[l+1],f=a[l+2];e=u<e?u:e,n=h<n?h:n,s=f<s?f:s,r=u>r?u:r,i=h>i?h:i,o=f>o?f:o}return[[e,n,s],[r,i,o]]}function CM(t,e,n){const s=SM(e.value),r=n||vM(e);return{name:t,type:{type:"fixed-size-list",listSize:e.size,children:[{name:"value",type:s}]},nullable:!1,metadata:r}}function vM(t){const e={};return"byteOffset"in t&&(e.byteOffset=t.byteOffset.toString(10)),"byteStride"in t&&(e.byteStride=t.byteStride.toString(10)),"normalized"in t&&(e.normalized=t.normalized.toString()),e}async function os(t,e,n,s){let r,i;!Array.isArray(e)&&!om(e)?(r=[],i=e):(r=e,i=n);const o=fv(i);let a=t;return typeof t=="string"&&(a=await o(t)),Ur(t)&&(a=await o(t)),Array.isArray(r)?await hu(a,r,i):await hu(a,r,i)}const wM="4.2.0-beta.2";var xS;const bM=(xS=globalThis.loaders)==null?void 0:xS.parseImageNode,zp=typeof Image<"u",Vp=typeof ImageBitmap<"u",RM=!!bM,Hp=Oh?!0:RM;function IM(t){switch(t){case"auto":return Vp||zp||Hp;case"imagebitmap":return Vp;case"image":return zp;case"data":return Hp;default:throw new Error(`@loaders.gl/images: image ${t} not supported in this environment`)}}function PM(){if(Vp)return"imagebitmap";if(zp)return"image";if(Hp)return"data";throw new Error("Install '@loaders.gl/polyfills' to parse images under Node.js")}function xM(t){const e=MM(t);if(!e)throw new Error("Not an image");return e}function dv(t){switch(xM(t)){case"data":return t;case"image":case"imagebitmap":const e=document.createElement("canvas"),n=e.getContext("2d");if(!n)throw new Error("getImageData");return e.width=t.width,e.height=t.height,n.drawImage(t,0,0),n.getImageData(0,0,t.width,t.height);default:throw new Error("getImageData")}}function MM(t){return typeof ImageBitmap<"u"&&t instanceof ImageBitmap?"imagebitmap":typeof Image<"u"&&t instanceof Image?"image":t&&typeof t=="object"&&t.data&&t.width&&t.height?"data":null}const BM=/^data:image\/svg\+xml/,OM=/\.svg((\?|#).*)?$/;function lm(t){return t&&(BM.test(t)||OM.test(t))}function NM(t,e){if(lm(e)){let s=new TextDecoder().decode(t);try{typeof unescape=="function"&&typeof encodeURIComponent=="function"&&(s=unescape(encodeURIComponent(s)))}catch(i){throw new Error(i.message)}return`data:image/svg+xml;base64,${btoa(s)}`}return pv(t,e)}function pv(t,e){if(lm(e))throw new Error("SVG cannot be parsed directly to imagebitmap");return new Blob([new Uint8Array(t)])}async function gv(t,e,n){const s=NM(t,n),r=self.URL||self.webkitURL,i=typeof s!="string"&&r.createObjectURL(s);try{return await FM(i||s,e)}finally{i&&r.revokeObjectURL(i)}}async function FM(t,e){const n=new Image;return n.src=t,e.image&&e.image.decode&&n.decode?(await n.decode(),n):await new Promise((s,r)=>{try{n.onload=()=>s(n),n.onerror=i=>{const o=i instanceof Error?i.message:"error";r(new Error(o))}}catch(i){r(i)}})}const DM={};let ZA=!0;async function LM(t,e,n){let s;lm(n)?s=await gv(t,e,n):s=pv(t,n);const r=e&&e.imagebitmap;return await UM(s,r)}async function UM(t,e=null){if((kM(e)||!ZA)&&(e=null),e)try{return await createImageBitmap(t,e)}catch(n){console.warn(n),ZA=!1}return await createImageBitmap(t)}function kM(t){for(const e in t||DM)return!1;return!0}function zM(t){return!WM(t,"ftyp",4)||!(t[8]&96)?null:VM(t)}function VM(t){switch(HM(t,8,12).replace("\0"," ").trim()){case"avif":case"avis":return{extension:"avif",mimeType:"image/avif"};default:return null}}function HM(t,e,n){return String.fromCharCode(...t.slice(e,n))}function jM(t){return[...t].map(e=>e.charCodeAt(0))}function WM(t,e,n=0){const s=jM(e);for(let r=0;r<s.length;++r)if(s[r]!==t[r+n])return!1;return!0}const Bn=!1,ia=!0;function um(t){const e=Qa(t);return XM(e)||YM(e)||$M(e)||KM(e)||GM(e)}function GM(t){const e=new Uint8Array(t instanceof DataView?t.buffer:t),n=zM(e);return n?{mimeType:n.mimeType,width:0,height:0}:null}function XM(t){const e=Qa(t);return e.byteLength>=24&&e.getUint32(0,Bn)===2303741511?{mimeType:"image/png",width:e.getUint32(16,Bn),height:e.getUint32(20,Bn)}:null}function $M(t){const e=Qa(t);return e.byteLength>=10&&e.getUint32(0,Bn)===1195984440?{mimeType:"image/gif",width:e.getUint16(6,ia),height:e.getUint16(8,ia)}:null}function KM(t){const e=Qa(t);return e.byteLength>=14&&e.getUint16(0,Bn)===16973&&e.getUint32(2,ia)===e.byteLength?{mimeType:"image/bmp",width:e.getUint32(18,ia),height:e.getUint32(22,ia)}:null}function YM(t){const e=Qa(t);if(!(e.byteLength>=3&&e.getUint16(0,Bn)===65496&&e.getUint8(2)===255))return null;const{tableMarkers:s,sofMarkers:r}=JM();let i=2;for(;i+9<e.byteLength;){const o=e.getUint16(i,Bn);if(r.has(o))return{mimeType:"image/jpeg",height:e.getUint16(i+5,Bn),width:e.getUint16(i+7,Bn)};if(!s.has(o))return null;i+=2,i+=e.getUint16(i,Bn)}return null}function JM(){const t=new Set([65499,65476,65484,65501,65534]);for(let n=65504;n<65520;++n)t.add(n);return{tableMarkers:t,sofMarkers:new Set([65472,65473,65474,65475,65477,65478,65479,65481,65482,65483,65485,65486,65487,65502])}}function Qa(t){if(t instanceof DataView)return t;if(ArrayBuffer.isView(t))return new DataView(t.buffer);if(t instanceof ArrayBuffer)return new DataView(t);throw new Error("toDataView")}async function qM(t,e){var r;const{mimeType:n}=um(t)||{},s=(r=globalThis.loaders)==null?void 0:r.parseImageNode;return de(s),await s(t,n)}async function ZM(t,e,n){e=e||{};const r=(e.image||{}).type||"auto",{url:i}=n||{},o=QM(r);let a;switch(o){case"imagebitmap":a=await LM(t,e,i);break;case"image":a=await gv(t,e,i);break;case"data":a=await qM(t);break;default:de(!1)}return r==="data"&&(a=dv(a)),a}function QM(t){switch(t){case"auto":case"data":return PM();default:return IM(t),t}}const eB=["png","jpg","jpeg","gif","webp","bmp","ico","svg","avif"],tB=["image/png","image/jpeg","image/gif","image/webp","image/avif","image/bmp","image/vnd.microsoft.icon","image/svg+xml"],nB={image:{type:"auto",decode:!0}},_v={dataType:null,batchType:null,id:"image",module:"images",name:"Images",version:wM,mimeTypes:tB,extensions:eB,parse:ZM,tests:[t=>!!um(new DataView(t))],options:nB},jf={};function sB(t){if(jf[t]===void 0){const e=Oh?iB(t):rB(t);jf[t]=e}return jf[t]}function rB(t){var r,i;const e=["image/png","image/jpeg","image/gif"],n=((r=globalThis.loaders)==null?void 0:r.imageFormatsNode)||e;return!!((i=globalThis.loaders)==null?void 0:i.parseImageNode)&&n.includes(t)}function iB(t){switch(t){case"image/avif":case"image/webp":return oB(t);default:return!0}}function oB(t){try{return document.createElement("canvas").toDataURL(t).indexOf(`data:${t}`)===0}catch{return!1}}const aB=new io({id:"deck"}),J=aB;let jp={};function cB(t){jp=t}function Ze(t,e,n,s){J.level>0&&jp[t]&&jp[t].call(null,e,n,s)}function lB(t){const e=t[0],n=t[t.length-1];return e==="{"&&n==="}"||e==="["&&n==="]"}const uB={id:"JSON",name:"JSON",module:"",version:"",options:{},extensions:["json","geojson"],mimeTypes:["application/json","application/geo+json"],testText:lB,parseTextSync:JSON.parse};function hB(){const t="9.0.6",e=globalThis.deck&&globalThis.deck.VERSION;if(e&&e!==t)throw new Error(`deck.gl - multiple versions detected: ${e} vs ${t}`);return e||(J.log(1,`deck.gl ${t}`)(),globalThis.deck={...globalThis.deck,VERSION:t,version:t,log:J,_registerLoggers:cB},Jx([uB,[_v,{imagebitmap:{premultiplyAlpha:"none"}}]])),t}const fB=hB();function gr(t,e){if(!t)throw new Error(e||"shadertools: assertion failed.")}const Wf={number:{type:"number",validate(t,e){return Number.isFinite(t)&&typeof e=="object"&&(e.max===void 0||t<=e.max)&&(e.min===void 0||t>=e.min)}},array:{type:"array",validate(t,e){return Array.isArray(t)||ArrayBuffer.isView(t)}}};function dB(t){const e={};for(const[n,s]of Object.entries(t))e[n]=gB(s);return e}function pB(t,e,n){const s={};for(const[r,i]of Object.entries(e))t&&r in t&&!i.private?(i.validate&&gr(i.validate(t[r],i),`${n}: invalid ${r}`),s[r]=t[r]):s[r]=i.value;return s}function gB(t){let e=QA(t);if(e!=="object")return{value:t,...Wf[e],type:e};if(typeof t=="object")return t?t.type!==void 0?{...t,...Wf[t.type],type:t.type}:t.value===void 0?{type:"object",value:t}:(e=QA(t.value),{...t,...Wf[e],type:e}):{type:"object",value:null};throw new Error("props")}function QA(t){return Array.isArray(t)||ArrayBuffer.isView(t)?"array":typeof t}const _B=`#ifdef MODULE_LOGDEPTH
logdepth_adjustPosition(gl_Position);
#endif
`,mB=`#ifdef MODULE_MATERIAL
gl_FragColor = material_filterColor(gl_FragColor);
#endif
#ifdef MODULE_LIGHTING
gl_FragColor = lighting_filterColor(gl_FragColor);
#endif
#ifdef MODULE_FOG
gl_FragColor = fog_filterColor(gl_FragColor);
#endif
#ifdef MODULE_PICKING
gl_FragColor = picking_filterHighlightColor(gl_FragColor);
gl_FragColor = picking_filterPickingColor(gl_FragColor);
#endif
#ifdef MODULE_LOGDEPTH
logdepth_setFragDepth();
#endif
`,yB={vertex:_B,fragment:mB},e0=/void\s+main\s*\([^)]*\)\s*\{\n?/,t0=/}\n?[^{}]*$/,Gf=[],Rl="__LUMA_INJECT_DECLARATIONS__";function AB(t){const e={vertex:{},fragment:{}};for(const n in t){let s=t[n];const r=TB(n);typeof s=="string"&&(s={order:0,injection:s}),e[r][n]=s}return e}function TB(t){const e=t.slice(0,2);switch(e){case"vs":return"vertex";case"fs":return"fragment";default:throw new Error(e)}}function fu(t,e,n,s=!1){const r=e==="vertex";for(const i in n){const o=n[i];o.sort((c,l)=>c.order-l.order),Gf.length=o.length;for(let c=0,l=o.length;c<l;++c)Gf[c]=o[c].injection;const a=`${Gf.join(`
`)}
`;switch(i){case"vs:#decl":r&&(t=t.replace(Rl,a));break;case"vs:#main-start":r&&(t=t.replace(e0,c=>c+a));break;case"vs:#main-end":r&&(t=t.replace(t0,c=>a+c));break;case"fs:#decl":r||(t=t.replace(Rl,a));break;case"fs:#main-start":r||(t=t.replace(e0,c=>c+a));break;case"fs:#main-end":r||(t=t.replace(t0,c=>a+c));break;default:t=t.replace(i,c=>c+a)}}return t=t.replace(Rl,""),s&&(t=t.replace(/\}\s*$/,i=>i+yB[e])),t}let EB=1;class _r{constructor(e){p(this,"name");p(this,"vs");p(this,"fs");p(this,"getModuleUniforms");p(this,"dependencies");p(this,"deprecations");p(this,"defines");p(this,"injections");p(this,"uniforms",{});p(this,"uniformTypes",{});const{name:n,vs:s,fs:r,dependencies:i=[],uniformPropTypes:o={},getUniforms:a,deprecations:c=[],defines:l={},inject:u={}}=e;gr(typeof n=="string"),this.name=n,this.vs=s,this.fs=r,this.getModuleUniforms=a,this.dependencies=_r.instantiateModules(i),this.deprecations=this._parseDeprecationDefinitions(c),this.defines=l,this.injections=AB(u),o&&(this.uniforms=dB(o))}static instantiateModules(e){return e.map(n=>{if(n instanceof _r)return n;gr(typeof n!="string",`Shader module use by name is deprecated. Import shader module '${JSON.stringify(n)}' and use it directly.`),n.name||(console.warn("shader module has no name"),n.name=`shader-module-${EB++}`);const s=new _r(n);return s.dependencies=_r.instantiateModules(n.dependencies||[]),s})}getModuleSource(e){let n;switch(e){case"vertex":n=this.vs||"";break;case"fragment":n=this.fs||"";break;default:gr(!1)}const s=this.name.toUpperCase().replace(/[^0-9a-z]/gi,"_");return`// ----- MODULE ${this.name} ---------------

#define MODULE_${s}
${n}

`}getUniforms(e,n){return this.getModuleUniforms?this.getModuleUniforms(e,n):pB(e,this.uniforms,this.name)}getDefines(){return this.defines}checkDeprecations(e,n){this.deprecations.forEach(s=>{var r;(r=s.regex)!=null&&r.test(e)&&(s.deprecated?n.deprecated(s.old,s.new)():n.removed(s.old,s.new)())})}_parseDeprecationDefinitions(e){return e.forEach(n=>{switch(n.type){case"function":n.regex=new RegExp(`\\b${n.old}\\(`);break;default:n.regex=new RegExp(`${n.type} ${n.old};`)}}),e}_defaultGetUniforms(e={}){const n={},s=this.uniforms;for(const r in s){const i=s[r];r in e&&!i.private?(i.validate&&gr(i.validate(e[r],i),`${this.name}: invalid ${r}`),n[r]=e[r]):n[r]=i.value}return n}}function n0(t){if(t.source&&t.platformInfo.type==="webgpu")return{...t,vs:void 0,fs:void 0};if(!t.vs)throw new Error("no vertex shader");const e=s0(t.platformInfo,t.vs);let n;return t.fs&&(n=s0(t.platformInfo,t.fs)),{...t,vs:e,fs:n}}function s0(t,e){if(typeof e=="string")return e;switch(t.type){case"webgpu":if(e!=null&&e.wgsl)return e.wgsl;throw new Error("WebGPU does not support GLSL shaders");default:if(e!=null&&e.glsl)return e.glsl;throw new Error("WebGL does not support WGSL shaders")}}function Fh(t){const e=_r.instantiateModules(t);return SB(e)}function SB(t){const e={},n={};return mv({modules:t,level:0,moduleMap:e,moduleDepth:n}),Object.keys(n).sort((s,r)=>n[r]-n[s]).map(s=>e[s])}function mv(t){const{modules:e,level:n,moduleMap:s,moduleDepth:r}=t;if(n>=5)throw new Error("Possible loop in shader dependency graph");for(const i of e)s[i.name]=i,(r[i.name]===void 0||r[i.name]<n)&&(r[i.name]=n);for(const i of e)i.dependencies&&mv({modules:i.dependencies,level:n+1,moduleMap:s,moduleDepth:r})}function CB(t){switch(t==null?void 0:t.gpu.toLowerCase()){case"apple":return`#define APPLE_GPU
#define LUMA_FP64_CODE_ELIMINATION_WORKAROUND 1
#define LUMA_FP32_TAN_PRECISION_WORKAROUND 1
#define LUMA_FP64_HIGH_BITS_OVERFLOW_WORKAROUND 1
`;case"nvidia":return`#define NVIDIA_GPU
#define LUMA_FP64_CODE_ELIMINATION_WORKAROUND 1
`;case"intel":return`#define INTEL_GPU
#define LUMA_FP64_CODE_ELIMINATION_WORKAROUND 1
#define LUMA_FP32_TAN_PRECISION_WORKAROUND 1
#define LUMA_FP64_HIGH_BITS_OVERFLOW_WORKAROUND 1
`;case"amd":return`#define AMD_GPU
`;default:return`#define DEFAULT_GPU
#define LUMA_FP64_CODE_ELIMINATION_WORKAROUND 1
#define LUMA_FP32_TAN_PRECISION_WORKAROUND 1
#define LUMA_FP64_HIGH_BITS_OVERFLOW_WORKAROUND 1
`}}function vB(t,e){var s;if(Number(((s=t.match(/^#version[ \t]+(\d+)/m))==null?void 0:s[1])||100)!==300)throw new Error("luma.gl v9 only supports GLSL 3.00 shader sources");switch(e){case"vertex":return t=r0(t,wB),t;case"fragment":return t=r0(t,bB),t;default:throw new Error(e)}}const yv=[[/^(#version[ \t]+(100|300[ \t]+es))?[ \t]*\n/,`#version 300 es
`],[/\btexture(2D|2DProj|Cube)Lod(EXT)?\(/g,"textureLod("],[/\btexture(2D|2DProj|Cube)(EXT)?\(/g,"texture("]],wB=[...yv,[Wp("attribute"),"in $1"],[Wp("varying"),"out $1"]],bB=[...yv,[Wp("varying"),"in $1"]];function r0(t,e){for(const[n,s]of e)t=t.replace(n,s);return t}function Wp(t){return new RegExp(`\\b${t}[ \\t]+(\\w+[ \\t]+\\w+(\\[\\w+\\])?;)`,"g")}function Av(t,e){let n="";for(const s in t){const r=t[s];if(n+=`void ${r.signature} {
`,r.header&&(n+=`  ${r.header}`),e[s]){const i=e[s];i.sort((o,a)=>o.order-a.order);for(const o of i)n+=`  ${o.injection}
`}r.footer&&(n+=`  ${r.footer}`),n+=`}
`}return n}function Tv(t){const e={vertex:{},fragment:{}};for(const n of t){let s,r;typeof n!="string"?(s=n,r=s.hook):(s={},r=n),r=r.trim();const[i,o]=r.split(":"),a=r.replace(/\(.+/,""),c=Object.assign(s,{signature:o});switch(i){case"vs":e.vertex[a]=c;break;case"fs":e.fragment[a]=c;break;default:throw new Error(i)}}return e}function RB(t,e){return{name:IB(t,e),language:"glsl",version:PB(t)}}function IB(t,e="unnamed"){const s=/#define[^\S\r\n]*SHADER_NAME[^\S\r\n]*([A-Za-z0-9_-]+)\s*/.exec(t);return s?s[1]:e}function PB(t){let e=100;const n=t.match(/[^\s]+/g);if(n&&n.length>=2&&n[0]==="#version"){const s=parseInt(n[1],10);Number.isFinite(s)&&(e=s)}if(e!==100&&e!==300)throw new Error(`Invalid GLSL version ${e}`);return e}const Ev=`

${Rl}
`,xB=`precision highp float;
`;function MB(t){const e=Fh(t.modules||[]);return{source:Gp(t.platformInfo,{...t,source:t.source,stage:"vertex",modules:e}),getUniforms:hm(e)}}function BB(t){const e=Fh(t.modules||[]);return{vs:Gp(t.platformInfo,{...t,source:t.vs,stage:"vertex",modules:e}),fs:Gp(t.platformInfo,{...t,source:t.fs,stage:"fragment",modules:e}),getUniforms:hm(e)}}function OB(t){const{vs:e,fs:n}=t,s=Fh(t.modules||[]);return{vs:i0(t.platformInfo,{...t,source:e,stage:"vertex",modules:s}),fs:i0(t.platformInfo,{...t,source:n,stage:"fragment",modules:s}),getUniforms:hm(s)}}function Gp(t,e){const{source:n,stage:s,modules:r,hookFunctions:i=[],inject:o={},log:a}=e;gr(typeof n=="string","shader source must be a string");const c=n;let l="";const u=Tv(i),h={},f={},d={};for(const _ in o){const E=typeof o[_]=="string"?{injection:o[_],order:0}:o[_],m=/^(v|f)s:(#)?([\w-]+)$/.exec(_);if(m){const y=m[2],A=m[3];y?A==="decl"?f[_]=[E]:d[_]=[E]:h[_]=[E]}else d[_]=[E]}const g=t.type!=="webgpu"?r:[];for(const _ of g){a&&_.checkDeprecations(c,a);const E=_.getModuleSource(s,"wgsl");l+=E;const m=_.injections[s];for(const y in m){const A=/^(v|f)s:#([\w-]+)$/.exec(y);if(A){const b=A[2]==="decl"?f:d;b[y]=b[y]||[],b[y].push(m[y])}else h[y]=h[y]||[],h[y].push(m[y])}}return l+=Ev,l=fu(l,s,f),l+=Av(u[s],h),l+=c,l=fu(l,s,d),l}function i0(t,e){const{id:n,source:s,stage:r,language:i="glsl",modules:o,defines:a={},hookFunctions:c=[],inject:l={},prologue:u=!0,log:h}=e;gr(typeof s=="string","shader source must be a string");const f=i==="glsl"?RB(s).version:-1,d=t.shaderLanguageVersion,g=f===100?"#version 100":"#version 300 es",E=s.split(`
`).slice(1).join(`
`),m={};o.forEach(B=>{Object.assign(m,B.getDefines())}),Object.assign(m,a);let y="";switch(i){case"wgsl":break;case"glsl":y=u?`${g}

// ----- PROLOGUE -------------------------
${NB({id:n,source:s,stage:r})}
${`#define SHADER_TYPE_${r.toUpperCase()}`}
${CB(t)}
${r==="fragment"?xB:""}

// ----- APPLICATION DEFINES -------------------------

${FB(m)}

`:`${g}
`;break}const A=Tv(c),C={},b={},P={};for(const B in l){const O=typeof l[B]=="string"?{injection:l[B],order:0}:l[B],N=/^(v|f)s:(#)?([\w-]+)$/.exec(B);if(N){const F=N[2],H=N[3];F?H==="decl"?b[B]=[O]:P[B]=[O]:C[B]=[O]}else P[B]=[O]}for(const B of o){h&&B.checkDeprecations(E,h);const O=B.getModuleSource(r);y+=O;const N=B.injections[r];for(const F in N){const H=/^(v|f)s:#([\w-]+)$/.exec(F);if(H){const G=H[2]==="decl"?b:P;G[F]=G[F]||[],G[F].push(N[F])}else C[F]=C[F]||[],C[F].push(N[F])}}return y+="// ----- MAIN SHADER SOURCE -------------------------",y+=Ev,y=fu(y,r,b),y+=Av(A[r],C),y+=E,y=fu(y,r,P),i==="glsl"&&f!==d&&(y=vB(y,r)),y.trim()}function hm(t){return function(n){const s={};for(const r of t){const i=r.getUniforms(n,s);Object.assign(s,i)}return s}}function NB(t){const{id:e,source:n,stage:s}=t;return e&&n.indexOf("SHADER_NAME")===-1?`
#define SHADER_NAME ${e}_${s}

`:""}function FB(t={}){let e="";for(const n in t){const s=t[n];(s||Number.isFinite(s))&&(e+=`#define ${n.toUpperCase()} ${t[n]}
`)}return e}const ur=class ur{constructor(){p(this,"_hookFunctions",[]);p(this,"_defaultModules",[])}static getDefaultShaderAssembler(){return ur.defaultShaderAssembler=ur.defaultShaderAssembler||new ur,ur.defaultShaderAssembler}addDefaultModule(e){this._defaultModules.find(n=>n.name===(typeof e=="string"?e:e.name))||this._defaultModules.push(e)}removeDefaultModule(e){const n=typeof e=="string"?e:e.name;this._defaultModules=this._defaultModules.filter(s=>s.name!==n)}addShaderHook(e,n){n&&(e=Object.assign(n,{hook:e})),this._hookFunctions.push(e)}assembleShader(e){const n=this._getModuleList(e.modules),s=this._hookFunctions,r=n0(e);return{...MB({platformInfo:e.platformInfo,...r,modules:n,hookFunctions:s}),modules:n}}assembleShaderPair(e){const n=n0(e),s=this._getModuleList(e.modules),r=this._hookFunctions,{platformInfo:i}=e;return{...e.platformInfo.shaderLanguage==="wgsl"?BB({platformInfo:i,...n,modules:s,hookFunctions:r}):OB({platformInfo:i,...n,modules:s,hookFunctions:r}),modules:s}}_getModuleList(e=[]){const n=new Array(this._defaultModules.length+e.length),s={};let r=0;for(let i=0,o=this._defaultModules.length;i<o;++i){const a=this._defaultModules[i],c=a.name;n[r++]=a,s[c]=!0}for(let i=0,o=e.length;i<o;++i){const a=e[i],c=a.name;s[c]||(n[r++]=a,s[c]=!0)}return n.length=r,_r.instantiateModules(n)}};p(ur,"defaultShaderAssembler");let du=ur;const DB=`out vec4 transform_output;
void main() {
transform_output = vec4(0);
}`,LB=`#version 300 es
${DB}`;function UB(t){const{input:e,inputChannels:n,output:s}=t||{};if(!e)return LB;if(!n)throw new Error("inputChannels");const r=kB(n),i=zB(e,n);return`#version 300 es
in ${r} ${e};
out vec4 ${s};
void main() {
  ${s} = ${i};
}`}function kB(t){switch(t){case 1:return"float";case 2:return"vec2";case 3:return"vec3";case 4:return"vec4";default:throw new Error(`invalid channels: ${t}`)}}function zB(t,e){switch(e){case 1:return`vec4(${t}, 0.0, 0.0, 1.0)`;case 2:return`vec4(${t}, 0.0, 1.0)`;case 3:return`vec4(${t}, 1.0)`;case 4:return t;default:throw new Error(`invalid channels: ${e}`)}}const U=new io({id:"luma.gl"});class VB{constructor(){p(this,"stats",new Map)}getStats(e){return this.get(e)}get(e){return this.stats.has(e)||this.stats.set(e,new oo({id:e})),this.stats.get(e)}}const fm=new VB;function HB(){const t="9.0.9",e="set luma.log.level=1 (or higher) to trace rendering";if(globalThis.luma&&globalThis.luma.VERSION!==t)throw new Error(`luma.gl - multiple VERSIONs detected: ${globalThis.luma.VERSION} vs ${t}`);return globalThis.luma||(Ys()&&U.log(1,`${t} - ${e}`)(),globalThis.luma=globalThis.luma||{VERSION:t,version:t,log:U,stats:fm}),t}const jB=HB();function WB(t){return ArrayBuffer.isView(t)&&!(t instanceof DataView)?t:null}function Oa(t){return Array.isArray(t)?t.length===0||typeof t[0]=="number"?t:null:WB(t)}const Xf={};function Js(t="id"){Xf[t]=Xf[t]||1;const e=Xf[t]++;return`${t}-${e}`}function pu(t){let e=!0;for(const n in t){e=!1;break}return e}var Gd;let fe=(Gd=class{constructor(e,n,s){p(this,"id");p(this,"props");p(this,"userData",{});p(this,"_device");p(this,"destroyed",!1);p(this,"allocatedBytes",0);p(this,"_attachedResources",new Set);if(!e)throw new Error("no device");this._device=e,this.props=GB(n,s);const r=this.props.id!=="undefined"?this.props.id:Js(this[Symbol.toStringTag]);this.props.id=r,this.id=r,this.userData=this.props.userData||{},this.addStats()}destroy(){this.destroyResource()}delete(){return this.destroy(),this}toString(){return`${this[Symbol.toStringTag]||this.constructor.name}(${this.id})`}getProps(){return this.props}attachResource(e){this._attachedResources.add(e)}detachResource(e){this._attachedResources.delete(e)}destroyAttachedResource(e){this._attachedResources.delete(e)&&e.destroy()}destroyAttachedResources(){for(const e of Object.values(this._attachedResources))e.destroy();this._attachedResources=new Set}destroyResource(){this.destroyAttachedResources(),this.removeStats(),this.destroyed=!0}removeStats(){const e=this._device.statsManager.getStats("Resource Counts"),n=this[Symbol.toStringTag];e.get(`${n}s Active`).decrementCount()}trackAllocatedMemory(e,n=this[Symbol.toStringTag]){const s=this._device.statsManager.getStats("Resource Counts");s.get("GPU Memory").addCount(e),s.get(`${n} Memory`).addCount(e),this.allocatedBytes=e}trackDeallocatedMemory(e=this[Symbol.toStringTag]){const n=this._device.statsManager.getStats("Resource Counts");n.get("GPU Memory").subtractCount(this.allocatedBytes),n.get(`${e} Memory`).subtractCount(this.allocatedBytes),this.allocatedBytes=0}addStats(){const e=this._device.statsManager.getStats("Resource Counts"),n=this[Symbol.toStringTag];e.get("Resources Created").incrementCount(),e.get(`${n}s Created`).incrementCount(),e.get(`${n}s Active`).incrementCount()}},p(Gd,"defaultProps",{id:"undefined",handle:void 0,userData:void 0}),Gd);function GB(t,e){const n={...e};for(const s in t)t[s]!==void 0&&(n[s]=t[s]);return n}const We=class We extends fe{constructor(n,s){const r={...s};(s.usage||0)&We.INDEX&&!s.indexType&&(s.data instanceof Uint32Array?r.indexType="uint32":s.data instanceof Uint16Array&&(r.indexType="uint16"));super(n,r,We.defaultProps);p(this,"usage");p(this,"indexType");p(this,"updateTimestamp");p(this,"debugData",new ArrayBuffer(0));this.usage=s.usage||0,this.indexType=r.indexType,this.updateTimestamp=n.incrementTimestamp()}get[Symbol.toStringTag](){return"Buffer"}readSyncWebGL(n,s){throw new Error("not implemented")}_setDebugData(n,s,r){const i=ArrayBuffer.isView(n)?n.buffer:n,o=Math.min(n?n.byteLength:r,We.DEBUG_DATA_MAX_LENGTH);n===null?this.debugData=new ArrayBuffer(o):s===0&&r===n.byteLength?this.debugData=i.slice(0,o):this.debugData=i.slice(s,s+o)}};p(We,"defaultProps",{...fe.defaultProps,usage:0,byteLength:0,byteOffset:0,data:null,indexType:"uint16",mappedAtCreation:!1}),p(We,"MAP_READ",1),p(We,"MAP_WRITE",2),p(We,"COPY_SRC",4),p(We,"COPY_DST",8),p(We,"INDEX",16),p(We,"VERTEX",32),p(We,"UNIFORM",64),p(We,"STORAGE",128),p(We,"INDIRECT",256),p(We,"QUERY_RESOLVE",512),p(We,"DEBUG_DATA_MAX_LENGTH",32);let Ae=We;function Sv(t){const e=o0[t],n=XB(e),s=t.includes("norm"),r=!s&&!t.startsWith("float"),i=t.startsWith("s");return{dataType:o0[t],byteLength:n,integer:r,signed:i,normalized:s}}function XB(t){return $B[t]}const o0={uint8:"uint8",sint8:"sint8",unorm8:"uint8",snorm8:"sint8",uint16:"uint16",sint16:"sint16",unorm16:"uint16",snorm16:"sint16",float16:"float16",float32:"float32",uint32:"uint32",sint32:"sint32"},$B={uint8:1,sint8:1,uint16:2,sint16:2,float16:2,float32:4,uint32:4,sint32:4},KB=["bc1","bc2","bc3","bc4","bc5","bc6","bc7","etc1","etc2","eac","atc","astc","pvrtc"],YB=/^(rg?b?a?)([0-9]*)([a-z]*)(-srgb)?(-webgl|-unsized)?$/;function JB(t){return KB.some(e=>t.startsWith(e))}function Cv(t){const e=YB.exec(t);if(e){const[,n,s,r,i,o]=e;if(n){const a=`${r}${s}`,c=Sv(a);return{format:n,components:n.length,srgb:i==="-srgb",unsized:o==="-unsized",webgl:o==="-webgl",...c}}}return ZB(t)}const qB={"rgba4unorm-webgl":{format:"rgba",bpp:2},"rgb565unorm-webgl":{format:"rgb",bpp:2},"rgb5a1unorm-webgl":{format:"rgba",bbp:2},rgb9e5ufloat:{format:"rgb",bbp:4},rg11b10ufloat:{format:"rgb",bbp:4},rgb10a2unorm:{format:"rgba",bbp:4},"rgb10a2uint-webgl":{format:"rgba",bbp:4},stencil8:{components:1,bpp:1,a:"stencil"},depth16unorm:{components:1,bpp:2,a:"depth"},depth24plus:{components:1,bpp:3,a:"depth"},depth32float:{components:1,bpp:4,a:"depth"},"depth24plus-stencil8":{components:2,bpp:4,a:"depth-stencil"},"depth24unorm-stencil8":{components:2,bpp:4,a:"depth-stencil"},"depth32float-stencil8":{components:2,bpp:4,a:"depth-stencil"}};function ZB(t){var n;const e=qB[t];if(!e)throw new Error(`Unknown format ${t}`);return{format:e.format||"",components:e.components||((n=e.format)==null?void 0:n.length)||1,byteLength:e.bpp||1,srgb:!1,unsized:!1}}class QB{}class e2{constructor(e=[],n){p(this,"features");p(this,"disabledFeatures");this.features=new Set(e),this.disabledFeatures=n||{}}*[Symbol.iterator](){yield*this.features}has(e){return!this.disabledFeatures[e]&&this.features.has(e)}}const da=class da{constructor(e){p(this,"id");p(this,"props");p(this,"userData",{});p(this,"statsManager",fm);p(this,"_lumaData",{});p(this,"timestamp",0);this.props={...da.defaultProps,...e},this.id=this.props.id||Js(this[Symbol.toStringTag].toLowerCase())}get[Symbol.toStringTag](){return"Device"}isTextureFormatCompressed(e){return JB(e)}loseDevice(){return!1}getCanvasContext(){if(!this.canvasContext)throw new Error("Device has no CanvasContext");return this.canvasContext}createTexture(e){return(e instanceof Promise||typeof e=="string")&&(e={data:e}),this._createTexture(e)}createCommandEncoder(e={}){throw new Error("not implemented")}readPixelsToArrayWebGL(e,n){throw new Error("not implemented")}readPixelsToBufferWebGL(e,n){throw new Error("not implemented")}setParametersWebGL(e){throw new Error("not implemented")}getParametersWebGL(e){throw new Error("not implemented")}withParametersWebGL(e,n){throw new Error("not implemented")}clearWebGL(e){throw new Error("not implemented")}resetWebGL(){throw new Error("not implemented")}incrementTimestamp(){return this.timestamp++}onError(e){this.props.onError(e)}_getBufferProps(e){(e instanceof ArrayBuffer||ArrayBuffer.isView(e))&&(e={data:e});const n={...e};return(e.usage||0)&Ae.INDEX&&!e.indexType&&(e.data instanceof Uint32Array?n.indexType="uint32":e.data instanceof Uint16Array?n.indexType="uint16":U.warn("indices buffer content must be of integer type")()),n}};p(da,"defaultProps",{id:null,canvas:null,container:null,manageState:!0,width:800,height:600,requestMaxLimits:!0,debug:!!U.get("debug"),spector:!!U.get("spector"),break:[],initalizeFeatures:!0,disabledFeatures:{"compilation-status-async-webgl":!0},gl:null,onError:e=>U.error(e.message)}),p(da,"VERSION",jB);let Sr=da;function oe(t,e){if(!t)throw new Error(e||"luma.gl: assertion failed.")}const wo=new Map;class Cr{static registerDevices(e){for(const n of e)oe(n.type&&n.isSupported&&n.create),wo.set(n.type,n)}static getAvailableDevices(){return Array.from(wo).map(e=>e.type)}static getSupportedDevices(){return Array.from(wo).filter(e=>e.isSupported()).map(e=>e.type)}static setDefaultDeviceProps(e){Object.assign(Sr.defaultProps,e)}static async attachDevice(e){const n=a0(e.devices)||wo;if(e.handle instanceof WebGL2RenderingContext){const s=n.get("webgl");if(s)return await s.attach(e.handle)}if(e.handle===null){const s=n.get("unknown");if(s)return await s.attach(null)}throw new Error("Failed to attach device. Ensure `@luma.gl/webgl` and/or `@luma.gl/webgpu` modules are imported.")}static async createDevice(e={}){var s,r;e={...Sr.defaultProps,...e},e.gl&&(e.type="webgl");const n=a0(e.devices)||wo;switch(e.type){case"webgpu":let i=n.get("webgpu");if(i)return await i.create(e);break;case"webgl":let o=n.get("webgl");if(o)return await o.create(e);break;case"unknown":const a=n.get("unknown");if(a)return await a.create(e);break;case"best-available":if(i=n.get("webgpu"),(s=i==null?void 0:i.isSupported)!=null&&s.call(i))return await i.create(e);if(o=n.get("webgl"),(r=o==null?void 0:o.isSupported)!=null&&r.call(o))return await o.create(e);break}throw new Error("No matching device found. Ensure `@luma.gl/webgl` and/or `@luma.gl/webgpu` modules are imported.")}}p(Cr,"defaultProps",{...Sr.defaultProps,type:"best-available",devices:void 0}),p(Cr,"stats",fm),p(Cr,"log",U);function a0(t){if(!t||(t==null?void 0:t.length)===0)return null;const e=new Map;for(const n of t)e.set(n.type,n);return e}const t2=Ys()&&typeof document<"u",Dh=()=>t2&&document.readyState==="complete",n2={canvas:null,width:800,height:600,useDevicePixels:!0,autoResize:!0,container:null,visible:!0,colorSpace:"srgb",alphaMode:"opaque"};class dm{constructor(e){p(this,"id");p(this,"props");p(this,"canvas");p(this,"htmlCanvas");p(this,"offscreenCanvas");p(this,"type");p(this,"width",1);p(this,"height",1);p(this,"resizeObserver");p(this,"_canvasSizeInfo",{clientWidth:0,clientHeight:0,devicePixelRatio:1});if(this.props={...n2,...e},e=this.props,!Ys()){this.id="node-canvas-context",this.type="node",this.width=this.props.width,this.height=this.props.height,this.canvas=null;return}if(e.canvas)typeof e.canvas=="string"?this.canvas=i2(e.canvas):this.canvas=e.canvas;else{const n=o2(e),s=r2((e==null?void 0:e.container)||null);s.insertBefore(n,s.firstChild),this.canvas=n,e!=null&&e.visible||(this.canvas.style.visibility="hidden")}this.canvas instanceof HTMLCanvasElement?(this.id=this.canvas.id,this.type="html-canvas",this.htmlCanvas=this.canvas):(this.id="offscreen-canvas",this.type="offscreen-canvas",this.offscreenCanvas=this.canvas),this.canvas instanceof HTMLCanvasElement&&e.autoResize&&(this.resizeObserver=new ResizeObserver(n=>{for(const s of n)s.target===this.canvas&&this.update()}),this.resizeObserver.observe(this.canvas))}static get isPageLoaded(){return Dh()}getDevicePixelRatio(e){return typeof OffscreenCanvas<"u"&&this.canvas instanceof OffscreenCanvas||(e=e===void 0?this.props.useDevicePixels:e,!e||e<=0)?1:e===!0?typeof window<"u"&&window.devicePixelRatio||1:e}getPixelSize(){switch(this.type){case"node":return[this.width,this.height];case"offscreen-canvas":return[this.canvas.width,this.canvas.height];case"html-canvas":const e=this.getDevicePixelRatio(),n=this.canvas;return n.parentElement?[n.clientWidth*e,n.clientHeight*e]:[this.canvas.width,this.canvas.height];default:throw new Error(this.type)}}getAspect(){const[e,n]=this.getPixelSize();return e/n}cssToDeviceRatio(){try{const[e]=this.getDrawingBufferSize(),{clientWidth:n}=this._canvasSizeInfo;return n?e/n:1}catch{return 1}}cssToDevicePixels(e,n=!0){const s=this.cssToDeviceRatio(),[r,i]=this.getDrawingBufferSize();return a2(e,s,r,i,n)}setDevicePixelRatio(e,n={}){if(!this.htmlCanvas)return;let s="width"in n?n.width:this.htmlCanvas.clientWidth,r="height"in n?n.height:this.htmlCanvas.clientHeight;(!s||!r)&&(U.log(1,"Canvas clientWidth/clientHeight is 0")(),e=1,s=this.htmlCanvas.width||1,r=this.htmlCanvas.height||1);const i=this._canvasSizeInfo;if(i.clientWidth!==s||i.clientHeight!==r||i.devicePixelRatio!==e){let o=e;const a=Math.floor(s*o),c=Math.floor(r*o);this.htmlCanvas.width=a,this.htmlCanvas.height=c;const[l,u]=this.getDrawingBufferSize();(l!==a||u!==c)&&(o=Math.min(l/s,u/r),this.htmlCanvas.width=Math.floor(s*o),this.htmlCanvas.height=Math.floor(r*o),U.warn("Device pixel ratio clamped")()),this._canvasSizeInfo.clientWidth=s,this._canvasSizeInfo.clientHeight=r,this._canvasSizeInfo.devicePixelRatio=e}}getDrawingBufferSize(){const e=this.device.gl;if(!e)throw new Error("canvas size");return[e.drawingBufferWidth,e.drawingBufferHeight]}_setAutoCreatedCanvasId(e){var n;((n=this.htmlCanvas)==null?void 0:n.id)==="lumagl-auto-created-canvas"&&(this.htmlCanvas.id=e)}}p(dm,"pageLoaded",s2());function s2(){return Dh()||typeof window>"u"?Promise.resolve():new Promise(t=>{window.addEventListener("load",()=>t())})}function r2(t){if(typeof t=="string"){const e=document.getElementById(t);if(!e&&!Dh())throw new Error(`Accessing '${t}' before page was loaded`);if(!e)throw new Error(`${t} is not an HTML element`);return e}else if(t)return t;return document.body}function i2(t){const e=document.getElementById(t);if(!e&&!Dh())throw new Error(`Accessing '${t}' before page was loaded`);if(!(e instanceof HTMLCanvasElement))throw new Error("Object is not a canvas element");return e}function o2(t){const{width:e,height:n}=t,s=document.createElement("canvas");return s.id="lumagl-auto-created-canvas",s.width=e||1,s.height=n||1,s.style.width=Number.isFinite(e)?`${e}px`:"100%",s.style.height=Number.isFinite(n)?`${n}px`:"100%",s}function a2(t,e,n,s,r){const i=t,o=c0(i[0],e,n);let a=l0(i[1],e,s,r),c=c0(i[0]+1,e,n);const l=c===n-1?c:c-1;c=l0(i[1]+1,e,s,r);let u;return r?(c=c===0?c:c+1,u=a,a=c):u=c===s-1?c:c-1,{x:o,y:a,width:Math.max(l-o+1,1),height:Math.max(u-a+1,1)}}function c0(t,e,n){return Math.min(Math.round(t*e),n-1)}function l0(t,e,n,s){return s?Math.max(0,n-1-Math.round(t*e)):Math.min(Math.round(t*e),n-1)}const Xn=class Xn extends fe{constructor(n,s,r=Xn.defaultProps){super(n,s,r);p(this,"dimension");p(this,"format");p(this,"width");p(this,"height");p(this,"depth");p(this,"updateTimestamp");this.dimension=this.props.dimension,this.format=this.props.format,this.width=this.props.width,this.height=this.props.height,this.depth=this.props.depth,this.updateTimestamp=n.incrementTimestamp()}get[Symbol.toStringTag](){return"Texture"}};p(Xn,"defaultProps",{...fe.defaultProps,data:null,dimension:"2d",format:"rgba8unorm",width:void 0,height:void 0,depth:1,mipmaps:!0,compressed:!1,usage:0,mipLevels:void 0,samples:void 0,type:void 0,sampler:{},view:void 0}),p(Xn,"COPY_SRC",1),p(Xn,"COPY_DST",2),p(Xn,"TEXTURE_BINDING",4),p(Xn,"STORAGE_BINDING",8),p(Xn,"RENDER_ATTACHMENT",16);let Rt=Xn;const Uu=class Uu extends fe{get[Symbol.toStringTag](){return"TextureView"}constructor(e,n){super(e,n,Uu.defaultProps)}};p(Uu,"defaultProps",{...fe.defaultProps,format:void 0,dimension:void 0,aspect:"all",baseMipLevel:0,mipLevelCount:void 0,baseArrayLayer:0,arrayLayerCount:void 0});let gu=Uu;function c2(t,e,n){let s="";const r=e.split(/\r?\n/),i=t.slice().sort((o,a)=>o.lineNum-a.lineNum);switch((n==null?void 0:n.showSourceCode)||"no"){case"all":let o=0;for(let a=1;a<=r.length;a++)for(s+=vv(r[a-1],a,n);i.length>o&&i[o].lineNum===a;){const c=i[o++];s+=u0(c,r,c.lineNum,{...n,inlineSource:!1})}return s;case"issues":case"no":for(const a of t)s+=u0(a,r,a.lineNum,{inlineSource:(n==null?void 0:n.showSourceCode)!=="no"});return s}}function u0(t,e,n,s){if(s!=null&&s.inlineSource){const r=l2(e,n),i=t.linePos>0?`${" ".repeat(t.linePos+5)}^^^
`:"";return`
${r}${i}${t.type.toUpperCase()}: ${t.message}

`}return s!=null&&s.html?`<div class='luma-compiler-log-error' style="color:red;"><b> ${t.type.toUpperCase()}: ${t.message}</b></div>`:`${t.type.toUpperCase()}: ${t.message}`}function l2(t,e,n){let s="";for(let r=e-2;r<=e;r++){const i=t[r-1];i!==void 0&&(s+=vv(i,e,n))}return s}function vv(t,e,n){const s=n!=null&&n.html?h2(t):t;return`${u2(String(e),4)}: ${s}${n!=null&&n.html?"<br/>":`
`}`}function u2(t,e){let n="";for(let s=t.length;s<e;++s)n+=" ";return n+t}function h2(t){return t.replaceAll("&","&amp;").replaceAll("<","&lt;").replaceAll(">","&gt;").replaceAll('"',"&quot;").replaceAll("'","&#039;")}function wv(t,e){return{name:f2(t,e),language:"glsl",version:d2(t)}}function f2(t,e="unnamed"){const s=/#define[\s*]SHADER_NAME[\s*]([A-Za-z0-9_-]+)[\s*]/.exec(t);return s?s[1]:e}function d2(t){let e=100;const n=t.match(/[^\s]+/g);if(n&&n.length>=2&&n[0]==="#version"){const s=parseInt(n[1],10);Number.isFinite(s)&&(e=s)}return e}const ku=class ku extends fe{constructor(n,s){super(n,{id:p2(s),...s},ku.defaultProps);p(this,"stage");p(this,"source");p(this,"compilationStatus","pending");this.stage=this.props.stage,this.source=this.props.source}get[Symbol.toStringTag](){return"Shader"}getCompilationInfoSync(){return null}getTranslatedSource(){return null}async debugShader(n=this.props.debug){switch(n){case"never":return;case"errors":if(this.compilationStatus==="success")return;break}const s=await this.getCompilationInfo();this.props.debug==="warnings"&&(s==null?void 0:s.length)===0||this._displayShaderLog(s)}_displayShaderLog(n){var l;if(typeof document>"u"||!(document!=null&&document.createElement))return;const s=wv(this.source).name,r=`${this.stage} ${s}`;let i=c2(n,this.source,{showSourceCode:"all",html:!0});const o=this.getTranslatedSource();o&&(i+=`<br /><br /><h1>Translated Source</h1><br /><br /><code style="user-select:text;"><pre>${o}</pre></code>`);const a=document.createElement("Button");a.innerHTML=`
<h1>Shader Compilation Error in ${r}</h1><br /><br />
<code style="user-select:text;"><pre>
${i}
</pre></code>`,a.style.top="10px",a.style.left="10px",a.style.position="absolute",a.style.zIndex="9999",a.style.width="100%",a.style.textAlign="left",document.body.appendChild(a);const c=document.getElementsByClassName("luma-compiler-log-error");(l=c[0])!=null&&l.scrollIntoView&&c[0].scrollIntoView(),a.onclick=()=>{const u=`data:text/plain,${encodeURIComponent(this.source)}`;navigator.clipboard.writeText(u)}}};p(ku,"defaultProps",{...fe.defaultProps,language:"auto",stage:void 0,source:"",sourceMap:null,entryPoint:"main",debug:"errors"});let _u=ku;function p2(t){return wv(t.source).name||t.id||Js(`unnamed ${t.stage}-shader`)}const zu=class zu extends fe{get[Symbol.toStringTag](){return"Sampler"}constructor(e,n){super(e,n,zu.defaultProps)}};p(zu,"defaultProps",{...fe.defaultProps,type:"color-sampler",addressModeU:"clamp-to-edge",addressModeV:"clamp-to-edge",addressModeW:"clamp-to-edge",magFilter:"nearest",minFilter:"nearest",mipmapFilter:"nearest",lodMinClamp:0,lodMaxClamp:32,compare:"less-equal",maxAnisotropy:1});let mu=zu;const Vu=class Vu extends fe{constructor(n,s={}){super(n,s,Vu.defaultProps);p(this,"width");p(this,"height");p(this,"colorAttachments",[]);p(this,"depthStencilAttachment",null);this.width=this.props.width,this.height=this.props.height}get[Symbol.toStringTag](){return"Framebuffer"}resize(n){let s=!n;if(n){const[r,i]=Array.isArray(n)?n:[n.width,n.height];s=s||i!==this.height||r!==this.width,this.width=r,this.height=i}s&&(U.log(2,`Resizing framebuffer ${this.id} to ${this.width}x${this.height}`)(),this.resizeAttachments(this.width,this.height))}autoCreateAttachmentTextures(){if(this.props.colorAttachments.length===0&&!this.props.depthStencilAttachment)throw new Error("Framebuffer has noattachments");this.colorAttachments=this.props.colorAttachments.map(s=>{if(typeof s=="string"){const r=this.createColorTexture(s);return this.attachResource(r),r.view}return s instanceof Rt?s.view:s});const n=this.props.depthStencilAttachment;if(n)if(typeof n=="string"){const s=this.createDepthStencilTexture(n);this.attachResource(s),this.depthStencilAttachment=s.view}else n instanceof Rt?this.depthStencilAttachment=n.view:this.depthStencilAttachment=n}createColorTexture(n){return this.device.createTexture({id:"color-attachment",usage:Rt.RENDER_ATTACHMENT,format:n,width:this.width,height:this.height})}createDepthStencilTexture(n){return this.device.createTexture({id:"depth-stencil-attachment",usage:Rt.RENDER_ATTACHMENT,format:n,width:this.width,height:this.height})}resizeAttachments(n,s){for(let r=0;r<this.colorAttachments.length;++r)if(this.colorAttachments[r]){const i=this.device._createTexture({...this.colorAttachments[r].props,width:n,height:s});this.destroyAttachedResource(this.colorAttachments[r]),this.colorAttachments[r]=i.view,this.attachResource(i.view)}if(this.depthStencilAttachment){const r=this.device._createTexture({...this.depthStencilAttachment.props,width:n,height:s});this.destroyAttachedResource(this.depthStencilAttachment),this.depthStencilAttachment=r.view,this.attachResource(r)}}};p(Vu,"defaultProps",{...fe.defaultProps,width:1,height:1,colorAttachments:[],depthStencilAttachment:null});let yu=Vu;const Hu=class Hu extends fe{constructor(n,s){super(n,s,Hu.defaultProps);p(this,"shaderLayout");p(this,"bufferLayout");p(this,"linkStatus","pending");p(this,"hash","");this.shaderLayout=this.props.shaderLayout,this.bufferLayout=this.props.bufferLayout||[]}get[Symbol.toStringTag](){return"RenderPipeline"}setUniformsWebGL(n){throw new Error("Use uniform blocks")}};p(Hu,"defaultProps",{...fe.defaultProps,vs:null,vertexEntryPoint:"vertexMain",vsConstants:{},fs:null,fragmentEntryPoint:"fragmentMain",fsConstants:{},shaderLayout:null,bufferLayout:[],topology:"triangle-list",parameters:{},vertexCount:0,instanceCount:0,bindings:{},uniforms:{}});let Wi=Hu;const ju=class ju extends fe{get[Symbol.toStringTag](){return"RenderPass"}constructor(e,n){super(e,n,ju.defaultProps)}};p(ju,"defaultProps",{...fe.defaultProps,framebuffer:null,parameters:void 0,clearColor:[0,0,0,0],clearDepth:1,clearStencil:0,depthReadOnly:!1,stencilReadOnly:!1,discard:!1,occlusionQuerySet:void 0,timestampQuerySet:void 0,beginTimestampIndex:void 0,endTimestampIndex:void 0});let Xp=ju;const Wu=class Wu extends fe{constructor(n,s){super(n,s,Wu.defaultProps);p(this,"hash","")}get[Symbol.toStringTag](){return"ComputePipeline"}};p(Wu,"defaultProps",{...fe.defaultProps,shader:void 0,entryPoint:void 0,constants:{},shaderLayout:void 0});let Au=Wu;const Gu=class Gu extends fe{get[Symbol.toStringTag](){return"CommandEncoder"}constructor(e,n){super(e,n,Gu.defaultProps)}};p(Gu,"defaultProps",{...fe.defaultProps,measureExecutionTime:void 0});let $p=Gu;const Xu=class Xu extends fe{get[Symbol.toStringTag](){return"CommandBuffer"}constructor(e,n){super(e,n,Xu.defaultProps)}};p(Xu,"defaultProps",{...fe.defaultProps});let Kp=Xu;function g2(t){const[e,n]=m2[t],s=e==="i32"||e==="u32",r=e!=="u32",i=y2[e]*n,o=_2(e,n);return{dataType:e,components:n,defaultVertexFormat:o,byteLength:i,integer:s,signed:r}}function _2(t,e){let n;switch(t){case"f32":n="float32";break;case"i32":n="sint32";break;case"u32":n="uint32";break;case"f16":return e<=2?"float16x2":"float16x4"}return e===1?n:`${n}x${e}`}const m2={f32:["f32",1],"vec2<f32>":["f32",2],"vec3<f32>":["f32",3],"vec4<f32>":["f32",4],f16:["f16",1],"vec2<f16>":["f16",2],"vec3<f16>":["f16",3],"vec4<f16>":["f16",4],i32:["i32",1],"vec2<i32>":["i32",2],"vec3<i32>":["i32",3],"vec4<i32>":["i32",4],u32:["u32",1],"vec2<u32>":["u32",2],"vec3<u32>":["u32",3],"vec4<u32>":["u32",4]},y2={f32:4,f16:2,i32:4,u32:4};function bv(t){let e;t.endsWith("-webgl")&&(t.replace("-webgl",""),e=!0);const[n,s]=t.split("x"),r=n,i=s?parseInt(s):1,o=Sv(r),a={type:r,components:i,byteLength:o.byteLength*i,integer:o.integer,signed:o.signed,normalized:o.normalized};return e&&(a.webglOnly=!0),a}function Rv(t,e){const n={};for(const s of t.attributes)n[s.name]=T2(t,e,s.name);return n}function A2(t,e,n=16){const s=Rv(t,e),r=new Array(n).fill(null);for(const i of Object.values(s))r[i.location]=i;return r}function T2(t,e,n){const s=E2(t,n),r=S2(e,n);if(!s)return null;const i=g2(s.type),o=(r==null?void 0:r.vertexFormat)||i.defaultVertexFormat,a=bv(o);return{attributeName:(r==null?void 0:r.attributeName)||s.name,bufferName:(r==null?void 0:r.bufferName)||s.name,location:s.location,shaderType:s.type,shaderDataType:i.dataType,shaderComponents:i.components,vertexFormat:o,bufferDataType:a.type,bufferComponents:a.components,normalized:a.normalized,integer:i.integer,stepMode:(r==null?void 0:r.stepMode)||s.stepMode,byteOffset:(r==null?void 0:r.byteOffset)||0,byteStride:(r==null?void 0:r.byteStride)||0}}function E2(t,e){const n=t.attributes.find(s=>s.name===e);return n||U.warn(`shader layout attribute "${e}" not present in shader`),n||null}function S2(t,e){C2(t);let n=v2(t,e);return n||(n=w2(t,e),n)?n:(U.warn(`layout for attribute "${e}" not present in buffer layout`),null)}function C2(t){for(const e of t)(e.attributes&&e.format||!e.attributes&&!e.format)&&U.warn(`BufferLayout ${name} must have either 'attributes' or 'format' field`)}function v2(t,e){for(const n of t)if(n.format&&n.name===e)return{attributeName:n.name,bufferName:e,stepMode:n.stepMode,vertexFormat:n.format,byteOffset:0,byteStride:n.byteStride||0};return null}function w2(t,e){var n;for(const s of t){let r=s.byteStride;if(typeof s.byteStride!="number")for(const o of s.attributes||[]){const a=bv(o.format);r+=a.byteLength}const i=(n=s.attributes)==null?void 0:n.find(o=>o.attribute===e);if(i)return{attributeName:i.attribute,bufferName:s.name,stepMode:s.stepMode,vertexFormat:i.format,byteOffset:i.byteOffset,byteStride:r}}return null}function b2(t,e){const n={...t,attributes:t.attributes.map(s=>({...s}))};for(const s of(e==null?void 0:e.attributes)||[]){const r=n.attributes.find(i=>i.name===s.name);r?(r.type=s.type||r.type,r.stepMode=s.stepMode||r.stepMode):U.warn(`shader layout attribute ${s.name} not present in shader`)}return n}const $u=class $u extends fe{constructor(n,s){super(n,s,$u.defaultProps);p(this,"maxVertexAttributes");p(this,"attributeInfos");p(this,"indexBuffer",null);p(this,"attributes");this.maxVertexAttributes=n.limits.maxVertexAttributes,this.attributes=new Array(this.maxVertexAttributes).fill(null),this.attributeInfos=A2(s.renderPipeline.shaderLayout,s.renderPipeline.bufferLayout,this.maxVertexAttributes)}get[Symbol.toStringTag](){return"VertexArray"}setConstantWebGL(n,s){throw new Error("constant attributes not supported")}};p($u,"defaultProps",{...fe.defaultProps,renderPipeline:null});let Yp=$u;const Ku=class Ku extends fe{get[Symbol.toStringTag](){return"TransformFeedback"}constructor(e,n){super(e,n,Ku.defaultProps)}};p(Ku,"defaultProps",{...fe.defaultProps,layout:void 0,buffers:{}});let Jp=Ku;const Yu=class Yu extends fe{get[Symbol.toStringTag](){return"QuerySet"}constructor(e,n){super(e,n,Yu.defaultProps)}};p(Yu,"defaultProps",{...fe.defaultProps,type:void 0,count:void 0});let qp=Yu;const R2={f32:{type:"f32",components:1},i32:{type:"i32",components:1},u32:{type:"u32",components:1},"vec2<f32>":{type:"f32",components:2},"vec3<f32>":{type:"f32",components:3},"vec4<f32>":{type:"f32",components:4},"vec2<i32>":{type:"i32",components:2},"vec3<i32>":{type:"i32",components:3},"vec4<i32>":{type:"i32",components:4},"vec2<u32>":{type:"u32",components:2},"vec3<u32>":{type:"u32",components:3},"vec4<u32>":{type:"u32",components:4},"mat2x2<f32>":{type:"f32",components:4},"mat2x3<f32>":{type:"f32",components:6},"mat2x4<f32>":{type:"f32",components:8},"mat3x2<f32>":{type:"f32",components:6},"mat3x3<f32>":{type:"f32",components:9},"mat3x4<f32>":{type:"f32",components:12},"mat4x2<f32>":{type:"f32",components:8},"mat4x3<f32>":{type:"f32",components:12},"mat4x4<f32>":{type:"f32",components:16}};function I2(t){const e=R2[t];return oe(t),e}function P2(t,e){switch(e){case 1:return t;case 2:return t+t%2;default:return t+(4-t%4)%4}}let Oc;function Iv(t){return(!Oc||Oc.byteLength<t)&&(Oc=new ArrayBuffer(t)),Oc}function x2(t,e){const n=Iv(t.BYTES_PER_ELEMENT*e);return new t(n,0,e)}function M2(t){const{target:e,source:n,start:s=0,count:r=1}=t,i=n.length,o=r*i;let a=0;for(let c=s;a<i;a++)e[c++]=n[a];for(;a<o;)a<o-a?(e.copyWithin(s+a,s,s+a),a*=2):(e.copyWithin(s+a,s,s+o-a),a=o);return t.target}const h0=1024;class B2{constructor(e){p(this,"layout",{});p(this,"byteLength");let n=0;for(const[r,i]of Object.entries(e)){const o=I2(i),{type:a,components:c}=o;n=P2(n,c);const l=n;n+=c,this.layout[r]={type:a,size:c,offset:l}}n+=(4-n%4)%4;const s=n*4;this.byteLength=Math.max(s,h0)}getData(e){const n=Math.max(this.byteLength,h0),s=Iv(n),r={i32:new Int32Array(s),u32:new Uint32Array(s),f32:new Float32Array(s),f16:new Uint16Array(s)};for(const[i,o]of Object.entries(e)){const a=this.layout[i];if(!a){U.warn(`Supplied uniform value ${i} not present in uniform block layout`)();continue}const{type:c,size:l,offset:u}=a,h=r[c];if(l===1){if(typeof o!="number"&&typeof o!="boolean"){U.warn(`Supplied value for single component uniform ${i} is not a number: ${o}`)();continue}h[u]=Number(o)}else{const f=Oa(o);if(!f){U.warn(`Supplied value for multi component / array uniform ${i} is not a numeric array: ${o}`)();continue}h.set(f,u)}}return new Uint8Array(s)}has(e){return!!this.layout[e]}get(e){return this.layout[e]}}function O2(t,e,n=16){if(t!==e)return!1;const s=Oa(t);if(!s)return!1;const r=Oa(e);if(r&&s.length===r.length){for(let i=0;i<s.length;++i)if(r[i]!==s[i])return!1}return!0}function N2(t){const e=Oa(t);return e?e.slice():t}class F2{constructor(e){p(this,"name");p(this,"uniforms",{});p(this,"modifiedUniforms",{});p(this,"modified",!0);p(this,"bindingLayout",{});p(this,"needsRedraw","initialized");var n;if(this.name=e==null?void 0:e.name,e!=null&&e.name&&(e!=null&&e.shaderLayout)){const s=(n=e==null?void 0:e.shaderLayout.bindings)==null?void 0:n.find(i=>i.type==="uniform"&&i.name===(e==null?void 0:e.name));if(!s)throw new Error(e==null?void 0:e.name);const r=s;for(const i of r.uniforms||[])this.bindingLayout[i.name]=i}}setUniforms(e){for(const[n,s]of Object.entries(e))this._setUniform(n,s),this.needsRedraw||this.setNeedsRedraw(`${this.name}.${n}=${s}`)}setNeedsRedraw(e){this.needsRedraw=this.needsRedraw||e}getAllUniforms(){return this.modifiedUniforms={},this.needsRedraw=!1,this.uniforms||{}}_setUniform(e,n){O2(this.uniforms[e],n)||(this.uniforms[e]=N2(n),this.modifiedUniforms[e]=!0,this.modified=!0)}}class D2{constructor(e){p(this,"uniformBlocks",new Map);p(this,"uniformBufferLayouts",new Map);p(this,"uniformBuffers",new Map);for(const[n,s]of Object.entries(e)){const r=n,i=new B2(s.uniformTypes||{});this.uniformBufferLayouts.set(r,i);const o=new F2({name:n});o.setUniforms(s.defaultUniforms||{}),this.uniformBlocks.set(r,o)}}destroy(){for(const e of this.uniformBuffers.values())e.destroy()}setUniforms(e){for(const[n,s]of Object.entries(e))this.uniformBlocks.get(n).setUniforms(s);this.updateUniformBuffers()}getUniformBufferByteLength(e){return this.uniformBufferLayouts.get(e).byteLength}getUniformBufferData(e){const n=this.uniformBlocks.get(e).getAllUniforms();return this.uniformBufferLayouts.get(e).getData(n)}createUniformBuffer(e,n,s){s&&this.setUniforms(s);const r=this.getUniformBufferByteLength(n),i=e.createBuffer({usage:Ae.UNIFORM|Ae.COPY_DST,byteLength:r}),o=this.getUniformBufferData(n);return i.write(o),i}getManagedUniformBuffer(e,n){if(!this.uniformBuffers.get(n)){const s=this.getUniformBufferByteLength(n),r=e.createBuffer({usage:Ae.UNIFORM|Ae.COPY_DST,byteLength:s});this.uniformBuffers.set(n,r)}return this.uniformBuffers.get(n)}updateUniformBuffers(){let e=!1;for(const n of this.uniformBlocks.keys()){const s=this.updateUniformBuffer(n);e||(e=s)}return e&&U.log(3,`UniformStore.updateUniformBuffers(): ${e}`)(),e}updateUniformBuffer(e){const n=this.uniformBlocks.get(e),s=this.uniformBuffers.get(e);let r=!1;if(s&&n.needsRedraw){r||(r=n.needsRedraw);const i=this.getUniformBufferData(e);this.uniformBuffers.get(e).write(i);const a=this.uniformBlocks.get(e).getAllUniforms();U.log(4,`Writing to uniform buffer ${String(e)}`,i,a)()}return r}}function Pv(t){const e=ArrayBuffer.isView(t)?t.constructor:t;switch(e){case Float32Array:return"float32";case Uint16Array:return"uint16";case Uint32Array:return"uint32";case Uint8Array:case Uint8ClampedArray:return"uint8";case Int8Array:return"sint8";case Int16Array:return"sint16";case Int32Array:return"sint32";default:throw new Error(e.constructor.name)}}function xv(t){switch(t){case"float32":return Float32Array;case"uint32":return Uint32Array;case"sint32":return Int32Array;case"uint16":case"unorm16":return Uint16Array;case"sint16":case"snorm16":return Int16Array;case"uint8":case"unorm8":return Uint8Array;case"sint8":case"snorm8":return Int8Array;default:throw new Error(t)}}function L2(t,e,n){if(!e||e>4)throw new Error(`size ${e}`);const s=e;let r=Pv(t);if(r==="uint8"||r==="sint8"){if(s===1||s===3)throw new Error(`size: ${e}`);return n&&(r=r.replace("int","norm")),`${r}x${s}`}if(r==="uint16"||r==="sint16"){if(s===1||s===3)throw new Error(`size: ${e}`);return n&&(r=r.replace("int","norm")),`${r}x${s}`}return s===1?r:`${r}x${s}`}function U2(t){return Oa(t)!==null||typeof t=="number"||typeof t=="boolean"}function Mv(t){const e={bindings:{},uniforms:{}};return Object.keys(t).forEach(n=>{const s=t[n];U2(s)?e.uniforms[n]=s:e.bindings[n]=s}),e}function k2(t,e,n){const{removedProps:s={},deprecatedProps:r={},replacedProps:i={}}=n;for(const a in s)if(a in e){const l=s[a]?`${t}.${s[a]}`:"N/A";U.removed(`${t}.${a}`,l)()}for(const a in r)if(a in e){const c=r[a];U.deprecated(`${t}.${a}`,`${t}.${c}`)()}let o=null;for(const[a,c]of Object.entries(i))a in e&&(U.deprecated(`${t}.${a}`,`${t}.${c}`)(),o=o||Object.assign({},e),o[c]=e[a],delete o[a]);return o||e}let z2="";async function V2(t,e){return await new Promise((n,s)=>{try{const r=new Image;r.onload=()=>n(r),r.onerror=()=>s(new Error(`Could not load image ${t}.`)),r.crossOrigin=(e==null?void 0:e.crossOrigin)||"anonymous",r.src=t.startsWith("http")?t:z2+t}catch(r){s(r)}})}async function Bv(t,e){const n=document.getElementsByTagName("head")[0];if(!n)throw new Error("loadScript");const s=document.createElement("script");return s.setAttribute("type","text/javascript"),s.setAttribute("src",t),e&&(s.id=e),new Promise((r,i)=>{s.onload=r,s.onerror=o=>i(new Error(`Unable to load script '${t}': ${o}`)),n.appendChild(s)})}function Zp(t,e,n){if(t===e)return!0;if(!n||!t||!e)return!1;if(Array.isArray(t)){if(!Array.isArray(e)||t.length!==e.length)return!1;for(let s=0;s<t.length;s++)if(!Zp(t[s],e[s],n-1))return!1;return!0}if(Array.isArray(e))return!1;if(typeof t=="object"&&typeof e=="object"){const s=Object.keys(t),r=Object.keys(e);if(s.length!==r.length)return!1;for(const i of s)if(!e.hasOwnProperty(i)||!Zp(t[i],e[i],n-1))return!1;return!0}return!1}function H2(t){return typeof window<"u"&&window.requestAnimationFrame?window.requestAnimationFrame(t):setTimeout(t,1e3/60)}function j2(t){return typeof window<"u"&&window.cancelAnimationFrame?window.cancelAnimationFrame(t):clearTimeout(t)}class W2{constructor(){this.constants=new Map,this.aliases=new Map,this.structs=new Map}}let kr=class{constructor(){}get isAstNode(){return!0}get astNodeType(){return""}evaluate(e){throw new Error("Cannot evaluate node")}evaluateString(e){return this.evaluate(e).toString()}};class Pe extends kr{constructor(){super()}}class Ov extends Pe{constructor(e,n,s,r){super(),this.name=e,this.args=n,this.returnType=s,this.body=r}get astNodeType(){return"function"}}class G2 extends Pe{constructor(e){super(),this.expression=e}get astNodeType(){return"staticAssert"}}class X2 extends Pe{constructor(e,n){super(),this.condition=e,this.body=n}get astNodeType(){return"while"}}class $2 extends Pe{constructor(e){super(),this.body=e}get astNodeType(){return"continuing"}}class K2 extends Pe{constructor(e,n,s,r){super(),this.init=e,this.condition=n,this.increment=s,this.body=r}get astNodeType(){return"for"}}class pi extends Pe{constructor(e,n,s,r,i){super(),this.name=e,this.type=n,this.storage=s,this.access=r,this.value=i}get astNodeType(){return"var"}}class Nv extends Pe{constructor(e,n,s){super(),this.name=e,this.type=n,this.value=s}get astNodeType(){return"override"}}class f0 extends Pe{constructor(e,n,s,r,i){super(),this.name=e,this.type=n,this.storage=s,this.access=r,this.value=i}get astNodeType(){return"let"}}class d0 extends Pe{constructor(e,n,s,r,i){super(),this.name=e,this.type=n,this.storage=s,this.access=r,this.value=i}get astNodeType(){return"const"}evaluate(e){return this.value.evaluate(e)}}var Gi;(function(t){t.increment="++",t.decrement="--"})(Gi||(Gi={}));(function(t){function e(n){const s=n;if(s=="parse")throw new Error("Invalid value for IncrementOperator");return t[s]}t.parse=e})(Gi||(Gi={}));class Y2 extends Pe{constructor(e,n){super(),this.operator=e,this.variable=n}get astNodeType(){return"increment"}}var Na;(function(t){t.assign="=",t.addAssign="+=",t.subtractAssin="-=",t.multiplyAssign="*=",t.divideAssign="/=",t.moduloAssign="%=",t.andAssign="&=",t.orAssign="|=",t.xorAssign="^=",t.shiftLeftAssign="<<=",t.shiftRightAssign=">>="})(Na||(Na={}));(function(t){function e(n){const s=n;if(s=="parse")throw new Error("Invalid value for AssignOperator");return t[s]}t.parse=e})(Na||(Na={}));class J2 extends Pe{constructor(e,n,s){super(),this.operator=e,this.variable=n,this.value=s}get astNodeType(){return"assign"}}class q2 extends Pe{constructor(e,n){super(),this.name=e,this.args=n}get astNodeType(){return"call"}}class Z2 extends Pe{constructor(e,n){super(),this.body=e,this.continuing=n}get astNodeType(){return"loop"}}class Q2 extends Pe{constructor(e,n){super(),this.condition=e,this.body=n}get astNodeType(){return"body"}}class eO extends Pe{constructor(e,n,s,r){super(),this.condition=e,this.body=n,this.elseif=s,this.else=r}get astNodeType(){return"if"}}class tO extends Pe{constructor(e){super(),this.value=e}get astNodeType(){return"return"}}class nO extends Pe{constructor(e){super(),this.name=e}get astNodeType(){return"enable"}}class Fv extends Pe{constructor(e,n){super(),this.name=e,this.type=n}get astNodeType(){return"alias"}}class sO extends Pe{constructor(){super()}get astNodeType(){return"discard"}}class rO extends Pe{constructor(){super()}get astNodeType(){return"break"}}class iO extends Pe{constructor(){super()}get astNodeType(){return"continue"}}class zr extends Pe{constructor(e){super(),this.name=e}get astNodeType(){return"type"}get isStruct(){return!1}get isArray(){return!1}}class lr extends zr{constructor(e,n){super(e),this.members=n}get astNodeType(){return"struct"}get isStruct(){return!0}getMemberIndex(e){for(let n=0;n<this.members.length;n++)if(this.members[n].name==e)return n;return-1}}class Dv extends zr{constructor(e,n,s){super(e),this.format=n,this.access=s}get astNodeType(){return"template"}}class oO extends zr{constructor(e,n,s,r){super(e),this.storage=n,this.type=s,this.access=r}get astNodeType(){return"pointer"}}class Lv extends zr{constructor(e,n,s,r){super(e),this.attributes=n,this.format=s,this.count=r}get astNodeType(){return"array"}get isArray(){return!0}}class Ho extends zr{constructor(e,n,s){super(e),this.format=n,this.access=s}get astNodeType(){return"sampler"}}class Un extends kr{constructor(){super()}}class p0 extends Un{constructor(e){super(),this.value=e}get astNodeType(){return"stringExpr"}toString(){return this.value}evaluateString(){return this.value}}class jo extends Un{constructor(e,n){super(),this.type=e,this.args=n}get astNodeType(){return"createExpr"}}class aO extends Un{constructor(e,n){super(),this.name=e,this.args=n}get astNodeType(){return"callExpr"}evaluate(e){switch(this.name){case"abs":return Math.abs(this.args[0].evaluate(e));case"acos":return Math.acos(this.args[0].evaluate(e));case"acosh":return Math.acosh(this.args[0].evaluate(e));case"asin":return Math.asin(this.args[0].evaluate(e));case"asinh":return Math.asinh(this.args[0].evaluate(e));case"atan":return Math.atan(this.args[0].evaluate(e));case"atan2":return Math.atan2(this.args[0].evaluate(e),this.args[1].evaluate(e));case"atanh":return Math.atanh(this.args[0].evaluate(e));case"ceil":return Math.ceil(this.args[0].evaluate(e));case"clamp":return Math.min(Math.max(this.args[0].evaluate(e),this.args[1].evaluate(e)),this.args[2].evaluate(e));case"cos":return Math.cos(this.args[0].evaluate(e));case"degrees":return this.args[0].evaluate(e)*180/Math.PI;case"distance":return Math.sqrt(Math.pow(this.args[0].evaluate(e)-this.args[1].evaluate(e),2));case"dot":case"exp":return Math.exp(this.args[0].evaluate(e));case"exp2":return Math.pow(2,this.args[0].evaluate(e));case"floor":return Math.floor(this.args[0].evaluate(e));case"fma":return this.args[0].evaluate(e)*this.args[1].evaluate(e)+this.args[2].evaluate(e);case"fract":return this.args[0].evaluate(e)-Math.floor(this.args[0].evaluate(e));case"inverseSqrt":return 1/Math.sqrt(this.args[0].evaluate(e));case"log":return Math.log(this.args[0].evaluate(e));case"log2":return Math.log2(this.args[0].evaluate(e));case"max":return Math.max(this.args[0].evaluate(e),this.args[1].evaluate(e));case"min":return Math.min(this.args[0].evaluate(e),this.args[1].evaluate(e));case"mix":return this.args[0].evaluate(e)*(1-this.args[2].evaluate(e))+this.args[1].evaluate(e)*this.args[2].evaluate(e);case"modf":return this.args[0].evaluate(e)-Math.floor(this.args[0].evaluate(e));case"pow":return Math.pow(this.args[0].evaluate(e),this.args[1].evaluate(e));case"radians":return this.args[0].evaluate(e)*Math.PI/180;case"round":return Math.round(this.args[0].evaluate(e));case"sign":return Math.sign(this.args[0].evaluate(e));case"sin":return Math.sin(this.args[0].evaluate(e));case"sinh":return Math.sinh(this.args[0].evaluate(e));case"saturate":return Math.min(Math.max(this.args[0].evaluate(e),0),1);case"smoothstep":return this.args[0].evaluate(e)*this.args[0].evaluate(e)*(3-2*this.args[0].evaluate(e));case"sqrt":return Math.sqrt(this.args[0].evaluate(e));case"step":return this.args[0].evaluate(e)<this.args[1].evaluate(e)?0:1;case"tan":return Math.tan(this.args[0].evaluate(e));case"tanh":return Math.tanh(this.args[0].evaluate(e));case"trunc":return Math.trunc(this.args[0].evaluate(e));default:throw new Error("Non const function: "+this.name)}}}class cO extends Un{constructor(e){super(),this.name=e}get astNodeType(){return"varExpr"}}class g0 extends Un{constructor(e,n){super(),this.name=e,this.initializer=n}get astNodeType(){return"constExpr"}evaluate(e){var n,s;if(this.initializer instanceof jo){const r=(n=this.postfix)===null||n===void 0?void 0:n.evaluateString(e),i=(s=this.initializer.type)===null||s===void 0?void 0:s.name,o=e.structs.get(i),a=o==null?void 0:o.getMemberIndex(r);if(a!=-1)return this.initializer.args[a].evaluate(e);console.log(a)}return this.initializer.evaluate(e)}}class _0 extends Un{constructor(e){super(),this.value=e}get astNodeType(){return"literalExpr"}evaluate(){return this.value}}class lO extends Un{constructor(e,n){super(),this.type=e,this.value=n}get astNodeType(){return"bitcastExpr"}}class uO extends Un{constructor(e,n){super(),this.type=e,this.args=n}get astNodeType(){return"typecastExpr"}evaluate(e){return this.args[0].evaluate(e)}}class m0 extends Un{constructor(e){super(),this.contents=e}get astNodeType(){return"groupExpr"}evaluate(e){return this.contents[0].evaluate(e)}}class Uv extends Un{constructor(){super()}}class hO extends Uv{constructor(e,n){super(),this.operator=e,this.right=n}get astNodeType(){return"unaryOp"}evaluate(e){switch(this.operator){case"+":return this.right.evaluate(e);case"-":return-this.right.evaluate(e);case"!":return this.right.evaluate(e)?0:1;case"~":return~this.right.evaluate(e);default:throw new Error("Unknown unary operator: "+this.operator)}}}class vn extends Uv{constructor(e,n,s){super(),this.operator=e,this.left=n,this.right=s}get astNodeType(){return"binaryOp"}evaluate(e){switch(this.operator){case"+":return this.left.evaluate(e)+this.right.evaluate(e);case"-":return this.left.evaluate(e)-this.right.evaluate(e);case"*":return this.left.evaluate(e)*this.right.evaluate(e);case"/":return this.left.evaluate(e)/this.right.evaluate(e);case"%":return this.left.evaluate(e)%this.right.evaluate(e);case"==":return this.left.evaluate(e)==this.right.evaluate(e)?1:0;case"!=":return this.left.evaluate(e)!=this.right.evaluate(e)?1:0;case"<":return this.left.evaluate(e)<this.right.evaluate(e)?1:0;case">":return this.left.evaluate(e)>this.right.evaluate(e)?1:0;case"<=":return this.left.evaluate(e)<=this.right.evaluate(e)?1:0;case">=":return this.left.evaluate(e)>=this.right.evaluate(e)?1:0;case"&&":return this.left.evaluate(e)&&this.right.evaluate(e)?1:0;case"||":return this.left.evaluate(e)||this.right.evaluate(e)?1:0;default:throw new Error(`Unknown operator ${this.operator}`)}}}class kv extends kr{constructor(){super()}}class fO extends kv{constructor(e,n){super(),this.selector=e,this.body=n}get astNodeType(){return"case"}}class dO extends kv{constructor(e){super(),this.body=e}get astNodeType(){return"default"}}class pO extends kr{constructor(e,n,s){super(),this.name=e,this.type=n,this.attributes=s}get astNodeType(){return"argument"}}class gO extends kr{constructor(e,n){super(),this.condition=e,this.body=n}get astNodeType(){return"elseif"}}class _O extends kr{constructor(e,n,s){super(),this.name=e,this.type=n,this.attributes=s}get astNodeType(){return"member"}}let y0=class extends kr{constructor(e,n){super(),this.name=e,this.value=n}get astNodeType(){return"attribute"}};var D,R;(function(t){t[t.token=0]="token",t[t.keyword=1]="keyword",t[t.reserved=2]="reserved"})(R||(R={}));class I{constructor(e,n,s){this.name=e,this.type=n,this.rule=s}toString(){return this.name}}class v{}D=v;v.none=new I("",R.reserved,"");v.eof=new I("EOF",R.token,"");v.reserved={asm:new I("asm",R.reserved,"asm"),bf16:new I("bf16",R.reserved,"bf16"),do:new I("do",R.reserved,"do"),enum:new I("enum",R.reserved,"enum"),f16:new I("f16",R.reserved,"f16"),f64:new I("f64",R.reserved,"f64"),handle:new I("handle",R.reserved,"handle"),i8:new I("i8",R.reserved,"i8"),i16:new I("i16",R.reserved,"i16"),i64:new I("i64",R.reserved,"i64"),mat:new I("mat",R.reserved,"mat"),premerge:new I("premerge",R.reserved,"premerge"),regardless:new I("regardless",R.reserved,"regardless"),typedef:new I("typedef",R.reserved,"typedef"),u8:new I("u8",R.reserved,"u8"),u16:new I("u16",R.reserved,"u16"),u64:new I("u64",R.reserved,"u64"),unless:new I("unless",R.reserved,"unless"),using:new I("using",R.reserved,"using"),vec:new I("vec",R.reserved,"vec"),void:new I("void",R.reserved,"void")};v.keywords={array:new I("array",R.keyword,"array"),atomic:new I("atomic",R.keyword,"atomic"),bool:new I("bool",R.keyword,"bool"),f32:new I("f32",R.keyword,"f32"),i32:new I("i32",R.keyword,"i32"),mat2x2:new I("mat2x2",R.keyword,"mat2x2"),mat2x3:new I("mat2x3",R.keyword,"mat2x3"),mat2x4:new I("mat2x4",R.keyword,"mat2x4"),mat3x2:new I("mat3x2",R.keyword,"mat3x2"),mat3x3:new I("mat3x3",R.keyword,"mat3x3"),mat3x4:new I("mat3x4",R.keyword,"mat3x4"),mat4x2:new I("mat4x2",R.keyword,"mat4x2"),mat4x3:new I("mat4x3",R.keyword,"mat4x3"),mat4x4:new I("mat4x4",R.keyword,"mat4x4"),ptr:new I("ptr",R.keyword,"ptr"),sampler:new I("sampler",R.keyword,"sampler"),sampler_comparison:new I("sampler_comparison",R.keyword,"sampler_comparison"),struct:new I("struct",R.keyword,"struct"),texture_1d:new I("texture_1d",R.keyword,"texture_1d"),texture_2d:new I("texture_2d",R.keyword,"texture_2d"),texture_2d_array:new I("texture_2d_array",R.keyword,"texture_2d_array"),texture_3d:new I("texture_3d",R.keyword,"texture_3d"),texture_cube:new I("texture_cube",R.keyword,"texture_cube"),texture_cube_array:new I("texture_cube_array",R.keyword,"texture_cube_array"),texture_multisampled_2d:new I("texture_multisampled_2d",R.keyword,"texture_multisampled_2d"),texture_storage_1d:new I("texture_storage_1d",R.keyword,"texture_storage_1d"),texture_storage_2d:new I("texture_storage_2d",R.keyword,"texture_storage_2d"),texture_storage_2d_array:new I("texture_storage_2d_array",R.keyword,"texture_storage_2d_array"),texture_storage_3d:new I("texture_storage_3d",R.keyword,"texture_storage_3d"),texture_depth_2d:new I("texture_depth_2d",R.keyword,"texture_depth_2d"),texture_depth_2d_array:new I("texture_depth_2d_array",R.keyword,"texture_depth_2d_array"),texture_depth_cube:new I("texture_depth_cube",R.keyword,"texture_depth_cube"),texture_depth_cube_array:new I("texture_depth_cube_array",R.keyword,"texture_depth_cube_array"),texture_depth_multisampled_2d:new I("texture_depth_multisampled_2d",R.keyword,"texture_depth_multisampled_2d"),texture_external:new I("texture_external",R.keyword,"texture_external"),u32:new I("u32",R.keyword,"u32"),vec2:new I("vec2",R.keyword,"vec2"),vec3:new I("vec3",R.keyword,"vec3"),vec4:new I("vec4",R.keyword,"vec4"),bitcast:new I("bitcast",R.keyword,"bitcast"),block:new I("block",R.keyword,"block"),break:new I("break",R.keyword,"break"),case:new I("case",R.keyword,"case"),continue:new I("continue",R.keyword,"continue"),continuing:new I("continuing",R.keyword,"continuing"),default:new I("default",R.keyword,"default"),discard:new I("discard",R.keyword,"discard"),else:new I("else",R.keyword,"else"),enable:new I("enable",R.keyword,"enable"),fallthrough:new I("fallthrough",R.keyword,"fallthrough"),false:new I("false",R.keyword,"false"),fn:new I("fn",R.keyword,"fn"),for:new I("for",R.keyword,"for"),function:new I("function",R.keyword,"function"),if:new I("if",R.keyword,"if"),let:new I("let",R.keyword,"let"),const:new I("const",R.keyword,"const"),loop:new I("loop",R.keyword,"loop"),while:new I("while",R.keyword,"while"),private:new I("private",R.keyword,"private"),read:new I("read",R.keyword,"read"),read_write:new I("read_write",R.keyword,"read_write"),return:new I("return",R.keyword,"return"),storage:new I("storage",R.keyword,"storage"),switch:new I("switch",R.keyword,"switch"),true:new I("true",R.keyword,"true"),alias:new I("alias",R.keyword,"alias"),type:new I("type",R.keyword,"type"),uniform:new I("uniform",R.keyword,"uniform"),var:new I("var",R.keyword,"var"),override:new I("override",R.keyword,"override"),workgroup:new I("workgroup",R.keyword,"workgroup"),write:new I("write",R.keyword,"write"),r8unorm:new I("r8unorm",R.keyword,"r8unorm"),r8snorm:new I("r8snorm",R.keyword,"r8snorm"),r8uint:new I("r8uint",R.keyword,"r8uint"),r8sint:new I("r8sint",R.keyword,"r8sint"),r16uint:new I("r16uint",R.keyword,"r16uint"),r16sint:new I("r16sint",R.keyword,"r16sint"),r16float:new I("r16float",R.keyword,"r16float"),rg8unorm:new I("rg8unorm",R.keyword,"rg8unorm"),rg8snorm:new I("rg8snorm",R.keyword,"rg8snorm"),rg8uint:new I("rg8uint",R.keyword,"rg8uint"),rg8sint:new I("rg8sint",R.keyword,"rg8sint"),r32uint:new I("r32uint",R.keyword,"r32uint"),r32sint:new I("r32sint",R.keyword,"r32sint"),r32float:new I("r32float",R.keyword,"r32float"),rg16uint:new I("rg16uint",R.keyword,"rg16uint"),rg16sint:new I("rg16sint",R.keyword,"rg16sint"),rg16float:new I("rg16float",R.keyword,"rg16float"),rgba8unorm:new I("rgba8unorm",R.keyword,"rgba8unorm"),rgba8unorm_srgb:new I("rgba8unorm_srgb",R.keyword,"rgba8unorm_srgb"),rgba8snorm:new I("rgba8snorm",R.keyword,"rgba8snorm"),rgba8uint:new I("rgba8uint",R.keyword,"rgba8uint"),rgba8sint:new I("rgba8sint",R.keyword,"rgba8sint"),bgra8unorm:new I("bgra8unorm",R.keyword,"bgra8unorm"),bgra8unorm_srgb:new I("bgra8unorm_srgb",R.keyword,"bgra8unorm_srgb"),rgb10a2unorm:new I("rgb10a2unorm",R.keyword,"rgb10a2unorm"),rg11b10float:new I("rg11b10float",R.keyword,"rg11b10float"),rg32uint:new I("rg32uint",R.keyword,"rg32uint"),rg32sint:new I("rg32sint",R.keyword,"rg32sint"),rg32float:new I("rg32float",R.keyword,"rg32float"),rgba16uint:new I("rgba16uint",R.keyword,"rgba16uint"),rgba16sint:new I("rgba16sint",R.keyword,"rgba16sint"),rgba16float:new I("rgba16float",R.keyword,"rgba16float"),rgba32uint:new I("rgba32uint",R.keyword,"rgba32uint"),rgba32sint:new I("rgba32sint",R.keyword,"rgba32sint"),rgba32float:new I("rgba32float",R.keyword,"rgba32float"),static_assert:new I("static_assert",R.keyword,"static_assert")};v.tokens={decimal_float_literal:new I("decimal_float_literal",R.token,/((-?[0-9]*\.[0-9]+|-?[0-9]+\.[0-9]*)((e|E)(\+|-)?[0-9]+)?f?)|(-?[0-9]+(e|E)(\+|-)?[0-9]+f?)|([0-9]+f)/),hex_float_literal:new I("hex_float_literal",R.token,/-?0x((([0-9a-fA-F]*\.[0-9a-fA-F]+|[0-9a-fA-F]+\.[0-9a-fA-F]*)((p|P)(\+|-)?[0-9]+f?)?)|([0-9a-fA-F]+(p|P)(\+|-)?[0-9]+f?))/),int_literal:new I("int_literal",R.token,/-?0x[0-9a-fA-F]+|0i?|-?[1-9][0-9]*i?/),uint_literal:new I("uint_literal",R.token,/0x[0-9a-fA-F]+u|0u|[1-9][0-9]*u/),ident:new I("ident",R.token,/[a-zA-Z][0-9a-zA-Z_]*/),and:new I("and",R.token,"&"),and_and:new I("and_and",R.token,"&&"),arrow:new I("arrow ",R.token,"->"),attr:new I("attr",R.token,"@"),attr_left:new I("attr_left",R.token,"[["),attr_right:new I("attr_right",R.token,"]]"),forward_slash:new I("forward_slash",R.token,"/"),bang:new I("bang",R.token,"!"),bracket_left:new I("bracket_left",R.token,"["),bracket_right:new I("bracket_right",R.token,"]"),brace_left:new I("brace_left",R.token,"{"),brace_right:new I("brace_right",R.token,"}"),colon:new I("colon",R.token,":"),comma:new I("comma",R.token,","),equal:new I("equal",R.token,"="),equal_equal:new I("equal_equal",R.token,"=="),not_equal:new I("not_equal",R.token,"!="),greater_than:new I("greater_than",R.token,">"),greater_than_equal:new I("greater_than_equal",R.token,">="),shift_right:new I("shift_right",R.token,">>"),less_than:new I("less_than",R.token,"<"),less_than_equal:new I("less_than_equal",R.token,"<="),shift_left:new I("shift_left",R.token,"<<"),modulo:new I("modulo",R.token,"%"),minus:new I("minus",R.token,"-"),minus_minus:new I("minus_minus",R.token,"--"),period:new I("period",R.token,"."),plus:new I("plus",R.token,"+"),plus_plus:new I("plus_plus",R.token,"++"),or:new I("or",R.token,"|"),or_or:new I("or_or",R.token,"||"),paren_left:new I("paren_left",R.token,"("),paren_right:new I("paren_right",R.token,")"),semicolon:new I("semicolon",R.token,";"),star:new I("star",R.token,"*"),tilde:new I("tilde",R.token,"~"),underscore:new I("underscore",R.token,"_"),xor:new I("xor",R.token,"^"),plus_equal:new I("plus_equal",R.token,"+="),minus_equal:new I("minus_equal",R.token,"-="),times_equal:new I("times_equal",R.token,"*="),division_equal:new I("division_equal",R.token,"/="),modulo_equal:new I("modulo_equal",R.token,"%="),and_equal:new I("and_equal",R.token,"&="),or_equal:new I("or_equal",R.token,"|="),xor_equal:new I("xor_equal",R.token,"^="),shift_right_equal:new I("shift_right_equal",R.token,">>="),shift_left_equal:new I("shift_left_equal",R.token,"<<=")};v.storage_class=[D.keywords.function,D.keywords.private,D.keywords.workgroup,D.keywords.uniform,D.keywords.storage];v.access_mode=[D.keywords.read,D.keywords.write,D.keywords.read_write];v.sampler_type=[D.keywords.sampler,D.keywords.sampler_comparison];v.sampled_texture_type=[D.keywords.texture_1d,D.keywords.texture_2d,D.keywords.texture_2d_array,D.keywords.texture_3d,D.keywords.texture_cube,D.keywords.texture_cube_array];v.multisampled_texture_type=[D.keywords.texture_multisampled_2d];v.storage_texture_type=[D.keywords.texture_storage_1d,D.keywords.texture_storage_2d,D.keywords.texture_storage_2d_array,D.keywords.texture_storage_3d];v.depth_texture_type=[D.keywords.texture_depth_2d,D.keywords.texture_depth_2d_array,D.keywords.texture_depth_cube,D.keywords.texture_depth_cube_array,D.keywords.texture_depth_multisampled_2d];v.texture_external_type=[D.keywords.texture_external];v.any_texture_type=[...D.sampled_texture_type,...D.multisampled_texture_type,...D.storage_texture_type,...D.depth_texture_type,...D.texture_external_type];v.texel_format=[D.keywords.r8unorm,D.keywords.r8snorm,D.keywords.r8uint,D.keywords.r8sint,D.keywords.r16uint,D.keywords.r16sint,D.keywords.r16float,D.keywords.rg8unorm,D.keywords.rg8snorm,D.keywords.rg8uint,D.keywords.rg8sint,D.keywords.r32uint,D.keywords.r32sint,D.keywords.r32float,D.keywords.rg16uint,D.keywords.rg16sint,D.keywords.rg16float,D.keywords.rgba8unorm,D.keywords.rgba8unorm_srgb,D.keywords.rgba8snorm,D.keywords.rgba8uint,D.keywords.rgba8sint,D.keywords.bgra8unorm,D.keywords.bgra8unorm_srgb,D.keywords.rgb10a2unorm,D.keywords.rg11b10float,D.keywords.rg32uint,D.keywords.rg32sint,D.keywords.rg32float,D.keywords.rgba16uint,D.keywords.rgba16sint,D.keywords.rgba16float,D.keywords.rgba32uint,D.keywords.rgba32sint,D.keywords.rgba32float];v.const_literal=[D.tokens.int_literal,D.tokens.uint_literal,D.tokens.decimal_float_literal,D.tokens.hex_float_literal,D.keywords.true,D.keywords.false];v.literal_or_ident=[D.tokens.ident,D.tokens.int_literal,D.tokens.uint_literal,D.tokens.decimal_float_literal,D.tokens.hex_float_literal];v.element_count_expression=[D.tokens.int_literal,D.tokens.uint_literal,D.tokens.ident];v.template_types=[D.keywords.vec2,D.keywords.vec3,D.keywords.vec4,D.keywords.mat2x2,D.keywords.mat2x3,D.keywords.mat2x4,D.keywords.mat3x2,D.keywords.mat3x3,D.keywords.mat3x4,D.keywords.mat4x2,D.keywords.mat4x3,D.keywords.mat4x4,D.keywords.atomic,D.keywords.bitcast,...D.any_texture_type];v.attribute_name=[D.tokens.ident,D.keywords.block];v.assignment_operators=[D.tokens.equal,D.tokens.plus_equal,D.tokens.minus_equal,D.tokens.times_equal,D.tokens.division_equal,D.tokens.modulo_equal,D.tokens.and_equal,D.tokens.or_equal,D.tokens.xor_equal,D.tokens.shift_right_equal,D.tokens.shift_left_equal];v.increment_operators=[D.tokens.plus_plus,D.tokens.minus_minus];class A0{constructor(e,n,s){this.type=e,this.lexeme=n,this.line=s}toString(){return this.lexeme}isTemplateType(){return v.template_types.indexOf(this.type)!=-1}isArrayType(){return this.type==v.keywords.array}isArrayOrTemplateType(){return this.isArrayType()||this.isTemplateType()}}class mO{constructor(e){this._tokens=[],this._start=0,this._current=0,this._line=1,this._source=e??""}scanTokens(){for(;!this._isAtEnd();)if(this._start=this._current,!this.scanToken())throw`Invalid syntax at line ${this._line}`;return this._tokens.push(new A0(v.eof,"",this._line)),this._tokens}scanToken(){let e=this._advance();if(e==`
`)return this._line++,!0;if(this._isWhitespace(e))return!0;if(e=="/"){if(this._peekAhead()=="/"){for(;e!=`
`;){if(this._isAtEnd())return!0;e=this._advance()}return this._line++,!0}else if(this._peekAhead()=="*"){this._advance();let s=1;for(;s>0;){if(this._isAtEnd())return!0;if(e=this._advance(),e==`
`)this._line++;else if(e=="*"){if(this._peekAhead()=="/"&&(this._advance(),s--,s==0))return!0}else e=="/"&&this._peekAhead()=="*"&&(this._advance(),s++)}return!0}}let n=v.none;for(;;){let s=this._findType(e);const r=this._peekAhead();if(e==">"&&(r==">"||r=="=")){let i=!1,o=this._tokens.length-1;for(let a=0;a<5&&o>=0;++a,--o)if(this._tokens[o].type===v.tokens.less_than){o>0&&this._tokens[o-1].isArrayOrTemplateType()&&(i=!0);break}if(i)return this._addToken(s),!0}if(s===v.none){let i=e,o=0;const a=2;for(let c=0;c<a;++c)if(i+=this._peekAhead(c),s=this._findType(i),s!==v.none){o=c;break}if(s===v.none)return n===v.none?!1:(this._current--,this._addToken(n),!0);e=i,this._current+=o+1}if(n=s,this._isAtEnd())break;e+=this._advance()}return n===v.none?!1:(this._addToken(n),!0)}_findType(e){for(const n in v.keywords){const s=v.keywords[n];if(this._match(e,s.rule))return s}for(const n in v.tokens){const s=v.tokens[n];if(this._match(e,s.rule))return s}return v.none}_match(e,n){if(typeof n=="string"){if(n==e)return!0}else{const s=n.exec(e);if(s&&s.index==0&&s[0]==e)return!0}return!1}_isAtEnd(){return this._current>=this._source.length}_isWhitespace(e){return e==" "||e=="	"||e=="\r"}_advance(e=0){let n=this._source[this._current];return e=e||0,e++,this._current+=e,n}_peekAhead(e=0){return e=e||0,this._current+e>=this._source.length?"\0":this._source[this._current+e]}_addToken(e){const n=this._source.substring(this._start,this._current);this._tokens.push(new A0(e,n,this._line))}}class yO{constructor(){this._tokens=[],this._current=0,this._context=new W2}parse(e){this._initialize(e);let n=[];for(;!this._isAtEnd();){const s=this._global_decl_or_directive();if(!s)break;n.push(s)}return n}_initialize(e){if(e)if(typeof e=="string"){const n=new mO(e);this._tokens=n.scanTokens()}else this._tokens=e;else this._tokens=[];this._current=0}_error(e,n){return console.error(e,n),{token:e,message:n,toString:function(){return`${n}`}}}_isAtEnd(){return this._current>=this._tokens.length||this._peek().type==v.eof}_match(e){if(e instanceof I)return this._check(e)?(this._advance(),!0):!1;for(let n=0,s=e.length;n<s;++n){const r=e[n];if(this._check(r))return this._advance(),!0}return!1}_consume(e,n){if(this._check(e))return this._advance();throw this._error(this._peek(),n)}_check(e){if(this._isAtEnd())return!1;const n=this._peek();if(e instanceof Array){let s=n.type;return e.indexOf(s)!=-1}return n.type==e}_advance(){return this._isAtEnd()||this._current++,this._previous()}_peek(){return this._tokens[this._current]}_previous(){return this._tokens[this._current-1]}_global_decl_or_directive(){for(;this._match(v.tokens.semicolon)&&!this._isAtEnd(););if(this._match(v.keywords.alias)){const n=this._type_alias();return this._consume(v.tokens.semicolon,"Expected ';'"),n}if(this._match(v.keywords.enable)){const n=this._enable_directive();return this._consume(v.tokens.semicolon,"Expected ';'"),n}const e=this._attribute();if(this._check(v.keywords.var)){const n=this._global_variable_decl();return n!=null&&(n.attributes=e),this._consume(v.tokens.semicolon,"Expected ';'."),n}if(this._check(v.keywords.override)){const n=this._override_variable_decl();return n!=null&&(n.attributes=e),this._consume(v.tokens.semicolon,"Expected ';'."),n}if(this._check(v.keywords.let)){const n=this._global_let_decl();return n!=null&&(n.attributes=e),this._consume(v.tokens.semicolon,"Expected ';'."),n}if(this._check(v.keywords.const)){const n=this._global_const_decl();return n!=null&&(n.attributes=e),this._consume(v.tokens.semicolon,"Expected ';'."),n}if(this._check(v.keywords.struct)){const n=this._struct_decl();return n!=null&&(n.attributes=e),n}if(this._check(v.keywords.fn)){const n=this._function_decl();return n!=null&&(n.attributes=e),n}return null}_function_decl(){if(!this._match(v.keywords.fn))return null;const e=this._consume(v.tokens.ident,"Expected function name.").toString();this._consume(v.tokens.paren_left,"Expected '(' for function arguments.");const n=[];if(!this._check(v.tokens.paren_right))do{if(this._check(v.tokens.paren_right))break;const i=this._attribute(),o=this._consume(v.tokens.ident,"Expected argument name.").toString();this._consume(v.tokens.colon,"Expected ':' for argument type.");const a=this._attribute(),c=this._type_decl();c!=null&&(c.attributes=a,n.push(new pO(o,c,i)))}while(this._match(v.tokens.comma));this._consume(v.tokens.paren_right,"Expected ')' after function arguments.");let s=null;if(this._match(v.tokens.arrow)){const i=this._attribute();s=this._type_decl(),s!=null&&(s.attributes=i)}const r=this._compound_statement();return new Ov(e,n,s,r)}_compound_statement(){const e=[];for(this._consume(v.tokens.brace_left,"Expected '{' for block.");!this._check(v.tokens.brace_right);){const n=this._statement();n!==null&&e.push(n)}return this._consume(v.tokens.brace_right,"Expected '}' for block."),e}_statement(){for(;this._match(v.tokens.semicolon)&&!this._isAtEnd(););if(this._check(v.keywords.if))return this._if_statement();if(this._check(v.keywords.switch))return this._switch_statement();if(this._check(v.keywords.loop))return this._loop_statement();if(this._check(v.keywords.for))return this._for_statement();if(this._check(v.keywords.while))return this._while_statement();if(this._check(v.keywords.continuing))return this._continuing_statement();if(this._check(v.keywords.static_assert))return this._static_assert_statement();if(this._check(v.tokens.brace_left))return this._compound_statement();let e=null;return this._check(v.keywords.return)?e=this._return_statement():this._check([v.keywords.var,v.keywords.let,v.keywords.const])?e=this._variable_statement():this._match(v.keywords.discard)?e=new sO:this._match(v.keywords.break)?e=new rO:this._match(v.keywords.continue)?e=new iO:e=this._increment_decrement_statement()||this._func_call_statement()||this._assignment_statement(),e!=null&&this._consume(v.tokens.semicolon,"Expected ';' after statement."),e}_static_assert_statement(){if(!this._match(v.keywords.static_assert))return null;let e=this._optional_paren_expression();return new G2(e)}_while_statement(){if(!this._match(v.keywords.while))return null;let e=this._optional_paren_expression();const n=this._compound_statement();return new X2(e,n)}_continuing_statement(){if(!this._match(v.keywords.continuing))return null;const e=this._compound_statement();return new $2(e)}_for_statement(){if(!this._match(v.keywords.for))return null;this._consume(v.tokens.paren_left,"Expected '('.");const e=this._check(v.tokens.semicolon)?null:this._for_init();this._consume(v.tokens.semicolon,"Expected ';'.");const n=this._check(v.tokens.semicolon)?null:this._short_circuit_or_expression();this._consume(v.tokens.semicolon,"Expected ';'.");const s=this._check(v.tokens.paren_right)?null:this._for_increment();this._consume(v.tokens.paren_right,"Expected ')'.");const r=this._compound_statement();return new K2(e,n,s,r)}_for_init(){return this._variable_statement()||this._func_call_statement()||this._assignment_statement()}_for_increment(){return this._func_call_statement()||this._increment_decrement_statement()||this._assignment_statement()}_variable_statement(){if(this._check(v.keywords.var)){const e=this._variable_decl();if(e===null)throw this._error(this._peek(),"Variable declaration expected.");let n=null;return this._match(v.tokens.equal)&&(n=this._short_circuit_or_expression()),new pi(e.name,e.type,e.storage,e.access,n)}if(this._match(v.keywords.let)){const e=this._consume(v.tokens.ident,"Expected name for let.").toString();let n=null;if(this._match(v.tokens.colon)){const r=this._attribute();n=this._type_decl(),n!=null&&(n.attributes=r)}this._consume(v.tokens.equal,"Expected '=' for let.");const s=this._short_circuit_or_expression();return new f0(e,n,null,null,s)}if(this._match(v.keywords.const)){const e=this._consume(v.tokens.ident,"Expected name for const.").toString();let n=null;if(this._match(v.tokens.colon)){const r=this._attribute();n=this._type_decl(),n!=null&&(n.attributes=r)}this._consume(v.tokens.equal,"Expected '=' for const.");const s=this._short_circuit_or_expression();return new d0(e,n,null,null,s)}return null}_increment_decrement_statement(){const e=this._current,n=this._unary_expression();if(n==null)return null;if(!this._check(v.increment_operators))return this._current=e,null;const s=this._consume(v.increment_operators,"Expected increment operator");return new Y2(s.type===v.tokens.plus_plus?Gi.increment:Gi.decrement,n)}_assignment_statement(){let e=null;if(this._check(v.tokens.brace_right))return null;let n=this._match(v.tokens.underscore);if(n||(e=this._unary_expression()),!n&&e==null)return null;const s=this._consume(v.assignment_operators,"Expected assignment operator."),r=this._short_circuit_or_expression();return new J2(Na.parse(s.lexeme),e,r)}_func_call_statement(){if(!this._check(v.tokens.ident))return null;const e=this._current,n=this._consume(v.tokens.ident,"Expected function name."),s=this._argument_expression_list();return s===null?(this._current=e,null):new q2(n.lexeme,s)}_loop_statement(){if(!this._match(v.keywords.loop))return null;this._consume(v.tokens.brace_left,"Expected '{' for loop.");const e=[];let n=this._statement();for(;n!==null;){if(Array.isArray(n))for(let r of n)e.push(r);else e.push(n);n=this._statement()}let s=null;return this._match(v.keywords.continuing)&&(s=this._compound_statement()),this._consume(v.tokens.brace_right,"Expected '}' for loop."),new Z2(e,s)}_switch_statement(){if(!this._match(v.keywords.switch))return null;const e=this._optional_paren_expression();this._consume(v.tokens.brace_left,"Expected '{' for switch.");const n=this._switch_body();if(n==null||n.length==0)throw this._error(this._previous(),"Expected 'case' or 'default'.");return this._consume(v.tokens.brace_right,"Expected '}' for switch."),new Q2(e,n)}_switch_body(){const e=[];if(this._match(v.keywords.case)){const n=this._case_selectors();this._match(v.tokens.colon),this._consume(v.tokens.brace_left,"Exected '{' for switch case.");const s=this._case_body();this._consume(v.tokens.brace_right,"Exected '}' for switch case."),e.push(new fO(n,s))}if(this._match(v.keywords.default)){this._match(v.tokens.colon),this._consume(v.tokens.brace_left,"Exected '{' for switch default.");const n=this._case_body();this._consume(v.tokens.brace_right,"Exected '}' for switch default."),e.push(new dO(n))}if(this._check([v.keywords.default,v.keywords.case])){const n=this._switch_body();e.push(n[0])}return e}_case_selectors(){var e,n,s,r;const i=[(n=(e=this._shift_expression())===null||e===void 0?void 0:e.evaluate(this._context).toString())!==null&&n!==void 0?n:""];for(;this._match(v.tokens.comma);)i.push((r=(s=this._shift_expression())===null||s===void 0?void 0:s.evaluate(this._context).toString())!==null&&r!==void 0?r:"");return i}_case_body(){if(this._match(v.keywords.fallthrough))return this._consume(v.tokens.semicolon,"Expected ';'"),[];let e=this._statement();if(e==null)return[];e instanceof Array||(e=[e]);const n=this._case_body();return n.length==0?e:[...e,n[0]]}_if_statement(){if(!this._match(v.keywords.if))return null;const e=this._optional_paren_expression(),n=this._compound_statement();let s=[];this._match_elseif()&&(s=this._elseif_statement(s));let r=null;return this._match(v.keywords.else)&&(r=this._compound_statement()),new eO(e,n,s,r)}_match_elseif(){return this._tokens[this._current].type===v.keywords.else&&this._tokens[this._current+1].type===v.keywords.if?(this._advance(),this._advance(),!0):!1}_elseif_statement(e=[]){const n=this._optional_paren_expression(),s=this._compound_statement();return e.push(new gO(n,s)),this._match_elseif()&&this._elseif_statement(e),e}_return_statement(){if(!this._match(v.keywords.return))return null;const e=this._short_circuit_or_expression();return new tO(e)}_short_circuit_or_expression(){let e=this._short_circuit_and_expr();for(;this._match(v.tokens.or_or);)e=new vn(this._previous().toString(),e,this._short_circuit_and_expr());return e}_short_circuit_and_expr(){let e=this._inclusive_or_expression();for(;this._match(v.tokens.and_and);)e=new vn(this._previous().toString(),e,this._inclusive_or_expression());return e}_inclusive_or_expression(){let e=this._exclusive_or_expression();for(;this._match(v.tokens.or);)e=new vn(this._previous().toString(),e,this._exclusive_or_expression());return e}_exclusive_or_expression(){let e=this._and_expression();for(;this._match(v.tokens.xor);)e=new vn(this._previous().toString(),e,this._and_expression());return e}_and_expression(){let e=this._equality_expression();for(;this._match(v.tokens.and);)e=new vn(this._previous().toString(),e,this._equality_expression());return e}_equality_expression(){const e=this._relational_expression();return this._match([v.tokens.equal_equal,v.tokens.not_equal])?new vn(this._previous().toString(),e,this._relational_expression()):e}_relational_expression(){let e=this._shift_expression();for(;this._match([v.tokens.less_than,v.tokens.greater_than,v.tokens.less_than_equal,v.tokens.greater_than_equal]);)e=new vn(this._previous().toString(),e,this._shift_expression());return e}_shift_expression(){let e=this._additive_expression();for(;this._match([v.tokens.shift_left,v.tokens.shift_right]);)e=new vn(this._previous().toString(),e,this._additive_expression());return e}_additive_expression(){let e=this._multiplicative_expression();for(;this._match([v.tokens.plus,v.tokens.minus]);)e=new vn(this._previous().toString(),e,this._multiplicative_expression());return e}_multiplicative_expression(){let e=this._unary_expression();for(;this._match([v.tokens.star,v.tokens.forward_slash,v.tokens.modulo]);)e=new vn(this._previous().toString(),e,this._unary_expression());return e}_unary_expression(){return this._match([v.tokens.minus,v.tokens.bang,v.tokens.tilde,v.tokens.star,v.tokens.and])?new hO(this._previous().toString(),this._unary_expression()):this._singular_expression()}_singular_expression(){const e=this._primary_expression(),n=this._postfix_expression();return n&&(e.postfix=n),e}_postfix_expression(){if(this._match(v.tokens.bracket_left)){const e=this._short_circuit_or_expression();this._consume(v.tokens.bracket_right,"Expected ']'.");const n=this._postfix_expression();return n&&(e.postfix=n),e}if(this._match(v.tokens.period)){const e=this._consume(v.tokens.ident,"Expected member name."),n=this._postfix_expression(),s=new p0(e.lexeme);return n&&(s.postfix=n),s}return null}_getStruct(e){return this._context.aliases.has(e)?this._context.aliases.get(e).type:this._context.structs.has(e)?this._context.structs.get(e):null}_primary_expression(){if(this._match(v.tokens.ident)){const s=this._previous().toString();if(this._check(v.tokens.paren_left)){const r=this._argument_expression_list(),i=this._getStruct(s);return i!=null?new jo(i,r):new aO(s,r)}if(this._context.constants.has(s)){const r=this._context.constants.get(s);return new g0(s,r.value)}return new cO(s)}if(this._match(v.const_literal))return new _0(parseFloat(this._previous().toString()));if(this._check(v.tokens.paren_left))return this._paren_expression();if(this._match(v.keywords.bitcast)){this._consume(v.tokens.less_than,"Expected '<'.");const s=this._type_decl();this._consume(v.tokens.greater_than,"Expected '>'.");const r=this._paren_expression();return new lO(s,r)}const e=this._type_decl(),n=this._argument_expression_list();return new uO(e,n)}_argument_expression_list(){if(!this._match(v.tokens.paren_left))return null;const e=[];do{if(this._check(v.tokens.paren_right))break;const n=this._short_circuit_or_expression();e.push(n)}while(this._match(v.tokens.comma));return this._consume(v.tokens.paren_right,"Expected ')' for agument list"),e}_optional_paren_expression(){this._match(v.tokens.paren_left);const e=this._short_circuit_or_expression();return this._match(v.tokens.paren_right),new m0([e])}_paren_expression(){this._consume(v.tokens.paren_left,"Expected '('.");const e=this._short_circuit_or_expression();return this._consume(v.tokens.paren_right,"Expected ')'."),new m0([e])}_struct_decl(){if(!this._match(v.keywords.struct))return null;const e=this._consume(v.tokens.ident,"Expected name for struct.").toString();this._consume(v.tokens.brace_left,"Expected '{' for struct body.");const n=[];for(;!this._check(v.tokens.brace_right);){const r=this._attribute(),i=this._consume(v.tokens.ident,"Expected variable name.").toString();this._consume(v.tokens.colon,"Expected ':' for struct member type.");const o=this._attribute(),a=this._type_decl();a!=null&&(a.attributes=o),this._check(v.tokens.brace_right)?this._match(v.tokens.comma):this._consume(v.tokens.comma,"Expected ',' for struct member."),n.push(new _O(i,a,r))}this._consume(v.tokens.brace_right,"Expected '}' after struct body.");const s=new lr(e,n);return this._context.structs.set(e,s),s}_global_variable_decl(){const e=this._variable_decl();return e&&this._match(v.tokens.equal)&&(e.value=this._const_expression()),e}_override_variable_decl(){const e=this._override_decl();return e&&this._match(v.tokens.equal)&&(e.value=this._const_expression()),e}_global_const_decl(){if(!this._match(v.keywords.const))return null;const e=this._consume(v.tokens.ident,"Expected variable name");let n=null;if(this._match(v.tokens.colon)){const i=this._attribute();n=this._type_decl(),n!=null&&(n.attributes=i)}let s=null;if(this._match(v.tokens.equal)){const i=this._short_circuit_or_expression();if(i instanceof jo)s=i;else if(i instanceof g0&&i.initializer instanceof jo)s=i.initializer;else try{const o=i.evaluate(this._context);s=new _0(o)}catch{s=i}}const r=new d0(e.toString(),n,"","",s);return this._context.constants.set(r.name,r),r}_global_let_decl(){if(!this._match(v.keywords.let))return null;const e=this._consume(v.tokens.ident,"Expected variable name");let n=null;if(this._match(v.tokens.colon)){const r=this._attribute();n=this._type_decl(),n!=null&&(n.attributes=r)}let s=null;return this._match(v.tokens.equal)&&(s=this._const_expression()),new f0(e.toString(),n,"","",s)}_const_expression(){if(this._match(v.const_literal))return new p0(this._previous().toString());const e=this._type_decl();this._consume(v.tokens.paren_left,"Expected '('.");let n=[];for(;!this._check(v.tokens.paren_right)&&(n.push(this._const_expression()),!!this._check(v.tokens.comma));)this._advance();return this._consume(v.tokens.paren_right,"Expected ')'."),new jo(e,n)}_variable_decl(){if(!this._match(v.keywords.var))return null;let e="",n="";this._match(v.tokens.less_than)&&(e=this._consume(v.storage_class,"Expected storage_class.").toString(),this._match(v.tokens.comma)&&(n=this._consume(v.access_mode,"Expected access_mode.").toString()),this._consume(v.tokens.greater_than,"Expected '>'."));const s=this._consume(v.tokens.ident,"Expected variable name");let r=null;if(this._match(v.tokens.colon)){const i=this._attribute();r=this._type_decl(),r!=null&&(r.attributes=i)}return new pi(s.toString(),r,e,n,null)}_override_decl(){if(!this._match(v.keywords.override))return null;const e=this._consume(v.tokens.ident,"Expected variable name");let n=null;if(this._match(v.tokens.colon)){const s=this._attribute();n=this._type_decl(),n!=null&&(n.attributes=s)}return new Nv(e.toString(),n,null)}_enable_directive(){const e=this._consume(v.tokens.ident,"identity expected.");return new nO(e.toString())}_type_alias(){const e=this._consume(v.tokens.ident,"identity expected.");this._consume(v.tokens.equal,"Expected '=' for type alias.");let n=this._type_decl();if(n===null)throw this._error(this._peek(),"Expected Type for Alias.");this._context.aliases.has(n.name)&&(n=this._context.aliases.get(n.name).type);const s=new Fv(e.toString(),n);return this._context.aliases.set(s.name,s),s}_type_decl(){if(this._check([v.tokens.ident,...v.texel_format,v.keywords.bool,v.keywords.f32,v.keywords.i32,v.keywords.u32])){const s=this._advance(),r=s.toString();return this._context.structs.has(r)?this._context.structs.get(r):this._context.aliases.has(r)?this._context.aliases.get(r).type:new zr(s.toString())}let e=this._texture_sampler_types();if(e)return e;if(this._check(v.template_types)){let s=this._advance().toString(),r=null,i=null;return this._match(v.tokens.less_than)&&(r=this._type_decl(),i=null,this._match(v.tokens.comma)&&(i=this._consume(v.access_mode,"Expected access_mode for pointer").toString()),this._consume(v.tokens.greater_than,"Expected '>' for type.")),new Dv(s,r,i)}if(this._match(v.keywords.ptr)){let s=this._previous().toString();this._consume(v.tokens.less_than,"Expected '<' for pointer.");const r=this._consume(v.storage_class,"Expected storage_class for pointer");this._consume(v.tokens.comma,"Expected ',' for pointer.");const i=this._type_decl();let o=null;return this._match(v.tokens.comma)&&(o=this._consume(v.access_mode,"Expected access_mode for pointer").toString()),this._consume(v.tokens.greater_than,"Expected '>' for pointer."),new oO(s,r.toString(),i,o)}const n=this._attribute();if(this._match(v.keywords.array)){let s=null,r=-1;const i=this._previous();if(this._match(v.tokens.less_than)){s=this._type_decl(),this._context.aliases.has(s.name)&&(s=this._context.aliases.get(s.name).type);let o="";this._match(v.tokens.comma)&&(o=this._shift_expression().evaluate(this._context).toString()),this._consume(v.tokens.greater_than,"Expected '>' for array."),r=o?parseInt(o):0}return new Lv(i.toString(),n,s,r)}return null}_texture_sampler_types(){if(this._match(v.sampler_type))return new Ho(this._previous().toString(),null,null);if(this._match(v.depth_texture_type))return new Ho(this._previous().toString(),null,null);if(this._match(v.sampled_texture_type)||this._match(v.multisampled_texture_type)){const e=this._previous();this._consume(v.tokens.less_than,"Expected '<' for sampler type.");const n=this._type_decl();return this._consume(v.tokens.greater_than,"Expected '>' for sampler type."),new Ho(e.toString(),n,null)}if(this._match(v.storage_texture_type)){const e=this._previous();this._consume(v.tokens.less_than,"Expected '<' for sampler type.");const n=this._consume(v.texel_format,"Invalid texel format.").toString();this._consume(v.tokens.comma,"Expected ',' after texel format.");const s=this._consume(v.access_mode,"Expected access mode for storage texture type.").toString();return this._consume(v.tokens.greater_than,"Expected '>' for sampler type."),new Ho(e.toString(),n,s)}return null}_attribute(){let e=[];for(;this._match(v.tokens.attr);){const n=this._consume(v.attribute_name,"Expected attribute name"),s=new y0(n.toString(),null);if(this._match(v.tokens.paren_left)){if(s.value=this._consume(v.literal_or_ident,"Expected attribute value").toString(),this._check(v.tokens.comma)){this._advance();do{const r=this._consume(v.literal_or_ident,"Expected attribute value").toString();s.value instanceof Array||(s.value=[s.value]),s.value.push(r)}while(this._match(v.tokens.comma))}this._consume(v.tokens.paren_right,"Expected ')'")}e.push(s)}for(;this._match(v.tokens.attr_left);){if(!this._check(v.tokens.attr_right))do{const n=this._consume(v.attribute_name,"Expected attribute name"),s=new y0(n.toString(),null);if(this._match(v.tokens.paren_left)){if(s.value=[this._consume(v.literal_or_ident,"Expected attribute value").toString()],this._check(v.tokens.comma)){this._advance();do{const r=this._consume(v.literal_or_ident,"Expected attribute value").toString();s.value.push(r)}while(this._match(v.tokens.comma))}this._consume(v.tokens.paren_right,"Expected ')'")}e.push(s)}while(this._match(v.tokens.comma));this._consume(v.tokens.attr_right,"Expected ']]' after attribute declarations")}return e.length==0?null:e}}class Bi{constructor(e,n){this.name=e,this.attributes=n,this.size=0}get isArray(){return!1}get isStruct(){return!1}get isTemplate(){return!1}}class T0{constructor(e,n,s){this.name=e,this.type=n,this.attributes=s,this.offset=0,this.size=0}get isArray(){return this.type.isArray}get isStruct(){return this.type.isStruct}get isTemplate(){return this.type.isTemplate}get align(){return this.type.isStruct?this.type.align:0}get members(){return this.type.isStruct?this.type.members:null}get format(){return this.type.isArray?this.type.format:this.type.isTemplate?this.type.format:null}get count(){return this.type.isArray?this.type.count:0}get stride(){return this.type.isArray?this.type.stride:this.size}}class Nc extends Bi{constructor(e,n){super(e,n),this.members=[],this.align=0}get isStruct(){return!0}}class $f extends Bi{constructor(e,n){super(e,n),this.count=0,this.stride=0}get isArray(){return!0}}class E0 extends Bi{constructor(e,n,s,r){super(e,s),this.format=n,this.access=r}get isTemplate(){return!0}}var Es;(function(t){t[t.Uniform=0]="Uniform",t[t.Storage=1]="Storage",t[t.Texture=2]="Texture",t[t.Sampler=3]="Sampler",t[t.StorageTexture=4]="StorageTexture"})(Es||(Es={}));class Fc{constructor(e,n,s,r,i,o,a){this.name=e,this.type=n,this.group=s,this.binding=r,this.attributes=i,this.resourceType=o,this.access=a}get isArray(){return this.type.isArray}get isStruct(){return this.type.isStruct}get isTemplate(){return this.type.isTemplate}get size(){return this.type.size}get align(){return this.type.isStruct?this.type.align:0}get members(){return this.type.isStruct?this.type.members:null}get format(){return this.type.isArray?this.type.format:this.type.isTemplate?this.type.format:null}get count(){return this.type.isArray?this.type.count:0}get stride(){return this.type.isArray?this.type.stride:this.size}}class AO{constructor(e,n){this.name=e,this.type=n}}class Dc{constructor(e,n){this.align=e,this.size=n}}class TO{constructor(e,n,s,r){this.name=e,this.type=n,this.locationType=s,this.location=r,this.interpolation=null}}class S0{constructor(e,n,s,r){this.name=e,this.type=n,this.locationType=s,this.location=r}}class EO{constructor(e,n=null){this.stage=null,this.inputs=[],this.outputs=[],this.name=e,this.stage=n}}class SO{constructor(){this.vertex=[],this.fragment=[],this.compute=[]}}class CO{constructor(e,n,s,r){this.name=e,this.type=n,this.attributes=s,this.id=r}}class Jn{constructor(e){this.uniforms=[],this.storage=[],this.textures=[],this.samplers=[],this.aliases=[],this.overrides=[],this.structs=[],this.entry=new SO,this._types=new Map,e&&this.update(e)}_isStorageTexture(e){return e.name=="texture_storage_1d"||e.name=="texture_storage_2d"||e.name=="texture_storage_2d_array"||e.name=="texture_storage_3d"}update(e){const s=new yO().parse(e);for(const r of s){if(r instanceof lr){const i=this._getTypeInfo(r,null);i instanceof Nc&&this.structs.push(i);continue}if(r instanceof Fv){this.aliases.push(this._getAliasInfo(r));continue}if(r instanceof Nv){const i=r,o=this._getAttributeNum(i.attributes,"id",0),a=i.type!=null?this._getTypeInfo(i.type,i.attributes):null;this.overrides.push(new CO(i.name,a,i.attributes,o));continue}if(this._isUniformVar(r)){const i=r,o=this._getAttributeNum(i.attributes,"group",0),a=this._getAttributeNum(i.attributes,"binding",0),c=this._getTypeInfo(i.type,i.attributes),l=new Fc(i.name,c,o,a,i.attributes,Es.Uniform,i.access);this.uniforms.push(l);continue}if(this._isStorageVar(r)){const i=r,o=this._getAttributeNum(i.attributes,"group",0),a=this._getAttributeNum(i.attributes,"binding",0),c=this._getTypeInfo(i.type,i.attributes),l=this._isStorageTexture(c),u=new Fc(i.name,c,o,a,i.attributes,l?Es.StorageTexture:Es.Storage,i.access);this.storage.push(u);continue}if(this._isTextureVar(r)){const i=r,o=this._getAttributeNum(i.attributes,"group",0),a=this._getAttributeNum(i.attributes,"binding",0),c=this._getTypeInfo(i.type,i.attributes),l=this._isStorageTexture(c),u=new Fc(i.name,c,o,a,i.attributes,l?Es.StorageTexture:Es.Texture,i.access);l?this.storage.push(u):this.textures.push(u);continue}if(this._isSamplerVar(r)){const i=r,o=this._getAttributeNum(i.attributes,"group",0),a=this._getAttributeNum(i.attributes,"binding",0),c=this._getTypeInfo(i.type,i.attributes),l=new Fc(i.name,c,o,a,i.attributes,Es.Sampler,i.access);this.samplers.push(l);continue}if(r instanceof Ov){const i=this._getAttribute(r,"vertex"),o=this._getAttribute(r,"fragment"),a=this._getAttribute(r,"compute"),c=i||o||a;if(c){const l=new EO(r.name,c.name);l.inputs=this._getInputs(r.args),l.outputs=this._getOutputs(r.returnType),this.entry[c.name].push(l)}continue}}}getBindGroups(){const e=[];function n(s,r){s>=e.length&&(e.length=s+1),e[s]===void 0&&(e[s]=[]),r>=e[s].length&&(e[s].length=r+1)}for(const s of this.uniforms){n(s.group,s.binding);const r=e[s.group];r[s.binding]=s}for(const s of this.storage){n(s.group,s.binding);const r=e[s.group];r[s.binding]=s}for(const s of this.textures){n(s.group,s.binding);const r=e[s.group];r[s.binding]=s}for(const s of this.samplers){n(s.group,s.binding);const r=e[s.group];r[s.binding]=s}return e}_getOutputs(e,n=void 0){if(n===void 0&&(n=[]),e instanceof lr)this._getStructOutputs(e,n);else{const s=this._getOutputInfo(e);s!==null&&n.push(s)}return n}_getStructOutputs(e,n){for(const s of e.members)if(s.type instanceof lr)this._getStructOutputs(s.type,n);else{const r=this._getAttribute(s,"location")||this._getAttribute(s,"builtin");if(r!==null){const i=this._getTypeInfo(s.type,s.type.attributes),o=this._parseInt(r.value),a=new S0(s.name,i,r.name,o);n.push(a)}}}_getOutputInfo(e){const n=this._getAttribute(e,"location")||this._getAttribute(e,"builtin");if(n!==null){const s=this._getTypeInfo(e,e.attributes),r=this._parseInt(n.value);return new S0("",s,n.name,r)}return null}_getInputs(e,n=void 0){n===void 0&&(n=[]);for(const s of e)if(s.type instanceof lr)this._getStructInputs(s.type,n);else{const r=this._getInputInfo(s);r!==null&&n.push(r)}return n}_getStructInputs(e,n){for(const s of e.members)if(s.type instanceof lr)this._getStructInputs(s.type,n);else{const r=this._getInputInfo(s);r!==null&&n.push(r)}}_getInputInfo(e){const n=this._getAttribute(e,"location")||this._getAttribute(e,"builtin");if(n!==null){const s=this._getAttribute(e,"interpolation"),r=this._getTypeInfo(e.type,e.attributes),i=this._parseInt(n.value),o=new TO(e.name,r,n.name,i);return s!==null&&(o.interpolation=this._parseString(s.value)),o}return null}_parseString(e){return e instanceof Array&&(e=e[0]),e}_parseInt(e){e instanceof Array&&(e=e[0]);const n=parseInt(e);return isNaN(n)?e:n}_getAlias(e){for(const n of this.aliases)if(n.name==e)return n.type;return null}_getAliasInfo(e){return new AO(e.name,this._getTypeInfo(e.type,null))}_getTypeInfo(e,n){if(this._types.has(e))return this._types.get(e);if(e instanceof Lv){const r=e,i=this._getTypeInfo(r.format,r.attributes),o=new $f(r.name,n);return o.format=i,o.count=r.count,this._types.set(e,o),this._updateTypeInfo(o),o}if(e instanceof lr){const r=e,i=new Nc(r.name,n);for(const o of r.members){const a=this._getTypeInfo(o.type,o.attributes);i.members.push(new T0(o.name,a,o.attributes))}return this._types.set(e,i),this._updateTypeInfo(i),i}if(e instanceof Ho){const r=e,i=r.format instanceof zr,o=r.format?i?this._getTypeInfo(r.format,null):new Bi(r.format,null):null,a=new E0(r.name,o,n,r.access);return this._types.set(e,a),this._updateTypeInfo(a),a}if(e instanceof Dv){const r=e,i=r.format?this._getTypeInfo(r.format,null):null,o=new E0(r.name,i,n,r.access);return this._types.set(e,o),this._updateTypeInfo(o),o}const s=new Bi(e.name,n);return this._types.set(e,s),this._updateTypeInfo(s),s}_updateTypeInfo(e){var n,s;const r=this._getTypeSize(e);if(e.size=(n=r==null?void 0:r.size)!==null&&n!==void 0?n:0,e instanceof $f){const i=this._getTypeSize(e.format);e.stride=(s=i==null?void 0:i.size)!==null&&s!==void 0?s:0,this._updateTypeInfo(e.format)}e instanceof Nc&&this._updateStructInfo(e)}_updateStructInfo(e){var n;let s=0,r=0,i=0,o=0;for(let a=0,c=e.members.length;a<c;++a){const l=e.members[a],u=this._getTypeSize(l);if(!u)continue;(n=this._getAlias(l.type.name))!==null&&n!==void 0||l.type;const h=u.align,f=u.size;s=this._roundUp(h,s+r),r=f,i=s,o=Math.max(o,h),l.offset=s,l.size=f,this._updateTypeInfo(l.type)}e.size=this._roundUp(o,i+r),e.align=o}_getTypeSize(e){var n;if(e==null)return null;const s=this._getAttributeNum(e.attributes,"size",0),r=this._getAttributeNum(e.attributes,"align",0);if(e instanceof T0&&(e=e.type),e instanceof Bi){const i=this._getAlias(e.name);i!==null&&(e=i)}{const i=Jn._typeInfo[e.name];if(i!==void 0){const o=e.format==="f16"?2:1;return new Dc(Math.max(r,i.align/o),Math.max(s,i.size/o))}}{const i=Jn._typeInfo[e.name.substring(0,e.name.length-1)];if(i){const o=e.name[e.name.length-1]==="h"?2:1;return new Dc(Math.max(r,i.align/o),Math.max(s,i.size/o))}}if(e instanceof $f){let i=e,o=8,a=8;const c=this._getTypeSize(i.format);c!==null&&(a=c.size,o=c.align);const l=i.count,u=this._getAttributeNum((n=e==null?void 0:e.attributes)!==null&&n!==void 0?n:null,"stride",this._roundUp(o,a));return a=l*u,s&&(a=s),new Dc(Math.max(r,o),Math.max(s,a))}if(e instanceof Nc){let i=0,o=0,a=0,c=0,l=0;for(const u of e.members){const h=this._getTypeSize(u.type);h!==null&&(i=Math.max(h.align,i),a=this._roundUp(h.align,a+c),c=h.size,l=a)}return o=this._roundUp(i,l+c),new Dc(Math.max(r,i),Math.max(s,o))}return null}_isUniformVar(e){return e instanceof pi&&e.storage=="uniform"}_isStorageVar(e){return e instanceof pi&&e.storage=="storage"}_isTextureVar(e){return e instanceof pi&&e.type!==null&&Jn._textureTypes.indexOf(e.type.name)!=-1}_isSamplerVar(e){return e instanceof pi&&e.type!==null&&Jn._samplerTypes.indexOf(e.type.name)!=-1}_getAttribute(e,n){const s=e;if(!s||!s.attributes)return null;const r=s.attributes;for(let i of r)if(i.name==n)return i;return null}_getAttributeNum(e,n,s){if(e===null)return s;for(let r of e)if(r.name==n){let i=r!==null&&r.value!==null?r.value:s;return i instanceof Array&&(i=i[0]),typeof i=="number"?i:typeof i=="string"?parseInt(i):s}return s}_roundUp(e,n){return Math.ceil(n/e)*e}}Jn._typeInfo={f16:{align:2,size:2},i32:{align:4,size:4},u32:{align:4,size:4},f32:{align:4,size:4},atomic:{align:4,size:4},vec2:{align:8,size:8},vec3:{align:16,size:12},vec4:{align:16,size:16},mat2x2:{align:8,size:16},mat3x2:{align:8,size:24},mat4x2:{align:8,size:32},mat2x3:{align:16,size:32},mat3x3:{align:16,size:48},mat4x3:{align:16,size:64},mat2x4:{align:16,size:32},mat3x4:{align:16,size:48},mat4x4:{align:16,size:64}};Jn._textureTypes=v.any_texture_type.map(t=>t.name);Jn._samplerTypes=v.sampler_type.map(t=>t.name);function vO(t){const e={attributes:[],bindings:[]};let n;try{n=wO(t)}catch(i){return U.error(i.message)(),e}for(const i of n.uniforms){const o=[];for(const a of i.type.members)o.push({name:a.name,type:C0(a.type)});e.bindings.push({type:"uniform",name:i.name,location:i.binding,group:i.group,members:o})}const s=n.entry.vertex[0],r=(s==null?void 0:s.inputs.length)||0;for(let i=0;i<r;i++){const o=s.inputs[i];if(o.locationType==="location"){const a=C0(o.type);e.attributes.push({name:o.name,location:o.location,type:a})}}return e}function C0(t){return t.format?`${t.name}<${t.format.name}>`:t.name}function wO(t){try{return new Jn(t)}catch(e){if(e instanceof Error)throw e;let n="WGSL parse error";throw typeof e=="object"&&(e!=null&&e.message)&&(n+=`: ${e.message} `),typeof e=="object"&&(e!=null&&e.token)&&(n+=e.token.line||""),new Error(n,{cause:e})}}const bO=`#ifdef LUMA_FP32_TAN_PRECISION_WORKAROUND
const float TWO_PI = 6.2831854820251465;
const float PI_2 = 1.5707963705062866;
const float PI_16 = 0.1963495463132858;
const float SIN_TABLE_0 = 0.19509032368659973;
const float SIN_TABLE_1 = 0.3826834261417389;
const float SIN_TABLE_2 = 0.5555702447891235;
const float SIN_TABLE_3 = 0.7071067690849304;
const float COS_TABLE_0 = 0.9807852506637573;
const float COS_TABLE_1 = 0.9238795042037964;
const float COS_TABLE_2 = 0.8314695954322815;
const float COS_TABLE_3 = 0.7071067690849304;
const float INVERSE_FACTORIAL_3 = 1.666666716337204e-01;
const float INVERSE_FACTORIAL_5 = 8.333333767950535e-03;
const float INVERSE_FACTORIAL_7 = 1.9841270113829523e-04;
const float INVERSE_FACTORIAL_9 = 2.75573188446287533e-06;
float sin_taylor_fp32(float a) {
float r, s, t, x;
if (a == 0.0) {
return 0.0;
}
x = -a * a;
s = a;
r = a;
r = r * x;
t = r * INVERSE_FACTORIAL_3;
s = s + t;
r = r * x;
t = r * INVERSE_FACTORIAL_5;
s = s + t;
r = r * x;
t = r * INVERSE_FACTORIAL_7;
s = s + t;
r = r * x;
t = r * INVERSE_FACTORIAL_9;
s = s + t;
return s;
}
void sincos_taylor_fp32(float a, out float sin_t, out float cos_t) {
if (a == 0.0) {
sin_t = 0.0;
cos_t = 1.0;
}
sin_t = sin_taylor_fp32(a);
cos_t = sqrt(1.0 - sin_t * sin_t);
}
float tan_taylor_fp32(float a) {
float sin_a;
float cos_a;
if (a == 0.0) {
return 0.0;
}
float z = floor(a / TWO_PI);
float r = a - TWO_PI * z;
float t;
float q = floor(r / PI_2 + 0.5);
int j = int(q);
if (j < -2 || j > 2) {
return 1.0 / 0.0;
}
t = r - PI_2 * q;
q = floor(t / PI_16 + 0.5);
int k = int(q);
int abs_k = int(abs(float(k)));
if (abs_k > 4) {
return 1.0 / 0.0;
} else {
t = t - PI_16 * q;
}
float u = 0.0;
float v = 0.0;
float sin_t, cos_t;
float s, c;
sincos_taylor_fp32(t, sin_t, cos_t);
if (k == 0) {
s = sin_t;
c = cos_t;
} else {
if (abs(float(abs_k) - 1.0) < 0.5) {
u = COS_TABLE_0;
v = SIN_TABLE_0;
} else if (abs(float(abs_k) - 2.0) < 0.5) {
u = COS_TABLE_1;
v = SIN_TABLE_1;
} else if (abs(float(abs_k) - 3.0) < 0.5) {
u = COS_TABLE_2;
v = SIN_TABLE_2;
} else if (abs(float(abs_k) - 4.0) < 0.5) {
u = COS_TABLE_3;
v = SIN_TABLE_3;
}
if (k > 0) {
s = u * sin_t + v * cos_t;
c = u * cos_t - v * sin_t;
} else {
s = u * sin_t - v * cos_t;
c = u * cos_t + v * sin_t;
}
}
if (j == 0) {
sin_a = s;
cos_a = c;
} else if (j == 1) {
sin_a = c;
cos_a = -s;
} else if (j == -1) {
sin_a = -c;
cos_a = s;
} else {
sin_a = -s;
cos_a = -c;
}
return sin_a / cos_a;
}
#endif
float tan_fp32(float a) {
#ifdef LUMA_FP32_TAN_PRECISION_WORKAROUND
return tan_taylor_fp32(a);
#else
return tan(a);
#endif
}
`,RO={name:"fp32",vs:bO},IO=new Float32Array([0,1,1,1]),PO=`uniform pickingUniforms {
float isActive;
float isAttribute;
float isHighlightActive;
float useFloatColors;
vec3 highlightedObjectColor;
vec4 highlightColor;
} picking;
out vec4 picking_vRGBcolor_Avalid;
vec3 picking_normalizeColor(vec3 color) {
return picking.useFloatColors > 0.5 ? color : color / 255.0;
}
vec4 picking_normalizeColor(vec4 color) {
return picking.useFloatColors > 0.5 ? color : color / 255.0;
}
bool picking_isColorZero(vec3 color) {
return dot(color, vec3(1.0)) < 0.00001;
}
bool picking_isColorValid(vec3 color) {
return dot(color, vec3(1.0)) > 0.00001;
}
bool isVertexHighlighted(vec3 vertexColor) {
vec3 highlightedObjectColor = picking_normalizeColor(picking.highlightedObjectColor);
return
bool(picking.isHighlightActive) && picking_isColorZero(abs(vertexColor - highlightedObjectColor));
}
void picking_setPickingColor(vec3 pickingColor) {
pickingColor = picking_normalizeColor(pickingColor);
if (bool(picking.isActive)) {
picking_vRGBcolor_Avalid.a = float(picking_isColorValid(pickingColor));
if (!bool(picking.isAttribute)) {
picking_vRGBcolor_Avalid.rgb = pickingColor;
}
} else {
picking_vRGBcolor_Avalid.a = float(isVertexHighlighted(pickingColor));
}
}
void picking_setPickingAttribute(float value) {
if (bool(picking.isAttribute)) {
picking_vRGBcolor_Avalid.r = value;
}
}
void picking_setPickingAttribute(vec2 value) {
if (bool(picking.isAttribute)) {
picking_vRGBcolor_Avalid.rg = value;
}
}
void picking_setPickingAttribute(vec3 value) {
if (bool(picking.isAttribute)) {
picking_vRGBcolor_Avalid.rgb = value;
}
}
`,xO=`uniform pickingUniforms {
float isActive;
float isAttribute;
float isHighlightActive;
float useFloatColors;
vec3 highlightedObjectColor;
vec4 highlightColor;
} picking;
in vec4 picking_vRGBcolor_Avalid;
vec4 picking_filterHighlightColor(vec4 color) {
if (picking.isActive > 0.5) {
return color;
}
bool selected = bool(picking_vRGBcolor_Avalid.a);
if (selected) {
float highLightAlpha = picking.highlightColor.a;
float blendedAlpha = highLightAlpha + color.a * (1.0 - highLightAlpha);
float highLightRatio = highLightAlpha / blendedAlpha;
vec3 blendedRGB = mix(color.rgb, picking.highlightColor.rgb, highLightRatio);
return vec4(blendedRGB, blendedAlpha);
} else {
return color;
}
}
vec4 picking_filterPickingColor(vec4 color) {
if (bool(picking.isActive)) {
if (picking_vRGBcolor_Avalid.a == 0.0) {
discard;
}
return picking_vRGBcolor_Avalid;
}
return color;
}
vec4 picking_filterColor(vec4 color) {
vec4 highlightColor = picking_filterHighlightColor(color);
return picking_filterPickingColor(highlightColor);
}
`,v0={name:"picking",vs:PO,fs:xO,uniformTypes:{isActive:"f32",isAttribute:"f32",isHighlightActive:"f32",useFloatColors:"f32",highlightedObjectColor:"vec3<f32>",highlightColor:"vec4<f32>"},defaultUniforms:{isActive:!1,isAttribute:!1,isHighlightActive:!1,useFloatColors:!0,highlightedObjectColor:new Float32Array([0,0,0]),highlightColor:IO},getUniforms:MO};function MO(t={},e){const n={};if(t.highlightedObjectColor!==void 0)if(t.highlightedObjectColor===null)n.isHighlightActive=!1;else{n.isHighlightActive=!0;const s=t.highlightedObjectColor.slice(0,3);n.highlightedObjectColor=s}if(t.highlightColor){const s=Array.from(t.highlightColor,r=>r/255);Number.isFinite(s[3])||(s[3]=1),n.highlightColor=s}return t.isActive!==void 0&&(n.isActive=!!t.isActive,n.isAttribute=!!t.isAttribute),t.useFloatColors!==void 0&&(n.useFloatColors=!!t.useFloatColors),n}const BO=1/Math.PI*180,OO=1/180*Math.PI,NO={EPSILON:1e-12,debug:!1,precision:4,printTypes:!1,printDegrees:!1,printRowMajor:!0,_cartographicRadians:!1};globalThis.mathgl=globalThis.mathgl||{config:{...NO}};const Ue=globalThis.mathgl.config;function FO(t,{precision:e=Ue.precision}={}){return t=kO(t),`${parseFloat(t.toPrecision(e))}`}function Hs(t){return Array.isArray(t)||ArrayBuffer.isView(t)&&!(t instanceof DataView)}function DO(t){return UO(t)}function LO(t){return rn(t)}function UO(t,e){return pm(t,n=>n*OO,e)}function rn(t,e){return pm(t,n=>n*BO,e)}function qn(t,e,n){return pm(t,s=>Math.max(e,Math.min(n,s)))}function Tu(t,e,n){return Hs(t)?t.map((s,r)=>Tu(s,e[r],n)):n*e+(1-n)*t}function Xt(t,e,n){const s=Ue.EPSILON;n&&(Ue.EPSILON=n);try{if(t===e)return!0;if(Hs(t)&&Hs(e)){if(t.length!==e.length)return!1;for(let r=0;r<t.length;++r)if(!Xt(t[r],e[r]))return!1;return!0}return t&&t.equals?t.equals(e):e&&e.equals?e.equals(t):typeof t=="number"&&typeof e=="number"?Math.abs(t-e)<=Ue.EPSILON*Math.max(1,Math.abs(t),Math.abs(e)):!1}finally{Ue.EPSILON=s}}function kO(t){return Math.round(t/Ue.EPSILON)*Ue.EPSILON}function zO(t){return t.clone?t.clone():new Array(t.length)}function pm(t,e,n){if(Hs(t)){const s=t;n=n||zO(s);for(let r=0;r<n.length&&r<s.length;++r){const i=typeof t=="number"?t:t[r];n[r]=e(i,r,n)}return n}return e(t)}class gm extends Array{clone(){return new this.constructor().copy(this)}fromArray(e,n=0){for(let s=0;s<this.ELEMENTS;++s)this[s]=e[s+n];return this.check()}toArray(e=[],n=0){for(let s=0;s<this.ELEMENTS;++s)e[n+s]=this[s];return e}toObject(e){return e}from(e){return Array.isArray(e)?this.copy(e):this.fromObject(e)}to(e){return e===this?this:Hs(e)?this.toArray(e):this.toObject(e)}toTarget(e){return e?this.to(e):this}toFloat32Array(){return new Float32Array(this)}toString(){return this.formatString(Ue)}formatString(e){let n="";for(let s=0;s<this.ELEMENTS;++s)n+=(s>0?", ":"")+FO(this[s],e);return`${e.printTypes?this.constructor.name:""}[${n}]`}equals(e){if(!e||this.length!==e.length)return!1;for(let n=0;n<this.ELEMENTS;++n)if(!Xt(this[n],e[n]))return!1;return!0}exactEquals(e){if(!e||this.length!==e.length)return!1;for(let n=0;n<this.ELEMENTS;++n)if(this[n]!==e[n])return!1;return!0}negate(){for(let e=0;e<this.ELEMENTS;++e)this[e]=-this[e];return this.check()}lerp(e,n,s){if(s===void 0)return this.lerp(this,e,n);for(let r=0;r<this.ELEMENTS;++r){const i=e[r],o=typeof n=="number"?n:n[r];this[r]=i+s*(o-i)}return this.check()}min(e){for(let n=0;n<this.ELEMENTS;++n)this[n]=Math.min(e[n],this[n]);return this.check()}max(e){for(let n=0;n<this.ELEMENTS;++n)this[n]=Math.max(e[n],this[n]);return this.check()}clamp(e,n){for(let s=0;s<this.ELEMENTS;++s)this[s]=Math.min(Math.max(this[s],e[s]),n[s]);return this.check()}add(...e){for(const n of e)for(let s=0;s<this.ELEMENTS;++s)this[s]+=n[s];return this.check()}subtract(...e){for(const n of e)for(let s=0;s<this.ELEMENTS;++s)this[s]-=n[s];return this.check()}scale(e){if(typeof e=="number")for(let n=0;n<this.ELEMENTS;++n)this[n]*=e;else for(let n=0;n<this.ELEMENTS&&n<e.length;++n)this[n]*=e[n];return this.check()}multiplyByScalar(e){for(let n=0;n<this.ELEMENTS;++n)this[n]*=e;return this.check()}check(){if(Ue.debug&&!this.validate())throw new Error(`math.gl: ${this.constructor.name} some fields set to invalid numbers'`);return this}validate(){let e=this.length===this.ELEMENTS;for(let n=0;n<this.ELEMENTS;++n)e=e&&Number.isFinite(this[n]);return e}sub(e){return this.subtract(e)}setScalar(e){for(let n=0;n<this.ELEMENTS;++n)this[n]=e;return this.check()}addScalar(e){for(let n=0;n<this.ELEMENTS;++n)this[n]+=e;return this.check()}subScalar(e){return this.addScalar(-e)}multiplyScalar(e){for(let n=0;n<this.ELEMENTS;++n)this[n]*=e;return this.check()}divideScalar(e){return this.multiplyByScalar(1/e)}clampScalar(e,n){for(let s=0;s<this.ELEMENTS;++s)this[s]=Math.min(Math.max(this[s],e),n);return this.check()}get elements(){return this}}function VO(t,e){if(t.length!==e)return!1;for(let n=0;n<t.length;++n)if(!Number.isFinite(t[n]))return!1;return!0}function ie(t){if(!Number.isFinite(t))throw new Error(`Invalid number ${JSON.stringify(t)}`);return t}function oa(t,e,n=""){if(Ue.debug&&!VO(t,e))throw new Error(`math.gl: ${n} some fields set to invalid numbers'`);return t}function an(t,e){if(!t)throw new Error(`math.gl assertion ${e}`)}class _m extends gm{get x(){return this[0]}set x(e){this[0]=ie(e)}get y(){return this[1]}set y(e){this[1]=ie(e)}len(){return Math.sqrt(this.lengthSquared())}magnitude(){return this.len()}lengthSquared(){let e=0;for(let n=0;n<this.ELEMENTS;++n)e+=this[n]*this[n];return e}magnitudeSquared(){return this.lengthSquared()}distance(e){return Math.sqrt(this.distanceSquared(e))}distanceSquared(e){let n=0;for(let s=0;s<this.ELEMENTS;++s){const r=this[s]-e[s];n+=r*r}return ie(n)}dot(e){let n=0;for(let s=0;s<this.ELEMENTS;++s)n+=this[s]*e[s];return ie(n)}normalize(){const e=this.magnitude();if(e!==0)for(let n=0;n<this.ELEMENTS;++n)this[n]/=e;return this.check()}multiply(...e){for(const n of e)for(let s=0;s<this.ELEMENTS;++s)this[s]*=n[s];return this.check()}divide(...e){for(const n of e)for(let s=0;s<this.ELEMENTS;++s)this[s]/=n[s];return this.check()}lengthSq(){return this.lengthSquared()}distanceTo(e){return this.distance(e)}distanceToSquared(e){return this.distanceSquared(e)}getComponent(e){return an(e>=0&&e<this.ELEMENTS,"index is out of range"),ie(this[e])}setComponent(e,n){return an(e>=0&&e<this.ELEMENTS,"index is out of range"),this[e]=n,this.check()}addVectors(e,n){return this.copy(e).add(n)}subVectors(e,n){return this.copy(e).subtract(n)}multiplyVectors(e,n){return this.copy(e).multiply(n)}addScaledVector(e,n){return this.add(new this.constructor(e).multiplyScalar(n))}}const aa=1e-6;let yn=typeof Float32Array<"u"?Float32Array:Array;function HO(){const t=new yn(2);return yn!=Float32Array&&(t[0]=0,t[1]=0),t}function w0(t,e,n){return t[0]=e[0]+n[0],t[1]=e[1]+n[1],t}function jO(t,e){return t[0]=-e[0],t[1]=-e[1],t}function zv(t,e,n,s){const r=e[0],i=e[1];return t[0]=r+s*(n[0]-r),t[1]=i+s*(n[1]-i),t}function WO(t,e,n){const s=e[0],r=e[1];return t[0]=n[0]*s+n[2]*r,t[1]=n[1]*s+n[3]*r,t}function GO(t,e,n){const s=e[0],r=e[1];return t[0]=n[0]*s+n[2]*r+n[4],t[1]=n[1]*s+n[3]*r+n[5],t}function Vv(t,e,n){const s=e[0],r=e[1];return t[0]=n[0]*s+n[3]*r+n[6],t[1]=n[1]*s+n[4]*r+n[7],t}function Hv(t,e,n){const s=e[0],r=e[1];return t[0]=n[0]*s+n[4]*r+n[12],t[1]=n[1]*s+n[5]*r+n[13],t}(function(){const t=HO();return function(e,n,s,r,i,o){let a,c;for(n||(n=2),s||(s=0),r?c=Math.min(r*n+s,e.length):c=e.length,a=s;a<c;a+=n)t[0]=e[a],t[1]=e[a+1],i(t,t,o),e[a]=t[0],e[a+1]=t[1];return e}})();function jv(t,e,n){const s=e[0],r=e[1],i=n[3]*s+n[7]*r||1;return t[0]=(n[0]*s+n[4]*r)/i,t[1]=(n[1]*s+n[5]*r)/i,t}function Wv(t,e,n){const s=e[0],r=e[1],i=e[2],o=n[3]*s+n[7]*r+n[11]*i||1;return t[0]=(n[0]*s+n[4]*r+n[8]*i)/o,t[1]=(n[1]*s+n[5]*r+n[9]*i)/o,t[2]=(n[2]*s+n[6]*r+n[10]*i)/o,t}function XO(t,e,n){const s=e[0],r=e[1];return t[0]=n[0]*s+n[2]*r,t[1]=n[1]*s+n[3]*r,t[2]=e[2],t}function $O(t,e,n){const s=e[0],r=e[1];return t[0]=n[0]*s+n[2]*r,t[1]=n[1]*s+n[3]*r,t[2]=e[2],t[3]=e[3],t}function Gv(t,e,n){const s=e[0],r=e[1],i=e[2];return t[0]=n[0]*s+n[3]*r+n[6]*i,t[1]=n[1]*s+n[4]*r+n[7]*i,t[2]=n[2]*s+n[5]*r+n[8]*i,t[3]=e[3],t}class mm extends _m{constructor(e=0,n=0){super(2),Hs(e)&&arguments.length===1?this.copy(e):(Ue.debug&&(ie(e),ie(n)),this[0]=e,this[1]=n)}set(e,n){return this[0]=e,this[1]=n,this.check()}copy(e){return this[0]=e[0],this[1]=e[1],this.check()}fromObject(e){return Ue.debug&&(ie(e.x),ie(e.y)),this[0]=e.x,this[1]=e.y,this.check()}toObject(e){return e.x=this[0],e.y=this[1],e}get ELEMENTS(){return 2}horizontalAngle(){return Math.atan2(this.y,this.x)}verticalAngle(){return Math.atan2(this.x,this.y)}transform(e){return this.transformAsPoint(e)}transformAsPoint(e){return Hv(this,this,e),this.check()}transformAsVector(e){return jv(this,this,e),this.check()}transformByMatrix3(e){return Vv(this,this,e),this.check()}transformByMatrix2x3(e){return GO(this,this,e),this.check()}transformByMatrix2(e){return WO(this,this,e),this.check()}}function Xv(){const t=new yn(3);return yn!=Float32Array&&(t[0]=0,t[1]=0,t[2]=0),t}function $v(t){const e=t[0],n=t[1],s=t[2];return Math.sqrt(e*e+n*n+s*s)}function b0(t,e,n){const s=new yn(3);return s[0]=t,s[1]=e,s[2]=n,s}function KO(t,e,n){return t[0]=e[0]-n[0],t[1]=e[1]-n[1],t[2]=e[2]-n[2],t}function YO(t){const e=t[0],n=t[1],s=t[2];return e*e+n*n+s*s}function JO(t,e){return t[0]=-e[0],t[1]=-e[1],t[2]=-e[2],t}function qO(t,e){const n=e[0],s=e[1],r=e[2];let i=n*n+s*s+r*r;return i>0&&(i=1/Math.sqrt(i)),t[0]=e[0]*i,t[1]=e[1]*i,t[2]=e[2]*i,t}function ym(t,e){return t[0]*e[0]+t[1]*e[1]+t[2]*e[2]}function Il(t,e,n){const s=e[0],r=e[1],i=e[2],o=n[0],a=n[1],c=n[2];return t[0]=r*c-i*a,t[1]=i*o-s*c,t[2]=s*a-r*o,t}function ZO(t,e,n,s){const r=e[0],i=e[1],o=e[2];return t[0]=r+s*(n[0]-r),t[1]=i+s*(n[1]-i),t[2]=o+s*(n[2]-o),t}function Am(t,e,n){const s=e[0],r=e[1],i=e[2];let o=n[3]*s+n[7]*r+n[11]*i+n[15];return o=o||1,t[0]=(n[0]*s+n[4]*r+n[8]*i+n[12])/o,t[1]=(n[1]*s+n[5]*r+n[9]*i+n[13])/o,t[2]=(n[2]*s+n[6]*r+n[10]*i+n[14])/o,t}function Kv(t,e,n){const s=e[0],r=e[1],i=e[2];return t[0]=s*n[0]+r*n[3]+i*n[6],t[1]=s*n[1]+r*n[4]+i*n[7],t[2]=s*n[2]+r*n[5]+i*n[8],t}function Yv(t,e,n){const s=n[0],r=n[1],i=n[2],o=n[3],a=e[0],c=e[1],l=e[2];let u=r*l-i*c,h=i*a-s*l,f=s*c-r*a,d=r*f-i*h,g=i*u-s*f,_=s*h-r*u;const E=o*2;return u*=E,h*=E,f*=E,d*=2,g*=2,_*=2,t[0]=a+u+d,t[1]=c+h+g,t[2]=l+f+_,t}function QO(t,e,n,s){const r=[],i=[];return r[0]=e[0]-n[0],r[1]=e[1]-n[1],r[2]=e[2]-n[2],i[0]=r[0],i[1]=r[1]*Math.cos(s)-r[2]*Math.sin(s),i[2]=r[1]*Math.sin(s)+r[2]*Math.cos(s),t[0]=i[0]+n[0],t[1]=i[1]+n[1],t[2]=i[2]+n[2],t}function eN(t,e,n,s){const r=[],i=[];return r[0]=e[0]-n[0],r[1]=e[1]-n[1],r[2]=e[2]-n[2],i[0]=r[2]*Math.sin(s)+r[0]*Math.cos(s),i[1]=r[1],i[2]=r[2]*Math.cos(s)-r[0]*Math.sin(s),t[0]=i[0]+n[0],t[1]=i[1]+n[1],t[2]=i[2]+n[2],t}function tN(t,e,n,s){const r=[],i=[];return r[0]=e[0]-n[0],r[1]=e[1]-n[1],r[2]=e[2]-n[2],i[0]=r[0]*Math.cos(s)-r[1]*Math.sin(s),i[1]=r[0]*Math.sin(s)+r[1]*Math.cos(s),i[2]=r[2],t[0]=i[0]+n[0],t[1]=i[1]+n[1],t[2]=i[2]+n[2],t}function nN(t,e){const n=t[0],s=t[1],r=t[2],i=e[0],o=e[1],a=e[2],c=Math.sqrt((n*n+s*s+r*r)*(i*i+o*o+a*a)),l=c&&ym(t,e)/c;return Math.acos(Math.min(Math.max(l,-1),1))}const Jv=KO,qv=$v,Kf=YO;(function(){const t=Xv();return function(e,n,s,r,i,o){let a,c;for(n||(n=3),s||(s=0),r?c=Math.min(r*n+s,e.length):c=e.length,a=s;a<c;a+=n)t[0]=e[a],t[1]=e[a+1],t[2]=e[a+2],i(t,t,o),e[a]=t[0],e[a+1]=t[1],e[a+2]=t[2];return e}})();const Yf=[0,0,0];let Lc;class x extends _m{static get ZERO(){return Lc||(Lc=new x(0,0,0),Object.freeze(Lc)),Lc}constructor(e=0,n=0,s=0){super(-0,-0,-0),arguments.length===1&&Hs(e)?this.copy(e):(Ue.debug&&(ie(e),ie(n),ie(s)),this[0]=e,this[1]=n,this[2]=s)}set(e,n,s){return this[0]=e,this[1]=n,this[2]=s,this.check()}copy(e){return this[0]=e[0],this[1]=e[1],this[2]=e[2],this.check()}fromObject(e){return Ue.debug&&(ie(e.x),ie(e.y),ie(e.z)),this[0]=e.x,this[1]=e.y,this[2]=e.z,this.check()}toObject(e){return e.x=this[0],e.y=this[1],e.z=this[2],e}get ELEMENTS(){return 3}get z(){return this[2]}set z(e){this[2]=ie(e)}angle(e){return nN(this,e)}cross(e){return Il(this,this,e),this.check()}rotateX({radians:e,origin:n=Yf}){return QO(this,this,n,e),this.check()}rotateY({radians:e,origin:n=Yf}){return eN(this,this,n,e),this.check()}rotateZ({radians:e,origin:n=Yf}){return tN(this,this,n,e),this.check()}transform(e){return this.transformAsPoint(e)}transformAsPoint(e){return Am(this,this,e),this.check()}transformAsVector(e){return Wv(this,this,e),this.check()}transformByMatrix3(e){return Kv(this,this,e),this.check()}transformByMatrix2(e){return XO(this,this,e),this.check()}transformByQuaternion(e){return Yv(this,this,e),this.check()}}let Uc;class Tm extends _m{static get ZERO(){return Uc||(Uc=new Tm(0,0,0,0),Object.freeze(Uc)),Uc}constructor(e=0,n=0,s=0,r=0){super(-0,-0,-0,-0),Hs(e)&&arguments.length===1?this.copy(e):(Ue.debug&&(ie(e),ie(n),ie(s),ie(r)),this[0]=e,this[1]=n,this[2]=s,this[3]=r)}set(e,n,s,r){return this[0]=e,this[1]=n,this[2]=s,this[3]=r,this.check()}copy(e){return this[0]=e[0],this[1]=e[1],this[2]=e[2],this[3]=e[3],this.check()}fromObject(e){return Ue.debug&&(ie(e.x),ie(e.y),ie(e.z),ie(e.w)),this[0]=e.x,this[1]=e.y,this[2]=e.z,this[3]=e.w,this}toObject(e){return e.x=this[0],e.y=this[1],e.z=this[2],e.w=this[3],e}get ELEMENTS(){return 4}get z(){return this[2]}set z(e){this[2]=ie(e)}get w(){return this[3]}set w(e){this[3]=ie(e)}transform(e){return Am(this,this,e),this.check()}transformByMatrix3(e){return Gv(this,this,e),this.check()}transformByMatrix2(e){return $O(this,this,e),this.check()}transformByQuaternion(e){return Yv(this,this,e),this.check()}applyMatrix4(e){return e.transform(this,this),this}}class Zv extends gm{toString(){let e="[";if(Ue.printRowMajor){e+="row-major:";for(let n=0;n<this.RANK;++n)for(let s=0;s<this.RANK;++s)e+=` ${this[s*this.RANK+n]}`}else{e+="column-major:";for(let n=0;n<this.ELEMENTS;++n)e+=` ${this[n]}`}return e+="]",e}getElementIndex(e,n){return n*this.RANK+e}getElement(e,n){return this[n*this.RANK+e]}setElement(e,n,s){return this[n*this.RANK+e]=ie(s),this}getColumn(e,n=new Array(this.RANK).fill(-0)){const s=e*this.RANK;for(let r=0;r<this.RANK;++r)n[r]=this[s+r];return n}setColumn(e,n){const s=e*this.RANK;for(let r=0;r<this.RANK;++r)this[s+r]=n[r];return this}}function sN(){const t=new yn(9);return yn!=Float32Array&&(t[1]=0,t[2]=0,t[3]=0,t[5]=0,t[6]=0,t[7]=0),t[0]=1,t[4]=1,t[8]=1,t}function rN(t,e){if(t===e){const n=e[1],s=e[2],r=e[5];t[1]=e[3],t[2]=e[6],t[3]=n,t[5]=e[7],t[6]=s,t[7]=r}else t[0]=e[0],t[1]=e[3],t[2]=e[6],t[3]=e[1],t[4]=e[4],t[5]=e[7],t[6]=e[2],t[7]=e[5],t[8]=e[8];return t}function iN(t,e){const n=e[0],s=e[1],r=e[2],i=e[3],o=e[4],a=e[5],c=e[6],l=e[7],u=e[8],h=u*o-a*l,f=-u*i+a*c,d=l*i-o*c;let g=n*h+s*f+r*d;return g?(g=1/g,t[0]=h*g,t[1]=(-u*s+r*l)*g,t[2]=(a*s-r*o)*g,t[3]=f*g,t[4]=(u*n-r*c)*g,t[5]=(-a*n+r*i)*g,t[6]=d*g,t[7]=(-l*n+s*c)*g,t[8]=(o*n-s*i)*g,t):null}function oN(t){const e=t[0],n=t[1],s=t[2],r=t[3],i=t[4],o=t[5],a=t[6],c=t[7],l=t[8];return e*(l*i-o*c)+n*(-l*r+o*a)+s*(c*r-i*a)}function R0(t,e,n){const s=e[0],r=e[1],i=e[2],o=e[3],a=e[4],c=e[5],l=e[6],u=e[7],h=e[8],f=n[0],d=n[1],g=n[2],_=n[3],E=n[4],m=n[5],y=n[6],A=n[7],C=n[8];return t[0]=f*s+d*o+g*l,t[1]=f*r+d*a+g*u,t[2]=f*i+d*c+g*h,t[3]=_*s+E*o+m*l,t[4]=_*r+E*a+m*u,t[5]=_*i+E*c+m*h,t[6]=y*s+A*o+C*l,t[7]=y*r+A*a+C*u,t[8]=y*i+A*c+C*h,t}function aN(t,e,n){const s=e[0],r=e[1],i=e[2],o=e[3],a=e[4],c=e[5],l=e[6],u=e[7],h=e[8],f=n[0],d=n[1];return t[0]=s,t[1]=r,t[2]=i,t[3]=o,t[4]=a,t[5]=c,t[6]=f*s+d*o+l,t[7]=f*r+d*a+u,t[8]=f*i+d*c+h,t}function cN(t,e,n){const s=e[0],r=e[1],i=e[2],o=e[3],a=e[4],c=e[5],l=e[6],u=e[7],h=e[8],f=Math.sin(n),d=Math.cos(n);return t[0]=d*s+f*o,t[1]=d*r+f*a,t[2]=d*i+f*c,t[3]=d*o-f*s,t[4]=d*a-f*r,t[5]=d*c-f*i,t[6]=l,t[7]=u,t[8]=h,t}function I0(t,e,n){const s=n[0],r=n[1];return t[0]=s*e[0],t[1]=s*e[1],t[2]=s*e[2],t[3]=r*e[3],t[4]=r*e[4],t[5]=r*e[5],t[6]=e[6],t[7]=e[7],t[8]=e[8],t}function lN(t,e){const n=e[0],s=e[1],r=e[2],i=e[3],o=n+n,a=s+s,c=r+r,l=n*o,u=s*o,h=s*a,f=r*o,d=r*a,g=r*c,_=i*o,E=i*a,m=i*c;return t[0]=1-h-g,t[3]=u-m,t[6]=f+E,t[1]=u+m,t[4]=1-l-g,t[7]=d-_,t[2]=f-E,t[5]=d+_,t[8]=1-l-h,t}var Qp;(function(t){t[t.COL0ROW0=0]="COL0ROW0",t[t.COL0ROW1=1]="COL0ROW1",t[t.COL0ROW2=2]="COL0ROW2",t[t.COL1ROW0=3]="COL1ROW0",t[t.COL1ROW1=4]="COL1ROW1",t[t.COL1ROW2=5]="COL1ROW2",t[t.COL2ROW0=6]="COL2ROW0",t[t.COL2ROW1=7]="COL2ROW1",t[t.COL2ROW2=8]="COL2ROW2"})(Qp||(Qp={}));const uN=Object.freeze([1,0,0,0,1,0,0,0,1]);class Ie extends Zv{static get IDENTITY(){return fN()}static get ZERO(){return hN()}get ELEMENTS(){return 9}get RANK(){return 3}get INDICES(){return Qp}constructor(e,...n){super(-0,-0,-0,-0,-0,-0,-0,-0,-0),arguments.length===1&&Array.isArray(e)?this.copy(e):n.length>0?this.copy([e,...n]):this.identity()}copy(e){return this[0]=e[0],this[1]=e[1],this[2]=e[2],this[3]=e[3],this[4]=e[4],this[5]=e[5],this[6]=e[6],this[7]=e[7],this[8]=e[8],this.check()}identity(){return this.copy(uN)}fromObject(e){return this.check()}fromQuaternion(e){return lN(this,e),this.check()}set(e,n,s,r,i,o,a,c,l){return this[0]=e,this[1]=n,this[2]=s,this[3]=r,this[4]=i,this[5]=o,this[6]=a,this[7]=c,this[8]=l,this.check()}setRowMajor(e,n,s,r,i,o,a,c,l){return this[0]=e,this[1]=r,this[2]=a,this[3]=n,this[4]=i,this[5]=c,this[6]=s,this[7]=o,this[8]=l,this.check()}determinant(){return oN(this)}transpose(){return rN(this,this),this.check()}invert(){return iN(this,this),this.check()}multiplyLeft(e){return R0(this,e,this),this.check()}multiplyRight(e){return R0(this,this,e),this.check()}rotate(e){return cN(this,this,e),this.check()}scale(e){return Array.isArray(e)?I0(this,this,e):I0(this,this,[e,e]),this.check()}translate(e){return aN(this,this,e),this.check()}transform(e,n){let s;switch(e.length){case 2:s=Vv(n||[-0,-0],e,this);break;case 3:s=Kv(n||[-0,-0,-0],e,this);break;case 4:s=Gv(n||[-0,-0,-0,-0],e,this);break;default:throw new Error("Illegal vector")}return oa(s,e.length),s}transformVector(e,n){return this.transform(e,n)}transformVector2(e,n){return this.transform(e,n)}transformVector3(e,n){return this.transform(e,n)}}let kc,zc=null;function hN(){return kc||(kc=new Ie([0,0,0,0,0,0,0,0,0]),Object.freeze(kc)),kc}function fN(){return zc||(zc=new Ie,Object.freeze(zc)),zc}function dN(t){return t[0]=1,t[1]=0,t[2]=0,t[3]=0,t[4]=0,t[5]=1,t[6]=0,t[7]=0,t[8]=0,t[9]=0,t[10]=1,t[11]=0,t[12]=0,t[13]=0,t[14]=0,t[15]=1,t}function pN(t,e){if(t===e){const n=e[1],s=e[2],r=e[3],i=e[6],o=e[7],a=e[11];t[1]=e[4],t[2]=e[8],t[3]=e[12],t[4]=n,t[6]=e[9],t[7]=e[13],t[8]=s,t[9]=i,t[11]=e[14],t[12]=r,t[13]=o,t[14]=a}else t[0]=e[0],t[1]=e[4],t[2]=e[8],t[3]=e[12],t[4]=e[1],t[5]=e[5],t[6]=e[9],t[7]=e[13],t[8]=e[2],t[9]=e[6],t[10]=e[10],t[11]=e[14],t[12]=e[3],t[13]=e[7],t[14]=e[11],t[15]=e[15];return t}function eg(t,e){const n=e[0],s=e[1],r=e[2],i=e[3],o=e[4],a=e[5],c=e[6],l=e[7],u=e[8],h=e[9],f=e[10],d=e[11],g=e[12],_=e[13],E=e[14],m=e[15],y=n*a-s*o,A=n*c-r*o,C=n*l-i*o,b=s*c-r*a,P=s*l-i*a,B=r*l-i*c,O=u*_-h*g,N=u*E-f*g,F=u*m-d*g,H=h*E-f*_,X=h*m-d*_,G=f*m-d*E;let $=y*G-A*X+C*H+b*F-P*N+B*O;return $?($=1/$,t[0]=(a*G-c*X+l*H)*$,t[1]=(r*X-s*G-i*H)*$,t[2]=(_*B-E*P+m*b)*$,t[3]=(f*P-h*B-d*b)*$,t[4]=(c*F-o*G-l*N)*$,t[5]=(n*G-r*F+i*N)*$,t[6]=(E*C-g*B-m*A)*$,t[7]=(u*B-f*C+d*A)*$,t[8]=(o*X-a*F+l*O)*$,t[9]=(s*F-n*X-i*O)*$,t[10]=(g*P-_*C+m*y)*$,t[11]=(h*C-u*P-d*y)*$,t[12]=(a*N-o*H-c*O)*$,t[13]=(n*H-s*N+r*O)*$,t[14]=(_*A-g*b-E*y)*$,t[15]=(u*b-h*A+f*y)*$,t):null}function gN(t){const e=t[0],n=t[1],s=t[2],r=t[3],i=t[4],o=t[5],a=t[6],c=t[7],l=t[8],u=t[9],h=t[10],f=t[11],d=t[12],g=t[13],_=t[14],E=t[15],m=e*o-n*i,y=e*a-s*i,A=n*a-s*o,C=l*g-u*d,b=l*_-h*d,P=u*_-h*g,B=e*P-n*b+s*C,O=i*P-o*b+a*C,N=l*A-u*y+h*m,F=d*A-g*y+_*m;return c*B-r*O+E*N-f*F}function vr(t,e,n){const s=e[0],r=e[1],i=e[2],o=e[3],a=e[4],c=e[5],l=e[6],u=e[7],h=e[8],f=e[9],d=e[10],g=e[11],_=e[12],E=e[13],m=e[14],y=e[15];let A=n[0],C=n[1],b=n[2],P=n[3];return t[0]=A*s+C*a+b*h+P*_,t[1]=A*r+C*c+b*f+P*E,t[2]=A*i+C*l+b*d+P*m,t[3]=A*o+C*u+b*g+P*y,A=n[4],C=n[5],b=n[6],P=n[7],t[4]=A*s+C*a+b*h+P*_,t[5]=A*r+C*c+b*f+P*E,t[6]=A*i+C*l+b*d+P*m,t[7]=A*o+C*u+b*g+P*y,A=n[8],C=n[9],b=n[10],P=n[11],t[8]=A*s+C*a+b*h+P*_,t[9]=A*r+C*c+b*f+P*E,t[10]=A*i+C*l+b*d+P*m,t[11]=A*o+C*u+b*g+P*y,A=n[12],C=n[13],b=n[14],P=n[15],t[12]=A*s+C*a+b*h+P*_,t[13]=A*r+C*c+b*f+P*E,t[14]=A*i+C*l+b*d+P*m,t[15]=A*o+C*u+b*g+P*y,t}function Eu(t,e,n){const s=n[0],r=n[1],i=n[2];let o,a,c,l,u,h,f,d,g,_,E,m;return e===t?(t[12]=e[0]*s+e[4]*r+e[8]*i+e[12],t[13]=e[1]*s+e[5]*r+e[9]*i+e[13],t[14]=e[2]*s+e[6]*r+e[10]*i+e[14],t[15]=e[3]*s+e[7]*r+e[11]*i+e[15]):(o=e[0],a=e[1],c=e[2],l=e[3],u=e[4],h=e[5],f=e[6],d=e[7],g=e[8],_=e[9],E=e[10],m=e[11],t[0]=o,t[1]=a,t[2]=c,t[3]=l,t[4]=u,t[5]=h,t[6]=f,t[7]=d,t[8]=g,t[9]=_,t[10]=E,t[11]=m,t[12]=o*s+u*r+g*i+e[12],t[13]=a*s+h*r+_*i+e[13],t[14]=c*s+f*r+E*i+e[14],t[15]=l*s+d*r+m*i+e[15]),t}function Em(t,e,n){const s=n[0],r=n[1],i=n[2];return t[0]=e[0]*s,t[1]=e[1]*s,t[2]=e[2]*s,t[3]=e[3]*s,t[4]=e[4]*r,t[5]=e[5]*r,t[6]=e[6]*r,t[7]=e[7]*r,t[8]=e[8]*i,t[9]=e[9]*i,t[10]=e[10]*i,t[11]=e[11]*i,t[12]=e[12],t[13]=e[13],t[14]=e[14],t[15]=e[15],t}function _N(t,e,n,s){let r=s[0],i=s[1],o=s[2],a=Math.sqrt(r*r+i*i+o*o),c,l,u,h,f,d,g,_,E,m,y,A,C,b,P,B,O,N,F,H,X,G,$,Te;return a<aa?null:(a=1/a,r*=a,i*=a,o*=a,l=Math.sin(n),c=Math.cos(n),u=1-c,h=e[0],f=e[1],d=e[2],g=e[3],_=e[4],E=e[5],m=e[6],y=e[7],A=e[8],C=e[9],b=e[10],P=e[11],B=r*r*u+c,O=i*r*u+o*l,N=o*r*u-i*l,F=r*i*u-o*l,H=i*i*u+c,X=o*i*u+r*l,G=r*o*u+i*l,$=i*o*u-r*l,Te=o*o*u+c,t[0]=h*B+_*O+A*N,t[1]=f*B+E*O+C*N,t[2]=d*B+m*O+b*N,t[3]=g*B+y*O+P*N,t[4]=h*F+_*H+A*X,t[5]=f*F+E*H+C*X,t[6]=d*F+m*H+b*X,t[7]=g*F+y*H+P*X,t[8]=h*G+_*$+A*Te,t[9]=f*G+E*$+C*Te,t[10]=d*G+m*$+b*Te,t[11]=g*G+y*$+P*Te,e!==t&&(t[12]=e[12],t[13]=e[13],t[14]=e[14],t[15]=e[15]),t)}function Qv(t,e,n){const s=Math.sin(n),r=Math.cos(n),i=e[4],o=e[5],a=e[6],c=e[7],l=e[8],u=e[9],h=e[10],f=e[11];return e!==t&&(t[0]=e[0],t[1]=e[1],t[2]=e[2],t[3]=e[3],t[12]=e[12],t[13]=e[13],t[14]=e[14],t[15]=e[15]),t[4]=i*r+l*s,t[5]=o*r+u*s,t[6]=a*r+h*s,t[7]=c*r+f*s,t[8]=l*r-i*s,t[9]=u*r-o*s,t[10]=h*r-a*s,t[11]=f*r-c*s,t}function mN(t,e,n){const s=Math.sin(n),r=Math.cos(n),i=e[0],o=e[1],a=e[2],c=e[3],l=e[8],u=e[9],h=e[10],f=e[11];return e!==t&&(t[4]=e[4],t[5]=e[5],t[6]=e[6],t[7]=e[7],t[12]=e[12],t[13]=e[13],t[14]=e[14],t[15]=e[15]),t[0]=i*r-l*s,t[1]=o*r-u*s,t[2]=a*r-h*s,t[3]=c*r-f*s,t[8]=i*s+l*r,t[9]=o*s+u*r,t[10]=a*s+h*r,t[11]=c*s+f*r,t}function ew(t,e,n){const s=Math.sin(n),r=Math.cos(n),i=e[0],o=e[1],a=e[2],c=e[3],l=e[4],u=e[5],h=e[6],f=e[7];return e!==t&&(t[8]=e[8],t[9]=e[9],t[10]=e[10],t[11]=e[11],t[12]=e[12],t[13]=e[13],t[14]=e[14],t[15]=e[15]),t[0]=i*r+l*s,t[1]=o*r+u*s,t[2]=a*r+h*s,t[3]=c*r+f*s,t[4]=l*r-i*s,t[5]=u*r-o*s,t[6]=h*r-a*s,t[7]=f*r-c*s,t}function yN(t,e){const n=e[0],s=e[1],r=e[2],i=e[4],o=e[5],a=e[6],c=e[8],l=e[9],u=e[10];return t[0]=Math.sqrt(n*n+s*s+r*r),t[1]=Math.sqrt(i*i+o*o+a*a),t[2]=Math.sqrt(c*c+l*l+u*u),t}function AN(t,e){const n=e[0],s=e[1],r=e[2],i=e[3],o=n+n,a=s+s,c=r+r,l=n*o,u=s*o,h=s*a,f=r*o,d=r*a,g=r*c,_=i*o,E=i*a,m=i*c;return t[0]=1-h-g,t[1]=u+m,t[2]=f-E,t[3]=0,t[4]=u-m,t[5]=1-l-g,t[6]=d+_,t[7]=0,t[8]=f+E,t[9]=d-_,t[10]=1-l-h,t[11]=0,t[12]=0,t[13]=0,t[14]=0,t[15]=1,t}function TN(t,e,n,s,r,i,o){const a=1/(n-e),c=1/(r-s),l=1/(i-o);return t[0]=i*2*a,t[1]=0,t[2]=0,t[3]=0,t[4]=0,t[5]=i*2*c,t[6]=0,t[7]=0,t[8]=(n+e)*a,t[9]=(r+s)*c,t[10]=(o+i)*l,t[11]=-1,t[12]=0,t[13]=0,t[14]=o*i*2*l,t[15]=0,t}function EN(t,e,n,s,r){const i=1/Math.tan(e/2);if(t[0]=i/n,t[1]=0,t[2]=0,t[3]=0,t[4]=0,t[5]=i,t[6]=0,t[7]=0,t[8]=0,t[9]=0,t[11]=-1,t[12]=0,t[13]=0,t[15]=0,r!=null&&r!==1/0){const o=1/(s-r);t[10]=(r+s)*o,t[14]=2*r*s*o}else t[10]=-1,t[14]=-2*s;return t}const SN=EN;function CN(t,e,n,s,r,i,o){const a=1/(e-n),c=1/(s-r),l=1/(i-o);return t[0]=-2*a,t[1]=0,t[2]=0,t[3]=0,t[4]=0,t[5]=-2*c,t[6]=0,t[7]=0,t[8]=0,t[9]=0,t[10]=2*l,t[11]=0,t[12]=(e+n)*a,t[13]=(r+s)*c,t[14]=(o+i)*l,t[15]=1,t}const vN=CN;function wN(t,e,n,s){let r,i,o,a,c,l,u,h,f,d;const g=e[0],_=e[1],E=e[2],m=s[0],y=s[1],A=s[2],C=n[0],b=n[1],P=n[2];return Math.abs(g-C)<aa&&Math.abs(_-b)<aa&&Math.abs(E-P)<aa?dN(t):(h=g-C,f=_-b,d=E-P,r=1/Math.sqrt(h*h+f*f+d*d),h*=r,f*=r,d*=r,i=y*d-A*f,o=A*h-m*d,a=m*f-y*h,r=Math.sqrt(i*i+o*o+a*a),r?(r=1/r,i*=r,o*=r,a*=r):(i=0,o=0,a=0),c=f*a-d*o,l=d*i-h*a,u=h*o-f*i,r=Math.sqrt(c*c+l*l+u*u),r?(r=1/r,c*=r,l*=r,u*=r):(c=0,l=0,u=0),t[0]=i,t[1]=c,t[2]=h,t[3]=0,t[4]=o,t[5]=l,t[6]=f,t[7]=0,t[8]=a,t[9]=u,t[10]=d,t[11]=0,t[12]=-(i*g+o*_+a*E),t[13]=-(c*g+l*_+u*E),t[14]=-(h*g+f*_+d*E),t[15]=1,t)}function bN(){const t=new yn(4);return yn!=Float32Array&&(t[0]=0,t[1]=0,t[2]=0,t[3]=0),t}function RN(t,e,n){return t[0]=e[0]+n[0],t[1]=e[1]+n[1],t[2]=e[2]+n[2],t[3]=e[3]+n[3],t}function Sm(t,e,n){return t[0]=e[0]*n,t[1]=e[1]*n,t[2]=e[2]*n,t[3]=e[3]*n,t}function IN(t){const e=t[0],n=t[1],s=t[2],r=t[3];return Math.sqrt(e*e+n*n+s*s+r*r)}function PN(t){const e=t[0],n=t[1],s=t[2],r=t[3];return e*e+n*n+s*s+r*r}function xN(t,e){const n=e[0],s=e[1],r=e[2],i=e[3];let o=n*n+s*s+r*r+i*i;return o>0&&(o=1/Math.sqrt(o)),t[0]=n*o,t[1]=s*o,t[2]=r*o,t[3]=i*o,t}function MN(t,e){return t[0]*e[0]+t[1]*e[1]+t[2]*e[2]+t[3]*e[3]}function BN(t,e,n,s){const r=e[0],i=e[1],o=e[2],a=e[3];return t[0]=r+s*(n[0]-r),t[1]=i+s*(n[1]-i),t[2]=o+s*(n[2]-o),t[3]=a+s*(n[3]-a),t}function ao(t,e,n){const s=e[0],r=e[1],i=e[2],o=e[3];return t[0]=n[0]*s+n[4]*r+n[8]*i+n[12]*o,t[1]=n[1]*s+n[5]*r+n[9]*i+n[13]*o,t[2]=n[2]*s+n[6]*r+n[10]*i+n[14]*o,t[3]=n[3]*s+n[7]*r+n[11]*i+n[15]*o,t}function ON(t,e,n){const s=e[0],r=e[1],i=e[2],o=n[0],a=n[1],c=n[2],l=n[3],u=l*s+a*i-c*r,h=l*r+c*s-o*i,f=l*i+o*r-a*s,d=-o*s-a*r-c*i;return t[0]=u*l+d*-o+h*-c-f*-a,t[1]=h*l+d*-a+f*-o-u*-c,t[2]=f*l+d*-c+u*-a-h*-o,t[3]=e[3],t}(function(){const t=bN();return function(e,n,s,r,i,o){let a,c;for(n||(n=4),s||(s=0),r?c=Math.min(r*n+s,e.length):c=e.length,a=s;a<c;a+=n)t[0]=e[a],t[1]=e[a+1],t[2]=e[a+2],t[3]=e[a+3],i(t,t,o),e[a]=t[0],e[a+1]=t[1],e[a+2]=t[2],e[a+3]=t[3];return e}})();var tg;(function(t){t[t.COL0ROW0=0]="COL0ROW0",t[t.COL0ROW1=1]="COL0ROW1",t[t.COL0ROW2=2]="COL0ROW2",t[t.COL0ROW3=3]="COL0ROW3",t[t.COL1ROW0=4]="COL1ROW0",t[t.COL1ROW1=5]="COL1ROW1",t[t.COL1ROW2=6]="COL1ROW2",t[t.COL1ROW3=7]="COL1ROW3",t[t.COL2ROW0=8]="COL2ROW0",t[t.COL2ROW1=9]="COL2ROW1",t[t.COL2ROW2=10]="COL2ROW2",t[t.COL2ROW3=11]="COL2ROW3",t[t.COL3ROW0=12]="COL3ROW0",t[t.COL3ROW1=13]="COL3ROW1",t[t.COL3ROW2=14]="COL3ROW2",t[t.COL3ROW3=15]="COL3ROW3"})(tg||(tg={}));const NN=45*Math.PI/180,FN=1,Jf=.1,qf=500,DN=Object.freeze([1,0,0,0,0,1,0,0,0,0,1,0,0,0,0,1]);class q extends Zv{static get IDENTITY(){return UN()}static get ZERO(){return LN()}get ELEMENTS(){return 16}get RANK(){return 4}get INDICES(){return tg}constructor(e){super(-0,-0,-0,-0,-0,-0,-0,-0,-0,-0,-0,-0,-0,-0,-0,-0),arguments.length===1&&Array.isArray(e)?this.copy(e):this.identity()}copy(e){return this[0]=e[0],this[1]=e[1],this[2]=e[2],this[3]=e[3],this[4]=e[4],this[5]=e[5],this[6]=e[6],this[7]=e[7],this[8]=e[8],this[9]=e[9],this[10]=e[10],this[11]=e[11],this[12]=e[12],this[13]=e[13],this[14]=e[14],this[15]=e[15],this.check()}set(e,n,s,r,i,o,a,c,l,u,h,f,d,g,_,E){return this[0]=e,this[1]=n,this[2]=s,this[3]=r,this[4]=i,this[5]=o,this[6]=a,this[7]=c,this[8]=l,this[9]=u,this[10]=h,this[11]=f,this[12]=d,this[13]=g,this[14]=_,this[15]=E,this.check()}setRowMajor(e,n,s,r,i,o,a,c,l,u,h,f,d,g,_,E){return this[0]=e,this[1]=i,this[2]=l,this[3]=d,this[4]=n,this[5]=o,this[6]=u,this[7]=g,this[8]=s,this[9]=a,this[10]=h,this[11]=_,this[12]=r,this[13]=c,this[14]=f,this[15]=E,this.check()}toRowMajor(e){return e[0]=this[0],e[1]=this[4],e[2]=this[8],e[3]=this[12],e[4]=this[1],e[5]=this[5],e[6]=this[9],e[7]=this[13],e[8]=this[2],e[9]=this[6],e[10]=this[10],e[11]=this[14],e[12]=this[3],e[13]=this[7],e[14]=this[11],e[15]=this[15],e}identity(){return this.copy(DN)}fromObject(e){return this.check()}fromQuaternion(e){return AN(this,e),this.check()}frustum(e){const{left:n,right:s,bottom:r,top:i,near:o=Jf,far:a=qf}=e;return a===1/0?kN(this,n,s,r,i,o):TN(this,n,s,r,i,o,a),this.check()}lookAt(e){const{eye:n,center:s=[0,0,0],up:r=[0,1,0]}=e;return wN(this,n,s,r),this.check()}ortho(e){const{left:n,right:s,bottom:r,top:i,near:o=Jf,far:a=qf}=e;return vN(this,n,s,r,i,o,a),this.check()}orthographic(e){const{fovy:n=NN,aspect:s=FN,focalDistance:r=1,near:i=Jf,far:o=qf}=e;P0(n);const a=n/2,c=r*Math.tan(a),l=c*s;return this.ortho({left:-l,right:l,bottom:-c,top:c,near:i,far:o})}perspective(e){const{fovy:n=45*Math.PI/180,aspect:s=1,near:r=.1,far:i=500}=e;return P0(n),SN(this,n,s,r,i),this.check()}determinant(){return gN(this)}getScale(e=[-0,-0,-0]){return e[0]=Math.sqrt(this[0]*this[0]+this[1]*this[1]+this[2]*this[2]),e[1]=Math.sqrt(this[4]*this[4]+this[5]*this[5]+this[6]*this[6]),e[2]=Math.sqrt(this[8]*this[8]+this[9]*this[9]+this[10]*this[10]),e}getTranslation(e=[-0,-0,-0]){return e[0]=this[12],e[1]=this[13],e[2]=this[14],e}getRotation(e,n){e=e||[-0,-0,-0,-0,-0,-0,-0,-0,-0,-0,-0,-0,-0,-0,-0,-0],n=n||[-0,-0,-0];const s=this.getScale(n),r=1/s[0],i=1/s[1],o=1/s[2];return e[0]=this[0]*r,e[1]=this[1]*i,e[2]=this[2]*o,e[3]=0,e[4]=this[4]*r,e[5]=this[5]*i,e[6]=this[6]*o,e[7]=0,e[8]=this[8]*r,e[9]=this[9]*i,e[10]=this[10]*o,e[11]=0,e[12]=0,e[13]=0,e[14]=0,e[15]=1,e}getRotationMatrix3(e,n){e=e||[-0,-0,-0,-0,-0,-0,-0,-0,-0],n=n||[-0,-0,-0];const s=this.getScale(n),r=1/s[0],i=1/s[1],o=1/s[2];return e[0]=this[0]*r,e[1]=this[1]*i,e[2]=this[2]*o,e[3]=this[4]*r,e[4]=this[5]*i,e[5]=this[6]*o,e[6]=this[8]*r,e[7]=this[9]*i,e[8]=this[10]*o,e}transpose(){return pN(this,this),this.check()}invert(){return eg(this,this),this.check()}multiplyLeft(e){return vr(this,e,this),this.check()}multiplyRight(e){return vr(this,this,e),this.check()}rotateX(e){return Qv(this,this,e),this.check()}rotateY(e){return mN(this,this,e),this.check()}rotateZ(e){return ew(this,this,e),this.check()}rotateXYZ(e){return this.rotateX(e[0]).rotateY(e[1]).rotateZ(e[2])}rotateAxis(e,n){return _N(this,this,e,n),this.check()}scale(e){return Em(this,this,Array.isArray(e)?e:[e,e,e]),this.check()}translate(e){return Eu(this,this,e),this.check()}transform(e,n){return e.length===4?(n=ao(n||[-0,-0,-0,-0],e,this),oa(n,4),n):this.transformAsPoint(e,n)}transformAsPoint(e,n){const{length:s}=e;let r;switch(s){case 2:r=Hv(n||[-0,-0],e,this);break;case 3:r=Am(n||[-0,-0,-0],e,this);break;default:throw new Error("Illegal vector")}return oa(r,e.length),r}transformAsVector(e,n){let s;switch(e.length){case 2:s=jv(n||[-0,-0],e,this);break;case 3:s=Wv(n||[-0,-0,-0],e,this);break;default:throw new Error("Illegal vector")}return oa(s,e.length),s}transformPoint(e,n){return this.transformAsPoint(e,n)}transformVector(e,n){return this.transformAsPoint(e,n)}transformDirection(e,n){return this.transformAsVector(e,n)}makeRotationX(e){return this.identity().rotateX(e)}makeTranslation(e,n,s){return this.identity().translate([e,n,s])}}let Vc,Hc;function LN(){return Vc||(Vc=new q([0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0]),Object.freeze(Vc)),Vc}function UN(){return Hc||(Hc=new q,Object.freeze(Hc)),Hc}function P0(t){if(t>Math.PI*2)throw Error("expected radians")}function kN(t,e,n,s,r,i){const o=2*i/(n-e),a=2*i/(r-s),c=(n+e)/(n-e),l=(r+s)/(r-s),u=-1,h=-1,f=-2*i;return t[0]=o,t[1]=0,t[2]=0,t[3]=0,t[4]=0,t[5]=a,t[6]=0,t[7]=0,t[8]=c,t[9]=l,t[10]=u,t[11]=h,t[12]=0,t[13]=0,t[14]=f,t[15]=0,t}function x0(){const t=new yn(4);return yn!=Float32Array&&(t[0]=0,t[1]=0,t[2]=0),t[3]=1,t}function zN(t){return t[0]=0,t[1]=0,t[2]=0,t[3]=1,t}function tw(t,e,n){n=n*.5;const s=Math.sin(n);return t[0]=s*e[0],t[1]=s*e[1],t[2]=s*e[2],t[3]=Math.cos(n),t}function M0(t,e,n){const s=e[0],r=e[1],i=e[2],o=e[3],a=n[0],c=n[1],l=n[2],u=n[3];return t[0]=s*u+o*a+r*l-i*c,t[1]=r*u+o*c+i*a-s*l,t[2]=i*u+o*l+s*c-r*a,t[3]=o*u-s*a-r*c-i*l,t}function VN(t,e,n){n*=.5;const s=e[0],r=e[1],i=e[2],o=e[3],a=Math.sin(n),c=Math.cos(n);return t[0]=s*c+o*a,t[1]=r*c+i*a,t[2]=i*c-r*a,t[3]=o*c-s*a,t}function HN(t,e,n){n*=.5;const s=e[0],r=e[1],i=e[2],o=e[3],a=Math.sin(n),c=Math.cos(n);return t[0]=s*c-i*a,t[1]=r*c+o*a,t[2]=i*c+s*a,t[3]=o*c-r*a,t}function jN(t,e,n){n*=.5;const s=e[0],r=e[1],i=e[2],o=e[3],a=Math.sin(n),c=Math.cos(n);return t[0]=s*c+r*a,t[1]=r*c-s*a,t[2]=i*c+o*a,t[3]=o*c-i*a,t}function WN(t,e){const n=e[0],s=e[1],r=e[2];return t[0]=n,t[1]=s,t[2]=r,t[3]=Math.sqrt(Math.abs(1-n*n-s*s-r*r)),t}function Pl(t,e,n,s){const r=e[0],i=e[1],o=e[2],a=e[3];let c=n[0],l=n[1],u=n[2],h=n[3],f,d,g,_,E;return f=r*c+i*l+o*u+a*h,f<0&&(f=-f,c=-c,l=-l,u=-u,h=-h),1-f>aa?(d=Math.acos(f),E=Math.sin(d),g=Math.sin((1-s)*d)/E,_=Math.sin(s*d)/E):(g=1-s,_=s),t[0]=g*r+_*c,t[1]=g*i+_*l,t[2]=g*o+_*u,t[3]=g*a+_*h,t}function GN(t,e){const n=e[0],s=e[1],r=e[2],i=e[3],o=n*n+s*s+r*r+i*i,a=o?1/o:0;return t[0]=-n*a,t[1]=-s*a,t[2]=-r*a,t[3]=i*a,t}function XN(t,e){return t[0]=-e[0],t[1]=-e[1],t[2]=-e[2],t[3]=e[3],t}function nw(t,e){const n=e[0]+e[4]+e[8];let s;if(n>0)s=Math.sqrt(n+1),t[3]=.5*s,s=.5/s,t[0]=(e[5]-e[7])*s,t[1]=(e[6]-e[2])*s,t[2]=(e[1]-e[3])*s;else{let r=0;e[4]>e[0]&&(r=1),e[8]>e[r*3+r]&&(r=2);const i=(r+1)%3,o=(r+2)%3;s=Math.sqrt(e[r*3+r]-e[i*3+i]-e[o*3+o]+1),t[r]=.5*s,s=.5/s,t[3]=(e[i*3+o]-e[o*3+i])*s,t[i]=(e[i*3+r]+e[r*3+i])*s,t[o]=(e[o*3+r]+e[r*3+o])*s}return t}const $N=RN,KN=Sm,YN=MN,JN=BN,qN=IN,ZN=PN,sw=xN,QN=function(){const t=Xv(),e=b0(1,0,0),n=b0(0,1,0);return function(s,r,i){const o=ym(r,i);return o<-.999999?(Il(t,e,r),qv(t)<1e-6&&Il(t,n,r),qO(t,t),tw(s,t,Math.PI),s):o>.999999?(s[0]=0,s[1]=0,s[2]=0,s[3]=1,s):(Il(t,r,i),s[0]=t[0],s[1]=t[1],s[2]=t[2],s[3]=1+o,sw(s,s))}}();(function(){const t=x0(),e=x0();return function(n,s,r,i,o,a){return Pl(t,s,o,a),Pl(e,r,i,a),Pl(n,t,e,2*a*(1-a)),n}})();(function(){const t=sN();return function(e,n,s,r){return t[0]=s[0],t[3]=s[1],t[6]=s[2],t[1]=r[0],t[4]=r[1],t[7]=r[2],t[2]=-n[0],t[5]=-n[1],t[8]=-n[2],sw(e,nw(e,t))}})();const eF=[0,0,0,1];class Fa extends gm{constructor(e=0,n=0,s=0,r=1){super(-0,-0,-0,-0),Array.isArray(e)&&arguments.length===1?this.copy(e):this.set(e,n,s,r)}copy(e){return this[0]=e[0],this[1]=e[1],this[2]=e[2],this[3]=e[3],this.check()}set(e,n,s,r){return this[0]=e,this[1]=n,this[2]=s,this[3]=r,this.check()}fromObject(e){return this[0]=e.x,this[1]=e.y,this[2]=e.z,this[3]=e.w,this.check()}fromMatrix3(e){return nw(this,e),this.check()}fromAxisRotation(e,n){return tw(this,e,n),this.check()}identity(){return zN(this),this.check()}setAxisAngle(e,n){return this.fromAxisRotation(e,n)}get ELEMENTS(){return 4}get x(){return this[0]}set x(e){this[0]=ie(e)}get y(){return this[1]}set y(e){this[1]=ie(e)}get z(){return this[2]}set z(e){this[2]=ie(e)}get w(){return this[3]}set w(e){this[3]=ie(e)}len(){return qN(this)}lengthSquared(){return ZN(this)}dot(e){return YN(this,e)}rotationTo(e,n){return QN(this,e,n),this.check()}add(e){return $N(this,this,e),this.check()}calculateW(){return WN(this,this),this.check()}conjugate(){return XN(this,this),this.check()}invert(){return GN(this,this),this.check()}lerp(e,n,s){return s===void 0?this.lerp(this,e,n):(JN(this,e,n,s),this.check())}multiplyRight(e){return M0(this,this,e),this.check()}multiplyLeft(e){return M0(this,e,this),this.check()}normalize(){const e=this.len(),n=e>0?1/e:0;return this[0]=this[0]*n,this[1]=this[1]*n,this[2]=this[2]*n,this[3]=this[3]*n,e===0&&(this[3]=1),this.check()}rotateX(e){return VN(this,this,e),this.check()}rotateY(e){return HN(this,this,e),this.check()}rotateZ(e){return jN(this,this,e),this.check()}scale(e){return KN(this,this,e),this.check()}slerp(e,n,s){let r,i,o;switch(arguments.length){case 1:({start:r=eF,target:i,ratio:o}=e);break;case 2:r=this,i=e,o=n;break;default:r=e,i=n,o=s}return Pl(this,r,i,o),this.check()}transformVector4(e,n=new Tm){return ON(n,e,this),oa(n,4)}lengthSq(){return this.lengthSquared()}setFromAxisAngle(e,n){return this.setAxisAngle(e,n)}premultiply(e){return this.multiplyLeft(e)}multiply(e){return this.multiplyRight(e)}}const tF=.1,nF=1e-12,rw=1e-15,sF=1e-20,B0=`#if (defined(SHADER_TYPE_FRAGMENT) && defined(LIGHTING_FRAGMENT)) || (defined(SHADER_TYPE_VERTEX) && defined(LIGHTING_VERTEX))
struct AmbientLight {
vec3 color;
};
struct PointLight {
vec3 color;
vec3 position;
vec3 attenuation;
};
struct DirectionalLight {
vec3 color;
vec3 direction;
};
uniform AmbientLight lighting_uAmbientLight;
uniform PointLight lighting_uPointLight[MAX_LIGHTS];
uniform DirectionalLight lighting_uDirectionalLight[MAX_LIGHTS];
uniform int lighting_uPointLightCount;
uniform int lighting_uDirectionalLightCount;
uniform bool lighting_uEnabled;
float getPointLightAttenuation(PointLight pointLight, float distance) {
return pointLight.attenuation.x
+ pointLight.attenuation.y * distance
+ pointLight.attenuation.z * distance * distance;
}
#endif
`,rF={lightSources:{}};function Zf(t={}){const{color:e=[0,0,0],intensity:n=1}=t;return e.map(s=>s*n/255)}function iF({ambientLight:t,pointLights:e=[],directionalLights:n=[]}){const s={};return t?s["lighting_uAmbientLight.color"]=Zf(t):s["lighting_uAmbientLight.color"]=[0,0,0],e.forEach((r,i)=>{s[`lighting_uPointLight[${i}].color`]=Zf(r),s[`lighting_uPointLight[${i}].position`]=r.position,s[`lighting_uPointLight[${i}].attenuation`]=r.attenuation||[1,0,0]}),s.lighting_uPointLightCount=e.length,n.forEach((r,i)=>{s[`lighting_uDirectionalLight[${i}].color`]=Zf(r),s[`lighting_uDirectionalLight[${i}].direction`]=r.direction}),s.lighting_uDirectionalLightCount=n.length,s}function iw(t=rF){var e,n;if("lightSources"in t){const{ambientLight:s,pointLights:r,directionalLights:i}=t.lightSources||{};return s||r&&r.length>0||i&&i.length>0?Object.assign({},iF({ambientLight:s,pointLights:r,directionalLights:i}),{lighting_uEnabled:!0}):{lighting_uEnabled:!1}}if("lights"in t){const s={pointLights:[],directionalLights:[]};for(const r of t.lights||[])switch(r.type){case"ambient":s.ambientLight=r;break;case"directional":(e=s.directionalLights)==null||e.push(r);break;case"point":(n=s.pointLights)==null||n.push(r);break}return iw({lightSources:s})}return{}}const Cm={name:"lights",vs:B0,fs:B0,getUniforms:iw,defines:{MAX_LIGHTS:3}},ow=`uniform float lighting_uAmbient;
uniform float lighting_uDiffuse;
uniform float lighting_uShininess;
uniform vec3  lighting_uSpecularColor;
vec3 lighting_getLightColor(vec3 surfaceColor, vec3 light_direction, vec3 view_direction, vec3 normal_worldspace, vec3 color) {
vec3 halfway_direction = normalize(light_direction + view_direction);
float lambertian = dot(light_direction, normal_worldspace);
float specular = 0.0;
if (lambertian > 0.0) {
float specular_angle = max(dot(normal_worldspace, halfway_direction), 0.0);
specular = pow(specular_angle, lighting_uShininess);
}
lambertian = max(lambertian, 0.0);
return (lambertian * lighting_uDiffuse * surfaceColor + specular * lighting_uSpecularColor) * color;
}
vec3 lighting_getLightColor(vec3 surfaceColor, vec3 cameraPosition, vec3 position_worldspace, vec3 normal_worldspace) {
vec3 lightColor = surfaceColor;
if (lighting_uEnabled) {
vec3 view_direction = normalize(cameraPosition - position_worldspace);
lightColor = lighting_uAmbient * surfaceColor * lighting_uAmbientLight.color;
for (int i = 0; i < MAX_LIGHTS; i++) {
if (i >= lighting_uPointLightCount) {
break;
}
PointLight pointLight = lighting_uPointLight[i];
vec3 light_position_worldspace = pointLight.position;
vec3 light_direction = normalize(light_position_worldspace - position_worldspace);
lightColor += lighting_getLightColor(surfaceColor, light_direction, view_direction, normal_worldspace, pointLight.color);
}
for (int i = 0; i < MAX_LIGHTS; i++) {
if (i >= lighting_uDirectionalLightCount) {
break;
}
DirectionalLight directionalLight = lighting_uDirectionalLight[i];
lightColor += lighting_getLightColor(surfaceColor, -directionalLight.direction, view_direction, normal_worldspace, directionalLight.color);
}
}
return lightColor;
}
vec3 lighting_getSpecularLightColor(vec3 cameraPosition, vec3 position_worldspace, vec3 normal_worldspace) {
vec3 lightColor = vec3(0, 0, 0);
vec3 surfaceColor = vec3(0, 0, 0);
if (lighting_uEnabled) {
vec3 view_direction = normalize(cameraPosition - position_worldspace);
for (int i = 0; i < MAX_LIGHTS; i++) {
if (i >= lighting_uPointLightCount) {
break;
}
PointLight pointLight = lighting_uPointLight[i];
vec3 light_position_worldspace = pointLight.position;
vec3 light_direction = normalize(light_position_worldspace - position_worldspace);
lightColor += lighting_getLightColor(surfaceColor, light_direction, view_direction, normal_worldspace, pointLight.color);
}
for (int i = 0; i < MAX_LIGHTS; i++) {
if (i >= lighting_uDirectionalLightCount) {
break;
}
DirectionalLight directionalLight = lighting_uDirectionalLight[i];
lightColor += lighting_getLightColor(surfaceColor, -directionalLight.direction, view_direction, normal_worldspace, directionalLight.color);
}
}
return lightColor;
}
`,oF={};function aF(t){const{ambient:e=.35,diffuse:n=.6,shininess:s=32,specularColor:r=[30,30,30]}=t;return{lighting_uAmbient:e,lighting_uDiffuse:n,lighting_uShininess:s,lighting_uSpecularColor:r.map(i=>i/255)}}function aw(t=oF){if(!("material"in t))return{};const{material:e}=t;return e?aF(e):{lighting_uEnabled:!1}}const cw={name:"gouraud-lighting",dependencies:[Cm],vs:ow,defines:{LIGHTING_VERTEX:1},getUniforms:aw},cF={name:"phong-lighting",dependencies:[Cm],fs:ow,defines:{LIGHTING_FRAGMENT:1},getUniforms:aw},lF=`uniform mat4 u_MVPMatrix;
uniform mat4 u_ModelMatrix;
uniform mat4 u_NormalMatrix;
out vec3 pbr_vPosition;
out vec2 pbr_vUV;
#ifdef HAS_NORMALS
# ifdef HAS_TANGENTS
out mat3 pbr_vTBN;
# else
out vec3 pbr_vNormal;
# endif
#endif
void pbr_setPositionNormalTangentUV(vec4 position, vec4 normal, vec4 tangent, vec2 uv)
{
vec4 pos = u_ModelMatrix * position;
pbr_vPosition = vec3(pos.xyz) / pos.w;
#ifdef HAS_NORMALS
#ifdef HAS_TANGENTS
vec3 normalW = normalize(vec3(u_NormalMatrix * vec4(normal.xyz, 0.0)));
vec3 tangentW = normalize(vec3(u_ModelMatrix * vec4(tangent.xyz, 0.0)));
vec3 bitangentW = cross(normalW, tangentW) * tangent.w;
pbr_vTBN = mat3(tangentW, bitangentW, normalW);
#else
pbr_vNormal = normalize(vec3(u_ModelMatrix * vec4(normal.xyz, 0.0)));
#endif
#endif
#ifdef HAS_UV
pbr_vUV = uv;
#else
pbr_vUV = vec2(0.,0.);
#endif
}
`,uF=`precision highp float;
uniform bool pbr_uUnlit;
#ifdef USE_IBL
uniform samplerCube u_DiffuseEnvSampler;
uniform samplerCube u_SpecularEnvSampler;
uniform sampler2D u_brdfLUT;
uniform vec2 u_ScaleIBLAmbient;
#endif
#ifdef HAS_BASECOLORMAP
uniform sampler2D u_BaseColorSampler;
#endif
#ifdef HAS_NORMALMAP
uniform sampler2D u_NormalSampler;
uniform float u_NormalScale;
#endif
#ifdef HAS_EMISSIVEMAP
uniform sampler2D u_EmissiveSampler;
uniform vec3 u_EmissiveFactor;
#endif
#ifdef HAS_METALROUGHNESSMAP
uniform sampler2D u_MetallicRoughnessSampler;
#endif
#ifdef HAS_OCCLUSIONMAP
uniform sampler2D u_OcclusionSampler;
uniform float u_OcclusionStrength;
#endif
#ifdef ALPHA_CUTOFF
uniform float u_AlphaCutoff;
#endif
uniform vec2 u_MetallicRoughnessValues;
uniform vec4 u_BaseColorFactor;
uniform vec3 u_Camera;
#ifdef PBR_DEBUG
uniform vec4 u_ScaleDiffBaseMR;
uniform vec4 u_ScaleFGDSpec;
#endif
in vec3 pbr_vPosition;
in vec2 pbr_vUV;
#ifdef HAS_NORMALS
#ifdef HAS_TANGENTS
in mat3 pbr_vTBN;
#else
in vec3 pbr_vNormal;
#endif
#endif
struct PBRInfo
{
float NdotL;
float NdotV;
float NdotH;
float LdotH;
float VdotH;
float perceptualRoughness;
float metalness;
vec3 reflectance0;
vec3 reflectance90;
float alphaRoughness;
vec3 diffuseColor;
vec3 specularColor;
vec3 n;
vec3 v;
};
const float M_PI = 3.141592653589793;
const float c_MinRoughness = 0.04;
vec4 SRGBtoLINEAR(vec4 srgbIn)
{
#ifdef MANUAL_SRGB
#ifdef SRGB_FAST_APPROXIMATION
vec3 linOut = pow(srgbIn.xyz,vec3(2.2));
#else
vec3 bLess = step(vec3(0.04045),srgbIn.xyz);
vec3 linOut = mix( srgbIn.xyz/vec3(12.92), pow((srgbIn.xyz+vec3(0.055))/vec3(1.055),vec3(2.4)), bLess );
#endif
return vec4(linOut,srgbIn.w);;
#else
return srgbIn;
#endif
}
vec3 getNormal()
{
#ifndef HAS_TANGENTS
vec3 pos_dx = dFdx(pbr_vPosition);
vec3 pos_dy = dFdy(pbr_vPosition);
vec3 tex_dx = dFdx(vec3(pbr_vUV, 0.0));
vec3 tex_dy = dFdy(vec3(pbr_vUV, 0.0));
vec3 t = (tex_dy.t * pos_dx - tex_dx.t * pos_dy) / (tex_dx.s * tex_dy.t - tex_dy.s * tex_dx.t);
#ifdef HAS_NORMALS
vec3 ng = normalize(pbr_vNormal);
#else
vec3 ng = cross(pos_dx, pos_dy);
#endif
t = normalize(t - ng * dot(ng, t));
vec3 b = normalize(cross(ng, t));
mat3 tbn = mat3(t, b, ng);
#else
mat3 tbn = pbr_vTBN;
#endif
#ifdef HAS_NORMALMAP
vec3 n = texture(u_NormalSampler, pbr_vUV).rgb;
n = normalize(tbn * ((2.0 * n - 1.0) * vec3(u_NormalScale, u_NormalScale, 1.0)));
#else
vec3 n = normalize(tbn[2].xyz);
#endif
return n;
}
#ifdef USE_IBL
vec3 getIBLContribution(PBRInfo pbrInputs, vec3 n, vec3 reflection)
{
float mipCount = 9.0;
float lod = (pbrInputs.perceptualRoughness * mipCount);
vec3 brdf = SRGBtoLINEAR(texture(u_brdfLUT,
vec2(pbrInputs.NdotV, 1.0 - pbrInputs.perceptualRoughness))).rgb;
vec3 diffuseLight = SRGBtoLINEAR(textureCube(u_DiffuseEnvSampler, n)).rgb;
#ifdef USE_TEX_LOD
vec3 specularLight = SRGBtoLINEAR(textureCubeLod(u_SpecularEnvSampler, reflection, lod)).rgb;
#else
vec3 specularLight = SRGBtoLINEAR(textureCube(u_SpecularEnvSampler, reflection)).rgb;
#endif
vec3 diffuse = diffuseLight * pbrInputs.diffuseColor;
vec3 specular = specularLight * (pbrInputs.specularColor * brdf.x + brdf.y);
diffuse *= u_ScaleIBLAmbient.x;
specular *= u_ScaleIBLAmbient.y;
return diffuse + specular;
}
#endif
vec3 diffuse(PBRInfo pbrInputs)
{
return pbrInputs.diffuseColor / M_PI;
}
vec3 specularReflection(PBRInfo pbrInputs)
{
return pbrInputs.reflectance0 +
(pbrInputs.reflectance90 - pbrInputs.reflectance0) *
pow(clamp(1.0 - pbrInputs.VdotH, 0.0, 1.0), 5.0);
}
float geometricOcclusion(PBRInfo pbrInputs)
{
float NdotL = pbrInputs.NdotL;
float NdotV = pbrInputs.NdotV;
float r = pbrInputs.alphaRoughness;
float attenuationL = 2.0 * NdotL / (NdotL + sqrt(r * r + (1.0 - r * r) * (NdotL * NdotL)));
float attenuationV = 2.0 * NdotV / (NdotV + sqrt(r * r + (1.0 - r * r) * (NdotV * NdotV)));
return attenuationL * attenuationV;
}
float microfacetDistribution(PBRInfo pbrInputs)
{
float roughnessSq = pbrInputs.alphaRoughness * pbrInputs.alphaRoughness;
float f = (pbrInputs.NdotH * roughnessSq - pbrInputs.NdotH) * pbrInputs.NdotH + 1.0;
return roughnessSq / (M_PI * f * f);
}
void PBRInfo_setAmbientLight(inout PBRInfo pbrInputs) {
pbrInputs.NdotL = 1.0;
pbrInputs.NdotH = 0.0;
pbrInputs.LdotH = 0.0;
pbrInputs.VdotH = 1.0;
}
void PBRInfo_setDirectionalLight(inout PBRInfo pbrInputs, vec3 lightDirection) {
vec3 n = pbrInputs.n;
vec3 v = pbrInputs.v;
vec3 l = normalize(lightDirection);
vec3 h = normalize(l+v);
pbrInputs.NdotL = clamp(dot(n, l), 0.001, 1.0);
pbrInputs.NdotH = clamp(dot(n, h), 0.0, 1.0);
pbrInputs.LdotH = clamp(dot(l, h), 0.0, 1.0);
pbrInputs.VdotH = clamp(dot(v, h), 0.0, 1.0);
}
void PBRInfo_setPointLight(inout PBRInfo pbrInputs, PointLight pointLight) {
vec3 light_direction = normalize(pointLight.position - pbr_vPosition);
PBRInfo_setDirectionalLight(pbrInputs, light_direction);
}
vec3 calculateFinalColor(PBRInfo pbrInputs, vec3 lightColor) {
vec3 F = specularReflection(pbrInputs);
float G = geometricOcclusion(pbrInputs);
float D = microfacetDistribution(pbrInputs);
vec3 diffuseContrib = (1.0 - F) * diffuse(pbrInputs);
vec3 specContrib = F * G * D / (4.0 * pbrInputs.NdotL * pbrInputs.NdotV);
return pbrInputs.NdotL * lightColor * (diffuseContrib + specContrib);
}
vec4 pbr_filterColor(vec4 colorUnused)
{
#ifdef HAS_BASECOLORMAP
vec4 baseColor = SRGBtoLINEAR(texture(u_BaseColorSampler, pbr_vUV)) * u_BaseColorFactor;
#else
vec4 baseColor = u_BaseColorFactor;
#endif
#ifdef ALPHA_CUTOFF
if (baseColor.a < u_AlphaCutoff) {
discard;
}
#endif
vec3 color = vec3(0, 0, 0);
if(pbr_uUnlit){
color.rgb = baseColor.rgb;
}
else{
float perceptualRoughness = u_MetallicRoughnessValues.y;
float metallic = u_MetallicRoughnessValues.x;
#ifdef HAS_METALROUGHNESSMAP
vec4 mrSample = texture(u_MetallicRoughnessSampler, pbr_vUV);
perceptualRoughness = mrSample.g * perceptualRoughness;
metallic = mrSample.b * metallic;
#endif
perceptualRoughness = clamp(perceptualRoughness, c_MinRoughness, 1.0);
metallic = clamp(metallic, 0.0, 1.0);
float alphaRoughness = perceptualRoughness * perceptualRoughness;
vec3 f0 = vec3(0.04);
vec3 diffuseColor = baseColor.rgb * (vec3(1.0) - f0);
diffuseColor *= 1.0 - metallic;
vec3 specularColor = mix(f0, baseColor.rgb, metallic);
float reflectance = max(max(specularColor.r, specularColor.g), specularColor.b);
float reflectance90 = clamp(reflectance * 25.0, 0.0, 1.0);
vec3 specularEnvironmentR0 = specularColor.rgb;
vec3 specularEnvironmentR90 = vec3(1.0, 1.0, 1.0) * reflectance90;
vec3 n = getNormal();
vec3 v = normalize(u_Camera - pbr_vPosition);
float NdotV = clamp(abs(dot(n, v)), 0.001, 1.0);
vec3 reflection = -normalize(reflect(v, n));
PBRInfo pbrInputs = PBRInfo(
0.0,
NdotV,
0.0,
0.0,
0.0,
perceptualRoughness,
metallic,
specularEnvironmentR0,
specularEnvironmentR90,
alphaRoughness,
diffuseColor,
specularColor,
n,
v
);
#ifdef USE_LIGHTS
PBRInfo_setAmbientLight(pbrInputs);
color += calculateFinalColor(pbrInputs, lighting_uAmbientLight.color);
for(int i = 0; i < lighting_uDirectionalLightCount; i++) {
if (i < lighting_uDirectionalLightCount) {
PBRInfo_setDirectionalLight(pbrInputs, lighting_uDirectionalLight[i].direction);
color += calculateFinalColor(pbrInputs, lighting_uDirectionalLight[i].color);
}
}
for(int i = 0; i < lighting_uPointLightCount; i++) {
if (i < lighting_uPointLightCount) {
PBRInfo_setPointLight(pbrInputs, lighting_uPointLight[i]);
float attenuation = getPointLightAttenuation(lighting_uPointLight[i], distance(lighting_uPointLight[i].position, pbr_vPosition));
color += calculateFinalColor(pbrInputs, lighting_uPointLight[i].color / attenuation);
}
}
#endif
#ifdef USE_IBL
color += getIBLContribution(pbrInputs, n, reflection);
#endif
#ifdef HAS_OCCLUSIONMAP
float ao = texture(u_OcclusionSampler, pbr_vUV).r;
color = mix(color, color * ao, u_OcclusionStrength);
#endif
#ifdef HAS_EMISSIVEMAP
vec3 emissive = SRGBtoLINEAR(texture(u_EmissiveSampler, pbr_vUV)).rgb * u_EmissiveFactor;
color += emissive;
#endif
#ifdef PBR_DEBUG
color = mix(color, baseColor.rgb, u_ScaleDiffBaseMR.y);
color = mix(color, vec3(metallic), u_ScaleDiffBaseMR.z);
color = mix(color, vec3(perceptualRoughness), u_ScaleDiffBaseMR.w);
#endif
}
return vec4(pow(color,vec3(1.0/2.2)), baseColor.a);
}
`,vm={name:"pbr",vs:lF,fs:uF,defines:{LIGHTING_FRAGMENT:1},dependencies:[Cm]},lw="#define SMOOTH_EDGE_RADIUS 0.5",hF=`
${lw}

struct VertexGeometry {
  vec4 position;
  vec3 worldPosition;
  vec3 worldPositionAlt;
  vec3 normal;
  vec2 uv;
  vec3 pickingColor;
} geometry = VertexGeometry(
  vec4(0.0, 0.0, 1.0, 0.0),
  vec3(0.0),
  vec3(0.0),
  vec3(0.0),
  vec2(0.0),
  vec3(0.0)
);
`,fF=`
${lw}

struct FragmentGeometry {
  vec2 uv;
} geometry;

float smoothedge(float edge, float x) {
  return smoothstep(edge - SMOOTH_EDGE_RADIUS, edge + SMOOTH_EDGE_RADIUS, x);
}
`,dF={name:"geometry",vs:hF,fs:fF},Z={DEFAULT:-1,LNGLAT:1,METER_OFFSETS:2,LNGLAT_OFFSETS:3,CARTESIAN:0};Object.defineProperty(Z,"IDENTITY",{get:()=>(J.deprecated("COORDINATE_SYSTEM.IDENTITY","COORDINATE_SYSTEM.CARTESIAN")(),0)});const ln={WEB_MERCATOR:1,GLOBE:2,WEB_MERCATOR_AUTO_OFFSET:4,IDENTITY:0},js={common:0,meters:1,pixels:2},ng={click:{handler:"onClick"},panstart:{handler:"onDragStart"},panmove:{handler:"onDrag"},panend:{handler:"onDragEnd"}},pF=Object.keys(Z).map(t=>`const int COORDINATE_SYSTEM_${t} = ${Z[t]};`).join(""),gF=Object.keys(ln).map(t=>`const int PROJECTION_MODE_${t} = ${ln[t]};`).join(""),_F=Object.keys(js).map(t=>`const int UNIT_${t.toUpperCase()} = ${js[t]};`).join(""),mF=`${pF}
${gF}
${_F}
uniform int project_uCoordinateSystem;
uniform int project_uProjectionMode;
uniform float project_uScale;
uniform bool project_uWrapLongitude;
uniform vec3 project_uCommonUnitsPerMeter;
uniform vec3 project_uCommonUnitsPerWorldUnit;
uniform vec3 project_uCommonUnitsPerWorldUnit2;
uniform vec4 project_uCenter;
uniform mat4 project_uModelMatrix;
uniform mat4 project_uViewProjectionMatrix;
uniform vec2 project_uViewportSize;
uniform float project_uDevicePixelRatio;
uniform float project_uFocalDistance;
uniform vec3 project_uCameraPosition;
uniform vec3 project_uCoordinateOrigin;
uniform vec3 project_uCommonOrigin;
uniform bool project_uPseudoMeters;
const float TILE_SIZE = 512.0;
const float PI = 3.1415926536;
const float WORLD_SCALE = TILE_SIZE / (PI * 2.0);
const vec3 ZERO_64_LOW = vec3(0.0);
const float EARTH_RADIUS = 6370972.0;
const float GLOBE_RADIUS = 256.0;
float project_size_at_latitude(float lat) {
float y = clamp(lat, -89.9, 89.9);
return 1.0 / cos(radians(y));
}
float project_size() {
if (project_uProjectionMode == PROJECTION_MODE_WEB_MERCATOR &&
project_uCoordinateSystem == COORDINATE_SYSTEM_LNGLAT &&
project_uPseudoMeters == false) {
if (geometry.position.w == 0.0) {
return project_size_at_latitude(geometry.worldPosition.y);
}
float y = geometry.position.y / TILE_SIZE * 2.0 - 1.0;
float y2 = y * y;
float y4 = y2 * y2;
float y6 = y4 * y2;
return 1.0 + 4.9348 * y2 + 4.0587 * y4 + 1.5642 * y6;
}
return 1.0;
}
float project_size_at_latitude(float meters, float lat) {
return meters * project_uCommonUnitsPerMeter.z * project_size_at_latitude(lat);
}
float project_size(float meters) {
return meters * project_uCommonUnitsPerMeter.z * project_size();
}
vec2 project_size(vec2 meters) {
return meters * project_uCommonUnitsPerMeter.xy * project_size();
}
vec3 project_size(vec3 meters) {
return meters * project_uCommonUnitsPerMeter * project_size();
}
vec4 project_size(vec4 meters) {
return vec4(meters.xyz * project_uCommonUnitsPerMeter, meters.w);
}
mat3 project_get_orientation_matrix(vec3 up) {
vec3 uz = normalize(up);
vec3 ux = abs(uz.z) == 1.0 ? vec3(1.0, 0.0, 0.0) : normalize(vec3(uz.y, -uz.x, 0));
vec3 uy = cross(uz, ux);
return mat3(ux, uy, uz);
}
bool project_needs_rotation(vec3 commonPosition, out mat3 transform) {
if (project_uProjectionMode == PROJECTION_MODE_GLOBE) {
transform = project_get_orientation_matrix(commonPosition);
return true;
}
return false;
}
vec3 project_normal(vec3 vector) {
vec4 normal_modelspace = project_uModelMatrix * vec4(vector, 0.0);
vec3 n = normalize(normal_modelspace.xyz * project_uCommonUnitsPerMeter);
mat3 rotation;
if (project_needs_rotation(geometry.position.xyz, rotation)) {
n = rotation * n;
}
return n;
}
vec4 project_offset_(vec4 offset) {
float dy = offset.y;
vec3 commonUnitsPerWorldUnit = project_uCommonUnitsPerWorldUnit + project_uCommonUnitsPerWorldUnit2 * dy;
return vec4(offset.xyz * commonUnitsPerWorldUnit, offset.w);
}
vec2 project_mercator_(vec2 lnglat) {
float x = lnglat.x;
if (project_uWrapLongitude) {
x = mod(x + 180., 360.0) - 180.;
}
float y = clamp(lnglat.y, -89.9, 89.9);
return vec2(
radians(x) + PI,
PI + log(tan_fp32(PI * 0.25 + radians(y) * 0.5))
) * WORLD_SCALE;
}
vec3 project_globe_(vec3 lnglatz) {
float lambda = radians(lnglatz.x);
float phi = radians(lnglatz.y);
float cosPhi = cos(phi);
float D = (lnglatz.z / EARTH_RADIUS + 1.0) * GLOBE_RADIUS;
return vec3(
sin(lambda) * cosPhi,
-cos(lambda) * cosPhi,
sin(phi)
) * D;
}
vec4 project_position(vec4 position, vec3 position64Low) {
vec4 position_world = project_uModelMatrix * position;
if (project_uProjectionMode == PROJECTION_MODE_WEB_MERCATOR) {
if (project_uCoordinateSystem == COORDINATE_SYSTEM_LNGLAT) {
return vec4(
project_mercator_(position_world.xy),
project_size_at_latitude(position_world.z, position_world.y),
position_world.w
);
}
if (project_uCoordinateSystem == COORDINATE_SYSTEM_CARTESIAN) {
position_world.xyz += project_uCoordinateOrigin;
}
}
if (project_uProjectionMode == PROJECTION_MODE_GLOBE) {
if (project_uCoordinateSystem == COORDINATE_SYSTEM_LNGLAT) {
return vec4(
project_globe_(position_world.xyz),
position_world.w
);
}
}
if (project_uProjectionMode == PROJECTION_MODE_WEB_MERCATOR_AUTO_OFFSET) {
if (project_uCoordinateSystem == COORDINATE_SYSTEM_LNGLAT) {
if (abs(position_world.y - project_uCoordinateOrigin.y) > 0.25) {
return vec4(
project_mercator_(position_world.xy) - project_uCommonOrigin.xy,
project_size(position_world.z),
position_world.w
);
}
}
}
if (project_uProjectionMode == PROJECTION_MODE_IDENTITY ||
(project_uProjectionMode == PROJECTION_MODE_WEB_MERCATOR_AUTO_OFFSET &&
(project_uCoordinateSystem == COORDINATE_SYSTEM_LNGLAT ||
project_uCoordinateSystem == COORDINATE_SYSTEM_CARTESIAN))) {
position_world.xyz -= project_uCoordinateOrigin;
}
return project_offset_(position_world) + project_offset_(project_uModelMatrix * vec4(position64Low, 0.0));
}
vec4 project_position(vec4 position) {
return project_position(position, ZERO_64_LOW);
}
vec3 project_position(vec3 position, vec3 position64Low) {
vec4 projected_position = project_position(vec4(position, 1.0), position64Low);
return projected_position.xyz;
}
vec3 project_position(vec3 position) {
vec4 projected_position = project_position(vec4(position, 1.0), ZERO_64_LOW);
return projected_position.xyz;
}
vec2 project_position(vec2 position) {
vec4 projected_position = project_position(vec4(position, 0.0, 1.0), ZERO_64_LOW);
return projected_position.xy;
}
vec4 project_common_position_to_clipspace(vec4 position, mat4 viewProjectionMatrix, vec4 center) {
return viewProjectionMatrix * position + center;
}
vec4 project_common_position_to_clipspace(vec4 position) {
return project_common_position_to_clipspace(position, project_uViewProjectionMatrix, project_uCenter);
}
vec2 project_pixel_size_to_clipspace(vec2 pixels) {
vec2 offset = pixels / project_uViewportSize * project_uDevicePixelRatio * 2.0;
return offset * project_uFocalDistance;
}
float project_size_to_pixel(float meters) {
return project_size(meters) * project_uScale;
}
float project_size_to_pixel(float size, int unit) {
if (unit == UNIT_METERS) return project_size_to_pixel(size);
if (unit == UNIT_COMMON) return size * project_uScale;
return size;
}
float project_pixel_size(float pixels) {
return pixels / project_uScale;
}
vec2 project_pixel_size(vec2 pixels) {
return pixels / project_uScale;
}
`;function yF(t,e){if(t===e)return!0;if(Array.isArray(t)){const n=t.length;if(!e||e.length!==n)return!1;for(let s=0;s<n;s++)if(t[s]!==e[s])return!1;return!0}return!1}function ec(t){let e={},n;return s=>{for(const r in s)if(!yF(s[r],e[r])){n=t(s),e=s;break}return n}}const O0=[0,0,0,0],AF=[1,0,0,0,0,1,0,0,0,0,1,0,0,0,0,0],uw=[1,0,0,0,0,1,0,0,0,0,1,0,0,0,0,1],TF=[0,0,0],hw=[0,0,0],EF=ec(vF);function fw(t,e,n=hw){n.length<3&&(n=[n[0],n[1],0]);let s=n,r,i=!0;switch(e===Z.LNGLAT_OFFSETS||e===Z.METER_OFFSETS?r=n:r=t.isGeospatial?[Math.fround(t.longitude),Math.fround(t.latitude),0]:null,t.projectionMode){case ln.WEB_MERCATOR:(e===Z.LNGLAT||e===Z.CARTESIAN)&&(r=[0,0,0],i=!1);break;case ln.WEB_MERCATOR_AUTO_OFFSET:e===Z.LNGLAT?s=r:e===Z.CARTESIAN&&(s=[Math.fround(t.center[0]),Math.fround(t.center[1]),0],r=t.unprojectPosition(s),s[0]-=n[0],s[1]-=n[1],s[2]-=n[2]);break;case ln.IDENTITY:s=t.position.map(Math.fround),s[2]=s[2]||0;break;case ln.GLOBE:i=!1,r=null;break;default:i=!1}return{geospatialOrigin:r,shaderCoordinateOrigin:s,offsetMode:i}}function SF(t,e,n){const{viewMatrixUncentered:s,projectionMatrix:r}=t;let{viewMatrix:i,viewProjectionMatrix:o}=t,a=O0,c=O0,l=t.cameraPosition;const{geospatialOrigin:u,shaderCoordinateOrigin:h,offsetMode:f}=fw(t,e,n);return f&&(c=t.projectPosition(u||h),l=[l[0]-c[0],l[1]-c[1],l[2]-c[2]],c[3]=1,a=ao([],c,o),i=s||i,o=vr([],r,i),o=vr([],o,AF)),{viewMatrix:i,viewProjectionMatrix:o,projectionCenter:a,originCommon:c,cameraPosCommon:l,shaderCoordinateOrigin:h,geospatialOrigin:u}}function CF({viewport:t,devicePixelRatio:e=1,modelMatrix:n=null,coordinateSystem:s=Z.DEFAULT,coordinateOrigin:r=hw,autoWrapLongitude:i=!1}){s===Z.DEFAULT&&(s=t.isGeospatial?Z.LNGLAT:Z.CARTESIAN);const o=EF({viewport:t,devicePixelRatio:e,coordinateSystem:s,coordinateOrigin:r});return o.project_uWrapLongitude=i,o.project_uModelMatrix=n||uw,o}function vF({viewport:t,devicePixelRatio:e,coordinateSystem:n,coordinateOrigin:s}){const{projectionCenter:r,viewProjectionMatrix:i,originCommon:o,cameraPosCommon:a,shaderCoordinateOrigin:c,geospatialOrigin:l}=SF(t,n,s),u=t.getDistanceScales(),h=[t.width*e,t.height*e],f=ao([],[0,0,-t.focalDistance,1],t.projectionMatrix)[3]||1,d={project_uCoordinateSystem:n,project_uProjectionMode:t.projectionMode,project_uCoordinateOrigin:c,project_uCommonOrigin:o.slice(0,3),project_uCenter:r,project_uPseudoMeters:!!t._pseudoMeters,project_uViewportSize:h,project_uDevicePixelRatio:e,project_uFocalDistance:f,project_uCommonUnitsPerMeter:u.unitsPerMeter,project_uCommonUnitsPerWorldUnit:u.unitsPerMeter,project_uCommonUnitsPerWorldUnit2:TF,project_uScale:t.scale,project_uWrapLongitude:!1,project_uViewProjectionMatrix:i,project_uModelMatrix:uw,project_uCameraPosition:a};if(l){const g=t.getDistanceScales(l);switch(n){case Z.METER_OFFSETS:d.project_uCommonUnitsPerWorldUnit=g.unitsPerMeter,d.project_uCommonUnitsPerWorldUnit2=g.unitsPerMeter2;break;case Z.LNGLAT:case Z.LNGLAT_OFFSETS:t._pseudoMeters||(d.project_uCommonUnitsPerMeter=g.unitsPerMeter),d.project_uCommonUnitsPerWorldUnit=g.unitsPerDegree,d.project_uCommonUnitsPerWorldUnit2=g.unitsPerDegree2;break;case Z.CARTESIAN:d.project_uCommonUnitsPerWorldUnit=[1,1,g.unitsPerMeter[2]],d.project_uCommonUnitsPerWorldUnit2=[0,0,g.unitsPerMeter2[2]];break}}return d}const wF={};function bF(t=wF){return"viewport"in t?CF(t):{}}const wm={name:"project",dependencies:[RO,dF],vs:mF,getUniforms:bF},RF=`
vec4 project_position_to_clipspace(
  vec3 position, vec3 position64Low, vec3 offset, out vec4 commonPosition
) {
  vec3 projectedPosition = project_position(position, position64Low);
  mat3 rotation;
  if (project_needs_rotation(projectedPosition, rotation)) {
    // offset is specified as ENU
    // when in globe projection, rotate offset so that the ground alighs with the surface of the globe
    offset = rotation * offset;
  }
  commonPosition = vec4(projectedPosition + offset, 1.0);
  return project_common_position_to_clipspace(commonPosition);
}

vec4 project_position_to_clipspace(
  vec3 position, vec3 position64Low, vec3 offset
) {
  vec4 commonPosition;
  return project_position_to_clipspace(position, position64Low, offset, commonPosition);
}
`,qs={name:"project32",dependencies:[wm],vs:RF};function IF(){return[1,0,0,0,0,1,0,0,0,0,1,0,0,0,0,1]}function Oi(t,e){const n=ao([],e,t);return Sm(n,n,1/n[3]),n}function N0(t,e){const n=t%e;return n<0?e+n:n}function sg(t,e,n){return t<e?e:t>n?n:t}function PF(t){return Math.log(t)*Math.LOG2E}const bm=Math.log2||PF;function as(t,e){if(!t)throw new Error(e||"@math.gl/web-mercator: assertion failed.")}const un=Math.PI,dw=un/4,$t=un/180,rg=180/un,Xi=512,Su=4003e4,jc=85.051129,xF=1.5;function MF(t){return bm(t)}function $i(t){const[e,n]=t;as(Number.isFinite(e)),as(Number.isFinite(n)&&n>=-90&&n<=90,"invalid latitude");const s=e*$t,r=n*$t,i=Xi*(s+un)/(2*un),o=Xi*(un+Math.log(Math.tan(dw+r*.5)))/(2*un);return[i,o]}function Ki(t){const[e,n]=t,s=e/Xi*(2*un)-un,r=2*(Math.atan(Math.exp(n/Xi*(2*un)-un))-dw);return[s*rg,r*rg]}function BF(t){const{latitude:e}=t;as(Number.isFinite(e));const n=Math.cos(e*$t);return MF(Su*n)-9}function Qf(t){const e=Math.cos(t*$t);return Xi/Su/e}function ig(t){const{latitude:e,longitude:n,highPrecision:s=!1}=t;as(Number.isFinite(e)&&Number.isFinite(n));const r=Xi,i=Math.cos(e*$t),o=r/360,a=o/i,c=r/Su/i,l={unitsPerMeter:[c,c,c],metersPerUnit:[1/c,1/c,1/c],unitsPerDegree:[o,a,c],degreesPerUnit:[1/o,1/a,1/c]};if(s){const u=$t*Math.tan(e*$t)/i,h=o*u/2,f=r/Su*u,d=f/a*c;l.unitsPerDegree2=[0,h,f],l.unitsPerMeter2=[d,0,d]}return l}function pw(t,e){const[n,s,r]=t,[i,o,a]=e,{unitsPerMeter:c,unitsPerMeter2:l}=ig({longitude:n,latitude:s,highPrecision:!0}),u=$i(t);u[0]+=i*(c[0]+l[0]*o),u[1]+=o*(c[1]+l[1]*o);const h=Ki(u),f=(r||0)+(a||0);return Number.isFinite(r)||Number.isFinite(a)?[h[0],h[1],f]:h}function OF(t){const{height:e,pitch:n,bearing:s,altitude:r,scale:i,center:o}=t,a=IF();Eu(a,a,[0,0,-r]),Qv(a,a,-n*$t),ew(a,a,s*$t);const c=i/e;return Em(a,a,[c,c,c]),o&&Eu(a,a,JO([],o)),a}function NF(t){const{width:e,height:n,altitude:s,pitch:r=0,offset:i,center:o,scale:a,nearZMultiplier:c=1,farZMultiplier:l=1}=t;let{fovy:u=Cu(xF)}=t;s!==void 0&&(u=Cu(s));const h=u*$t,f=r*$t,d=gw(u);let g=d;o&&(g+=o[2]*a/Math.cos(f)/n);const _=h*(.5+(i?i[1]:0)/n),E=Math.sin(_)*g/Math.sin(sg(Math.PI/2-f-_,.01,Math.PI-.01)),m=Math.sin(f)*E+g,y=g*10,A=Math.min(m*l,y);return{fov:h,aspect:e/n,focalDistance:d,near:c,far:A}}function Cu(t){return 2*Math.atan(.5/t)*rg}function gw(t){return .5/Math.tan(.5*t*$t)}function _w(t,e){const[n,s,r=0]=t;return as(Number.isFinite(n)&&Number.isFinite(s)&&Number.isFinite(r)),Oi(e,[n,s,r,1])}function Rm(t,e,n=0){const[s,r,i]=t;if(as(Number.isFinite(s)&&Number.isFinite(r),"invalid pixel coordinate"),Number.isFinite(i))return Oi(e,[s,r,i,1]);const o=Oi(e,[s,r,0,1]),a=Oi(e,[s,r,1,1]),c=o[2],l=a[2],u=c===l?0:((n||0)-c)/(l-c);return zv([],o,a,u)}function FF(t){const{width:e,height:n,bounds:s,minExtent:r=0,maxZoom:i=24,offset:o=[0,0]}=t,[[a,c],[l,u]]=s,h=DF(t.padding),f=$i([a,sg(u,-jc,jc)]),d=$i([l,sg(c,-jc,jc)]),g=[Math.max(Math.abs(d[0]-f[0]),r),Math.max(Math.abs(d[1]-f[1]),r)],_=[e-h.left-h.right-Math.abs(o[0])*2,n-h.top-h.bottom-Math.abs(o[1])*2];as(_[0]>0&&_[1]>0);const E=_[0]/g[0],m=_[1]/g[1],y=(h.right-h.left)/2/E,A=(h.top-h.bottom)/2/m,C=[(d[0]+f[0])/2+y,(d[1]+f[1])/2+A],b=Ki(C),P=Math.min(i,bm(Math.abs(Math.min(E,m))));return as(Number.isFinite(P)),{longitude:b[0],latitude:b[1],zoom:P}}function DF(t=0){return typeof t=="number"?{top:t,bottom:t,left:t,right:t}:(as(Number.isFinite(t.top)&&Number.isFinite(t.bottom)&&Number.isFinite(t.left)&&Number.isFinite(t.right)),t)}const F0=Math.PI/180;function LF(t,e=0){const{width:n,height:s,unproject:r}=t,i={targetZ:e},o=r([0,s],i),a=r([n,s],i);let c,l;const u=t.fovy?.5*t.fovy*F0:Math.atan(.5/t.altitude),h=(90-t.pitch)*F0;return u>h-.01?(c=D0(t,0,e),l=D0(t,n,e)):(c=r([0,0],i),l=r([n,0],i)),[o,a,l,c]}function D0(t,e,n){const{pixelUnprojectionMatrix:s}=t,r=Oi(s,[e,0,1,1]),i=Oi(s,[e,t.height,1,1]),a=(n*t.distanceScales.unitsPerMeter[2]-r[2])/(i[2]-r[2]),c=zv([],r,i,a),l=Ki(c);return l.push(n),l}const L0=512;function UF(t){const{width:e,height:n,pitch:s=0}=t;let{longitude:r,latitude:i,zoom:o,bearing:a=0}=t;(r<-180||r>180)&&(r=N0(r+180,360)-180),(a<-180||a>180)&&(a=N0(a+180,360)-180);const c=bm(n/L0);if(o<=c)o=c,i=0;else{const l=n/2/Math.pow(2,o),u=Ki([0,l])[1];if(i<u)i=u;else{const h=Ki([0,L0-l])[1];i>h&&(i=h)}}return{width:e,height:n,longitude:r,latitude:i,zoom:o,pitch:s,bearing:a}}const kF=`
const int max_lights = 2;
uniform mat4 shadow_uViewProjectionMatrices[max_lights];
uniform vec4 shadow_uProjectCenters[max_lights];
uniform bool shadow_uDrawShadowMap;
uniform bool shadow_uUseShadowMap;
uniform int shadow_uLightId;
uniform float shadow_uLightCount;

out vec3 shadow_vPosition[max_lights];

vec4 shadow_setVertexPosition(vec4 position_commonspace) {
  if (shadow_uDrawShadowMap) {
    return project_common_position_to_clipspace(position_commonspace, shadow_uViewProjectionMatrices[shadow_uLightId], shadow_uProjectCenters[shadow_uLightId]);
  }
  if (shadow_uUseShadowMap) {
    for (int i = 0; i < max_lights; i++) {
      if(i < int(shadow_uLightCount)) {
        vec4 shadowMap_position = project_common_position_to_clipspace(position_commonspace, shadow_uViewProjectionMatrices[i], shadow_uProjectCenters[i]);
        shadow_vPosition[i] = (shadowMap_position.xyz / shadowMap_position.w + 1.0) / 2.0;
      }
    }
  }
  return gl_Position;
}
`,zF=`
const int max_lights = 2;
uniform bool shadow_uDrawShadowMap;
uniform bool shadow_uUseShadowMap;
uniform sampler2D shadow_uShadowMap0;
uniform sampler2D shadow_uShadowMap1;
uniform vec4 shadow_uColor;
uniform float shadow_uLightCount;

in vec3 shadow_vPosition[max_lights];

const vec4 bitPackShift = vec4(1.0, 255.0, 65025.0, 16581375.0);
const vec4 bitUnpackShift = 1.0 / bitPackShift;
const vec4 bitMask = vec4(1.0 / 255.0, 1.0 / 255.0, 1.0 / 255.0,  0.0);

float shadow_getShadowWeight(vec3 position, sampler2D shadowMap) {
  vec4 rgbaDepth = texture(shadowMap, position.xy);

  float z = dot(rgbaDepth, bitUnpackShift);
  return smoothstep(0.001, 0.01, position.z - z);
}

vec4 shadow_filterShadowColor(vec4 color) {
  if (shadow_uDrawShadowMap) {
    vec4 rgbaDepth = fract(gl_FragCoord.z * bitPackShift);
    rgbaDepth -= rgbaDepth.gbaa * bitMask;
    return rgbaDepth;
  }
  if (shadow_uUseShadowMap) {
    float shadowAlpha = 0.0;
    shadowAlpha += shadow_getShadowWeight(shadow_vPosition[0], shadow_uShadowMap0);
    if(shadow_uLightCount > 1.0) {
      shadowAlpha += shadow_getShadowWeight(shadow_vPosition[1], shadow_uShadowMap1);
    }
    shadowAlpha *= shadow_uColor.a / shadow_uLightCount;
    float blendedAlpha = shadowAlpha + color.a * (1.0 - shadowAlpha);

    return vec4(
      mix(color.rgb, shadow_uColor.rgb, shadowAlpha / blendedAlpha),
      blendedAlpha
    );
  }
  return color;
}
`,VF=ec(XF),HF=ec($F),jF=[0,0,0,1],WF=[1,0,0,0,0,1,0,0,0,0,1,0,0,0,0,0];function GF(t,e){const[n,s,r]=t,i=Rm([n,s,r],e);return Number.isFinite(r)?i:[i[0],i[1],0]}function XF({viewport:t,center:e}){return new q(t.viewProjectionMatrix).invert().transform(e)}function $F({viewport:t,shadowMatrices:e}){const n=[],s=t.pixelUnprojectionMatrix,r=t.isGeospatial?void 0:1,i=[[0,0,r],[t.width,0,r],[0,t.height,r],[t.width,t.height,r],[0,0,-1],[t.width,0,-1],[0,t.height,-1],[t.width,t.height,-1]].map(o=>GF(o,s));for(const o of e){const a=o.clone().translate(new x(t.center).negate()),c=i.map(u=>a.transform(u)),l=new q().ortho({left:Math.min(...c.map(u=>u[0])),right:Math.max(...c.map(u=>u[0])),bottom:Math.min(...c.map(u=>u[1])),top:Math.max(...c.map(u=>u[1])),near:Math.min(...c.map(u=>-u[2])),far:Math.max(...c.map(u=>-u[2]))});n.push(l.multiplyRight(o))}return n}function KF(t,e){const{shadowEnabled:n=!0}=t;if(!n||!t.shadowMatrices||!t.shadowMatrices.length)return{shadow_uDrawShadowMap:!1,shadow_uUseShadowMap:!1,shadow_uShadowMap0:t.dummyShadowMap,shadow_uShadowMap1:t.dummyShadowMap};const s={shadow_uDrawShadowMap:!!t.drawToShadowMap,shadow_uUseShadowMap:t.shadowMaps?t.shadowMaps.length>0:!1,shadow_uColor:t.shadowColor||jF,shadow_uLightId:t.shadowLightId||0,shadow_uLightCount:t.shadowMatrices.length},r=VF({viewport:t.viewport,center:e.project_uCenter}),i=[],o=HF({shadowMatrices:t.shadowMatrices,viewport:t.viewport}).slice();for(let a=0;a<t.shadowMatrices.length;a++){const c=o[a],l=c.clone().translate(new x(t.viewport.center).negate());e.project_uCoordinateSystem===Z.LNGLAT&&e.project_uProjectionMode===ln.WEB_MERCATOR?(o[a]=l,i[a]=r):(o[a]=c.clone().multiplyRight(WF),i[a]=l.transform(r))}for(let a=0;a<o.length;a++)s[`shadow_uViewProjectionMatrices[${a}]`]=o[a],s[`shadow_uProjectCenters[${a}]`]=i[a];for(let a=0;a<2;a++)s[`shadow_uShadowMap${a}`]=t.shadowMaps&&t.shadowMaps[a]||t.dummyShadowMap;return s}const U0={name:"shadow",dependencies:[wm],vs:kF,fs:zF,inject:{"vs:DECKGL_FILTER_GL_POSITION":`
    position = shadow_setVertexPosition(geometry.position);
    `,"fs:DECKGL_FILTER_COLOR":`
    color = shadow_filterShadowColor(color);
    `},getUniforms:(t={},e={})=>"viewport"in t&&(t.drawToShadowMap||t.shadowMaps&&t.shadowMaps.length>0)?KF(t,e):{}},Zs={...v0,defaultUniforms:{...v0.defaultUniforms,useFloatColors:!1},inject:{"vs:DECKGL_FILTER_GL_POSITION":`
    // for picking depth values
    picking_setPickingAttribute(position.z / position.w);
  `,"vs:DECKGL_FILTER_COLOR":`
  picking_setPickingColor(geometry.pickingColor);
  `,"fs:DECKGL_FILTER_COLOR":{order:99,injection:`
  // use highlight color if this fragment belongs to the selected object.
  color = picking_filterHighlightColor(color);

  // use picking color if rendering to picking FBO.
  color = picking_filterPickingColor(color);
    `}}},YF=[wm],JF=["vs:DECKGL_FILTER_SIZE(inout vec3 size, VertexGeometry geometry)","vs:DECKGL_FILTER_GL_POSITION(inout vec4 position, VertexGeometry geometry)","vs:DECKGL_FILTER_COLOR(inout vec4 color, VertexGeometry geometry)","fs:DECKGL_FILTER_COLOR(inout vec4 color, FragmentGeometry geometry)"];function qF(){const t=du.getDefaultShaderAssembler();for(const e of YF)t.addDefaultModule(e);for(const e of JF)t.addShaderHook(e);return t}const ZF=[255,255,255],QF=1;let eD=0;class tD{constructor(e={}){this.type="ambient";const{color:n=ZF}=e,{intensity:s=QF}=e;this.id=e.id||`ambient-${eD++}`,this.color=n,this.intensity=s}}const nD=[255,255,255],sD=1,rD=[0,0,-1];let iD=0;class k0{constructor(e={}){this.type="directional";const{color:n=nD}=e,{intensity:s=sD}=e,{direction:r=rD}=e,{_shadow:i=!1}=e;this.id=e.id||`directional-${iD++}`,this.color=n,this.intensity=s,this.type="directional",this.direction=new x(r).normalize().toArray(),this.shadow=i}getProjectedLight(e){return this}}class oD{constructor(e,n={id:"pass"}){const{id:s}=n;this.id=s,this.device=e,this.props={...n}}setProps(e){Object.assign(this.props,e)}render(e){}cleanup(){}}class Im extends oD{constructor(){super(...arguments),this._lastRenderIndex=-1}render(e){const[n,s]=this.device.canvasContext.getDrawingBufferSize(),r=e.clearCanvas??!0,i=e.clearColor??(r?[0,0,0,0]:!1),o=r?1:!1,a=e.colorMask??15,c={viewport:[0,0,n,s]};e.colorMask&&(c.colorMask=a),e.scissorRect&&(c.scissorRect=e.scissorRect);const l=this.device.beginRenderPass({framebuffer:e.target,parameters:c,clearColor:i,clearDepth:o});try{return this._drawLayers(l,e)}finally{l.end()}}_drawLayers(e,n){const{target:s,moduleParameters:r,viewports:i,views:o,onViewportActive:a,clearStack:c=!0}=n;n.pass=n.pass||"unknown",c&&(this._lastRenderIndex=-1);const l=[];for(const u of i){const h=o&&o[u.id];a==null||a(u);const f=this._getDrawLayerParams(u,n),d=u.subViewports||[u];for(const g of d){const _=this._drawLayersInViewport(e,{target:s,moduleParameters:r,viewport:g,view:h,pass:n.pass,layers:n.layers},f);l.push(_)}}return l}_getDrawLayerParams(e,{layers:n,pass:s,isPicking:r=!1,layerFilter:i,cullRect:o,effects:a,moduleParameters:c},l=!1){var g;const u=[],h=mw(this._lastRenderIndex+1),f={layer:n[0],viewport:e,isPicking:r,renderPass:s,cullRect:o},d={};for(let _=0;_<n.length;_++){const E=n[_],m=this._shouldDrawLayer(E,f,i,d),y={shouldDrawLayer:m};m&&!l&&(y.layerRenderIndex=h(E,m),y.moduleParameters=this._getModuleParameters(E,a,s,c),y.layerParameters={...(g=E.context.deck)==null?void 0:g.props.parameters,...this.getLayerParameters(E,_,e)}),u[_]=y}return u}_drawLayersInViewport(e,{layers:n,moduleParameters:s,pass:r,target:i,viewport:o,view:a},c){const l=aD(this.device,{moduleParameters:s,target:i,viewport:o});if(a&&a.props.clear){const h=a.props.clear===!0?{color:!0,depth:!0}:a.props.clear;this.device.withParametersWebGL({scissorTest:!0,scissor:l},()=>this.device.clearWebGL(h))}const u={totalCount:n.length,visibleCount:0,compositeCount:0,pickableCount:0};e.setParameters({viewport:l});for(let h=0;h<n.length;h++){const f=n[h],{shouldDrawLayer:d,layerRenderIndex:g,moduleParameters:_,layerParameters:E}=c[h];if(d&&f.props.pickable&&u.pickableCount++,f.isComposite)u.compositeCount++;else if(d){u.visibleCount++,this._lastRenderIndex=Math.max(this._lastRenderIndex,g),_.viewport=o,f.context.renderPass=e;try{f._drawLayer({renderPass:e,moduleParameters:_,uniforms:{layerIndex:g},parameters:E})}catch(m){f.raiseError(m,`drawing ${f} to ${r}`)}}}return u}shouldDrawLayer(e){return!0}getModuleParameters(e,n){return null}getLayerParameters(e,n,s){return e.props.parameters}_shouldDrawLayer(e,n,s,r){if(!(e.props.visible&&this.shouldDrawLayer(e)))return!1;n.layer=e;let o=e.parent;for(;o;){if(!o.props.visible||!o.filterSubLayer(n))return!1;n.layer=o,o=o.parent}if(s){const a=n.layer.id;if(a in r||(r[a]=s(n)),!r[a])return!1}return e.activateViewport(n.viewport),!0}_getModuleParameters(e,n,s,r){var a,c;const i=this.device.canvasContext.cssToDeviceRatio(),o=Object.assign(Object.create(((a=e.internalState)==null?void 0:a.propsInTransition)||e.props),{autoWrapLongitude:e.wrapLongitude,viewport:e.context.viewport,mousePosition:e.context.mousePosition,picking:{isActive:0},devicePixelRatio:i});if(n)for(const l of n)Object.assign(o,(c=l.getModuleParameters)==null?void 0:c.call(l,e));return Object.assign(o,this.getModuleParameters(e,n),r)}}function mw(t=0,e={}){const n={},s=(r,i)=>{const o=r.props._offset,a=r.id,c=r.parent&&r.parent.id;let l;if(c&&!(c in e)&&s(r.parent,!1),c in n){const u=n[c]=n[c]||mw(e[c],e);l=u(r,i),n[a]=u}else Number.isFinite(o)?(l=o+(e[c]||0),n[a]=null):l=t;return i&&l>=t&&(t=l+1),e[a]=l,l};return s}function aD(t,{moduleParameters:e,target:n,viewport:s}){const r=e&&e.devicePixelRatio||t.canvasContext.cssToDeviceRatio(),[,i]=t.canvasContext.getDrawingBufferSize(),o=n?n.height:i,a=s;return[a.x*r,o-(a.y+a.height)*r,a.width*r,a.height*r]}class cD extends Im{constructor(e,n){super(e,n),this.shadowMap=e.createTexture({width:1,height:1,sampler:{minFilter:"linear",magFilter:"linear",addressModeU:"clamp-to-edge",addressModeV:"clamp-to-edge"}}),this.depthBuffer=e.createTexture({format:"depth16unorm",width:1,height:1,mipmaps:!1,dataFormat:6402,type:5125}),this.fbo=e.createFramebuffer({id:"shadowmap",width:1,height:1,colorAttachments:[this.shadowMap],depthStencilAttachment:this.depthBuffer})}render(e){const n=this.fbo,s=this.device.canvasContext.cssToDeviceRatio(),r=e.viewports[0],i=r.width*s,o=r.height*s,a=[1,1,1,1];(i!==n.width||o!==n.height)&&n.resize({width:i,height:o}),super.render({...e,clearColor:a,target:n,pass:"shadow"})}getLayerParameters(e,n,s){return{...e.props.parameters,blend:!1,depthRange:[0,1],depthTest:!0}}shouldDrawLayer(e){return e.props.shadowEnabled!==!1}getModuleParameters(){return{drawToShadowMap:!0}}delete(){this.fbo&&(this.fbo.destroy(),this.fbo=null),this.shadowMap&&(this.shadowMap.destroy(),this.shadowMap=null),this.depthBuffer&&(this.depthBuffer.destroy(),this.depthBuffer=null)}}const lD={color:[255,255,255],intensity:1},z0=[{color:[255,255,255],intensity:1,direction:[-1,3,-1]},{color:[255,255,255],intensity:.9,direction:[1,-8,-2.5]}],uD=[0,0,0,200/255];class yw{constructor(e={}){this.id="lighting-effect",this.shadowColor=uD,this.shadow=!1,this.ambientLight=null,this.directionalLights=[],this.pointLights=[],this.shadowPasses=[],this.shadowMaps=[],this.dummyShadowMap=null,this.setProps(e)}setup(e){this.context=e;const{device:n,deck:s}=e;this.shadow&&!this.dummyShadowMap&&(this._createShadowPasses(n),s._addDefaultShaderModule(U0),this.dummyShadowMap=n.createTexture({width:1,height:1}))}setProps(e){this.ambientLight=null,this.directionalLights=[],this.pointLights=[];for(const n in e){const s=e[n];switch(s.type){case"ambient":this.ambientLight=s;break;case"directional":this.directionalLights.push(s);break;case"point":this.pointLights.push(s);break}}this._applyDefaultLights(),this.shadow=this.directionalLights.some(n=>n.shadow),this.context&&this.setup(this.context),this.props=e}preRender({layers:e,layerFilter:n,viewports:s,onViewportActive:r,views:i}){if(this.shadow){this.shadowMatrices=this._calculateMatrices();for(let o=0;o<this.shadowPasses.length;o++)this.shadowPasses[o].render({layers:e,layerFilter:n,viewports:s,onViewportActive:r,views:i,moduleParameters:{shadowLightId:o,dummyShadowMap:this.dummyShadowMap,shadowMatrices:this.shadowMatrices}})}}getModuleParameters(e){const n=this.shadow?{shadowMaps:this.shadowMaps,dummyShadowMap:this.dummyShadowMap,shadowColor:this.shadowColor,shadowMatrices:this.shadowMatrices}:{};return n.lightSources={ambientLight:this.ambientLight,directionalLights:this.directionalLights.map(s=>s.getProjectedLight({layer:e})),pointLights:this.pointLights.map(s=>s.getProjectedLight({layer:e}))},n}cleanup(e){for(const n of this.shadowPasses)n.delete();this.shadowPasses.length=0,this.shadowMaps.length=0,this.dummyShadowMap&&(this.dummyShadowMap.destroy(),this.dummyShadowMap=null,e.deck._removeDefaultShaderModule(U0))}_calculateMatrices(){const e=[];for(const n of this.directionalLights){const s=new q().lookAt({eye:new x(n.direction).negate()});e.push(s)}return e}_createShadowPasses(e){for(let n=0;n<this.directionalLights.length;n++){const s=new cD(e);this.shadowPasses[n]=s,this.shadowMaps[n]=s.shadowMap}}_applyDefaultLights(){const{ambientLight:e,pointLights:n,directionalLights:s}=this;!e&&n.length===0&&s.length===0&&(this.ambientLight=new tD(lD),this.directionalLights.push(new k0(z0[0]),new k0(z0[1])))}}class hD{constructor(e={}){this._pool=[],this.opts={overAlloc:2,poolSize:100},this.setOptions(e)}setOptions(e){Object.assign(this.opts,e)}allocate(e,n,{size:s=1,type:r,padding:i=0,copy:o=!1,initialize:a=!1,maxCount:c}){const l=r||e&&e.constructor||Float32Array,u=n*s+i;if(ArrayBuffer.isView(e)){if(u<=e.length)return e;if(u*e.BYTES_PER_ELEMENT<=e.buffer.byteLength)return new l(e.buffer,0,u)}let h=1/0;c&&(h=c*s+i);const f=this._allocate(l,u,a,h);return e&&o?f.set(e):a||f.fill(0,0,4),this._release(e),f}release(e){this._release(e)}_allocate(e,n,s,r){let i=Math.max(Math.ceil(n*this.opts.overAlloc),1);i>r&&(i=r);const o=this._pool,a=e.BYTES_PER_ELEMENT*i,c=o.findIndex(l=>l.byteLength>=a);if(c>=0){const l=new e(o.splice(c,1)[0],0,i);return s&&l.fill(0),l}return new e(i)}_release(e){if(!ArrayBuffer.isView(e))return;const n=this._pool,{buffer:s}=e,{byteLength:r}=s,i=n.findIndex(o=>o.byteLength>=r);i<0?n.push(s):(i>0||n.length<this.opts.poolSize)&&n.splice(i,0,s),n.length>this.opts.poolSize&&n.shift()}}const Yi=new hD;function Wo(){return[1,0,0,0,0,1,0,0,0,0,1,0,0,0,0,1]}function fD(t){return[t[12],t[13],t[14]]}function dD(t){return{left:Kr(t[3]+t[0],t[7]+t[4],t[11]+t[8],t[15]+t[12]),right:Kr(t[3]-t[0],t[7]-t[4],t[11]-t[8],t[15]-t[12]),bottom:Kr(t[3]+t[1],t[7]+t[5],t[11]+t[9],t[15]+t[13]),top:Kr(t[3]-t[1],t[7]-t[5],t[11]-t[9],t[15]-t[13]),near:Kr(t[3]+t[2],t[7]+t[6],t[11]+t[10],t[15]+t[14]),far:Kr(t[3]-t[2],t[7]-t[6],t[11]-t[10],t[15]-t[14])}}const V0=new x;function Kr(t,e,n,s){V0.set(t,e,n);const r=V0.len();return{distance:s/r,normal:new x(-t/r,-e/r,-n/r)}}function pD(t){return t-Math.fround(t)}let bo;function ed(t,e){const{size:n=1,startIndex:s=0}=e,r=e.endIndex!==void 0?e.endIndex:t.length,i=(r-s)/n;bo=Yi.allocate(bo,i,{type:Float32Array,size:n*2});let o=s,a=0;for(;o<r;){for(let c=0;c<n;c++){const l=t[o++];bo[a+c]=l,bo[a+c+n]=pD(l)}a+=n*2}return bo.subarray(0,i*n*2)}function gD(t){let e=null,n=!1;for(const s of t)s&&(e?(n||(e=[[e[0][0],e[0][1]],[e[1][0],e[1][1]]],n=!0),e[0][0]=Math.min(e[0][0],s[0][0]),e[0][1]=Math.min(e[0][1],s[0][1]),e[1][0]=Math.max(e[1][0],s[1][0]),e[1][1]=Math.max(e[1][1],s[1][1])):e=s);return e}const _D=Math.PI/180,mD=Wo(),H0=[0,0,0],yD={unitsPerMeter:[1,1,1],metersPerUnit:[1,1,1]};function AD({width:t,height:e,orthographic:n,fovyRadians:s,focalDistance:r,padding:i,near:o,far:a}){const c=t/e,l=n?new q().orthographic({fovy:s,aspect:c,focalDistance:r,near:o,far:a}):new q().perspective({fovy:s,aspect:c,near:o,far:a});if(i){const{left:u=0,right:h=0,top:f=0,bottom:d=0}=i,g=qn((u+t-h)/2,0,t)-t/2,_=qn((f+e-d)/2,0,e)-e/2;l[8]-=g*2/t,l[9]+=_*2/e}return l}const Ju=class Ju{constructor(e={}){this._frustumPlanes={},this.id=e.id||this.constructor.displayName||"viewport",this.x=e.x||0,this.y=e.y||0,this.width=e.width||1,this.height=e.height||1,this.zoom=e.zoom||0,this.padding=e.padding,this.distanceScales=e.distanceScales||yD,this.focalDistance=e.focalDistance||1,this.position=e.position||H0,this.modelMatrix=e.modelMatrix||null;const{longitude:n,latitude:s}=e;this.isGeospatial=Number.isFinite(s)&&Number.isFinite(n),this._initProps(e),this._initMatrices(e),this.equals=this.equals.bind(this),this.project=this.project.bind(this),this.unproject=this.unproject.bind(this),this.projectPosition=this.projectPosition.bind(this),this.unprojectPosition=this.unprojectPosition.bind(this),this.projectFlat=this.projectFlat.bind(this),this.unprojectFlat=this.unprojectFlat.bind(this)}get subViewports(){return null}get metersPerPixel(){return this.distanceScales.metersPerUnit[2]/this.scale}get projectionMode(){return this.isGeospatial?this.zoom<12?ln.WEB_MERCATOR:ln.WEB_MERCATOR_AUTO_OFFSET:ln.IDENTITY}equals(e){return e instanceof Ju?this===e?!0:e.width===this.width&&e.height===this.height&&e.scale===this.scale&&Xt(e.projectionMatrix,this.projectionMatrix)&&Xt(e.viewMatrix,this.viewMatrix):!1}project(e,{topLeft:n=!0}={}){const s=this.projectPosition(e),r=_w(s,this.pixelProjectionMatrix),[i,o]=r,a=n?o:this.height-o;return e.length===2?[i,a]:[i,a,r[2]]}unproject(e,{topLeft:n=!0,targetZ:s}={}){const[r,i,o]=e,a=n?i:this.height-i,c=s&&s*this.distanceScales.unitsPerMeter[2],l=Rm([r,a,o],this.pixelUnprojectionMatrix,c),[u,h,f]=this.unprojectPosition(l);return Number.isFinite(o)?[u,h,f]:Number.isFinite(s)?[u,h,s]:[u,h]}projectPosition(e){const[n,s]=this.projectFlat(e),r=(e[2]||0)*this.distanceScales.unitsPerMeter[2];return[n,s,r]}unprojectPosition(e){const[n,s]=this.unprojectFlat(e),r=(e[2]||0)*this.distanceScales.metersPerUnit[2];return[n,s,r]}projectFlat(e){if(this.isGeospatial){const n=$i(e);return n[1]=qn(n[1],-318,830),n}return e}unprojectFlat(e){return this.isGeospatial?Ki(e):e}getBounds(e={}){const n={targetZ:e.z||0},s=this.unproject([0,0],n),r=this.unproject([this.width,0],n),i=this.unproject([0,this.height],n),o=this.unproject([this.width,this.height],n);return[Math.min(s[0],r[0],i[0],o[0]),Math.min(s[1],r[1],i[1],o[1]),Math.max(s[0],r[0],i[0],o[0]),Math.max(s[1],r[1],i[1],o[1])]}getDistanceScales(e){return e?ig({longitude:e[0],latitude:e[1],highPrecision:!0}):this.distanceScales}containsPixel({x:e,y:n,width:s=1,height:r=1}){return e<this.x+this.width&&this.x<e+s&&n<this.y+this.height&&this.y<n+r}getFrustumPlanes(){return this._frustumPlanes.near?this._frustumPlanes:(Object.assign(this._frustumPlanes,dD(this.viewProjectionMatrix)),this._frustumPlanes)}panByPosition(e,n){return null}_initProps(e){const n=e.longitude,s=e.latitude;this.isGeospatial&&(Number.isFinite(e.zoom)||(this.zoom=BF({latitude:s})+Math.log2(this.focalDistance)),this.distanceScales=e.distanceScales||ig({latitude:s,longitude:n}));const r=Math.pow(2,this.zoom);this.scale=r;const{position:i,modelMatrix:o}=e;let a=H0;if(i&&(a=o?new q(o).transformAsVector(i,[]):i),this.isGeospatial){const c=this.projectPosition([n,s,0]);this.center=new x(a).scale(this.distanceScales.unitsPerMeter).add(c)}else this.center=this.projectPosition(a)}_initMatrices(e){const{viewMatrix:n=mD,projectionMatrix:s=null,orthographic:r=!1,fovyRadians:i,fovy:o=75,near:a=.1,far:c=1e3,padding:l=null,focalDistance:u=1}=e;this.viewMatrixUncentered=n,this.viewMatrix=new q().multiplyRight(n).translate(new x(this.center).negate()),this.projectionMatrix=s||AD({width:this.width,height:this.height,orthographic:r,fovyRadians:i||o*_D,focalDistance:u,padding:l,near:a,far:c});const h=Wo();vr(h,h,this.projectionMatrix),vr(h,h,this.viewMatrix),this.viewProjectionMatrix=h,this.viewMatrixInverse=eg([],this.viewMatrix)||this.viewMatrix,this.cameraPosition=fD(this.viewMatrixInverse);const f=Wo(),d=Wo();Em(f,f,[this.width/2,-this.height/2,1]),Eu(f,f,[1,-1,0]),vr(d,f,this.viewProjectionMatrix),this.pixelProjectionMatrix=d,this.pixelUnprojectionMatrix=eg(Wo(),this.pixelProjectionMatrix),this.pixelUnprojectionMatrix||J.warn("Pixel project matrix not invertible")()}};Ju.displayName="Viewport";let Da=Ju;const pa=class pa extends Da{constructor(e={}){const{latitude:n=0,longitude:s=0,zoom:r=0,pitch:i=0,bearing:o=0,nearZMultiplier:a=.1,farZMultiplier:c=1.01,nearZ:l,farZ:u,orthographic:h=!1,projectionMatrix:f,repeat:d=!1,worldOffset:g=0,position:_,padding:E,legacyMeterSizes:m=!1}=e;let{width:y,height:A,altitude:C=1.5}=e;const b=Math.pow(2,r);y=y||1,A=A||1;let P,B=null;if(f)C=f[5]/2,P=Cu(C);else{e.fovy?(P=e.fovy,C=gw(P)):P=Cu(C);let N;if(E){const{top:F=0,bottom:H=0}=E;N=[0,qn((F+A-H)/2,0,A)-A/2]}B=NF({width:y,height:A,scale:b,center:_&&[0,0,_[2]*Qf(n)],offset:N,pitch:i,fovy:P,nearZMultiplier:a,farZMultiplier:c}),Number.isFinite(l)&&(B.near=l),Number.isFinite(u)&&(B.far=u)}let O=OF({height:A,pitch:i,bearing:o,scale:b,altitude:C});g&&(O=new q().translate([512*g,0,0]).multiplyLeft(O)),super({...e,width:y,height:A,viewMatrix:O,longitude:s,latitude:n,zoom:r,...B,fovy:P,focalDistance:C}),this.latitude=n,this.longitude=s,this.zoom=r,this.pitch=i,this.bearing=o,this.altitude=C,this.fovy=P,this.orthographic=h,this._subViewports=d?[]:null,this._pseudoMeters=m,Object.freeze(this)}get subViewports(){if(this._subViewports&&!this._subViewports.length){const e=this.getBounds(),n=Math.floor((e[0]+180)/360),s=Math.ceil((e[2]-180)/360);for(let r=n;r<=s;r++){const i=r?new pa({...this,worldOffset:r}):this;this._subViewports.push(i)}}return this._subViewports}projectPosition(e){if(this._pseudoMeters)return super.projectPosition(e);const[n,s]=this.projectFlat(e),r=(e[2]||0)*Qf(e[1]);return[n,s,r]}unprojectPosition(e){if(this._pseudoMeters)return super.unprojectPosition(e);const[n,s]=this.unprojectFlat(e),r=(e[2]||0)/Qf(s);return[n,s,r]}addMetersToLngLat(e,n){return pw(e,n)}panByPosition(e,n){const s=Rm(n,this.pixelUnprojectionMatrix),r=this.projectFlat(e),i=w0([],r,jO([],s)),o=w0([],this.center,i),[a,c]=this.unprojectFlat(o);return{longitude:a,latitude:c}}getBounds(e={}){const n=LF(this,e.z||0);return[Math.min(n[0][0],n[1][0],n[2][0],n[3][0]),Math.min(n[0][1],n[1][1],n[2][1],n[3][1]),Math.max(n[0][0],n[1][0],n[2][0],n[3][0]),Math.max(n[0][1],n[1][1],n[2][1],n[3][1])]}fitBounds(e,n={}){const{width:s,height:r}=this,{longitude:i,latitude:o,zoom:a}=FF({width:s,height:r,bounds:e,...n});return new pa({width:s,height:r,longitude:i,latitude:o,zoom:a})}};pa.displayName="WebMercatorViewport";let Ji=pa;const j0=[0,0,0];function td(t,e,n=!1){const s=e.projectPosition(t);if(n&&e instanceof Ji){const[r,i,o=0]=t,a=e.getDistanceScales([r,i]);s[2]=o*a.unitsPerMeter[2]}return s}function TD(t){const{viewport:e,modelMatrix:n,coordinateOrigin:s}=t;let{coordinateSystem:r,fromCoordinateSystem:i,fromCoordinateOrigin:o}=t;return r===Z.DEFAULT&&(r=e.isGeospatial?Z.LNGLAT:Z.CARTESIAN),i===void 0&&(i=r),o===void 0&&(o=s),{viewport:e,coordinateSystem:r,coordinateOrigin:s,modelMatrix:n,fromCoordinateSystem:i,fromCoordinateOrigin:o}}function Aw(t,{viewport:e,modelMatrix:n,coordinateSystem:s,coordinateOrigin:r,offsetMode:i}){let[o,a,c=0]=t;switch(n&&([o,a,c]=ao([],[o,a,c,1],n)),s){case Z.LNGLAT:return td([o,a,c],e,i);case Z.LNGLAT_OFFSETS:return td([o+r[0],a+r[1],c+(r[2]||0)],e,i);case Z.METER_OFFSETS:return td(pw(r,[o,a,c]),e,i);case Z.CARTESIAN:default:return e.isGeospatial?[o+r[0],a+r[1],c+r[2]]:e.projectPosition([o,a,c])}}function ED(t,e){const{viewport:n,coordinateSystem:s,coordinateOrigin:r,modelMatrix:i,fromCoordinateSystem:o,fromCoordinateOrigin:a}=TD(e),{autoOffset:c=!0}=e,{geospatialOrigin:l=j0,shaderCoordinateOrigin:u=j0,offsetMode:h=!1}=c?fw(n,s,r):{},f=Aw(t,{viewport:n,modelMatrix:i,coordinateSystem:o,coordinateOrigin:a,offsetMode:h});if(h){const d=n.projectPosition(l||u);Jv(f,f,d)}return f}let SD=1,CD=1;class Tw{constructor(){p(this,"time",0);p(this,"channels",new Map);p(this,"animations",new Map);p(this,"playing",!1);p(this,"lastEngineTime",-1)}addChannel(e){const{delay:n=0,duration:s=Number.POSITIVE_INFINITY,rate:r=1,repeat:i=1}=e,o=SD++,a={time:0,delay:n,duration:s,rate:r,repeat:i};return this._setChannelTime(a,this.time),this.channels.set(o,a),o}removeChannel(e){this.channels.delete(e);for(const[n,s]of this.animations)s.channel===e&&this.detachAnimation(n)}isFinished(e){const n=this.channels.get(e);return n===void 0?!1:this.time>=n.delay+n.duration*n.repeat}getTime(e){if(e===void 0)return this.time;const n=this.channels.get(e);return n===void 0?-1:n.time}setTime(e){this.time=Math.max(0,e);const n=this.channels.values();for(const r of n)this._setChannelTime(r,this.time);const s=this.animations.values();for(const r of s){const{animation:i,channel:o}=r;i.setTime(this.getTime(o))}}play(){this.playing=!0}pause(){this.playing=!1,this.lastEngineTime=-1}reset(){this.setTime(0)}attachAnimation(e,n){const s=CD++;return this.animations.set(s,{animation:e,channel:n}),e.setTime(this.getTime(n)),s}detachAnimation(e){this.animations.delete(e)}update(e){this.playing&&(this.lastEngineTime===-1&&(this.lastEngineTime=e),this.setTime(this.time+(e-this.lastEngineTime)),this.lastEngineTime=e)}_setChannelTime(e,n){const s=n-e.delay,r=e.duration*e.repeat;s>=r?e.time=e.duration*e.rate:(e.time=Math.max(0,s)%e.duration,e.time*=e.rate)}}let vD=0;const wD={device:null,onAddHTML:()=>"",onInitialize:async()=>null,onRender:()=>{},onFinalize:()=>{},onError:t=>console.error(t),stats:Cr.stats.get(`animation-loop-${vD++}`),useDevicePixels:!0,autoResizeViewport:!1,autoResizeDrawingBuffer:!1};class bD{constructor(e){p(this,"device",null);p(this,"canvas",null);p(this,"props");p(this,"animationProps",null);p(this,"timeline",null);p(this,"stats");p(this,"cpuTime");p(this,"gpuTime");p(this,"frameRate");p(this,"display");p(this,"needsRedraw","initialized");p(this,"_initialized",!1);p(this,"_running",!1);p(this,"_animationFrameId",null);p(this,"_nextFramePromise",null);p(this,"_resolveNextFrame",null);p(this,"_cpuStartTime",0);if(this.props={...wD,...e},e=this.props,!e.device)throw new Error("No device provided");const{useDevicePixels:n=!0}=this.props;this.stats=e.stats||new oo({id:"animation-loop-stats"}),this.cpuTime=this.stats.get("CPU Time"),this.gpuTime=this.stats.get("GPU Time"),this.frameRate=this.stats.get("Frame Rate"),this.setProps({autoResizeViewport:e.autoResizeViewport,autoResizeDrawingBuffer:e.autoResizeDrawingBuffer,useDevicePixels:n}),this.start=this.start.bind(this),this.stop=this.stop.bind(this),this._onMousemove=this._onMousemove.bind(this),this._onMouseleave=this._onMouseleave.bind(this)}destroy(){this.stop(),this._setDisplay(null)}delete(){this.destroy()}setNeedsRedraw(e){return this.needsRedraw=this.needsRedraw||e,this}setProps(e){return"autoResizeViewport"in e&&(this.props.autoResizeViewport=e.autoResizeViewport||!1),"autoResizeDrawingBuffer"in e&&(this.props.autoResizeDrawingBuffer=e.autoResizeDrawingBuffer||!1),"useDevicePixels"in e&&(this.props.useDevicePixels=e.useDevicePixels||!1),this}async start(){if(this._running)return this;this._running=!0;try{let e;return this._initialized||(this._initialized=!0,await this._initDevice(),this._initialize(),await this.props.onInitialize(this._getAnimationProps())),this._running?(e!==!1&&(this._cancelAnimationFrame(),this._requestAnimationFrame()),this):null}catch(e){const n=e instanceof Error?e:new Error("Unknown error");throw this.props.onError(n),n}}stop(){return this._running&&(this.animationProps&&this.props.onFinalize(this.animationProps),this._cancelAnimationFrame(),this._nextFramePromise=null,this._resolveNextFrame=null,this._running=!1),this}redraw(){var e;return(e=this.device)!=null&&e.isLost?this:(this._beginFrameTimers(),this._setupFrame(),this._updateAnimationProps(),this._renderFrame(this._getAnimationProps()),this._clearNeedsRedraw(),this._resolveNextFrame&&(this._resolveNextFrame(this),this._nextFramePromise=null,this._resolveNextFrame=null),this._endFrameTimers(),this)}attachTimeline(e){return this.timeline=e,this.timeline}detachTimeline(){this.timeline=null}waitForRender(){return this.setNeedsRedraw("waitForRender"),this._nextFramePromise||(this._nextFramePromise=new Promise(e=>{this._resolveNextFrame=e})),this._nextFramePromise}async toDataURL(){if(this.setNeedsRedraw("toDataURL"),await this.waitForRender(),this.canvas instanceof HTMLCanvasElement)return this.canvas.toDataURL();throw new Error("OffscreenCanvas")}_initialize(){this._startEventHandling(),this._initializeAnimationProps(),this._updateAnimationProps(),this._resizeCanvasDrawingBuffer(),this._resizeViewport()}_setDisplay(e){this.display&&(this.display.destroy(),this.display.animationLoop=null),e&&(e.animationLoop=this),this.display=e}_requestAnimationFrame(){this._running&&(this._animationFrameId=H2(this._animationFrame.bind(this)))}_cancelAnimationFrame(){this._animationFrameId!==null&&(j2(this._animationFrameId),this._animationFrameId=null)}_animationFrame(){this._running&&(this.redraw(),this._requestAnimationFrame())}_renderFrame(e){if(this.display){this.display._renderFrame(e);return}this.props.onRender(this._getAnimationProps()),this.device.submit()}_clearNeedsRedraw(){this.needsRedraw=!1}_setupFrame(){this._resizeCanvasDrawingBuffer(),this._resizeViewport()}_initializeAnimationProps(){var e,n;if(!this.device)throw new Error("loop");this.animationProps={animationLoop:this,device:this.device,canvas:(n=(e=this.device)==null?void 0:e.canvasContext)==null?void 0:n.canvas,timeline:this.timeline,useDevicePixels:this.props.useDevicePixels,needsRedraw:!1,width:1,height:1,aspect:1,time:0,startTime:Date.now(),engineTime:0,tick:0,tock:0,_mousePosition:null}}_getAnimationProps(){if(!this.animationProps)throw new Error("animationProps");return this.animationProps}_updateAnimationProps(){if(!this.animationProps)return;const{width:e,height:n,aspect:s}=this._getSizeAndAspect();(e!==this.animationProps.width||n!==this.animationProps.height)&&this.setNeedsRedraw("drawing buffer resized"),s!==this.animationProps.aspect&&this.setNeedsRedraw("drawing buffer aspect changed"),this.animationProps.width=e,this.animationProps.height=n,this.animationProps.aspect=s,this.animationProps.needsRedraw=this.needsRedraw,this.animationProps.engineTime=Date.now()-this.animationProps.startTime,this.timeline&&this.timeline.update(this.animationProps.engineTime),this.animationProps.tick=Math.floor(this.animationProps.time/1e3*60),this.animationProps.tock++,this.animationProps.time=this.timeline?this.timeline.getTime():this.animationProps.engineTime}async _initDevice(){var e;if(this.device=await this.props.device,!this.device)throw new Error("No device provided");this.canvas=((e=this.device.canvasContext)==null?void 0:e.canvas)||null}_createInfoDiv(){if(this.canvas&&this.props.onAddHTML){const e=document.createElement("div");document.body.appendChild(e),e.style.position="relative";const n=document.createElement("div");n.style.position="absolute",n.style.left="10px",n.style.bottom="10px",n.style.width="300px",n.style.background="white",this.canvas instanceof HTMLCanvasElement&&e.appendChild(this.canvas),e.appendChild(n);const s=this.props.onAddHTML(n);s&&(n.innerHTML=s)}}_getSizeAndAspect(){var i,o,a,c;if(!this.device)return{width:1,height:1,aspect:1};const[e,n]=((o=(i=this.device)==null?void 0:i.canvasContext)==null?void 0:o.getPixelSize())||[1,1];let s=1;const r=(c=(a=this.device)==null?void 0:a.canvasContext)==null?void 0:c.canvas;return r&&r.clientHeight?s=r.clientWidth/r.clientHeight:e>0&&n>0&&(s=e/n),{width:e,height:n,aspect:s}}_resizeViewport(){this.props.autoResizeViewport&&this.device.gl&&this.device.gl.viewport(0,0,this.device.gl.drawingBufferWidth,this.device.gl.drawingBufferHeight)}_resizeCanvasDrawingBuffer(){var e,n;this.props.autoResizeDrawingBuffer&&((n=(e=this.device)==null?void 0:e.canvasContext)==null||n.resize({useDevicePixels:this.props.useDevicePixels}))}_beginFrameTimers(){this.frameRate.timeEnd(),this.frameRate.timeStart(),this.cpuTime.timeStart()}_endFrameTimers(){this.cpuTime.timeEnd()}_startEventHandling(){this.canvas&&(this.canvas.addEventListener("mousemove",this._onMousemove.bind(this)),this.canvas.addEventListener("mouseleave",this._onMouseleave.bind(this)))}_onMousemove(e){e instanceof MouseEvent&&(this._getAnimationProps()._mousePosition=[e.offsetX,e.offsetY])}_onMouseleave(e){this._getAnimationProps()._mousePosition=null}}class W0{constructor(e){p(this,"id");p(this,"userData",{});p(this,"topology");p(this,"bufferLayout",[]);p(this,"vertexCount");p(this,"indices");p(this,"attributes");this.id=e.id||Js("geometry"),this.topology=e.topology,this.indices=e.indices||null,this.attributes=e.attributes,this.vertexCount=e.vertexCount,this.bufferLayout=e.bufferLayout||[],this.indices&&oe(this.indices.usage===Ae.INDEX)}destroy(){var e;(e=this.indices)==null||e.destroy();for(const n of Object.values(this.attributes))n.destroy()}getVertexCount(){return this.vertexCount}getAttributes(){return this.attributes}getIndexes(){return this.indices}_calculateVertexCount(e){return e.byteLength/12}}function RD(t,e){if(e instanceof W0)return e;const n=ID(t,e),{attributes:s,bufferLayout:r}=PD(t,e);return new W0({topology:e.topology||"triangle-list",bufferLayout:r,vertexCount:e.vertexCount,indices:n,attributes:s})}function ID(t,e){if(!e.indices)return;const n=e.indices.value;return t.createBuffer({usage:Ae.INDEX,data:n})}function PD(t,e){const n=[],s={};for(const[i,o]of Object.entries(e.attributes)){let a=i;switch(i){case"POSITION":a="positions";break;case"NORMAL":a="normals";break;case"TEXCOORD_0":a="texCoords";break;case"COLOR_0":a="colors";break}s[a]=t.createBuffer({data:o.value,id:`${i}-buffer`});const{value:c,size:l,normalized:u}=o;n.push({name:a,format:L2(c,l,u)})}const r=e._calculateVertexCount(e.attributes,e.indices);return{attributes:s,bufferLayout:n,vertexCount:r}}class xD{constructor(e){p(this,"modules");p(this,"moduleUniforms");p(this,"moduleBindings");p(this,"moduleUniformsChanged");const n=Fh(Object.values(e));U.log(1,"Creating ShaderInputs with modules",n.map(s=>s.name))(),this.modules=e,this.moduleUniforms={},this.moduleBindings={};for(const[s,r]of Object.entries(e)){const i=s;this.moduleUniforms[i]=r.defaultUniforms||{},this.moduleBindings[i]={}}}destroy(){}setProps(e){var n;for(const s of Object.keys(e)){const r=s,i=e[r],o=this.modules[r];if(!o){U.warn(`Module ${s} not found`)();continue}const a=this.moduleUniforms[r],c=((n=o.getUniforms)==null?void 0:n.call(o,i,this.moduleUniforms[r]))||i;this.moduleUniforms[r]={...a,...c}}}getModules(){return Object.values(this.modules)}getUniformValues(){return this.moduleUniforms}getBindings(){const e={};for(const n of Object.values(this.moduleBindings))Object.assign(e,n);return e}getDebugTable(){var n;const e={};for(const[s,r]of Object.entries(this.moduleUniforms))for(const[i,o]of Object.entries(r))e[`${s}.${i}`]={type:(n=this.modules[s].uniformTypes)==null?void 0:n[i],value:String(o)};return e}}const qu=class qu{constructor(e){p(this,"device");p(this,"_hashCounter",0);p(this,"_hashes",{});p(this,"_renderPipelineCache",{});p(this,"_computePipelineCache",{});this.device=e}static getDefaultPipelineFactory(e){return e._lumaData.defaultPipelineFactory=e._lumaData.defaultPipelineFactory||new qu(e),e._lumaData.defaultPipelineFactory}createRenderPipeline(e){const n={...Wi.defaultProps,...e},s=this._hashRenderPipeline(n);if(!this._renderPipelineCache[s]){const r=this.device.createRenderPipeline({...n,id:n.id?`${n.id}-cached`:void 0});r.hash=s,this._renderPipelineCache[s]={pipeline:r,useCount:0}}return this._renderPipelineCache[s].useCount++,this._renderPipelineCache[s].pipeline}createComputePipeline(e){const n={...Au.defaultProps,...e},s=this._hashComputePipeline(n);if(!this._computePipelineCache[s]){const r=this.device.createComputePipeline({...n,id:n.id?`${n.id}-cached`:void 0});r.hash=s,this._computePipelineCache[s]={pipeline:r,useCount:0}}return this._computePipelineCache[s].useCount++,this._computePipelineCache[s].pipeline}release(e){const n=e.hash,s=e instanceof Au?this._computePipelineCache:this._renderPipelineCache;s[n].useCount--,s[n].useCount===0&&(s[n].pipeline.destroy(),delete s[n])}_hashComputePipeline(e){return`${this._getHash(e.shader.source)}`}_hashRenderPipeline(e){const n=this._getHash(e.vs.source),s=e.fs?this._getHash(e.fs.source):0,r="-",i=this._getHash(JSON.stringify(e.bufferLayout));switch(this.device.type){case"webgl":return`${n}/${s}V${r}BL${i}`;default:const o=this._getHash(JSON.stringify(e.parameters));return`${n}/${s}V${r}T${e.topology}P${o}BL${i}`}}_getHash(e){return this._hashes[e]===void 0&&(this._hashes[e]=this._hashCounter++),this._hashes[e]}};p(qu,"defaultProps",{...Wi.defaultProps});let og=qu;const Zu=class Zu{constructor(e){p(this,"device");p(this,"_cache",{});this.device=e}static getDefaultShaderFactory(e){var n;return(n=e._lumaData).defaultShaderFactory||(n.defaultShaderFactory=new Zu(e)),e._lumaData.defaultShaderFactory}createShader(e){const n=this._hashShader(e);let s=this._cache[n];if(!s){const r=this.device.createShader({...e,id:e.id?`${e.id}-cached`:void 0});this._cache[n]=s={shader:r,useCount:0}}return s.useCount++,s.shader}release(e){const n=this._hashShader(e),s=this._cache[n];s&&(s.useCount--,s.useCount===0&&(delete this._cache[n],s.shader.destroy()))}_hashShader(e){return`${e.stage}:${e.source}`}};p(Zu,"defaultProps",{..._u.defaultProps});let ag=Zu;function MD(t,e){var r;const n={},s="Values";if(t.attributes.length===0&&!((r=t.varyings)!=null&&r.length))return{"No attributes or varyings":{[s]:"N/A"}};for(const i of t.attributes)if(i){const o=`${i.location} ${i.name}: ${i.type}`;n[`in ${o}`]={[s]:i.stepMode||"vertex"}}for(const i of t.varyings||[]){const o=`${i.location} ${i.name}`;n[`out ${o}`]={[s]:JSON.stringify(i.accessor)}}return n}let ze=null,nd=null;function BD(t,{id:e,minimap:n,opaque:s,top:r="0",left:i="0",rgbaScale:o=1}){ze||(ze=document.createElement("canvas"),ze.id=e,ze.title=e,ze.style.zIndex="100",ze.style.position="absolute",ze.style.top=r,ze.style.left=i,ze.style.border="blue 1px solid",ze.style.transform="scaleY(-1)",document.body.appendChild(ze),nd=ze.getContext("2d")),(ze.width!==t.width||ze.height!==t.height)&&(ze.width=t.width/2,ze.height=t.height/2,ze.style.width="400px",ze.style.height="400px");const a=t.device.readPixelsToArrayWebGL(t),c=nd.createImageData(t.width,t.height),l=0;for(let u=0;u<a.length;u+=4)c.data[l+u+0]=a[u+0]*o,c.data[l+u+1]=a[u+1]*o,c.data[l+u+2]=a[u+2]*o,c.data[l+u+3]=s?255:a[u+3]*o;nd.putImageData(c,0,0)}const Yr=2,OD=1e4,Qu=class Qu{constructor(e,n){p(this,"device");p(this,"id");p(this,"source");p(this,"vs");p(this,"fs");p(this,"pipelineFactory");p(this,"shaderFactory");p(this,"userData",{});p(this,"parameters");p(this,"topology");p(this,"bufferLayout");p(this,"vertexCount");p(this,"instanceCount",0);p(this,"indexBuffer",null);p(this,"bufferAttributes",{});p(this,"constantAttributes",{});p(this,"bindings",{});p(this,"uniforms",{});p(this,"vertexArray");p(this,"transformFeedback",null);p(this,"pipeline");p(this,"shaderInputs");p(this,"_uniformStore");p(this,"_attributeInfos",{});p(this,"_gpuGeometry",null);p(this,"_getModuleUniforms");p(this,"props");p(this,"_pipelineNeedsUpdate","newly created");p(this,"_needsRedraw","initializing");p(this,"_destroyed",!1);p(this,"_lastDrawTimestamp",-1);p(this,"_lastLogTime",0);p(this,"_logOpen",!1);p(this,"_drawCount",0);var a,c,l,u;this.props={...Qu.defaultProps,...n},n=this.props,this.id=n.id||Js("model"),this.device=e,Object.assign(this.userData,n.userData);const s=Object.fromEntries(((a=this.props.modules)==null?void 0:a.map(h=>[h.name,h]))||[]);this.setShaderInputs(n.shaderInputs||new xD(s));const r=ND(e),i=(((c=this.props.modules)==null?void 0:c.length)>0?this.props.modules:(l=this.shaderInputs)==null?void 0:l.getModules())||[];if(this.device.type==="webgpu"&&this.props.source){(u=this.props).shaderLayout||(u.shaderLayout=vO(this.props.source));const{source:h,getUniforms:f}=this.props.shaderAssembler.assembleShader({platformInfo:r,...this.props,modules:i});this.source=h,this._getModuleUniforms=f}else{const{vs:h,fs:f,getUniforms:d}=this.props.shaderAssembler.assembleShaderPair({platformInfo:r,...this.props,modules:i});this.vs=h,this.fs=f,this._getModuleUniforms=d}this.vertexCount=this.props.vertexCount,this.instanceCount=this.props.instanceCount,this.topology=this.props.topology,this.bufferLayout=this.props.bufferLayout,this.parameters=this.props.parameters,n.geometry&&this.setGeometry(n.geometry),this.pipelineFactory=n.pipelineFactory||og.getDefaultPipelineFactory(this.device),this.shaderFactory=n.shaderFactory||ag.getDefaultShaderFactory(this.device),this.pipeline=this._updatePipeline(),this.vertexArray=e.createVertexArray({renderPipeline:this.pipeline}),this._gpuGeometry&&this._setGeometryAttributes(this._gpuGeometry),n.vertexCount&&this.setVertexCount(n.vertexCount),n.instanceCount&&this.setInstanceCount(n.instanceCount),n.indexBuffer&&this.setIndexBuffer(n.indexBuffer),n.attributes&&this.setAttributes(n.attributes),n.constantAttributes&&this.setConstantAttributes(n.constantAttributes),n.bindings&&this.setBindings(n.bindings),n.uniforms&&this.setUniforms(n.uniforms),n.moduleSettings&&this.updateModuleSettings(n.moduleSettings),n.transformFeedback&&(this.transformFeedback=n.transformFeedback),Object.seal(this)}destroy(){var e;this._destroyed||(this.pipelineFactory.release(this.pipeline),this.shaderFactory.release(this.pipeline.vs),this.pipeline.fs&&this.shaderFactory.release(this.pipeline.fs),this._uniformStore.destroy(),(e=this._gpuGeometry)==null||e.destroy(),this._destroyed=!0)}needsRedraw(){this._getBindingsUpdateTimestamp()>this._lastDrawTimestamp&&this.setNeedsRedraw("contents of bound textures or buffers updated");const e=this._needsRedraw;return this._needsRedraw=!1,e}setNeedsRedraw(e){this._needsRedraw||(this._needsRedraw=e)}predraw(){this.updateShaderInputs(),this.pipeline=this._updatePipeline()}draw(e){this.predraw();let n;try{this._logDrawCallStart(),this.pipeline=this._updatePipeline(),this.pipeline.setBindings(this.bindings,{disableWarnings:this.props.disableWarnings}),pu(this.uniforms)||this.pipeline.setUniformsWebGL(this.uniforms);const{indexBuffer:s}=this.vertexArray,r=s?s.byteLength/(s.indexType==="uint32"?4:2):void 0;n=this.pipeline.draw({renderPass:e,vertexArray:this.vertexArray,vertexCount:this.vertexCount,instanceCount:this.instanceCount,indexCount:r,transformFeedback:this.transformFeedback||void 0,parameters:this.parameters,topology:this.topology})}finally{this._logDrawCallEnd()}return this._logFramebuffer(e),n?(this._lastDrawTimestamp=this.device.timestamp,this._needsRedraw=!1):this._needsRedraw="waiting for resource initialization",n}setGeometry(e){var s;(s=this._gpuGeometry)==null||s.destroy();const n=e&&RD(this.device,e);n&&(this.setTopology(n.topology||"triangle-list"),this.bufferLayout=G0(n.bufferLayout,this.bufferLayout),this.vertexArray&&this._setGeometryAttributes(n)),this._gpuGeometry=n}setTopology(e){e!==this.topology&&(this.topology=e,this._setPipelineNeedsUpdate("topology"))}setBufferLayout(e){this.bufferLayout=this._gpuGeometry?G0(e,this._gpuGeometry.bufferLayout):e,this._setPipelineNeedsUpdate("bufferLayout"),this.pipeline=this._updatePipeline(),this.vertexArray=this.device.createVertexArray({renderPipeline:this.pipeline}),this._gpuGeometry&&this._setGeometryAttributes(this._gpuGeometry)}setParameters(e){Zp(e,this.parameters,2)||(this.parameters=e,this._setPipelineNeedsUpdate("parameters"))}setVertexCount(e){this.vertexCount=e,this.setNeedsRedraw("vertexCount")}setInstanceCount(e){this.instanceCount=e,this.setNeedsRedraw("instanceCount")}setShaderInputs(e){this.shaderInputs=e,this._uniformStore=new D2(this.shaderInputs.modules);for(const n of Object.keys(this.shaderInputs.modules)){const s=this._uniformStore.getManagedUniformBuffer(this.device,n);this.bindings[`${n}Uniforms`]=s}this.setNeedsRedraw("shaderInputs")}updateShaderInputs(){this._uniformStore.setUniforms(this.shaderInputs.getUniformValues()),this.setNeedsRedraw("shaderInputs")}setBindings(e){Object.assign(this.bindings,e),this.setNeedsRedraw("bindings")}setTransformFeedback(e){this.transformFeedback=e,this.setNeedsRedraw("transformFeedback")}setIndexBuffer(e){this.vertexArray.setIndexBuffer(e),this.setNeedsRedraw("indexBuffer")}setAttributes(e,n){e.indices&&U.warn(`Model:${this.id} setAttributes() - indexBuffer should be set using setIndexBuffer()`)();for(const[s,r]of Object.entries(e)){const i=this.bufferLayout.find(c=>X0(c).includes(s));if(!i){U.warn(`Model(${this.id}): Missing layout for buffer "${s}".`)();continue}const o=X0(i);let a=!1;for(const c of o){const l=this._attributeInfos[c];l&&(this.vertexArray.setBuffer(l.location,r),a=!0)}!a&&!((n==null?void 0:n.disableWarnings)??this.props.disableWarnings)&&U.warn(`Model(${this.id}): Ignoring buffer "${r.id}" for unknown attribute "${s}"`)()}this.setNeedsRedraw("attributes")}setConstantAttributes(e,n){for(const[s,r]of Object.entries(e)){const i=this._attributeInfos[s];i?this.vertexArray.setConstantWebGL(i.location,r):((n==null?void 0:n.disableWarnings)??this.props.disableWarnings)||U.warn(`Model "${this.id}: Ignoring constant supplied for unknown attribute "${s}"`)()}this.setNeedsRedraw("constants")}setUniforms(e){pu(e)||(this.pipeline.setUniformsWebGL(e),Object.assign(this.uniforms,e)),this.setNeedsRedraw("uniforms")}updateModuleSettings(e){const{bindings:n,uniforms:s}=Mv(this._getModuleUniforms(e));Object.assign(this.bindings,n),Object.assign(this.uniforms,s),this.setNeedsRedraw("moduleSettings")}_getBindingsUpdateTimestamp(){let e=0;for(const n of Object.values(this.bindings))n instanceof gu?e=Math.max(e,n.texture.updateTimestamp):n instanceof Ae||n instanceof Rt?e=Math.max(e,n.updateTimestamp):n instanceof mu||(e=Math.max(e,n.buffer.updateTimestamp));return e}_setGeometryAttributes(e){const n={...e.attributes};for(const[s]of Object.entries(n))!this.pipeline.shaderLayout.attributes.find(r=>r.name===s)&&s!=="positions"&&delete n[s];this.vertexCount=e.vertexCount,this.setIndexBuffer(e.indices||null),this.setAttributes(e.attributes,{disableWarnings:!0}),this.setAttributes(n,{disableWarnings:this.props.disableWarnings}),this.setNeedsRedraw("geometry attributes")}_setPipelineNeedsUpdate(e){this._pipelineNeedsUpdate||(this._pipelineNeedsUpdate=e),this.setNeedsRedraw(e)}_updatePipeline(){if(this._pipelineNeedsUpdate){let e=null,n=null;this.pipeline&&(U.log(1,`Model ${this.id}: Recreating pipeline because "${this._pipelineNeedsUpdate}".`)(),e=this.pipeline.vs,n=this.pipeline.fs),this._pipelineNeedsUpdate=!1;const s=this.shaderFactory.createShader({id:`${this.id}-vertex`,stage:"vertex",source:this.source||this.vs,debug:this.props.debugShaders});let r=null;this.source?r=s:this.fs&&(r=this.shaderFactory.createShader({id:`${this.id}-fragment`,stage:"fragment",source:this.source||this.fs,debug:this.props.debugShaders})),this.pipeline=this.pipelineFactory.createRenderPipeline({...this.props,bufferLayout:this.bufferLayout,topology:this.topology,parameters:this.parameters,vs:s,fs:r}),this._attributeInfos=Rv(this.pipeline.shaderLayout,this.bufferLayout),e&&this.shaderFactory.release(e),n&&this.shaderFactory.release(n)}return this.pipeline}_logDrawCallStart(){const e=U.level>3?0:OD;U.level<2||Date.now()-this._lastLogTime<e||(this._lastLogTime=Date.now(),this._logOpen=!0,U.group(Yr,`>>> DRAWING MODEL ${this.id}`,{collapsed:U.level<=2})())}_logDrawCallEnd(){if(this._logOpen){const e=MD(this.pipeline.shaderLayout,this.id);U.table(Yr,e)();const n=this.shaderInputs.getDebugTable();for(const[r,i]of Object.entries(this.uniforms))n[r]={value:i};U.table(Yr,n)();const s=this._getAttributeDebugTable();U.table(Yr,this._attributeInfos)(),U.table(Yr,s)(),U.groupEnd(Yr)(),this._logOpen=!1}}_logFramebuffer(e){const n=U.get("framebuffer");if(this._drawCount++,!n||this._drawCount++>3&&this._drawCount%60)return;const s=e.props.framebuffer;s&&BD(s,{id:s.id,minimap:!0})}_getAttributeDebugTable(){const e={};for(const[n,s]of Object.entries(this._attributeInfos))e[s.location]={name:n,type:s.shaderType,values:this._getBufferOrConstantValues(this.vertexArray.attributes[s.location],s.bufferDataType)};if(this.vertexArray.indexBuffer){const{indexBuffer:n}=this.vertexArray,s=n.indexType==="uint32"?new Uint32Array(n.debugData):new Uint16Array(n.debugData);e.indices={name:"indices",type:n.indexType,values:s.toString()}}return e}_getBufferOrConstantValues(e,n){const s=xv(n);return(e instanceof Ae?new s(e.debugData):e).toString()}};p(Qu,"defaultProps",{...Wi.defaultProps,source:null,vs:null,fs:null,id:"unnamed",handle:void 0,userData:{},defines:{},modules:[],moduleSettings:void 0,geometry:null,indexBuffer:null,attributes:{},constantAttributes:{},varyings:[],shaderInputs:void 0,pipelineFactory:void 0,shaderFactory:void 0,transformFeedback:void 0,shaderAssembler:du.getDefaultShaderAssembler(),debugShaders:void 0,disableWarnings:void 0});let ct=Qu;function G0(t,e){const n=[...t];for(const s of e){const r=n.findIndex(i=>i.name===s.name);r<0?n.push(s):n[r]=s}return n}function ND(t){return{type:t.type,shaderLanguage:t.info.shadingLanguage,shaderLanguageVersion:t.info.shadingLanguageVersion,gpu:t.info.gpu,features:t.features}}function X0(t){var e;return t.attributes?(e=t.attributes)==null?void 0:e.map(n=>n.attribute):[t.name]}class Lh{constructor(e,n=ct.defaultProps){p(this,"device");p(this,"model");p(this,"transformFeedback");oe(Lh.isSupported(e),"BufferTransform not yet implemented on WebGPU"),this.device=e,this.model=new ct(this.device,{id:n.id||"buffer-transform-model",fs:n.fs||UB(),topology:n.topology||"point-list",...n}),this.transformFeedback=this.device.createTransformFeedback({layout:this.model.pipeline.shaderLayout,buffers:n.feedbackBuffers}),this.model.setTransformFeedback(this.transformFeedback),Object.seal(this)}static isSupported(e){var n;return((n=e==null?void 0:e.info)==null?void 0:n.type)==="webgl"}destroy(){this.model&&this.model.destroy()}delete(){this.destroy()}run(e){const n=this.device.beginRenderPass(e);this.model.draw(n),n.end()}update(...e){console.warn("TextureTransform#update() not implemented")}getBuffer(e){return this.transformFeedback.getBuffer(e)}readAsync(e){const n=this.getBuffer(e);if(n instanceof Ae)return n.readAsync();const{buffer:s,byteOffset:r=0,byteLength:i=s.byteLength}=n;return s.readAsync(r,i)}}class Kt{constructor(e){p(this,"id");p(this,"topology");p(this,"vertexCount");p(this,"indices");p(this,"attributes");p(this,"userData",{});const{attributes:n={},indices:s=null,vertexCount:r=null}=e;this.id=e.id||Js("geometry"),this.topology=e.topology,s&&(this.indices=ArrayBuffer.isView(s)?{value:s,size:1}:s),this.attributes={};for(const[i,o]of Object.entries(n)){const a=ArrayBuffer.isView(o)?{value:o}:o;oe(ArrayBuffer.isView(a.value),`${this._print(i)}: must be typed array or object with value as typed array`),(i==="POSITION"||i==="positions")&&!a.size&&(a.size=3),i==="indices"?(oe(!this.indices),this.indices=a):this.attributes[i]=a}this.indices&&this.indices.isIndexed!==void 0&&(this.indices=Object.assign({},this.indices),delete this.indices.isIndexed),this.vertexCount=r||this._calculateVertexCount(this.attributes,this.indices)}getVertexCount(){return this.vertexCount}getAttributes(){return this.indices?{indices:this.indices,...this.attributes}:this.attributes}_print(e){return`Geometry ${this.id} attribute ${e}`}_setAttributes(e,n){return this}_calculateVertexCount(e,n){if(n)return n.value.length;let s=1/0;for(const r of Object.values(e)){const{value:i,size:o,constant:a}=r;!a&&i&&o>=1&&(s=Math.min(s,i.length/o))}return oe(Number.isFinite(s)),s}}class vu{constructor(e={}){p(this,"id");p(this,"matrix",new q);p(this,"display",!0);p(this,"position",new x);p(this,"rotation",new x);p(this,"scale",new x(1,1,1));p(this,"userData",{});p(this,"props",{});const{id:n}=e;this.id=n||Js(this.constructor.name),this._setScenegraphNodeProps(e)}getBounds(){return null}destroy(){}delete(){this.destroy()}setProps(e){return this._setScenegraphNodeProps(e),this}toString(){return`{type: ScenegraphNode, id: ${this.id})}`}setPosition(e){return oe(e.length===3,"setPosition requires vector argument"),this.position=e,this}setRotation(e){return oe(e.length===3,"setRotation requires vector argument"),this.rotation=e,this}setScale(e){return oe(e.length===3,"setScale requires vector argument"),this.scale=e,this}setMatrix(e,n=!0){n?this.matrix.copy(e):this.matrix=e}setMatrixComponents(e){const{position:n,rotation:s,scale:r,update:i=!0}=e;return n&&this.setPosition(n),s&&this.setRotation(s),r&&this.setScale(r),i&&this.updateMatrix(),this}updateMatrix(){const e=this.position,n=this.rotation,s=this.scale;return this.matrix.identity(),this.matrix.translate(e),this.matrix.rotateXYZ(n),this.matrix.scale(s),this}update(e={}){const{position:n,rotation:s,scale:r}=e;return n&&this.setPosition(n),s&&this.setRotation(s),r&&this.setScale(r),this.updateMatrix(),this}getCoordinateUniforms(e,n){oe(e),n=n||this.matrix;const s=new q(e).multiplyRight(n),r=s.invert(),i=r.transpose();return{viewMatrix:e,modelMatrix:n,objectMatrix:n,worldMatrix:s,worldInverseMatrix:r,worldInverseTransposeMatrix:i}}_setScenegraphNodeProps(e){"display"in e&&(this.display=e.display),"position"in e&&this.setPosition(e.position),"rotation"in e&&this.setRotation(e.rotation),"scale"in e&&this.setScale(e.scale),"matrix"in e&&this.setMatrix(e.matrix),Object.assign(this.props,e)}}class Ni extends vu{constructor(n={}){n=Array.isArray(n)?{children:n}:n;const{children:s=[]}=n;U.assert(s.every(r=>r instanceof vu),"every child must an instance of ScenegraphNode");super(n);p(this,"children");this.children=s}getBounds(){const n=[[1/0,1/0,1/0],[-1/0,-1/0,-1/0]];return this.traverse((s,{worldMatrix:r})=>{const i=s.getBounds();if(!i)return;const[o,a]=i,c=new x(o).add(a).divide([2,2,2]);r.transformAsPoint(c,c);const l=new x(a).subtract(o).divide([2,2,2]);r.transformAsVector(l,l);for(let u=0;u<8;u++){const h=new x(u&1?-1:1,u&2?-1:1,u&4?-1:1).multiply(l).add(c);for(let f=0;f<3;f++)n[0][f]=Math.min(n[0][f],h[f]),n[1][f]=Math.max(n[1][f],h[f])}}),Number.isFinite(n[0][0])?n:null}destroy(){this.children.forEach(n=>n.destroy()),this.removeAll(),super.destroy()}add(...n){for(const s of n)Array.isArray(s)?this.add(...s):this.children.push(s);return this}remove(n){const s=this.children,r=s.indexOf(n);return r>-1&&s.splice(r,1),this}removeAll(){return this.children=[],this}traverse(n,{worldMatrix:s=new q}={}){const r=new q(s).multiplyRight(this.matrix);for(const i of this.children)i instanceof Ni?i.traverse(n,{worldMatrix:r}):n(i,{worldMatrix:r})}}class cg extends vu{constructor(n){super(n);p(this,"model");p(this,"bounds",null);p(this,"managedResources");this.model=n.model,this.managedResources=n.managedResources||[],this.bounds=n.bounds||null,this.setProps(n)}getBounds(){return this.bounds}destroy(){this.model&&(this.model.destroy(),this.model=null),this.managedResources.forEach(n=>n.destroy()),this.managedResources=[]}draw(n){return this.model.draw(n)}}const FD={blendColorOperation:"add",blendColorSrcFactor:"one",blendColorDstFactor:"zero",blendAlphaOperation:"add",blendAlphaSrcFactor:"constant-alpha",blendAlphaDstFactor:"zero"};class Ew extends Im{constructor(){super(...arguments),this._colorEncoderState=null}render(e){return"pickingFBO"in e?this._drawPickingBuffer(e):super.render(e)}_drawPickingBuffer({layers:e,layerFilter:n,views:s,viewports:r,onViewportActive:i,pickingFBO:o,deviceRect:{x:a,y:c,width:l,height:u},cullRect:h,effects:f,pass:d="picking",pickZ:g,moduleParameters:_}){this.pickZ=g;const E=this._resetColorEncoder(g),m=[a,c,l,u],y=super.render({target:o,layers:e,layerFilter:n,views:s,viewports:r,onViewportActive:i,cullRect:h,effects:f==null?void 0:f.filter(C=>C.useInPicking),pass:d,isPicking:!0,moduleParameters:_,clearColor:[0,0,0,0],colorMask:15,scissorRect:m});return this._colorEncoderState=null,{decodePickingColor:E&&LD.bind(null,E),stats:y}}shouldDrawLayer(e){const{pickable:n,operation:s}=e.props;return n&&s.includes("draw")||s.includes("terrain")||s.includes("mask")}getModuleParameters(){return{picking:{isActive:1,isAttribute:this.pickZ},lightSources:{}}}getLayerParameters(e,n,s){const r={depthMask:!0,depthTest:!0,depthRange:[0,1],...e.props.parameters},{pickable:i,operation:o}=e.props;return!this._colorEncoderState||o.includes("terrain")?r.blend=!1:i&&o.includes("draw")&&(Object.assign(r,FD),r.blend=!0,r.blendColor=DD(this._colorEncoderState,e,s)),r}_resetColorEncoder(e){return this._colorEncoderState=e?null:{byLayer:new Map,byAlpha:[]},this._colorEncoderState}}function DD(t,e,n){const{byLayer:s,byAlpha:r}=t;let i,o=s.get(e);return o?(o.viewports.push(n),i=o.a):(i=s.size+1,i<=255?(o={a:i,layer:e,viewports:[n]},s.set(e,o),r[i]=o):(J.warn("Too many pickable layers, only picking the first 255")(),i=0)),[0,0,0,i/255]}function LD(t,e){const n=t.byAlpha[e[3]];return n&&{pickedLayer:n.layer,pickedViewports:n.viewports,pickedObjectIndex:n.layer.decodePickingColor(e)}}const ei={NO_STATE:"Awaiting state",MATCHED:"Matched. State transferred from previous layer",INITIALIZED:"Initialized",AWAITING_GC:"Discarded. Awaiting garbage collection",AWAITING_FINALIZATION:"No longer matched. Awaiting garbage collection",FINALIZED:"Finalized! Awaiting garbage collection"},wu=Symbol.for("component"),Us=Symbol.for("propTypes"),sd=Symbol.for("deprecatedProps"),Fi=Symbol.for("asyncPropDefaults"),Mr=Symbol.for("asyncPropOriginal"),Rs=Symbol.for("asyncPropResolved");function Uh(t,e=()=>!0){return Array.isArray(t)?Sw(t,e,[]):e(t)?[t]:[]}function Sw(t,e,n){let s=-1;for(;++s<t.length;){const r=t[s];Array.isArray(r)?Sw(r,e,n):e(r)&&n.push(r)}return n}function UD({target:t,source:e,start:n=0,count:s=1}){const r=e.length,i=s*r;let o=0;for(let a=n;o<r;o++)t[a++]=e[o];for(;o<i;)o<i-o?(t.copyWithin(n+o,n,n+o),o*=2):(t.copyWithin(n+o,n,n+i-o),o=i);return t}class kD{constructor(e,n,s){this._loadCount=0,this._subscribers=new Set,this.id=e,this.context=s,this.setData(n)}subscribe(e){this._subscribers.add(e)}unsubscribe(e){this._subscribers.delete(e)}inUse(){return this._subscribers.size>0}delete(){}getData(){return this.isLoaded?this._error?Promise.reject(this._error):this._content:this._loader.then(()=>this.getData())}setData(e,n){if(e===this._data&&!n)return;this._data=e;const s=++this._loadCount;let r=e;typeof e=="string"&&(r=os(e)),r instanceof Promise?(this.isLoaded=!1,this._loader=r.then(i=>{this._loadCount===s&&(this.isLoaded=!0,this._error=void 0,this._content=i)}).catch(i=>{this._loadCount===s&&(this.isLoaded=!0,this._error=i||!0)})):(this.isLoaded=!0,this._error=void 0,this._content=e);for(const i of this._subscribers)i.onChange(this.getData())}}class zD{constructor(e){var n;this.protocol=e.protocol||"resource://",this._context={device:e.device,gl:(n=e.device)==null?void 0:n.gl,resourceManager:this},this._resources={},this._consumers={},this._pruneRequest=null}contains(e){return e.startsWith(this.protocol)?!0:e in this._resources}add({resourceId:e,data:n,forceUpdate:s=!1,persistent:r=!0}){let i=this._resources[e];i?i.setData(n,s):(i=new kD(e,n,this._context),this._resources[e]=i),i.persistent=r}remove(e){const n=this._resources[e];n&&(n.delete(),delete this._resources[e])}unsubscribe({consumerId:e}){const n=this._consumers[e];if(n){for(const s in n){const r=n[s],i=this._resources[r.resourceId];i&&i.unsubscribe(r)}delete this._consumers[e],this.prune()}}subscribe({resourceId:e,onChange:n,consumerId:s,requestId:r="default"}){const{_resources:i,protocol:o}=this;e.startsWith(o)&&(e=e.replace(o,""),i[e]||this.add({resourceId:e,data:null,persistent:!1}));const a=i[e];if(this._track(s,r,a,n),a)return a.getData()}prune(){this._pruneRequest||(this._pruneRequest=setTimeout(()=>this._prune(),0))}finalize(){for(const e in this._resources)this._resources[e].delete()}_track(e,n,s,r){const i=this._consumers,o=i[e]=i[e]||{};let a=o[n];const c=a&&a.resourceId&&this._resources[a.resourceId];c&&(c.unsubscribe(a),this.prune()),s&&(a?(a.onChange=r,a.resourceId=s.id):a={onChange:r,resourceId:s.id},o[n]=a,s.subscribe(a))}_prune(){this._pruneRequest=null;for(const e of Object.keys(this._resources)){const n=this._resources[e];!n.persistent&&!n.inUse()&&(n.delete(),delete this._resources[e])}}}const VD="layerManager.setLayers",HD="layerManager.activateViewport";class jD{constructor(e,n){this._lastRenderedLayers=[],this._needsRedraw=!1,this._needsUpdate=!1,this._nextLayers=null,this._debug=!1,this._defaultShaderModulesChanged=!1,this.activateViewport=a=>{Ze(HD,this,a),a&&(this.context.viewport=a)};const{deck:s,stats:r,viewport:i,timeline:o}=n||{};this.layers=[],this.resourceManager=new zD({device:e,protocol:"deck://"}),this.context={mousePosition:null,userData:{},layerManager:this,device:e,gl:e==null?void 0:e.gl,deck:s,shaderAssembler:qF(),defaultShaderModules:[],renderPass:void 0,stats:r||new oo({id:"deck.gl"}),viewport:i||new Da({id:"DEFAULT-INITIAL-VIEWPORT"}),timeline:o||new Tw,resourceManager:this.resourceManager,onError:void 0},Object.seal(this)}finalize(){this.resourceManager.finalize();for(const e of this.layers)this._finalizeLayer(e)}needsRedraw(e={clearRedrawFlags:!1}){let n=this._needsRedraw;e.clearRedrawFlags&&(this._needsRedraw=!1);for(const s of this.layers){const r=s.getNeedsRedraw(e);n=n||r}return n}needsUpdate(){return this._nextLayers&&this._nextLayers!==this._lastRenderedLayers?"layers changed":this._defaultShaderModulesChanged?"shader modules changed":this._needsUpdate}setNeedsRedraw(e){this._needsRedraw=this._needsRedraw||e}setNeedsUpdate(e){this._needsUpdate=this._needsUpdate||e}getLayers({layerIds:e}={}){return e?this.layers.filter(n=>e.find(s=>n.id.indexOf(s)===0)):this.layers}setProps(e){"debug"in e&&(this._debug=e.debug),"userData"in e&&(this.context.userData=e.userData),"layers"in e&&(this._nextLayers=e.layers),"onError"in e&&(this.context.onError=e.onError)}setLayers(e,n){Ze(VD,this,n,e),this._lastRenderedLayers=e;const s=Uh(e,Boolean);for(const r of s)r.context=this.context;this._updateLayers(this.layers,s)}updateLayers(){const e=this.needsUpdate();e&&(this.setNeedsRedraw(`updating layers: ${e}`),this.setLayers(this._nextLayers||this._lastRenderedLayers,e)),this._nextLayers=null}addDefaultShaderModule(e){const{defaultShaderModules:n}=this.context;n.find(s=>s.name===e.name)||(n.push(e),this._defaultShaderModulesChanged=!0)}removeDefaultShaderModule(e){const{defaultShaderModules:n}=this.context,s=n.findIndex(r=>r.name===e.name);s>=0&&(n.splice(s,1),this._defaultShaderModulesChanged=!0)}_handleError(e,n,s){s.raiseError(n,`${e} of ${s}`)}_updateLayers(e,n){const s={};for(const o of e)s[o.id]?J.warn(`Multiple old layers with same id ${o.id}`)():s[o.id]=o;if(this._defaultShaderModulesChanged){for(const o of e)o.setNeedsUpdate(),o.setChangeFlags({extensionsChanged:!0});this._defaultShaderModulesChanged=!1}const r=[];this._updateSublayersRecursively(n,s,r),this._finalizeOldLayers(s);let i=!1;for(const o of r)if(o.hasUniformTransition()){i=`Uniform transition in ${o}`;break}this._needsUpdate=i,this.layers=r}_updateSublayersRecursively(e,n,s){for(const r of e){r.context=this.context;const i=n[r.id];i===null&&J.warn(`Multiple new layers with same id ${r.id}`)(),n[r.id]=null;let o=null;try{this._debug&&i!==r&&r.validateProps(),i?(this._transferLayerState(i,r),this._updateLayer(r)):this._initializeLayer(r),s.push(r),o=r.isComposite?r.getSubLayers():null}catch(a){this._handleError("matching",a,r)}o&&this._updateSublayersRecursively(o,n,s)}}_finalizeOldLayers(e){for(const n in e){const s=e[n];s&&this._finalizeLayer(s)}}_initializeLayer(e){try{e._initialize(),e.lifecycle=ei.INITIALIZED}catch(n){this._handleError("initialization",n,e)}}_transferLayerState(e,n){n._transferState(e),n.lifecycle=ei.MATCHED,n!==e&&(e.lifecycle=ei.AWAITING_GC)}_updateLayer(e){try{e._update()}catch(n){this._handleError("update",n,e)}}_finalizeLayer(e){this._needsRedraw=this._needsRedraw||`finalized ${e}`,e.lifecycle=ei.AWAITING_FINALIZATION;try{e._finalize(),e.lifecycle=ei.FINALIZED}catch(n){this._handleError("finalization",n,e)}}}function hn(t,e,n){if(t===e)return!0;if(!n||!t||!e)return!1;if(Array.isArray(t)){if(!Array.isArray(e)||t.length!==e.length)return!1;for(let s=0;s<t.length;s++)if(!hn(t[s],e[s],n-1))return!1;return!0}if(Array.isArray(e))return!1;if(typeof t=="object"&&typeof e=="object"){const s=Object.keys(t),r=Object.keys(e);if(s.length!==r.length)return!1;for(const i of s)if(!e.hasOwnProperty(i)||!hn(t[i],e[i],n-1))return!1;return!0}return!1}class WD{constructor(e){this.views=[],this.width=100,this.height=100,this.viewState={},this.controllers={},this.timeline=e.timeline,this._viewports=[],this._viewportMap={},this._isUpdating=!1,this._needsRedraw="First render",this._needsUpdate="Initialize",this._eventManager=e.eventManager,this._eventCallbacks={onViewStateChange:e.onViewStateChange,onInteractionStateChange:e.onInteractionStateChange},Object.seal(this),this.setProps(e)}finalize(){for(const e in this.controllers){const n=this.controllers[e];n&&n.finalize()}this.controllers={}}needsRedraw(e={clearRedrawFlags:!1}){const n=this._needsRedraw;return e.clearRedrawFlags&&(this._needsRedraw=!1),n}setNeedsUpdate(e){this._needsUpdate=this._needsUpdate||e,this._needsRedraw=this._needsRedraw||e}updateViewStates(){for(const e in this.controllers){const n=this.controllers[e];n&&n.updateTransition()}}getViewports(e){return e?this._viewports.filter(n=>n.containsPixel(e)):this._viewports}getViews(){const e={};return this.views.forEach(n=>{e[n.id]=n}),e}getView(e){return this.views.find(n=>n.id===e)}getViewState(e){const n=typeof e=="string"?this.getView(e):e,s=n&&this.viewState[n.getViewStateId()]||this.viewState;return n?n.filterViewState(s):s}getViewport(e){return this._viewportMap[e]}unproject(e,n){const s=this.getViewports(),r={x:e[0],y:e[1]};for(let i=s.length-1;i>=0;--i){const o=s[i];if(o.containsPixel(r)){const a=e.slice();return a[0]-=o.x,a[1]-=o.y,o.unproject(a,n)}}return null}setProps(e){e.views&&this._setViews(e.views),e.viewState&&this._setViewState(e.viewState),("width"in e||"height"in e)&&this._setSize(e.width,e.height),this._isUpdating||this._update()}_update(){this._isUpdating=!0,this._needsUpdate&&(this._needsUpdate=!1,this._rebuildViewports()),this._needsUpdate&&(this._needsUpdate=!1,this._rebuildViewports()),this._isUpdating=!1}_setSize(e,n){(e!==this.width||n!==this.height)&&(this.width=e,this.height=n,this.setNeedsUpdate("Size changed"))}_setViews(e){e=Uh(e,Boolean),this._diffViews(e,this.views)&&this.setNeedsUpdate("views changed"),this.views=e}_setViewState(e){e?(!hn(e,this.viewState,3)&&this.setNeedsUpdate("viewState changed"),this.viewState=e):J.warn("missing `viewState` or `initialViewState`")()}_createController(e,n){const s=n.type;return new s({timeline:this.timeline,eventManager:this._eventManager,onViewStateChange:this._eventCallbacks.onViewStateChange,onStateChange:this._eventCallbacks.onInteractionStateChange,makeViewport:i=>{var o;return(o=this.getView(e.id))==null?void 0:o.makeViewport({viewState:i,width:this.width,height:this.height})}})}_updateController(e,n,s,r){const i=e.controller;if(i&&s){const o={...n,...i,id:e.id,x:s.x,y:s.y,width:s.width,height:s.height};return(!r||r.constructor!==i.type)&&(r=this._createController(e,o)),r&&r.setProps(o),r}return null}_rebuildViewports(){const{views:e}=this,n=this.controllers;this._viewports=[],this.controllers={};let s=!1;for(let r=e.length;r--;){const i=e[r],o=this.getViewState(i),a=i.makeViewport({viewState:o,width:this.width,height:this.height});let c=n[i.id];const l=!!i.controller;l&&!c&&(s=!0),(s||!l)&&c&&(c.finalize(),c=null),this.controllers[i.id]=this._updateController(i,o,a,c),a&&this._viewports.unshift(a)}for(const r in n){const i=n[r];i&&!this.controllers[r]&&i.finalize()}this._buildViewportMap()}_buildViewportMap(){this._viewportMap={},this._viewports.forEach(e=>{e.id&&(this._viewportMap[e.id]=this._viewportMap[e.id]||e)})}_diffViews(e,n){return e.length!==n.length?!0:e.some((s,r)=>!e[r].equals(n[r]))}}const GD=/([0-9]+\.?[0-9]*)(%|px)/;function ds(t){switch(typeof t){case"number":return{position:t,relative:!1};case"string":const e=GD.exec(t);if(e&&e.length>=3){const n=e[2]==="%",s=parseFloat(e[1]);return{position:n?s/100:s,relative:n}}default:throw new Error(`Could not parse position string ${t}`)}}function ps(t,e){return t.relative?Math.round(t.position*e):t.position}class qi{constructor(e){const{id:n,x:s=0,y:r=0,width:i="100%",height:o="100%",padding:a=null}=e;this.id=n||this.constructor.displayName||"view",this.props={...e,id:this.id},this._x=ds(s),this._y=ds(r),this._width=ds(i),this._height=ds(o),this._padding=a&&{left:ds(a.left||0),right:ds(a.right||0),top:ds(a.top||0),bottom:ds(a.bottom||0)},this.equals=this.equals.bind(this),Object.seal(this)}equals(e){return this===e?!0:this.ViewportType===e.ViewportType&&hn(this.props,e.props,2)}makeViewport({width:e,height:n,viewState:s}){s=this.filterViewState(s);const r=this.getDimensions({width:e,height:n});return!r.height||!r.width?null:new this.ViewportType({...s,...this.props,...r})}getViewStateId(){const{viewState:e}=this.props;return typeof e=="string"?e:(e==null?void 0:e.id)||this.id}filterViewState(e){if(this.props.viewState&&typeof this.props.viewState=="object"){if(!this.props.viewState.id)return this.props.viewState;const n={...e};for(const s in this.props.viewState)s!=="id"&&(n[s]=this.props.viewState[s]);return n}return e}getDimensions({width:e,height:n}){const s={x:ps(this._x,e),y:ps(this._y,n),width:ps(this._width,e),height:ps(this._height,n)};return this._padding&&(s.padding={left:ps(this._padding.left,e),top:ps(this._padding.top,n),right:ps(this._padding.right,e),bottom:ps(this._padding.bottom,n)}),s}get controller(){const e=this.props.controller;return e?e===!0?{type:this.ControllerType}:typeof e=="function"?{type:e}:{type:this.ControllerType,...e}:null}}class kh{constructor(e){this._inProgress=!1,this._handle=null,this.time=0,this.settings={duration:0},this._timeline=e}get inProgress(){return this._inProgress}start(e){var n,s;this.cancel(),this.settings=e,this._inProgress=!0,(s=(n=this.settings).onStart)==null||s.call(n,this)}end(){var e,n;this._inProgress&&(this._timeline.removeChannel(this._handle),this._handle=null,this._inProgress=!1,(n=(e=this.settings).onEnd)==null||n.call(e,this))}cancel(){var e,n;this._inProgress&&((n=(e=this.settings).onInterrupt)==null||n.call(e,this),this._timeline.removeChannel(this._handle),this._handle=null,this._inProgress=!1)}update(){var e,n;if(!this._inProgress)return!1;if(this._handle===null){const{_timeline:s,settings:r}=this;this._handle=s.addChannel({delay:s.getTime(),duration:r.duration})}return this.time=this._timeline.getTime(this._handle),this._onUpdate(),(n=(e=this.settings).onUpdate)==null||n.call(e,this),this._timeline.isFinished(this._handle)&&this.end(),!0}_onUpdate(){}}const $0=()=>{},lg={BREAK:1,SNAP_TO_END:2,IGNORE:3},XD=t=>t,$D=lg.BREAK;class KD{constructor(e){this._onTransitionUpdate=n=>{const{time:s,settings:{interpolator:r,startProps:i,endProps:o,duration:a,easing:c}}=n,l=c(s/a),u=r.interpolateProps(i,o,l);this.propsInTransition=this.getControllerState({...this.props,...u}).getViewportProps(),this.onViewStateChange({viewState:this.propsInTransition,oldViewState:this.props})},this.getControllerState=e.getControllerState,this.propsInTransition=null,this.transition=new kh(e.timeline),this.onViewStateChange=e.onViewStateChange||$0,this.onStateChange=e.onStateChange||$0}finalize(){this.transition.cancel()}getViewportInTransition(){return this.propsInTransition}processViewStateChange(e){let n=!1;const s=this.props;if(this.props=e,!s||this._shouldIgnoreViewportChange(s,e))return!1;if(this._isTransitionEnabled(e)){let r=s;if(this.transition.inProgress){const{interruption:i,endProps:o}=this.transition.settings;r={...s,...i===lg.SNAP_TO_END?o:this.propsInTransition||s}}this._triggerTransition(r,e),n=!0}else this.transition.cancel();return n}updateTransition(){this.transition.update()}_isTransitionEnabled(e){const{transitionDuration:n,transitionInterpolator:s}=e;return(n>0||n==="auto")&&!!s}_isUpdateDueToCurrentTransition(e){return this.transition.inProgress&&this.propsInTransition?this.transition.settings.interpolator.arePropsEqual(e,this.propsInTransition):!1}_shouldIgnoreViewportChange(e,n){return this.transition.inProgress?this.transition.settings.interruption===lg.IGNORE||this._isUpdateDueToCurrentTransition(n):this._isTransitionEnabled(n)?n.transitionInterpolator.arePropsEqual(e,n):!0}_triggerTransition(e,n){const s=this.getControllerState(e),r=this.getControllerState(n).shortestPathFrom(s),i=n.transitionInterpolator,o=i.getDuration?i.getDuration(e,n):n.transitionDuration;if(o===0)return;const a=i.initializeProps(e,r);this.propsInTransition={};const c={duration:o,easing:n.transitionEasing||XD,interpolator:i,interruption:n.transitionInterruption||$D,startProps:a.start,endProps:a.end,onStart:n.onTransitionStart,onUpdate:this._onTransitionUpdate,onInterrupt:this._onTransitionEnd(n.onTransitionInterrupt),onEnd:this._onTransitionEnd(n.onTransitionEnd)};this.transition.start(c),this.onStateChange({inTransition:!0}),this.updateTransition()}_onTransitionEnd(e){return n=>{this.propsInTransition=null,this.onStateChange({inTransition:!1,isZooming:!1,isPanning:!1,isRotating:!1}),e==null||e(n)}}}function Xe(t,e){if(!t)throw new Error(e||"deck.gl: assertion failed.")}class YD{constructor(e){const{compare:n,extract:s,required:r}=e;this._propsToCompare=n,this._propsToExtract=s||n,this._requiredProps=r}arePropsEqual(e,n){for(const s of this._propsToCompare)if(!(s in e)||!(s in n)||!Xt(e[s],n[s]))return!1;return!0}initializeProps(e,n){const s={},r={};for(const i of this._propsToExtract)(i in e||i in n)&&(s[i]=e[i],r[i]=n[i]);return this._checkRequiredProps(s),this._checkRequiredProps(r),{start:s,end:r}}getDuration(e,n){return n.transitionDuration}_checkRequiredProps(e){this._requiredProps&&this._requiredProps.forEach(n=>{const s=e[n];Xe(Number.isFinite(s)||Array.isArray(s),`${n} is required for transition`)})}}const JD=["longitude","latitude","zoom","bearing","pitch"],qD=["longitude","latitude","zoom"];class Cw extends YD{constructor(e={}){const n=Array.isArray(e)?e:e.transitionProps,s=Array.isArray(e)?{}:e;s.transitionProps=Array.isArray(n)?{compare:n,required:n}:n||{compare:JD,required:qD},super(s.transitionProps),this.opts=s}initializeProps(e,n){const s=super.initializeProps(e,n),{makeViewport:r,around:i}=this.opts;if(r&&i){const o=r(e),a=r(n),c=o.unproject(i);s.start.around=i,Object.assign(s.end,{around:a.project(c),aroundPosition:c,width:n.width,height:n.height})}return s}interpolateProps(e,n,s){const r={};for(const i of this._propsToExtract)r[i]=Tu(e[i]||0,n[i]||0,s);if(n.aroundPosition&&this.opts.makeViewport){const i=this.opts.makeViewport({...n,...r});Object.assign(r,i.panByPosition(n.aroundPosition,Tu(e.around,n.around,s)))}return r}}const gs={transitionDuration:0},ZD=300,Wc=t=>1-(1-t)*(1-t),Jr={WHEEL:["wheel"],PAN:["panstart","panmove","panend"],PINCH:["pinchstart","pinchmove","pinchend"],TRIPLE_PAN:["tripanstart","tripanmove","tripanend"],DOUBLE_TAP:["doubletap"],KEYBOARD:["keydown"]},sr={};class QD{constructor(e){this.state={},this._events={},this._interactionState={isDragging:!1},this._customEvents=[],this._eventStartBlocked=null,this._panMove=!1,this.invertPan=!1,this.dragMode="rotate",this.inertia=0,this.scrollZoom=!0,this.dragPan=!0,this.dragRotate=!0,this.doubleClickZoom=!0,this.touchZoom=!0,this.touchRotate=!1,this.keyboard=!0,this.transitionManager=new KD({...e,getControllerState:n=>new this.ControllerState(n),onViewStateChange:this._onTransition.bind(this),onStateChange:this._setInteractionState.bind(this)}),this.handleEvent=this.handleEvent.bind(this),this.eventManager=e.eventManager,this.onViewStateChange=e.onViewStateChange||(()=>{}),this.onStateChange=e.onStateChange||(()=>{}),this.makeViewport=e.makeViewport}set events(e){this.toggleEvents(this._customEvents,!1),this.toggleEvents(e,!0),this._customEvents=e,this.props&&this.setProps(this.props)}finalize(){var e;for(const n in this._events)this._events[n]&&((e=this.eventManager)==null||e.off(n,this.handleEvent));this.transitionManager.finalize()}handleEvent(e){this._controllerState=void 0;const n=this._eventStartBlocked;switch(e.type){case"panstart":return n?!1:this._onPanStart(e);case"panmove":return this._onPan(e);case"panend":return this._onPanEnd(e);case"pinchstart":return n?!1:this._onPinchStart(e);case"pinchmove":return this._onPinch(e);case"pinchend":return this._onPinchEnd(e);case"tripanstart":return n?!1:this._onTriplePanStart(e);case"tripanmove":return this._onTriplePan(e);case"tripanend":return this._onTriplePanEnd(e);case"doubletap":return this._onDoubleTap(e);case"wheel":return this._onWheel(e);case"keydown":return this._onKeyDown(e);default:return!1}}get controllerState(){return this._controllerState=this._controllerState||new this.ControllerState({makeViewport:this.makeViewport,...this.props,...this.state}),this._controllerState}getCenter(e){const{x:n,y:s}=this.props,{offsetCenter:r}=e;return[r.x-n,r.y-s]}isPointInBounds(e,n){const{width:s,height:r}=this.props;if(n&&n.handled)return!1;const i=e[0]>=0&&e[0]<=s&&e[1]>=0&&e[1]<=r;return i&&n&&n.stopPropagation(),i}isFunctionKeyPressed(e){const{srcEvent:n}=e;return!!(n.metaKey||n.altKey||n.ctrlKey||n.shiftKey)}isDragging(){return this._interactionState.isDragging||!1}blockEvents(e){const n=setTimeout(()=>{this._eventStartBlocked===n&&(this._eventStartBlocked=null)},e);this._eventStartBlocked=n}setProps(e){e.dragMode&&(this.dragMode=e.dragMode),this.props=e,"transitionInterpolator"in e||(e.transitionInterpolator=this._getTransitionProps().transitionInterpolator),this.transitionManager.processViewStateChange(e);const{inertia:n}=e;this.inertia=Number.isFinite(n)?n:n===!0?ZD:0;const{scrollZoom:s=!0,dragPan:r=!0,dragRotate:i=!0,doubleClickZoom:o=!0,touchZoom:a=!0,touchRotate:c=!1,keyboard:l=!0}=e,u=!!this.onViewStateChange;this.toggleEvents(Jr.WHEEL,u&&s),this.toggleEvents(Jr.PAN,u),this.toggleEvents(Jr.PINCH,u&&(a||c)),this.toggleEvents(Jr.TRIPLE_PAN,u&&c),this.toggleEvents(Jr.DOUBLE_TAP,u&&o),this.toggleEvents(Jr.KEYBOARD,u&&l),this.scrollZoom=s,this.dragPan=r,this.dragRotate=i,this.doubleClickZoom=o,this.touchZoom=a,this.touchRotate=c,this.keyboard=l}updateTransition(){this.transitionManager.updateTransition()}toggleEvents(e,n){this.eventManager&&e.forEach(s=>{this._events[s]!==n&&(this._events[s]=n,n?this.eventManager.on(s,this.handleEvent):this.eventManager.off(s,this.handleEvent))})}updateViewport(e,n=null,s={}){const r={...e.getViewportProps(),...n},i=this.controllerState!==e;if(this.state=e.getState(),this._setInteractionState(s),i){const o=this.controllerState&&this.controllerState.getViewportProps();this.onViewStateChange&&this.onViewStateChange({viewState:r,interactionState:this._interactionState,oldViewState:o,viewId:this.props.id})}}_onTransition(e){this.onViewStateChange({...e,interactionState:this._interactionState,viewId:this.props.id})}_setInteractionState(e){Object.assign(this._interactionState,e),this.onStateChange(this._interactionState)}_onPanStart(e){const n=this.getCenter(e);if(!this.isPointInBounds(n,e))return!1;let s=this.isFunctionKeyPressed(e)||e.rightButton||!1;(this.invertPan||this.dragMode==="pan")&&(s=!s);const r=this.controllerState[s?"panStart":"rotateStart"]({pos:n});return this._panMove=s,this.updateViewport(r,gs,{isDragging:!0}),!0}_onPan(e){return this.isDragging()?this._panMove?this._onPanMove(e):this._onPanRotate(e):!1}_onPanEnd(e){return this.isDragging()?this._panMove?this._onPanMoveEnd(e):this._onPanRotateEnd(e):!1}_onPanMove(e){if(!this.dragPan)return!1;const n=this.getCenter(e),s=this.controllerState.pan({pos:n});return this.updateViewport(s,gs,{isDragging:!0,isPanning:!0}),!0}_onPanMoveEnd(e){const{inertia:n}=this;if(this.dragPan&&n&&e.velocity){const s=this.getCenter(e),r=[s[0]+e.velocityX*n/2,s[1]+e.velocityY*n/2],i=this.controllerState.pan({pos:r}).panEnd();this.updateViewport(i,{...this._getTransitionProps(),transitionDuration:n,transitionEasing:Wc},{isDragging:!1,isPanning:!0})}else{const s=this.controllerState.panEnd();this.updateViewport(s,null,{isDragging:!1,isPanning:!1})}return!0}_onPanRotate(e){if(!this.dragRotate)return!1;const n=this.getCenter(e),s=this.controllerState.rotate({pos:n});return this.updateViewport(s,gs,{isDragging:!0,isRotating:!0}),!0}_onPanRotateEnd(e){const{inertia:n}=this;if(this.dragRotate&&n&&e.velocity){const s=this.getCenter(e),r=[s[0]+e.velocityX*n/2,s[1]+e.velocityY*n/2],i=this.controllerState.rotate({pos:r}).rotateEnd();this.updateViewport(i,{...this._getTransitionProps(),transitionDuration:n,transitionEasing:Wc},{isDragging:!1,isRotating:!0})}else{const s=this.controllerState.rotateEnd();this.updateViewport(s,null,{isDragging:!1,isRotating:!1})}return!0}_onWheel(e){if(!this.scrollZoom)return!1;const n=this.getCenter(e);if(!this.isPointInBounds(n,e))return!1;e.srcEvent.preventDefault();const{speed:s=.01,smooth:r=!1}=this.scrollZoom===!0?{}:this.scrollZoom,{delta:i}=e;let o=2/(1+Math.exp(-Math.abs(i*s)));i<0&&o!==0&&(o=1/o);const a=this.controllerState.zoom({pos:n,scale:o});return this.updateViewport(a,{...this._getTransitionProps({around:n}),transitionDuration:r?250:1},{isZooming:!0,isPanning:!0}),!0}_onTriplePanStart(e){const n=this.getCenter(e);if(!this.isPointInBounds(n,e))return!1;const s=this.controllerState.rotateStart({pos:n});return this.updateViewport(s,gs,{isDragging:!0}),!0}_onTriplePan(e){if(!this.touchRotate||!this.isDragging())return!1;const n=this.getCenter(e);n[0]-=e.deltaX;const s=this.controllerState.rotate({pos:n});return this.updateViewport(s,gs,{isDragging:!0,isRotating:!0}),!0}_onTriplePanEnd(e){if(!this.isDragging())return!1;const{inertia:n}=this;if(this.touchRotate&&n&&e.velocityY){const s=this.getCenter(e),r=[s[0],s[1]+=e.velocityY*n/2],i=this.controllerState.rotate({pos:r});this.updateViewport(i,{...this._getTransitionProps(),transitionDuration:n,transitionEasing:Wc},{isDragging:!1,isRotating:!0}),this.blockEvents(n)}else{const s=this.controllerState.rotateEnd();this.updateViewport(s,null,{isDragging:!1,isRotating:!1})}return!0}_onPinchStart(e){const n=this.getCenter(e);if(!this.isPointInBounds(n,e))return!1;const s=this.controllerState.zoomStart({pos:n}).rotateStart({pos:n});return sr._startPinchRotation=e.rotation,sr._lastPinchEvent=e,this.updateViewport(s,gs,{isDragging:!0}),!0}_onPinch(e){if(!this.touchZoom&&!this.touchRotate||!this.isDragging())return!1;let n=this.controllerState;if(this.touchZoom){const{scale:s}=e,r=this.getCenter(e);n=n.zoom({pos:r,scale:s})}if(this.touchRotate){const{rotation:s}=e;n=n.rotate({deltaAngleX:sr._startPinchRotation-s})}return this.updateViewport(n,gs,{isDragging:!0,isPanning:this.touchZoom,isZooming:this.touchZoom,isRotating:this.touchRotate}),sr._lastPinchEvent=e,!0}_onPinchEnd(e){if(!this.isDragging())return!1;const{inertia:n}=this,{_lastPinchEvent:s}=sr;if(this.touchZoom&&n&&s&&e.scale!==s.scale){const r=this.getCenter(e);let i=this.controllerState.rotateEnd();const o=Math.log2(e.scale),a=(o-Math.log2(s.scale))/(e.deltaTime-s.deltaTime),c=Math.pow(2,o+a*n/2);i=i.zoom({pos:r,scale:c}).zoomEnd(),this.updateViewport(i,{...this._getTransitionProps({around:r}),transitionDuration:n,transitionEasing:Wc},{isDragging:!1,isPanning:this.touchZoom,isZooming:this.touchZoom,isRotating:!1}),this.blockEvents(n)}else{const r=this.controllerState.zoomEnd().rotateEnd();this.updateViewport(r,null,{isDragging:!1,isPanning:!1,isZooming:!1,isRotating:!1})}return sr._startPinchRotation=null,sr._lastPinchEvent=null,!0}_onDoubleTap(e){if(!this.doubleClickZoom)return!1;const n=this.getCenter(e);if(!this.isPointInBounds(n,e))return!1;const s=this.isFunctionKeyPressed(e),r=this.controllerState.zoom({pos:n,scale:s?.5:2});return this.updateViewport(r,this._getTransitionProps({around:n}),{isZooming:!0,isPanning:!0}),this.blockEvents(100),!0}_onKeyDown(e){if(!this.keyboard)return!1;const n=this.isFunctionKeyPressed(e),{zoomSpeed:s,moveSpeed:r,rotateSpeedX:i,rotateSpeedY:o}=this.keyboard===!0?{}:this.keyboard,{controllerState:a}=this;let c;const l={};switch(e.srcEvent.code){case"Minus":c=n?a.zoomOut(s).zoomOut(s):a.zoomOut(s),l.isZooming=!0;break;case"Equal":c=n?a.zoomIn(s).zoomIn(s):a.zoomIn(s),l.isZooming=!0;break;case"ArrowLeft":n?(c=a.rotateLeft(i),l.isRotating=!0):(c=a.moveLeft(r),l.isPanning=!0);break;case"ArrowRight":n?(c=a.rotateRight(i),l.isRotating=!0):(c=a.moveRight(r),l.isPanning=!0);break;case"ArrowUp":n?(c=a.rotateUp(o),l.isRotating=!0):(c=a.moveUp(r),l.isPanning=!0);break;case"ArrowDown":n?(c=a.rotateDown(o),l.isRotating=!0):(c=a.moveDown(r),l.isPanning=!0);break;default:return!1}return this.updateViewport(c,this._getTransitionProps(),l),!0}_getTransitionProps(e){const{transition:n}=this;return!n||!n.transitionInterpolator?gs:e?{...n,transitionInterpolator:new Cw({...e,...n.transitionInterpolator.opts,makeViewport:this.controllerState.makeViewport})}:n}}class eL{constructor(e,n){this._viewportProps=this.applyConstraints(e),this._state=n}getViewportProps(){return this._viewportProps}getState(){return this._state}}const K0=5,tL=1.2;class nL extends eL{constructor(e){const{width:n,height:s,latitude:r,longitude:i,zoom:o,bearing:a=0,pitch:c=0,altitude:l=1.5,position:u=[0,0,0],maxZoom:h=20,minZoom:f=0,maxPitch:d=60,minPitch:g=0,startPanLngLat:_,startZoomLngLat:E,startRotatePos:m,startBearing:y,startPitch:A,startZoom:C,normalize:b=!0}=e;Xe(Number.isFinite(i)),Xe(Number.isFinite(r)),Xe(Number.isFinite(o)),super({width:n,height:s,latitude:r,longitude:i,zoom:o,bearing:a,pitch:c,altitude:l,maxZoom:h,minZoom:f,maxPitch:d,minPitch:g,normalize:b,position:u},{startPanLngLat:_,startZoomLngLat:E,startRotatePos:m,startBearing:y,startPitch:A,startZoom:C}),this.makeViewport=e.makeViewport}panStart({pos:e}){return this._getUpdatedState({startPanLngLat:this._unproject(e)})}pan({pos:e,startPos:n}){const s=this.getState().startPanLngLat||this._unproject(n);if(!s)return this;const i=this.makeViewport(this.getViewportProps()).panByPosition(s,e);return this._getUpdatedState(i)}panEnd(){return this._getUpdatedState({startPanLngLat:null})}rotateStart({pos:e}){return this._getUpdatedState({startRotatePos:e,startBearing:this.getViewportProps().bearing,startPitch:this.getViewportProps().pitch})}rotate({pos:e,deltaAngleX:n=0,deltaAngleY:s=0}){const{startRotatePos:r,startBearing:i,startPitch:o}=this.getState();if(!r||i===void 0||o===void 0)return this;let a;return e?a=this._getNewRotation(e,r,o,i):a={bearing:i+n,pitch:o+s},this._getUpdatedState(a)}rotateEnd(){return this._getUpdatedState({startBearing:null,startPitch:null})}zoomStart({pos:e}){return this._getUpdatedState({startZoomLngLat:this._unproject(e),startZoom:this.getViewportProps().zoom})}zoom({pos:e,startPos:n,scale:s}){let{startZoom:r,startZoomLngLat:i}=this.getState();if(i||(r=this.getViewportProps().zoom,i=this._unproject(n)||this._unproject(e)),!i)return this;const{maxZoom:o,minZoom:a}=this.getViewportProps();let c=r+Math.log2(s);c=qn(c,a,o);const l=this.makeViewport({...this.getViewportProps(),zoom:c});return this._getUpdatedState({zoom:c,...l.panByPosition(i,e)})}zoomEnd(){return this._getUpdatedState({startZoomLngLat:null,startZoom:null})}zoomIn(e=2){return this._zoomFromCenter(e)}zoomOut(e=2){return this._zoomFromCenter(1/e)}moveLeft(e=100){return this._panFromCenter([e,0])}moveRight(e=100){return this._panFromCenter([-e,0])}moveUp(e=100){return this._panFromCenter([0,e])}moveDown(e=100){return this._panFromCenter([0,-e])}rotateLeft(e=15){return this._getUpdatedState({bearing:this.getViewportProps().bearing-e})}rotateRight(e=15){return this._getUpdatedState({bearing:this.getViewportProps().bearing+e})}rotateUp(e=10){return this._getUpdatedState({pitch:this.getViewportProps().pitch+e})}rotateDown(e=10){return this._getUpdatedState({pitch:this.getViewportProps().pitch-e})}shortestPathFrom(e){const n=e.getViewportProps(),s={...this.getViewportProps()},{bearing:r,longitude:i}=s;return Math.abs(r-n.bearing)>180&&(s.bearing=r<0?r+360:r-360),Math.abs(i-n.longitude)>180&&(s.longitude=i<0?i+360:i-360),s}applyConstraints(e){const{maxZoom:n,minZoom:s,zoom:r}=e;e.zoom=qn(r,s,n);const{maxPitch:i,minPitch:o,pitch:a}=e;e.pitch=qn(a,o,i);const{normalize:c=!0}=e;return c&&Object.assign(e,UF(e)),e}_zoomFromCenter(e){const{width:n,height:s}=this.getViewportProps();return this.zoom({pos:[n/2,s/2],scale:e})}_panFromCenter(e){const{width:n,height:s}=this.getViewportProps();return this.pan({startPos:[n/2,s/2],pos:[n/2+e[0],s/2+e[1]]})}_getUpdatedState(e){return new this.constructor({makeViewport:this.makeViewport,...this.getViewportProps(),...this.getState(),...e})}_unproject(e){const n=this.makeViewport(this.getViewportProps());return e&&n.unproject(e)}_getNewRotation(e,n,s,r){const i=e[0]-n[0],o=e[1]-n[1],a=e[1],c=n[1],{width:l,height:u}=this.getViewportProps(),h=i/l;let f=0;o>0?Math.abs(u-c)>K0&&(f=o/(c-u)*tL):o<0&&c>K0&&(f=1-a/c),f=qn(f,-1,1);const{minPitch:d,maxPitch:g}=this.getViewportProps(),_=r+180*h;let E=s;return f>0?E=s+f*(g-s):f<0&&(E=s-f*(d-s)),{pitch:E,bearing:_}}}class sL extends QD{constructor(){super(...arguments),this.ControllerState=nL,this.transition={transitionDuration:300,transitionInterpolator:new Cw({transitionProps:{compare:["longitude","latitude","zoom","bearing","pitch","position"],required:["longitude","latitude","zoom"]}})},this.dragMode="pan"}setProps(e){e.position=e.position||[0,0,0];const n=this.props;super.setProps(e),(!n||n.height!==e.height)&&this.updateViewport(new this.ControllerState({makeViewport:this.makeViewport,...e,...this.state}))}}const ty=class ty extends qi{constructor(e={}){super(e)}get ViewportType(){return Ji}get ControllerType(){return sL}};ty.displayName="MapView";let ug=ty;const rL=new yw;function iL(t,e){const n=t.order??1/0,s=e.order??1/0;return n-s}class oL{constructor(e){this._resolvedEffects=[],this._defaultEffects=[],this.effects=[],this._context=e,this._needsRedraw="Initial render",this._setEffects([])}addDefaultEffect(e){const n=this._defaultEffects;if(!n.find(s=>s.id===e.id)){const s=n.findIndex(r=>iL(r,e)>0);s<0?n.push(e):n.splice(s,0,e),e.setup(this._context),this._setEffects(this.effects)}}setProps(e){"effects"in e&&(hn(e.effects,this.effects,1)||this._setEffects(e.effects))}needsRedraw(e={clearRedrawFlags:!1}){const n=this._needsRedraw;return e.clearRedrawFlags&&(this._needsRedraw=!1),n}getEffects(){return this._resolvedEffects}_setEffects(e){const n={};for(const r of this.effects)n[r.id]=r;const s=[];for(const r of e){const i=n[r.id];let o=r;i&&i!==r?i.setProps?(i.setProps(r.props),o=i):i.cleanup(this._context):i||r.setup(this._context),s.push(o),delete n[r.id]}for(const r in n)n[r].cleanup(this._context);this.effects=s,this._resolvedEffects=s.concat(this._defaultEffects),e.some(r=>r instanceof yw)||this._resolvedEffects.push(rL),this._needsRedraw="effects changed"}finalize(){for(const e of this._resolvedEffects)e.cleanup(this._context);this.effects.length=0,this._resolvedEffects.length=0,this._defaultEffects.length=0}}class aL extends Im{shouldDrawLayer(e){const{operation:n}=e.props;return n.includes("draw")||n.includes("terrain")}}const cL="deckRenderer.renderLayers";class lL{constructor(e){this.device=e,this.gl=e.gl,this.layerFilter=null,this.drawPickingColors=!1,this.drawLayersPass=new aL(e),this.pickLayersPass=new Ew(e),this.renderCount=0,this._needsRedraw="Initial render",this.renderBuffers=[],this.lastPostProcessEffect=null}setProps(e){this.layerFilter!==e.layerFilter&&(this.layerFilter=e.layerFilter,this._needsRedraw="layerFilter changed"),this.drawPickingColors!==e.drawPickingColors&&(this.drawPickingColors=e.drawPickingColors,this._needsRedraw="drawPickingColors changed")}renderLayers(e){if(!e.viewports.length)return;const n=this.drawPickingColors?this.pickLayersPass:this.drawLayersPass,s={layerFilter:this.layerFilter,isPicking:this.drawPickingColors,...e};s.effects&&this._preRender(s.effects,s);const r=this.lastPostProcessEffect?this.renderBuffers[0]:s.target;this.lastPostProcessEffect&&(s.clearColor=[0,0,0,0],s.clearCanvas=!0);const i=n.render({...s,target:r});s.effects&&this._postRender(s.effects,s),this.renderCount++,Ze(cL,this,i,e)}needsRedraw(e={clearRedrawFlags:!1}){const n=this._needsRedraw;return e.clearRedrawFlags&&(this._needsRedraw=!1),n}finalize(){const{renderBuffers:e}=this;for(const n of e)n.delete();e.length=0}_preRender(e,n){this.lastPostProcessEffect=null,n.preRenderStats=n.preRenderStats||{};for(const s of e)n.preRenderStats[s.id]=s.preRender(n),s.postRender&&(this.lastPostProcessEffect=s.id);this.lastPostProcessEffect&&this._resizeRenderBuffers()}_resizeRenderBuffers(){const{renderBuffers:e}=this,n=this.device.canvasContext.getDrawingBufferSize();e.length===0&&[0,1].map(s=>{const r=this.device.createTexture({sampler:{minFilter:"linear",magFilter:"linear"}});e.push(this.device.createFramebuffer({id:`deck-renderbuffer-${s}`,colorAttachments:[r]}))});for(const s of e)s.resize(n)}_postRender(e,n){const{renderBuffers:s}=this,r={...n,inputBuffer:s[0],swapBuffer:s[1]};for(const i of e)if(i.postRender){r.target=i.id===this.lastPostProcessEffect?n.target:void 0;const o=i.postRender(r);r.inputBuffer=o,r.swapBuffer=o===s[0]?s[1]:s[0]}}}const uL={pickedColor:null,pickedObjectIndex:-1};function hL({pickedColors:t,decodePickingColor:e,deviceX:n,deviceY:s,deviceRadius:r,deviceRect:i}){const{x:o,y:a,width:c,height:l}=i;let u=r*r,h=-1,f=0;for(let d=0;d<l;d++){const g=d+a-s,_=g*g;if(_>u)f+=4*c;else for(let E=0;E<c;E++){if(t[f+3]-1>=0){const y=E+o-n,A=y*y+_;A<=u&&(u=A,h=f)}f+=4}}if(h>=0){const d=t.slice(h,h+4),g=e(d);if(g){const _=Math.floor(h/4/c),E=h/4-_*c;return{...g,pickedColor:d,pickedX:o+E,pickedY:a+_}}J.error("Picked non-existent layer. Is picking buffer corrupt?")()}return uL}function fL({pickedColors:t,decodePickingColor:e}){const n=new Map;if(t){for(let s=0;s<t.length;s+=4)if(t[s+3]-1>=0){const i=t.slice(s,s+4),o=i.join(",");if(!n.has(o)){const a=e(i);a?n.set(o,{...a,color:i}):J.error("Picked non-existent layer. Is picking buffer corrupt?")()}}}return Array.from(n.values())}function vw({pickInfo:t,viewports:e,pixelRatio:n,x:s,y:r,z:i}){let o=e[0];e.length>1&&(o=pL((t==null?void 0:t.pickedViewports)||e,{x:s,y:r}));let a;if(o){const c=[s-o.x,r-o.y];i!==void 0&&(c[2]=i),a=o.unproject(c)}return{color:null,layer:null,viewport:o,index:-1,picked:!1,x:s,y:r,pixel:[s,r],coordinate:a,devicePixel:t&&"pickedX"in t?[t.pickedX,t.pickedY]:void 0,pixelRatio:n}}function dL(t){const{pickInfo:e,lastPickedInfo:n,mode:s,layers:r}=t,{pickedColor:i,pickedLayer:o,pickedObjectIndex:a}=e,c=o?[o]:[];if(s==="hover"){const h=n.index,f=n.layerId,d=o?o.props.id:null;if(d!==f||a!==h){if(d!==f){const g=r.find(_=>_.props.id===f);g&&c.unshift(g)}n.layerId=d,n.index=a,n.info=null}}const l=vw(t),u=new Map;return u.set(null,l),c.forEach(h=>{let f={...l};h===o&&(f.color=i,f.index=a,f.picked=!0),f=ww({layer:h,info:f,mode:s});const d=f.layer;h===o&&s==="hover"&&(n.info=f),u.set(d.id,f),s==="hover"&&d.updateAutoHighlight(f)}),u}function ww({layer:t,info:e,mode:n}){for(;t&&e;){const s=e.layer||null;e.sourceLayer=s,e.layer=t,e=t.getPickingInfo({info:e,mode:n,sourceLayer:s}),t=t.parent}return e}function pL(t,e){for(let n=t.length-1;n>=0;n--){const s=t[n];if(s.containsPixel(e))return s}return t[0]}class gL{constructor(e){this._pickable=!0,this.device=e,this.pickLayersPass=new Ew(e),this.lastPickedInfo={index:-1,layerId:null,info:null}}setProps(e){"layerFilter"in e&&(this.layerFilter=e.layerFilter),"_pickable"in e&&(this._pickable=e._pickable)}finalize(){this.pickingFBO&&this.pickingFBO.destroy(),this.depthFBO&&this.depthFBO.destroy()}pickObject(e){return this._pickClosestObject(e)}pickObjects(e){return this._pickVisibleObjects(e)}getLastPickedObject({x:e,y:n,layers:s,viewports:r},i=this.lastPickedInfo.info){const o=i&&i.layer&&i.layer.id,a=i&&i.viewport&&i.viewport.id,c=o?s.find(f=>f.id===o):null,l=a&&r.find(f=>f.id===a)||r[0],u=l&&l.unproject([e-l.x,n-l.y]);return{...i,...{x:e,y:n,viewport:l,coordinate:u,layer:c}}}_resizeBuffer(){var n,s;if(!this.pickingFBO&&(this.pickingFBO=this.device.createFramebuffer({colorAttachments:["rgba8unorm"],depthStencilAttachment:"depth16unorm"}),this.device.isTextureFormatRenderable("rgba32float"))){const r=this.device.createFramebuffer({colorAttachments:["rgba32float"],depthStencilAttachment:"depth16unorm"});this.depthFBO=r}const e=this.device.gl;(n=this.pickingFBO)==null||n.resize({width:e.canvas.width,height:e.canvas.height}),(s=this.depthFBO)==null||s.resize({width:e.canvas.width,height:e.canvas.height})}_getPickable(e){if(this._pickable===!1)return null;const n=e.filter(s=>this.pickLayersPass.shouldDrawLayer(s)&&!s.isComposite);return n.length?n:null}_pickClosestObject({layers:e,views:n,viewports:s,x:r,y:i,radius:o=0,depth:a=1,mode:c="query",unproject3D:l,onViewportActive:u,effects:h}){const f=this.device.canvasContext.cssToDeviceRatio(),d=this._getPickable(e);if(!d||s.length===0)return{result:[],emptyInfo:vw({viewports:s,x:r,y:i,pixelRatio:f})};this._resizeBuffer();const g=this.device.canvasContext.cssToDevicePixels([r,i],!0),_=[g.x+Math.floor(g.width/2),g.y+Math.floor(g.height/2)],E=Math.round(o*f),{width:m,height:y}=this.pickingFBO,A=this._getPickingRect({deviceX:_[0],deviceY:_[1],deviceRadius:E,deviceWidth:m,deviceHeight:y}),C={x:r-o,y:i-o,width:o*2+1,height:o*2+1};let b;const P=[],B=new Set;for(let O=0;O<a;O++){let N;if(A){const H=this._drawAndSample({layers:d,views:n,viewports:s,onViewportActive:u,deviceRect:A,cullRect:C,effects:h,pass:`picking:${c}`});N=hL({...H,deviceX:_[0],deviceY:_[1],deviceRadius:E,deviceRect:A})}else N={pickedColor:null,pickedObjectIndex:-1};let F;if(N.pickedLayer&&l&&this.depthFBO){const{pickedColors:H}=this._drawAndSample({layers:[N.pickedLayer],views:n,viewports:s,onViewportActive:u,deviceRect:{x:N.pickedX,y:N.pickedY,width:1,height:1},cullRect:C,effects:h,pass:`picking:${c}:z`},!0);H[3]&&(F=H[0])}N.pickedLayer&&O+1<a&&(B.add(N.pickedLayer),N.pickedLayer.disablePickingIndex(N.pickedObjectIndex)),b=dL({pickInfo:N,lastPickedInfo:this.lastPickedInfo,mode:c,layers:d,viewports:s,x:r,y:i,z:F,pixelRatio:f});for(const H of b.values())H.layer&&P.push(H);if(!N.pickedColor)break}for(const O of B)O.restorePickingColors();return{result:P,emptyInfo:b.get(null)}}_pickVisibleObjects({layers:e,views:n,viewports:s,x:r,y:i,width:o=1,height:a=1,mode:c="query",maxObjects:l=null,onViewportActive:u,effects:h}){const f=this._getPickable(e);if(!f||s.length===0)return[];this._resizeBuffer();const d=this.device.canvasContext.cssToDeviceRatio(),g=this.device.canvasContext.cssToDevicePixels([r,i],!0),_=g.x,E=g.y+g.height,m=this.device.canvasContext.cssToDevicePixels([r+o,i+a],!0),y=m.x+m.width,A=m.y,C={x:_,y:A,width:y-_,height:E-A},b=this._drawAndSample({layers:f,views:n,viewports:s,onViewportActive:u,deviceRect:C,cullRect:{x:r,y:i,width:o,height:a},effects:h,pass:`picking:${c}`}),P=fL(b),B=new Map,O=[],N=Number.isFinite(l);for(let F=0;F<P.length&&!(N&&O.length>=l);F++){const H=P[F];let X={color:H.pickedColor,layer:null,index:H.pickedObjectIndex,picked:!0,x:r,y:i,pixelRatio:d};X=ww({layer:H.pickedLayer,info:X,mode:c});const G=X.layer.id;B.has(G)||B.set(G,new Set);const $=B.get(G),Te=X.object??X.index;$.has(Te)||($.add(Te),O.push(X))}return O}_drawAndSample({layers:e,views:n,viewports:s,onViewportActive:r,deviceRect:i,cullRect:o,effects:a,pass:c},l=!1){const u=l?this.depthFBO:this.pickingFBO,h={layers:e,layerFilter:this.layerFilter,views:n,viewports:s,onViewportActive:r,pickingFBO:u,deviceRect:i,cullRect:o,effects:a,pass:c,pickZ:l,preRenderStats:{}};for(const y of a)y.useInPicking&&(h.preRenderStats[y.id]=y.preRender(h));const{decodePickingColor:f}=this.pickLayersPass.render(h),{x:d,y:g,width:_,height:E}=i,m=new(l?Float32Array:Uint8Array)(_*E*4);return this.device.readPixelsToArrayWebGL(u,{sourceX:d,sourceY:g,sourceWidth:_,sourceHeight:E,target:m}),{pickedColors:m,decodePickingColor:f}}_getPickingRect({deviceX:e,deviceY:n,deviceRadius:s,deviceWidth:r,deviceHeight:i}){const o=Math.max(0,e-s),a=Math.max(0,n-s),c=Math.min(r,e+s+1)-o,l=Math.min(i,n+s+1)-a;return c<=0||l<=0?null:{x:o,y:a,width:c,height:l}}}const _L={"top-left":{top:0,left:0},"top-right":{top:0,right:0},"bottom-left":{bottom:0,left:0},"bottom-right":{bottom:0,right:0},fill:{top:0,left:0,bottom:0,right:0}},mL="top-left",Y0="__root";class yL{constructor({deck:e,parentElement:n}){this.defaultWidgets=[],this.widgets=[],this.resolvedWidgets=[],this.containers={},this.lastViewports={},this.deck=e,this.parentElement=n}getWidgets(){return this.resolvedWidgets}setProps(e){e.widgets&&!hn(e.widgets,this.widgets,1)&&this._setWidgets(e.widgets)}finalize(){for(const e of this.getWidgets())this._remove(e);this.defaultWidgets.length=0,this.resolvedWidgets.length=0;for(const e in this.containers)this.containers[e].remove()}addDefault(e){this.defaultWidgets.find(n=>n.id===e.id)||(this._add(e),this.defaultWidgets.push(e),this._setWidgets(this.widgets))}_setWidgets(e){const n={};for(const s of this.resolvedWidgets)n[s.id]=s;this.resolvedWidgets.length=0;for(const s of this.defaultWidgets)n[s.id]=null,this.resolvedWidgets.push(s);for(let s of e){const r=n[s.id];r?r.viewId!==s.viewId||r.placement!==s.placement?(this._remove(r),this._add(s)):s!==r&&(r.setProps(s.props),s=r):this._add(s),n[s.id]=null,this.resolvedWidgets.push(s)}for(const s in n){const r=n[s];r&&this._remove(r)}this.widgets=e}_add(e){const{viewId:n=null,placement:s=mL}=e,r=e.onAdd({deck:this.deck,viewId:n});r&&this._getContainer(n,s).append(r),e._element=r}_remove(e){e.onRemove(),e._element&&e._element.remove(),e._element=void 0}_getContainer(e,n){var o;const s=e||Y0;let r=this.containers[s];r||(r=document.createElement("div"),r.style.pointerEvents="none",r.style.position="absolute",r.style.overflow="hidden",(o=this.parentElement)==null||o.append(r),this.containers[s]=r);let i=r.querySelector(`.${n}`);return i||(i=document.createElement("div"),i.className=n,i.style.position="absolute",Object.assign(i.style,_L[n]),r.append(i)),i}_updateContainers(){const e=this.deck.width,n=this.deck.height;for(const s in this.containers){const r=this.lastViewports[s]||null,i=s===Y0||r,o=this.containers[s];i?(o.style.display="block",o.style.left=`${r?r.x:0}px`,o.style.top=`${r?r.y:0}px`,o.style.width=`${r?r.width:e}px`,o.style.height=`${r?r.height:n}px`):o.style.display="none"}}onRedraw({viewports:e,layers:n}){var i,o;const s=e.reduce((a,c)=>(a[c.id]=c,a),{}),{lastViewports:r}=this;for(const a of this.getWidgets()){const{viewId:c}=a;if(c){const l=s[c];l&&(a.onViewportChange&&!l.equals(r[c])&&a.onViewportChange(l),(i=a.onRedraw)==null||i.call(a,{viewports:[l],layers:n}))}else{if(a.onViewportChange)for(const l of e)l.equals(r[l.id])||a.onViewportChange(l);(o=a.onRedraw)==null||o.call(a,{viewports:e,layers:n})}}this.lastViewports=s,this._updateContainers()}onHover(e,n){var s,r;for(const i of this.getWidgets()){const{viewId:o}=i;(!o||o===((s=e.viewport)==null?void 0:s.id))&&((r=i.onHover)==null||r.call(i,e,n))}}onEvent(e,n){var r,i;const s=ng[n.type];if(s)for(const o of this.getWidgets()){const{viewId:a}=o;(!a||a===((r=e.viewport)==null?void 0:r.id))&&((i=o[s.handler])==null||i.call(o,e,n))}}}const AL={zIndex:"1",position:"absolute",pointerEvents:"none",color:"#a0a7b4",backgroundColor:"#29323c",padding:"10px",top:"0",left:"0",display:"none"};class TL{constructor(){this.id="default-tooltip",this.placement="fill",this.props={},this.isVisible=!1}onAdd({deck:e}){const n=document.createElement("div");return n.className="deck-tooltip",Object.assign(n.style,AL),this.deck=e,this.element=n,n}onRemove(){this.deck=void 0,this.element=void 0}setProps(){}onViewportChange(e){var n;this.isVisible&&e.id===((n=this.lastViewport)==null?void 0:n.id)&&e!==this.lastViewport&&this.setTooltip(null)}onHover(e){const{deck:n}=this,s=n&&n.props.getTooltip;if(!s)return;const r=s(e);this.lastViewport=e.viewport,this.setTooltip(r,e.x,e.y)}setTooltip(e,n,s){const r=this.element;if(r){if(typeof e=="string")r.innerText=e;else if(e)e.text&&(r.innerText=e.text),e.html&&(r.innerHTML=e.html),e.className&&(r.className=e.className);else{this.isVisible=!1,r.style.display="none";return}this.isVisible=!0,r.style.display="block",r.style.transform=`translate(${n}px, ${s}px)`,e&&typeof e=="object"&&"style"in e&&Object.assign(r.style,e.style)}}}var gi;(function(t){t[t.DEPTH_BUFFER_BIT=256]="DEPTH_BUFFER_BIT",t[t.STENCIL_BUFFER_BIT=1024]="STENCIL_BUFFER_BIT",t[t.COLOR_BUFFER_BIT=16384]="COLOR_BUFFER_BIT",t[t.POINTS=0]="POINTS",t[t.LINES=1]="LINES",t[t.LINE_LOOP=2]="LINE_LOOP",t[t.LINE_STRIP=3]="LINE_STRIP",t[t.TRIANGLES=4]="TRIANGLES",t[t.TRIANGLE_STRIP=5]="TRIANGLE_STRIP",t[t.TRIANGLE_FAN=6]="TRIANGLE_FAN",t[t.ZERO=0]="ZERO",t[t.ONE=1]="ONE",t[t.SRC_COLOR=768]="SRC_COLOR",t[t.ONE_MINUS_SRC_COLOR=769]="ONE_MINUS_SRC_COLOR",t[t.SRC_ALPHA=770]="SRC_ALPHA",t[t.ONE_MINUS_SRC_ALPHA=771]="ONE_MINUS_SRC_ALPHA",t[t.DST_ALPHA=772]="DST_ALPHA",t[t.ONE_MINUS_DST_ALPHA=773]="ONE_MINUS_DST_ALPHA",t[t.DST_COLOR=774]="DST_COLOR",t[t.ONE_MINUS_DST_COLOR=775]="ONE_MINUS_DST_COLOR",t[t.SRC_ALPHA_SATURATE=776]="SRC_ALPHA_SATURATE",t[t.CONSTANT_COLOR=32769]="CONSTANT_COLOR",t[t.ONE_MINUS_CONSTANT_COLOR=32770]="ONE_MINUS_CONSTANT_COLOR",t[t.CONSTANT_ALPHA=32771]="CONSTANT_ALPHA",t[t.ONE_MINUS_CONSTANT_ALPHA=32772]="ONE_MINUS_CONSTANT_ALPHA",t[t.FUNC_ADD=32774]="FUNC_ADD",t[t.FUNC_SUBTRACT=32778]="FUNC_SUBTRACT",t[t.FUNC_REVERSE_SUBTRACT=32779]="FUNC_REVERSE_SUBTRACT",t[t.BLEND_EQUATION=32777]="BLEND_EQUATION",t[t.BLEND_EQUATION_RGB=32777]="BLEND_EQUATION_RGB",t[t.BLEND_EQUATION_ALPHA=34877]="BLEND_EQUATION_ALPHA",t[t.BLEND_DST_RGB=32968]="BLEND_DST_RGB",t[t.BLEND_SRC_RGB=32969]="BLEND_SRC_RGB",t[t.BLEND_DST_ALPHA=32970]="BLEND_DST_ALPHA",t[t.BLEND_SRC_ALPHA=32971]="BLEND_SRC_ALPHA",t[t.BLEND_COLOR=32773]="BLEND_COLOR",t[t.ARRAY_BUFFER_BINDING=34964]="ARRAY_BUFFER_BINDING",t[t.ELEMENT_ARRAY_BUFFER_BINDING=34965]="ELEMENT_ARRAY_BUFFER_BINDING",t[t.LINE_WIDTH=2849]="LINE_WIDTH",t[t.ALIASED_POINT_SIZE_RANGE=33901]="ALIASED_POINT_SIZE_RANGE",t[t.ALIASED_LINE_WIDTH_RANGE=33902]="ALIASED_LINE_WIDTH_RANGE",t[t.CULL_FACE_MODE=2885]="CULL_FACE_MODE",t[t.FRONT_FACE=2886]="FRONT_FACE",t[t.DEPTH_RANGE=2928]="DEPTH_RANGE",t[t.DEPTH_WRITEMASK=2930]="DEPTH_WRITEMASK",t[t.DEPTH_CLEAR_VALUE=2931]="DEPTH_CLEAR_VALUE",t[t.DEPTH_FUNC=2932]="DEPTH_FUNC",t[t.STENCIL_CLEAR_VALUE=2961]="STENCIL_CLEAR_VALUE",t[t.STENCIL_FUNC=2962]="STENCIL_FUNC",t[t.STENCIL_FAIL=2964]="STENCIL_FAIL",t[t.STENCIL_PASS_DEPTH_FAIL=2965]="STENCIL_PASS_DEPTH_FAIL",t[t.STENCIL_PASS_DEPTH_PASS=2966]="STENCIL_PASS_DEPTH_PASS",t[t.STENCIL_REF=2967]="STENCIL_REF",t[t.STENCIL_VALUE_MASK=2963]="STENCIL_VALUE_MASK",t[t.STENCIL_WRITEMASK=2968]="STENCIL_WRITEMASK",t[t.STENCIL_BACK_FUNC=34816]="STENCIL_BACK_FUNC",t[t.STENCIL_BACK_FAIL=34817]="STENCIL_BACK_FAIL",t[t.STENCIL_BACK_PASS_DEPTH_FAIL=34818]="STENCIL_BACK_PASS_DEPTH_FAIL",t[t.STENCIL_BACK_PASS_DEPTH_PASS=34819]="STENCIL_BACK_PASS_DEPTH_PASS",t[t.STENCIL_BACK_REF=36003]="STENCIL_BACK_REF",t[t.STENCIL_BACK_VALUE_MASK=36004]="STENCIL_BACK_VALUE_MASK",t[t.STENCIL_BACK_WRITEMASK=36005]="STENCIL_BACK_WRITEMASK",t[t.VIEWPORT=2978]="VIEWPORT",t[t.SCISSOR_BOX=3088]="SCISSOR_BOX",t[t.COLOR_CLEAR_VALUE=3106]="COLOR_CLEAR_VALUE",t[t.COLOR_WRITEMASK=3107]="COLOR_WRITEMASK",t[t.UNPACK_ALIGNMENT=3317]="UNPACK_ALIGNMENT",t[t.PACK_ALIGNMENT=3333]="PACK_ALIGNMENT",t[t.MAX_TEXTURE_SIZE=3379]="MAX_TEXTURE_SIZE",t[t.MAX_VIEWPORT_DIMS=3386]="MAX_VIEWPORT_DIMS",t[t.SUBPIXEL_BITS=3408]="SUBPIXEL_BITS",t[t.RED_BITS=3410]="RED_BITS",t[t.GREEN_BITS=3411]="GREEN_BITS",t[t.BLUE_BITS=3412]="BLUE_BITS",t[t.ALPHA_BITS=3413]="ALPHA_BITS",t[t.DEPTH_BITS=3414]="DEPTH_BITS",t[t.STENCIL_BITS=3415]="STENCIL_BITS",t[t.POLYGON_OFFSET_UNITS=10752]="POLYGON_OFFSET_UNITS",t[t.POLYGON_OFFSET_FACTOR=32824]="POLYGON_OFFSET_FACTOR",t[t.TEXTURE_BINDING_2D=32873]="TEXTURE_BINDING_2D",t[t.SAMPLE_BUFFERS=32936]="SAMPLE_BUFFERS",t[t.SAMPLES=32937]="SAMPLES",t[t.SAMPLE_COVERAGE_VALUE=32938]="SAMPLE_COVERAGE_VALUE",t[t.SAMPLE_COVERAGE_INVERT=32939]="SAMPLE_COVERAGE_INVERT",t[t.COMPRESSED_TEXTURE_FORMATS=34467]="COMPRESSED_TEXTURE_FORMATS",t[t.VENDOR=7936]="VENDOR",t[t.RENDERER=7937]="RENDERER",t[t.VERSION=7938]="VERSION",t[t.IMPLEMENTATION_COLOR_READ_TYPE=35738]="IMPLEMENTATION_COLOR_READ_TYPE",t[t.IMPLEMENTATION_COLOR_READ_FORMAT=35739]="IMPLEMENTATION_COLOR_READ_FORMAT",t[t.BROWSER_DEFAULT_WEBGL=37444]="BROWSER_DEFAULT_WEBGL",t[t.STATIC_DRAW=35044]="STATIC_DRAW",t[t.STREAM_DRAW=35040]="STREAM_DRAW",t[t.DYNAMIC_DRAW=35048]="DYNAMIC_DRAW",t[t.ARRAY_BUFFER=34962]="ARRAY_BUFFER",t[t.ELEMENT_ARRAY_BUFFER=34963]="ELEMENT_ARRAY_BUFFER",t[t.BUFFER_SIZE=34660]="BUFFER_SIZE",t[t.BUFFER_USAGE=34661]="BUFFER_USAGE",t[t.CURRENT_VERTEX_ATTRIB=34342]="CURRENT_VERTEX_ATTRIB",t[t.VERTEX_ATTRIB_ARRAY_ENABLED=34338]="VERTEX_ATTRIB_ARRAY_ENABLED",t[t.VERTEX_ATTRIB_ARRAY_SIZE=34339]="VERTEX_ATTRIB_ARRAY_SIZE",t[t.VERTEX_ATTRIB_ARRAY_STRIDE=34340]="VERTEX_ATTRIB_ARRAY_STRIDE",t[t.VERTEX_ATTRIB_ARRAY_TYPE=34341]="VERTEX_ATTRIB_ARRAY_TYPE",t[t.VERTEX_ATTRIB_ARRAY_NORMALIZED=34922]="VERTEX_ATTRIB_ARRAY_NORMALIZED",t[t.VERTEX_ATTRIB_ARRAY_POINTER=34373]="VERTEX_ATTRIB_ARRAY_POINTER",t[t.VERTEX_ATTRIB_ARRAY_BUFFER_BINDING=34975]="VERTEX_ATTRIB_ARRAY_BUFFER_BINDING",t[t.CULL_FACE=2884]="CULL_FACE",t[t.FRONT=1028]="FRONT",t[t.BACK=1029]="BACK",t[t.FRONT_AND_BACK=1032]="FRONT_AND_BACK",t[t.BLEND=3042]="BLEND",t[t.DEPTH_TEST=2929]="DEPTH_TEST",t[t.DITHER=3024]="DITHER",t[t.POLYGON_OFFSET_FILL=32823]="POLYGON_OFFSET_FILL",t[t.SAMPLE_ALPHA_TO_COVERAGE=32926]="SAMPLE_ALPHA_TO_COVERAGE",t[t.SAMPLE_COVERAGE=32928]="SAMPLE_COVERAGE",t[t.SCISSOR_TEST=3089]="SCISSOR_TEST",t[t.STENCIL_TEST=2960]="STENCIL_TEST",t[t.NO_ERROR=0]="NO_ERROR",t[t.INVALID_ENUM=1280]="INVALID_ENUM",t[t.INVALID_VALUE=1281]="INVALID_VALUE",t[t.INVALID_OPERATION=1282]="INVALID_OPERATION",t[t.OUT_OF_MEMORY=1285]="OUT_OF_MEMORY",t[t.CONTEXT_LOST_WEBGL=37442]="CONTEXT_LOST_WEBGL",t[t.CW=2304]="CW",t[t.CCW=2305]="CCW",t[t.DONT_CARE=4352]="DONT_CARE",t[t.FASTEST=4353]="FASTEST",t[t.NICEST=4354]="NICEST",t[t.GENERATE_MIPMAP_HINT=33170]="GENERATE_MIPMAP_HINT",t[t.BYTE=5120]="BYTE",t[t.UNSIGNED_BYTE=5121]="UNSIGNED_BYTE",t[t.SHORT=5122]="SHORT",t[t.UNSIGNED_SHORT=5123]="UNSIGNED_SHORT",t[t.INT=5124]="INT",t[t.UNSIGNED_INT=5125]="UNSIGNED_INT",t[t.FLOAT=5126]="FLOAT",t[t.DOUBLE=5130]="DOUBLE",t[t.DEPTH_COMPONENT=6402]="DEPTH_COMPONENT",t[t.ALPHA=6406]="ALPHA",t[t.RGB=6407]="RGB",t[t.RGBA=6408]="RGBA",t[t.LUMINANCE=6409]="LUMINANCE",t[t.LUMINANCE_ALPHA=6410]="LUMINANCE_ALPHA",t[t.UNSIGNED_SHORT_4_4_4_4=32819]="UNSIGNED_SHORT_4_4_4_4",t[t.UNSIGNED_SHORT_5_5_5_1=32820]="UNSIGNED_SHORT_5_5_5_1",t[t.UNSIGNED_SHORT_5_6_5=33635]="UNSIGNED_SHORT_5_6_5",t[t.FRAGMENT_SHADER=35632]="FRAGMENT_SHADER",t[t.VERTEX_SHADER=35633]="VERTEX_SHADER",t[t.COMPILE_STATUS=35713]="COMPILE_STATUS",t[t.DELETE_STATUS=35712]="DELETE_STATUS",t[t.LINK_STATUS=35714]="LINK_STATUS",t[t.VALIDATE_STATUS=35715]="VALIDATE_STATUS",t[t.ATTACHED_SHADERS=35717]="ATTACHED_SHADERS",t[t.ACTIVE_ATTRIBUTES=35721]="ACTIVE_ATTRIBUTES",t[t.ACTIVE_UNIFORMS=35718]="ACTIVE_UNIFORMS",t[t.MAX_VERTEX_ATTRIBS=34921]="MAX_VERTEX_ATTRIBS",t[t.MAX_VERTEX_UNIFORM_VECTORS=36347]="MAX_VERTEX_UNIFORM_VECTORS",t[t.MAX_VARYING_VECTORS=36348]="MAX_VARYING_VECTORS",t[t.MAX_COMBINED_TEXTURE_IMAGE_UNITS=35661]="MAX_COMBINED_TEXTURE_IMAGE_UNITS",t[t.MAX_VERTEX_TEXTURE_IMAGE_UNITS=35660]="MAX_VERTEX_TEXTURE_IMAGE_UNITS",t[t.MAX_TEXTURE_IMAGE_UNITS=34930]="MAX_TEXTURE_IMAGE_UNITS",t[t.MAX_FRAGMENT_UNIFORM_VECTORS=36349]="MAX_FRAGMENT_UNIFORM_VECTORS",t[t.SHADER_TYPE=35663]="SHADER_TYPE",t[t.SHADING_LANGUAGE_VERSION=35724]="SHADING_LANGUAGE_VERSION",t[t.CURRENT_PROGRAM=35725]="CURRENT_PROGRAM",t[t.NEVER=512]="NEVER",t[t.LESS=513]="LESS",t[t.EQUAL=514]="EQUAL",t[t.LEQUAL=515]="LEQUAL",t[t.GREATER=516]="GREATER",t[t.NOTEQUAL=517]="NOTEQUAL",t[t.GEQUAL=518]="GEQUAL",t[t.ALWAYS=519]="ALWAYS",t[t.KEEP=7680]="KEEP",t[t.REPLACE=7681]="REPLACE",t[t.INCR=7682]="INCR",t[t.DECR=7683]="DECR",t[t.INVERT=5386]="INVERT",t[t.INCR_WRAP=34055]="INCR_WRAP",t[t.DECR_WRAP=34056]="DECR_WRAP",t[t.NEAREST=9728]="NEAREST",t[t.LINEAR=9729]="LINEAR",t[t.NEAREST_MIPMAP_NEAREST=9984]="NEAREST_MIPMAP_NEAREST",t[t.LINEAR_MIPMAP_NEAREST=9985]="LINEAR_MIPMAP_NEAREST",t[t.NEAREST_MIPMAP_LINEAR=9986]="NEAREST_MIPMAP_LINEAR",t[t.LINEAR_MIPMAP_LINEAR=9987]="LINEAR_MIPMAP_LINEAR",t[t.TEXTURE_MAG_FILTER=10240]="TEXTURE_MAG_FILTER",t[t.TEXTURE_MIN_FILTER=10241]="TEXTURE_MIN_FILTER",t[t.TEXTURE_WRAP_S=10242]="TEXTURE_WRAP_S",t[t.TEXTURE_WRAP_T=10243]="TEXTURE_WRAP_T",t[t.TEXTURE_2D=3553]="TEXTURE_2D",t[t.TEXTURE=5890]="TEXTURE",t[t.TEXTURE_CUBE_MAP=34067]="TEXTURE_CUBE_MAP",t[t.TEXTURE_BINDING_CUBE_MAP=34068]="TEXTURE_BINDING_CUBE_MAP",t[t.TEXTURE_CUBE_MAP_POSITIVE_X=34069]="TEXTURE_CUBE_MAP_POSITIVE_X",t[t.TEXTURE_CUBE_MAP_NEGATIVE_X=34070]="TEXTURE_CUBE_MAP_NEGATIVE_X",t[t.TEXTURE_CUBE_MAP_POSITIVE_Y=34071]="TEXTURE_CUBE_MAP_POSITIVE_Y",t[t.TEXTURE_CUBE_MAP_NEGATIVE_Y=34072]="TEXTURE_CUBE_MAP_NEGATIVE_Y",t[t.TEXTURE_CUBE_MAP_POSITIVE_Z=34073]="TEXTURE_CUBE_MAP_POSITIVE_Z",t[t.TEXTURE_CUBE_MAP_NEGATIVE_Z=34074]="TEXTURE_CUBE_MAP_NEGATIVE_Z",t[t.MAX_CUBE_MAP_TEXTURE_SIZE=34076]="MAX_CUBE_MAP_TEXTURE_SIZE",t[t.TEXTURE0=33984]="TEXTURE0",t[t.ACTIVE_TEXTURE=34016]="ACTIVE_TEXTURE",t[t.REPEAT=10497]="REPEAT",t[t.CLAMP_TO_EDGE=33071]="CLAMP_TO_EDGE",t[t.MIRRORED_REPEAT=33648]="MIRRORED_REPEAT",t[t.TEXTURE_WIDTH=4096]="TEXTURE_WIDTH",t[t.TEXTURE_HEIGHT=4097]="TEXTURE_HEIGHT",t[t.FLOAT_VEC2=35664]="FLOAT_VEC2",t[t.FLOAT_VEC3=35665]="FLOAT_VEC3",t[t.FLOAT_VEC4=35666]="FLOAT_VEC4",t[t.INT_VEC2=35667]="INT_VEC2",t[t.INT_VEC3=35668]="INT_VEC3",t[t.INT_VEC4=35669]="INT_VEC4",t[t.BOOL=35670]="BOOL",t[t.BOOL_VEC2=35671]="BOOL_VEC2",t[t.BOOL_VEC3=35672]="BOOL_VEC3",t[t.BOOL_VEC4=35673]="BOOL_VEC4",t[t.FLOAT_MAT2=35674]="FLOAT_MAT2",t[t.FLOAT_MAT3=35675]="FLOAT_MAT3",t[t.FLOAT_MAT4=35676]="FLOAT_MAT4",t[t.SAMPLER_2D=35678]="SAMPLER_2D",t[t.SAMPLER_CUBE=35680]="SAMPLER_CUBE",t[t.LOW_FLOAT=36336]="LOW_FLOAT",t[t.MEDIUM_FLOAT=36337]="MEDIUM_FLOAT",t[t.HIGH_FLOAT=36338]="HIGH_FLOAT",t[t.LOW_INT=36339]="LOW_INT",t[t.MEDIUM_INT=36340]="MEDIUM_INT",t[t.HIGH_INT=36341]="HIGH_INT",t[t.FRAMEBUFFER=36160]="FRAMEBUFFER",t[t.RENDERBUFFER=36161]="RENDERBUFFER",t[t.RGBA4=32854]="RGBA4",t[t.RGB5_A1=32855]="RGB5_A1",t[t.RGB565=36194]="RGB565",t[t.DEPTH_COMPONENT16=33189]="DEPTH_COMPONENT16",t[t.STENCIL_INDEX=6401]="STENCIL_INDEX",t[t.STENCIL_INDEX8=36168]="STENCIL_INDEX8",t[t.DEPTH_STENCIL=34041]="DEPTH_STENCIL",t[t.RENDERBUFFER_WIDTH=36162]="RENDERBUFFER_WIDTH",t[t.RENDERBUFFER_HEIGHT=36163]="RENDERBUFFER_HEIGHT",t[t.RENDERBUFFER_INTERNAL_FORMAT=36164]="RENDERBUFFER_INTERNAL_FORMAT",t[t.RENDERBUFFER_RED_SIZE=36176]="RENDERBUFFER_RED_SIZE",t[t.RENDERBUFFER_GREEN_SIZE=36177]="RENDERBUFFER_GREEN_SIZE",t[t.RENDERBUFFER_BLUE_SIZE=36178]="RENDERBUFFER_BLUE_SIZE",t[t.RENDERBUFFER_ALPHA_SIZE=36179]="RENDERBUFFER_ALPHA_SIZE",t[t.RENDERBUFFER_DEPTH_SIZE=36180]="RENDERBUFFER_DEPTH_SIZE",t[t.RENDERBUFFER_STENCIL_SIZE=36181]="RENDERBUFFER_STENCIL_SIZE",t[t.FRAMEBUFFER_ATTACHMENT_OBJECT_TYPE=36048]="FRAMEBUFFER_ATTACHMENT_OBJECT_TYPE",t[t.FRAMEBUFFER_ATTACHMENT_OBJECT_NAME=36049]="FRAMEBUFFER_ATTACHMENT_OBJECT_NAME",t[t.FRAMEBUFFER_ATTACHMENT_TEXTURE_LEVEL=36050]="FRAMEBUFFER_ATTACHMENT_TEXTURE_LEVEL",t[t.FRAMEBUFFER_ATTACHMENT_TEXTURE_CUBE_MAP_FACE=36051]="FRAMEBUFFER_ATTACHMENT_TEXTURE_CUBE_MAP_FACE",t[t.COLOR_ATTACHMENT0=36064]="COLOR_ATTACHMENT0",t[t.DEPTH_ATTACHMENT=36096]="DEPTH_ATTACHMENT",t[t.STENCIL_ATTACHMENT=36128]="STENCIL_ATTACHMENT",t[t.DEPTH_STENCIL_ATTACHMENT=33306]="DEPTH_STENCIL_ATTACHMENT",t[t.NONE=0]="NONE",t[t.FRAMEBUFFER_COMPLETE=36053]="FRAMEBUFFER_COMPLETE",t[t.FRAMEBUFFER_INCOMPLETE_ATTACHMENT=36054]="FRAMEBUFFER_INCOMPLETE_ATTACHMENT",t[t.FRAMEBUFFER_INCOMPLETE_MISSING_ATTACHMENT=36055]="FRAMEBUFFER_INCOMPLETE_MISSING_ATTACHMENT",t[t.FRAMEBUFFER_INCOMPLETE_DIMENSIONS=36057]="FRAMEBUFFER_INCOMPLETE_DIMENSIONS",t[t.FRAMEBUFFER_UNSUPPORTED=36061]="FRAMEBUFFER_UNSUPPORTED",t[t.FRAMEBUFFER_BINDING=36006]="FRAMEBUFFER_BINDING",t[t.RENDERBUFFER_BINDING=36007]="RENDERBUFFER_BINDING",t[t.READ_FRAMEBUFFER=36008]="READ_FRAMEBUFFER",t[t.DRAW_FRAMEBUFFER=36009]="DRAW_FRAMEBUFFER",t[t.MAX_RENDERBUFFER_SIZE=34024]="MAX_RENDERBUFFER_SIZE",t[t.INVALID_FRAMEBUFFER_OPERATION=1286]="INVALID_FRAMEBUFFER_OPERATION",t[t.UNPACK_FLIP_Y_WEBGL=37440]="UNPACK_FLIP_Y_WEBGL",t[t.UNPACK_PREMULTIPLY_ALPHA_WEBGL=37441]="UNPACK_PREMULTIPLY_ALPHA_WEBGL",t[t.UNPACK_COLORSPACE_CONVERSION_WEBGL=37443]="UNPACK_COLORSPACE_CONVERSION_WEBGL",t[t.READ_BUFFER=3074]="READ_BUFFER",t[t.UNPACK_ROW_LENGTH=3314]="UNPACK_ROW_LENGTH",t[t.UNPACK_SKIP_ROWS=3315]="UNPACK_SKIP_ROWS",t[t.UNPACK_SKIP_PIXELS=3316]="UNPACK_SKIP_PIXELS",t[t.PACK_ROW_LENGTH=3330]="PACK_ROW_LENGTH",t[t.PACK_SKIP_ROWS=3331]="PACK_SKIP_ROWS",t[t.PACK_SKIP_PIXELS=3332]="PACK_SKIP_PIXELS",t[t.TEXTURE_BINDING_3D=32874]="TEXTURE_BINDING_3D",t[t.UNPACK_SKIP_IMAGES=32877]="UNPACK_SKIP_IMAGES",t[t.UNPACK_IMAGE_HEIGHT=32878]="UNPACK_IMAGE_HEIGHT",t[t.MAX_3D_TEXTURE_SIZE=32883]="MAX_3D_TEXTURE_SIZE",t[t.MAX_ELEMENTS_VERTICES=33e3]="MAX_ELEMENTS_VERTICES",t[t.MAX_ELEMENTS_INDICES=33001]="MAX_ELEMENTS_INDICES",t[t.MAX_TEXTURE_LOD_BIAS=34045]="MAX_TEXTURE_LOD_BIAS",t[t.MAX_FRAGMENT_UNIFORM_COMPONENTS=35657]="MAX_FRAGMENT_UNIFORM_COMPONENTS",t[t.MAX_VERTEX_UNIFORM_COMPONENTS=35658]="MAX_VERTEX_UNIFORM_COMPONENTS",t[t.MAX_ARRAY_TEXTURE_LAYERS=35071]="MAX_ARRAY_TEXTURE_LAYERS",t[t.MIN_PROGRAM_TEXEL_OFFSET=35076]="MIN_PROGRAM_TEXEL_OFFSET",t[t.MAX_PROGRAM_TEXEL_OFFSET=35077]="MAX_PROGRAM_TEXEL_OFFSET",t[t.MAX_VARYING_COMPONENTS=35659]="MAX_VARYING_COMPONENTS",t[t.FRAGMENT_SHADER_DERIVATIVE_HINT=35723]="FRAGMENT_SHADER_DERIVATIVE_HINT",t[t.RASTERIZER_DISCARD=35977]="RASTERIZER_DISCARD",t[t.VERTEX_ARRAY_BINDING=34229]="VERTEX_ARRAY_BINDING",t[t.MAX_VERTEX_OUTPUT_COMPONENTS=37154]="MAX_VERTEX_OUTPUT_COMPONENTS",t[t.MAX_FRAGMENT_INPUT_COMPONENTS=37157]="MAX_FRAGMENT_INPUT_COMPONENTS",t[t.MAX_SERVER_WAIT_TIMEOUT=37137]="MAX_SERVER_WAIT_TIMEOUT",t[t.MAX_ELEMENT_INDEX=36203]="MAX_ELEMENT_INDEX",t[t.RED=6403]="RED",t[t.RGB8=32849]="RGB8",t[t.RGBA8=32856]="RGBA8",t[t.RGB10_A2=32857]="RGB10_A2",t[t.TEXTURE_3D=32879]="TEXTURE_3D",t[t.TEXTURE_WRAP_R=32882]="TEXTURE_WRAP_R",t[t.TEXTURE_MIN_LOD=33082]="TEXTURE_MIN_LOD",t[t.TEXTURE_MAX_LOD=33083]="TEXTURE_MAX_LOD",t[t.TEXTURE_BASE_LEVEL=33084]="TEXTURE_BASE_LEVEL",t[t.TEXTURE_MAX_LEVEL=33085]="TEXTURE_MAX_LEVEL",t[t.TEXTURE_COMPARE_MODE=34892]="TEXTURE_COMPARE_MODE",t[t.TEXTURE_COMPARE_FUNC=34893]="TEXTURE_COMPARE_FUNC",t[t.SRGB=35904]="SRGB",t[t.SRGB8=35905]="SRGB8",t[t.SRGB8_ALPHA8=35907]="SRGB8_ALPHA8",t[t.COMPARE_REF_TO_TEXTURE=34894]="COMPARE_REF_TO_TEXTURE",t[t.RGBA32F=34836]="RGBA32F",t[t.RGB32F=34837]="RGB32F",t[t.RGBA16F=34842]="RGBA16F",t[t.RGB16F=34843]="RGB16F",t[t.TEXTURE_2D_ARRAY=35866]="TEXTURE_2D_ARRAY",t[t.TEXTURE_BINDING_2D_ARRAY=35869]="TEXTURE_BINDING_2D_ARRAY",t[t.R11F_G11F_B10F=35898]="R11F_G11F_B10F",t[t.RGB9_E5=35901]="RGB9_E5",t[t.RGBA32UI=36208]="RGBA32UI",t[t.RGB32UI=36209]="RGB32UI",t[t.RGBA16UI=36214]="RGBA16UI",t[t.RGB16UI=36215]="RGB16UI",t[t.RGBA8UI=36220]="RGBA8UI",t[t.RGB8UI=36221]="RGB8UI",t[t.RGBA32I=36226]="RGBA32I",t[t.RGB32I=36227]="RGB32I",t[t.RGBA16I=36232]="RGBA16I",t[t.RGB16I=36233]="RGB16I",t[t.RGBA8I=36238]="RGBA8I",t[t.RGB8I=36239]="RGB8I",t[t.RED_INTEGER=36244]="RED_INTEGER",t[t.RGB_INTEGER=36248]="RGB_INTEGER",t[t.RGBA_INTEGER=36249]="RGBA_INTEGER",t[t.R8=33321]="R8",t[t.RG8=33323]="RG8",t[t.R16F=33325]="R16F",t[t.R32F=33326]="R32F",t[t.RG16F=33327]="RG16F",t[t.RG32F=33328]="RG32F",t[t.R8I=33329]="R8I",t[t.R8UI=33330]="R8UI",t[t.R16I=33331]="R16I",t[t.R16UI=33332]="R16UI",t[t.R32I=33333]="R32I",t[t.R32UI=33334]="R32UI",t[t.RG8I=33335]="RG8I",t[t.RG8UI=33336]="RG8UI",t[t.RG16I=33337]="RG16I",t[t.RG16UI=33338]="RG16UI",t[t.RG32I=33339]="RG32I",t[t.RG32UI=33340]="RG32UI",t[t.R8_SNORM=36756]="R8_SNORM",t[t.RG8_SNORM=36757]="RG8_SNORM",t[t.RGB8_SNORM=36758]="RGB8_SNORM",t[t.RGBA8_SNORM=36759]="RGBA8_SNORM",t[t.RGB10_A2UI=36975]="RGB10_A2UI",t[t.TEXTURE_IMMUTABLE_FORMAT=37167]="TEXTURE_IMMUTABLE_FORMAT",t[t.TEXTURE_IMMUTABLE_LEVELS=33503]="TEXTURE_IMMUTABLE_LEVELS",t[t.UNSIGNED_INT_2_10_10_10_REV=33640]="UNSIGNED_INT_2_10_10_10_REV",t[t.UNSIGNED_INT_10F_11F_11F_REV=35899]="UNSIGNED_INT_10F_11F_11F_REV",t[t.UNSIGNED_INT_5_9_9_9_REV=35902]="UNSIGNED_INT_5_9_9_9_REV",t[t.FLOAT_32_UNSIGNED_INT_24_8_REV=36269]="FLOAT_32_UNSIGNED_INT_24_8_REV",t[t.UNSIGNED_INT_24_8=34042]="UNSIGNED_INT_24_8",t[t.HALF_FLOAT=5131]="HALF_FLOAT",t[t.RG=33319]="RG",t[t.RG_INTEGER=33320]="RG_INTEGER",t[t.INT_2_10_10_10_REV=36255]="INT_2_10_10_10_REV",t[t.CURRENT_QUERY=34917]="CURRENT_QUERY",t[t.QUERY_RESULT=34918]="QUERY_RESULT",t[t.QUERY_RESULT_AVAILABLE=34919]="QUERY_RESULT_AVAILABLE",t[t.ANY_SAMPLES_PASSED=35887]="ANY_SAMPLES_PASSED",t[t.ANY_SAMPLES_PASSED_CONSERVATIVE=36202]="ANY_SAMPLES_PASSED_CONSERVATIVE",t[t.MAX_DRAW_BUFFERS=34852]="MAX_DRAW_BUFFERS",t[t.DRAW_BUFFER0=34853]="DRAW_BUFFER0",t[t.DRAW_BUFFER1=34854]="DRAW_BUFFER1",t[t.DRAW_BUFFER2=34855]="DRAW_BUFFER2",t[t.DRAW_BUFFER3=34856]="DRAW_BUFFER3",t[t.DRAW_BUFFER4=34857]="DRAW_BUFFER4",t[t.DRAW_BUFFER5=34858]="DRAW_BUFFER5",t[t.DRAW_BUFFER6=34859]="DRAW_BUFFER6",t[t.DRAW_BUFFER7=34860]="DRAW_BUFFER7",t[t.DRAW_BUFFER8=34861]="DRAW_BUFFER8",t[t.DRAW_BUFFER9=34862]="DRAW_BUFFER9",t[t.DRAW_BUFFER10=34863]="DRAW_BUFFER10",t[t.DRAW_BUFFER11=34864]="DRAW_BUFFER11",t[t.DRAW_BUFFER12=34865]="DRAW_BUFFER12",t[t.DRAW_BUFFER13=34866]="DRAW_BUFFER13",t[t.DRAW_BUFFER14=34867]="DRAW_BUFFER14",t[t.DRAW_BUFFER15=34868]="DRAW_BUFFER15",t[t.MAX_COLOR_ATTACHMENTS=36063]="MAX_COLOR_ATTACHMENTS",t[t.COLOR_ATTACHMENT1=36065]="COLOR_ATTACHMENT1",t[t.COLOR_ATTACHMENT2=36066]="COLOR_ATTACHMENT2",t[t.COLOR_ATTACHMENT3=36067]="COLOR_ATTACHMENT3",t[t.COLOR_ATTACHMENT4=36068]="COLOR_ATTACHMENT4",t[t.COLOR_ATTACHMENT5=36069]="COLOR_ATTACHMENT5",t[t.COLOR_ATTACHMENT6=36070]="COLOR_ATTACHMENT6",t[t.COLOR_ATTACHMENT7=36071]="COLOR_ATTACHMENT7",t[t.COLOR_ATTACHMENT8=36072]="COLOR_ATTACHMENT8",t[t.COLOR_ATTACHMENT9=36073]="COLOR_ATTACHMENT9",t[t.COLOR_ATTACHMENT10=36074]="COLOR_ATTACHMENT10",t[t.COLOR_ATTACHMENT11=36075]="COLOR_ATTACHMENT11",t[t.COLOR_ATTACHMENT12=36076]="COLOR_ATTACHMENT12",t[t.COLOR_ATTACHMENT13=36077]="COLOR_ATTACHMENT13",t[t.COLOR_ATTACHMENT14=36078]="COLOR_ATTACHMENT14",t[t.COLOR_ATTACHMENT15=36079]="COLOR_ATTACHMENT15",t[t.SAMPLER_3D=35679]="SAMPLER_3D",t[t.SAMPLER_2D_SHADOW=35682]="SAMPLER_2D_SHADOW",t[t.SAMPLER_2D_ARRAY=36289]="SAMPLER_2D_ARRAY",t[t.SAMPLER_2D_ARRAY_SHADOW=36292]="SAMPLER_2D_ARRAY_SHADOW",t[t.SAMPLER_CUBE_SHADOW=36293]="SAMPLER_CUBE_SHADOW",t[t.INT_SAMPLER_2D=36298]="INT_SAMPLER_2D",t[t.INT_SAMPLER_3D=36299]="INT_SAMPLER_3D",t[t.INT_SAMPLER_CUBE=36300]="INT_SAMPLER_CUBE",t[t.INT_SAMPLER_2D_ARRAY=36303]="INT_SAMPLER_2D_ARRAY",t[t.UNSIGNED_INT_SAMPLER_2D=36306]="UNSIGNED_INT_SAMPLER_2D",t[t.UNSIGNED_INT_SAMPLER_3D=36307]="UNSIGNED_INT_SAMPLER_3D",t[t.UNSIGNED_INT_SAMPLER_CUBE=36308]="UNSIGNED_INT_SAMPLER_CUBE",t[t.UNSIGNED_INT_SAMPLER_2D_ARRAY=36311]="UNSIGNED_INT_SAMPLER_2D_ARRAY",t[t.MAX_SAMPLES=36183]="MAX_SAMPLES",t[t.SAMPLER_BINDING=35097]="SAMPLER_BINDING",t[t.PIXEL_PACK_BUFFER=35051]="PIXEL_PACK_BUFFER",t[t.PIXEL_UNPACK_BUFFER=35052]="PIXEL_UNPACK_BUFFER",t[t.PIXEL_PACK_BUFFER_BINDING=35053]="PIXEL_PACK_BUFFER_BINDING",t[t.PIXEL_UNPACK_BUFFER_BINDING=35055]="PIXEL_UNPACK_BUFFER_BINDING",t[t.COPY_READ_BUFFER=36662]="COPY_READ_BUFFER",t[t.COPY_WRITE_BUFFER=36663]="COPY_WRITE_BUFFER",t[t.COPY_READ_BUFFER_BINDING=36662]="COPY_READ_BUFFER_BINDING",t[t.COPY_WRITE_BUFFER_BINDING=36663]="COPY_WRITE_BUFFER_BINDING",t[t.FLOAT_MAT2x3=35685]="FLOAT_MAT2x3",t[t.FLOAT_MAT2x4=35686]="FLOAT_MAT2x4",t[t.FLOAT_MAT3x2=35687]="FLOAT_MAT3x2",t[t.FLOAT_MAT3x4=35688]="FLOAT_MAT3x4",t[t.FLOAT_MAT4x2=35689]="FLOAT_MAT4x2",t[t.FLOAT_MAT4x3=35690]="FLOAT_MAT4x3",t[t.UNSIGNED_INT_VEC2=36294]="UNSIGNED_INT_VEC2",t[t.UNSIGNED_INT_VEC3=36295]="UNSIGNED_INT_VEC3",t[t.UNSIGNED_INT_VEC4=36296]="UNSIGNED_INT_VEC4",t[t.UNSIGNED_NORMALIZED=35863]="UNSIGNED_NORMALIZED",t[t.SIGNED_NORMALIZED=36764]="SIGNED_NORMALIZED",t[t.VERTEX_ATTRIB_ARRAY_INTEGER=35069]="VERTEX_ATTRIB_ARRAY_INTEGER",t[t.VERTEX_ATTRIB_ARRAY_DIVISOR=35070]="VERTEX_ATTRIB_ARRAY_DIVISOR",t[t.TRANSFORM_FEEDBACK_BUFFER_MODE=35967]="TRANSFORM_FEEDBACK_BUFFER_MODE",t[t.MAX_TRANSFORM_FEEDBACK_SEPARATE_COMPONENTS=35968]="MAX_TRANSFORM_FEEDBACK_SEPARATE_COMPONENTS",t[t.TRANSFORM_FEEDBACK_VARYINGS=35971]="TRANSFORM_FEEDBACK_VARYINGS",t[t.TRANSFORM_FEEDBACK_BUFFER_START=35972]="TRANSFORM_FEEDBACK_BUFFER_START",t[t.TRANSFORM_FEEDBACK_BUFFER_SIZE=35973]="TRANSFORM_FEEDBACK_BUFFER_SIZE",t[t.TRANSFORM_FEEDBACK_PRIMITIVES_WRITTEN=35976]="TRANSFORM_FEEDBACK_PRIMITIVES_WRITTEN",t[t.MAX_TRANSFORM_FEEDBACK_INTERLEAVED_COMPONENTS=35978]="MAX_TRANSFORM_FEEDBACK_INTERLEAVED_COMPONENTS",t[t.MAX_TRANSFORM_FEEDBACK_SEPARATE_ATTRIBS=35979]="MAX_TRANSFORM_FEEDBACK_SEPARATE_ATTRIBS",t[t.INTERLEAVED_ATTRIBS=35980]="INTERLEAVED_ATTRIBS",t[t.SEPARATE_ATTRIBS=35981]="SEPARATE_ATTRIBS",t[t.TRANSFORM_FEEDBACK_BUFFER=35982]="TRANSFORM_FEEDBACK_BUFFER",t[t.TRANSFORM_FEEDBACK_BUFFER_BINDING=35983]="TRANSFORM_FEEDBACK_BUFFER_BINDING",t[t.TRANSFORM_FEEDBACK=36386]="TRANSFORM_FEEDBACK",t[t.TRANSFORM_FEEDBACK_PAUSED=36387]="TRANSFORM_FEEDBACK_PAUSED",t[t.TRANSFORM_FEEDBACK_ACTIVE=36388]="TRANSFORM_FEEDBACK_ACTIVE",t[t.TRANSFORM_FEEDBACK_BINDING=36389]="TRANSFORM_FEEDBACK_BINDING",t[t.FRAMEBUFFER_ATTACHMENT_COLOR_ENCODING=33296]="FRAMEBUFFER_ATTACHMENT_COLOR_ENCODING",t[t.FRAMEBUFFER_ATTACHMENT_COMPONENT_TYPE=33297]="FRAMEBUFFER_ATTACHMENT_COMPONENT_TYPE",t[t.FRAMEBUFFER_ATTACHMENT_RED_SIZE=33298]="FRAMEBUFFER_ATTACHMENT_RED_SIZE",t[t.FRAMEBUFFER_ATTACHMENT_GREEN_SIZE=33299]="FRAMEBUFFER_ATTACHMENT_GREEN_SIZE",t[t.FRAMEBUFFER_ATTACHMENT_BLUE_SIZE=33300]="FRAMEBUFFER_ATTACHMENT_BLUE_SIZE",t[t.FRAMEBUFFER_ATTACHMENT_ALPHA_SIZE=33301]="FRAMEBUFFER_ATTACHMENT_ALPHA_SIZE",t[t.FRAMEBUFFER_ATTACHMENT_DEPTH_SIZE=33302]="FRAMEBUFFER_ATTACHMENT_DEPTH_SIZE",t[t.FRAMEBUFFER_ATTACHMENT_STENCIL_SIZE=33303]="FRAMEBUFFER_ATTACHMENT_STENCIL_SIZE",t[t.FRAMEBUFFER_DEFAULT=33304]="FRAMEBUFFER_DEFAULT",t[t.DEPTH24_STENCIL8=35056]="DEPTH24_STENCIL8",t[t.DRAW_FRAMEBUFFER_BINDING=36006]="DRAW_FRAMEBUFFER_BINDING",t[t.READ_FRAMEBUFFER_BINDING=36010]="READ_FRAMEBUFFER_BINDING",t[t.RENDERBUFFER_SAMPLES=36011]="RENDERBUFFER_SAMPLES",t[t.FRAMEBUFFER_ATTACHMENT_TEXTURE_LAYER=36052]="FRAMEBUFFER_ATTACHMENT_TEXTURE_LAYER",t[t.FRAMEBUFFER_INCOMPLETE_MULTISAMPLE=36182]="FRAMEBUFFER_INCOMPLETE_MULTISAMPLE",t[t.UNIFORM_BUFFER=35345]="UNIFORM_BUFFER",t[t.UNIFORM_BUFFER_BINDING=35368]="UNIFORM_BUFFER_BINDING",t[t.UNIFORM_BUFFER_START=35369]="UNIFORM_BUFFER_START",t[t.UNIFORM_BUFFER_SIZE=35370]="UNIFORM_BUFFER_SIZE",t[t.MAX_VERTEX_UNIFORM_BLOCKS=35371]="MAX_VERTEX_UNIFORM_BLOCKS",t[t.MAX_FRAGMENT_UNIFORM_BLOCKS=35373]="MAX_FRAGMENT_UNIFORM_BLOCKS",t[t.MAX_COMBINED_UNIFORM_BLOCKS=35374]="MAX_COMBINED_UNIFORM_BLOCKS",t[t.MAX_UNIFORM_BUFFER_BINDINGS=35375]="MAX_UNIFORM_BUFFER_BINDINGS",t[t.MAX_UNIFORM_BLOCK_SIZE=35376]="MAX_UNIFORM_BLOCK_SIZE",t[t.MAX_COMBINED_VERTEX_UNIFORM_COMPONENTS=35377]="MAX_COMBINED_VERTEX_UNIFORM_COMPONENTS",t[t.MAX_COMBINED_FRAGMENT_UNIFORM_COMPONENTS=35379]="MAX_COMBINED_FRAGMENT_UNIFORM_COMPONENTS",t[t.UNIFORM_BUFFER_OFFSET_ALIGNMENT=35380]="UNIFORM_BUFFER_OFFSET_ALIGNMENT",t[t.ACTIVE_UNIFORM_BLOCKS=35382]="ACTIVE_UNIFORM_BLOCKS",t[t.UNIFORM_TYPE=35383]="UNIFORM_TYPE",t[t.UNIFORM_SIZE=35384]="UNIFORM_SIZE",t[t.UNIFORM_BLOCK_INDEX=35386]="UNIFORM_BLOCK_INDEX",t[t.UNIFORM_OFFSET=35387]="UNIFORM_OFFSET",t[t.UNIFORM_ARRAY_STRIDE=35388]="UNIFORM_ARRAY_STRIDE",t[t.UNIFORM_MATRIX_STRIDE=35389]="UNIFORM_MATRIX_STRIDE",t[t.UNIFORM_IS_ROW_MAJOR=35390]="UNIFORM_IS_ROW_MAJOR",t[t.UNIFORM_BLOCK_BINDING=35391]="UNIFORM_BLOCK_BINDING",t[t.UNIFORM_BLOCK_DATA_SIZE=35392]="UNIFORM_BLOCK_DATA_SIZE",t[t.UNIFORM_BLOCK_ACTIVE_UNIFORMS=35394]="UNIFORM_BLOCK_ACTIVE_UNIFORMS",t[t.UNIFORM_BLOCK_ACTIVE_UNIFORM_INDICES=35395]="UNIFORM_BLOCK_ACTIVE_UNIFORM_INDICES",t[t.UNIFORM_BLOCK_REFERENCED_BY_VERTEX_SHADER=35396]="UNIFORM_BLOCK_REFERENCED_BY_VERTEX_SHADER",t[t.UNIFORM_BLOCK_REFERENCED_BY_FRAGMENT_SHADER=35398]="UNIFORM_BLOCK_REFERENCED_BY_FRAGMENT_SHADER",t[t.OBJECT_TYPE=37138]="OBJECT_TYPE",t[t.SYNC_CONDITION=37139]="SYNC_CONDITION",t[t.SYNC_STATUS=37140]="SYNC_STATUS",t[t.SYNC_FLAGS=37141]="SYNC_FLAGS",t[t.SYNC_FENCE=37142]="SYNC_FENCE",t[t.SYNC_GPU_COMMANDS_COMPLETE=37143]="SYNC_GPU_COMMANDS_COMPLETE",t[t.UNSIGNALED=37144]="UNSIGNALED",t[t.SIGNALED=37145]="SIGNALED",t[t.ALREADY_SIGNALED=37146]="ALREADY_SIGNALED",t[t.TIMEOUT_EXPIRED=37147]="TIMEOUT_EXPIRED",t[t.CONDITION_SATISFIED=37148]="CONDITION_SATISFIED",t[t.WAIT_FAILED=37149]="WAIT_FAILED",t[t.SYNC_FLUSH_COMMANDS_BIT=1]="SYNC_FLUSH_COMMANDS_BIT",t[t.COLOR=6144]="COLOR",t[t.DEPTH=6145]="DEPTH",t[t.STENCIL=6146]="STENCIL",t[t.MIN=32775]="MIN",t[t.MAX=32776]="MAX",t[t.DEPTH_COMPONENT24=33190]="DEPTH_COMPONENT24",t[t.STREAM_READ=35041]="STREAM_READ",t[t.STREAM_COPY=35042]="STREAM_COPY",t[t.STATIC_READ=35045]="STATIC_READ",t[t.STATIC_COPY=35046]="STATIC_COPY",t[t.DYNAMIC_READ=35049]="DYNAMIC_READ",t[t.DYNAMIC_COPY=35050]="DYNAMIC_COPY",t[t.DEPTH_COMPONENT32F=36012]="DEPTH_COMPONENT32F",t[t.DEPTH32F_STENCIL8=36013]="DEPTH32F_STENCIL8",t[t.INVALID_INDEX=4294967295]="INVALID_INDEX",t[t.TIMEOUT_IGNORED=-1]="TIMEOUT_IGNORED",t[t.MAX_CLIENT_WAIT_TIMEOUT_WEBGL=37447]="MAX_CLIENT_WAIT_TIMEOUT_WEBGL",t[t.UNMASKED_VENDOR_WEBGL=37445]="UNMASKED_VENDOR_WEBGL",t[t.UNMASKED_RENDERER_WEBGL=37446]="UNMASKED_RENDERER_WEBGL",t[t.MAX_TEXTURE_MAX_ANISOTROPY_EXT=34047]="MAX_TEXTURE_MAX_ANISOTROPY_EXT",t[t.TEXTURE_MAX_ANISOTROPY_EXT=34046]="TEXTURE_MAX_ANISOTROPY_EXT",t[t.R16_EXT=33322]="R16_EXT",t[t.RG16_EXT=33324]="RG16_EXT",t[t.RGB16_EXT=32852]="RGB16_EXT",t[t.RGBA16_EXT=32859]="RGBA16_EXT",t[t.R16_SNORM_EXT=36760]="R16_SNORM_EXT",t[t.RG16_SNORM_EXT=36761]="RG16_SNORM_EXT",t[t.RGB16_SNORM_EXT=36762]="RGB16_SNORM_EXT",t[t.RGBA16_SNORM_EXT=36763]="RGBA16_SNORM_EXT",t[t.COMPRESSED_RGB_S3TC_DXT1_EXT=33776]="COMPRESSED_RGB_S3TC_DXT1_EXT",t[t.COMPRESSED_RGBA_S3TC_DXT1_EXT=33777]="COMPRESSED_RGBA_S3TC_DXT1_EXT",t[t.COMPRESSED_RGBA_S3TC_DXT3_EXT=33778]="COMPRESSED_RGBA_S3TC_DXT3_EXT",t[t.COMPRESSED_RGBA_S3TC_DXT5_EXT=33779]="COMPRESSED_RGBA_S3TC_DXT5_EXT",t[t.COMPRESSED_SRGB_S3TC_DXT1_EXT=35916]="COMPRESSED_SRGB_S3TC_DXT1_EXT",t[t.COMPRESSED_SRGB_ALPHA_S3TC_DXT1_EXT=35917]="COMPRESSED_SRGB_ALPHA_S3TC_DXT1_EXT",t[t.COMPRESSED_SRGB_ALPHA_S3TC_DXT3_EXT=35918]="COMPRESSED_SRGB_ALPHA_S3TC_DXT3_EXT",t[t.COMPRESSED_SRGB_ALPHA_S3TC_DXT5_EXT=35919]="COMPRESSED_SRGB_ALPHA_S3TC_DXT5_EXT",t[t.COMPRESSED_RED_RGTC1_EXT=36283]="COMPRESSED_RED_RGTC1_EXT",t[t.COMPRESSED_SIGNED_RED_RGTC1_EXT=36284]="COMPRESSED_SIGNED_RED_RGTC1_EXT",t[t.COMPRESSED_RED_GREEN_RGTC2_EXT=36285]="COMPRESSED_RED_GREEN_RGTC2_EXT",t[t.COMPRESSED_SIGNED_RED_GREEN_RGTC2_EXT=36286]="COMPRESSED_SIGNED_RED_GREEN_RGTC2_EXT",t[t.COMPRESSED_RGBA_BPTC_UNORM_EXT=36492]="COMPRESSED_RGBA_BPTC_UNORM_EXT",t[t.COMPRESSED_SRGB_ALPHA_BPTC_UNORM_EXT=36493]="COMPRESSED_SRGB_ALPHA_BPTC_UNORM_EXT",t[t.COMPRESSED_RGB_BPTC_SIGNED_FLOAT_EXT=36494]="COMPRESSED_RGB_BPTC_SIGNED_FLOAT_EXT",t[t.COMPRESSED_RGB_BPTC_UNSIGNED_FLOAT_EXT=36495]="COMPRESSED_RGB_BPTC_UNSIGNED_FLOAT_EXT",t[t.COMPRESSED_R11_EAC=37488]="COMPRESSED_R11_EAC",t[t.COMPRESSED_SIGNED_R11_EAC=37489]="COMPRESSED_SIGNED_R11_EAC",t[t.COMPRESSED_RG11_EAC=37490]="COMPRESSED_RG11_EAC",t[t.COMPRESSED_SIGNED_RG11_EAC=37491]="COMPRESSED_SIGNED_RG11_EAC",t[t.COMPRESSED_RGB8_ETC2=37492]="COMPRESSED_RGB8_ETC2",t[t.COMPRESSED_RGBA8_ETC2_EAC=37493]="COMPRESSED_RGBA8_ETC2_EAC",t[t.COMPRESSED_SRGB8_ETC2=37494]="COMPRESSED_SRGB8_ETC2",t[t.COMPRESSED_SRGB8_ALPHA8_ETC2_EAC=37495]="COMPRESSED_SRGB8_ALPHA8_ETC2_EAC",t[t.COMPRESSED_RGB8_PUNCHTHROUGH_ALPHA1_ETC2=37496]="COMPRESSED_RGB8_PUNCHTHROUGH_ALPHA1_ETC2",t[t.COMPRESSED_SRGB8_PUNCHTHROUGH_ALPHA1_ETC2=37497]="COMPRESSED_SRGB8_PUNCHTHROUGH_ALPHA1_ETC2",t[t.COMPRESSED_RGB_PVRTC_4BPPV1_IMG=35840]="COMPRESSED_RGB_PVRTC_4BPPV1_IMG",t[t.COMPRESSED_RGBA_PVRTC_4BPPV1_IMG=35842]="COMPRESSED_RGBA_PVRTC_4BPPV1_IMG",t[t.COMPRESSED_RGB_PVRTC_2BPPV1_IMG=35841]="COMPRESSED_RGB_PVRTC_2BPPV1_IMG",t[t.COMPRESSED_RGBA_PVRTC_2BPPV1_IMG=35843]="COMPRESSED_RGBA_PVRTC_2BPPV1_IMG",t[t.COMPRESSED_RGB_ETC1_WEBGL=36196]="COMPRESSED_RGB_ETC1_WEBGL",t[t.COMPRESSED_RGB_ATC_WEBGL=35986]="COMPRESSED_RGB_ATC_WEBGL",t[t.COMPRESSED_RGBA_ATC_EXPLICIT_ALPHA_WEBGL=35986]="COMPRESSED_RGBA_ATC_EXPLICIT_ALPHA_WEBGL",t[t.COMPRESSED_RGBA_ATC_INTERPOLATED_ALPHA_WEBGL=34798]="COMPRESSED_RGBA_ATC_INTERPOLATED_ALPHA_WEBGL",t[t.COMPRESSED_RGBA_ASTC_4x4_KHR=37808]="COMPRESSED_RGBA_ASTC_4x4_KHR",t[t.COMPRESSED_RGBA_ASTC_5x4_KHR=37809]="COMPRESSED_RGBA_ASTC_5x4_KHR",t[t.COMPRESSED_RGBA_ASTC_5x5_KHR=37810]="COMPRESSED_RGBA_ASTC_5x5_KHR",t[t.COMPRESSED_RGBA_ASTC_6x5_KHR=37811]="COMPRESSED_RGBA_ASTC_6x5_KHR",t[t.COMPRESSED_RGBA_ASTC_6x6_KHR=37812]="COMPRESSED_RGBA_ASTC_6x6_KHR",t[t.COMPRESSED_RGBA_ASTC_8x5_KHR=37813]="COMPRESSED_RGBA_ASTC_8x5_KHR",t[t.COMPRESSED_RGBA_ASTC_8x6_KHR=37814]="COMPRESSED_RGBA_ASTC_8x6_KHR",t[t.COMPRESSED_RGBA_ASTC_8x8_KHR=37815]="COMPRESSED_RGBA_ASTC_8x8_KHR",t[t.COMPRESSED_RGBA_ASTC_10x5_KHR=37816]="COMPRESSED_RGBA_ASTC_10x5_KHR",t[t.COMPRESSED_RGBA_ASTC_10x6_KHR=37817]="COMPRESSED_RGBA_ASTC_10x6_KHR",t[t.COMPRESSED_RGBA_ASTC_10x8_KHR=37818]="COMPRESSED_RGBA_ASTC_10x8_KHR",t[t.COMPRESSED_RGBA_ASTC_10x10_KHR=37819]="COMPRESSED_RGBA_ASTC_10x10_KHR",t[t.COMPRESSED_RGBA_ASTC_12x10_KHR=37820]="COMPRESSED_RGBA_ASTC_12x10_KHR",t[t.COMPRESSED_RGBA_ASTC_12x12_KHR=37821]="COMPRESSED_RGBA_ASTC_12x12_KHR",t[t.COMPRESSED_SRGB8_ALPHA8_ASTC_4x4_KHR=37840]="COMPRESSED_SRGB8_ALPHA8_ASTC_4x4_KHR",t[t.COMPRESSED_SRGB8_ALPHA8_ASTC_5x4_KHR=37841]="COMPRESSED_SRGB8_ALPHA8_ASTC_5x4_KHR",t[t.COMPRESSED_SRGB8_ALPHA8_ASTC_5x5_KHR=37842]="COMPRESSED_SRGB8_ALPHA8_ASTC_5x5_KHR",t[t.COMPRESSED_SRGB8_ALPHA8_ASTC_6x5_KHR=37843]="COMPRESSED_SRGB8_ALPHA8_ASTC_6x5_KHR",t[t.COMPRESSED_SRGB8_ALPHA8_ASTC_6x6_KHR=37844]="COMPRESSED_SRGB8_ALPHA8_ASTC_6x6_KHR",t[t.COMPRESSED_SRGB8_ALPHA8_ASTC_8x5_KHR=37845]="COMPRESSED_SRGB8_ALPHA8_ASTC_8x5_KHR",t[t.COMPRESSED_SRGB8_ALPHA8_ASTC_8x6_KHR=37846]="COMPRESSED_SRGB8_ALPHA8_ASTC_8x6_KHR",t[t.COMPRESSED_SRGB8_ALPHA8_ASTC_8x8_KHR=37847]="COMPRESSED_SRGB8_ALPHA8_ASTC_8x8_KHR",t[t.COMPRESSED_SRGB8_ALPHA8_ASTC_10x5_KHR=37848]="COMPRESSED_SRGB8_ALPHA8_ASTC_10x5_KHR",t[t.COMPRESSED_SRGB8_ALPHA8_ASTC_10x6_KHR=37849]="COMPRESSED_SRGB8_ALPHA8_ASTC_10x6_KHR",t[t.COMPRESSED_SRGB8_ALPHA8_ASTC_10x8_KHR=37850]="COMPRESSED_SRGB8_ALPHA8_ASTC_10x8_KHR",t[t.COMPRESSED_SRGB8_ALPHA8_ASTC_10x10_KHR=37851]="COMPRESSED_SRGB8_ALPHA8_ASTC_10x10_KHR",t[t.COMPRESSED_SRGB8_ALPHA8_ASTC_12x10_KHR=37852]="COMPRESSED_SRGB8_ALPHA8_ASTC_12x10_KHR",t[t.COMPRESSED_SRGB8_ALPHA8_ASTC_12x12_KHR=37853]="COMPRESSED_SRGB8_ALPHA8_ASTC_12x12_KHR",t[t.QUERY_COUNTER_BITS_EXT=34916]="QUERY_COUNTER_BITS_EXT",t[t.CURRENT_QUERY_EXT=34917]="CURRENT_QUERY_EXT",t[t.QUERY_RESULT_EXT=34918]="QUERY_RESULT_EXT",t[t.QUERY_RESULT_AVAILABLE_EXT=34919]="QUERY_RESULT_AVAILABLE_EXT",t[t.TIME_ELAPSED_EXT=35007]="TIME_ELAPSED_EXT",t[t.TIMESTAMP_EXT=36392]="TIMESTAMP_EXT",t[t.GPU_DISJOINT_EXT=36795]="GPU_DISJOINT_EXT",t[t.COMPLETION_STATUS_KHR=37297]="COMPLETION_STATUS_KHR",t[t.DEPTH_CLAMP_EXT=34383]="DEPTH_CLAMP_EXT",t[t.FIRST_VERTEX_CONVENTION_WEBGL=36429]="FIRST_VERTEX_CONVENTION_WEBGL",t[t.LAST_VERTEX_CONVENTION_WEBGL=36430]="LAST_VERTEX_CONVENTION_WEBGL",t[t.PROVOKING_VERTEX_WEBL=36431]="PROVOKING_VERTEX_WEBL",t[t.POLYGON_MODE_WEBGL=2880]="POLYGON_MODE_WEBGL",t[t.POLYGON_OFFSET_LINE_WEBGL=10754]="POLYGON_OFFSET_LINE_WEBGL",t[t.LINE_WEBGL=6913]="LINE_WEBGL",t[t.FILL_WEBGL=6914]="FILL_WEBGL",t[t.MAX_CLIP_DISTANCES_WEBGL=3378]="MAX_CLIP_DISTANCES_WEBGL",t[t.MAX_CULL_DISTANCES_WEBGL=33529]="MAX_CULL_DISTANCES_WEBGL",t[t.MAX_COMBINED_CLIP_AND_CULL_DISTANCES_WEBGL=33530]="MAX_COMBINED_CLIP_AND_CULL_DISTANCES_WEBGL",t[t.CLIP_DISTANCE0_WEBGL=12288]="CLIP_DISTANCE0_WEBGL",t[t.CLIP_DISTANCE1_WEBGL=12289]="CLIP_DISTANCE1_WEBGL",t[t.CLIP_DISTANCE2_WEBGL=12290]="CLIP_DISTANCE2_WEBGL",t[t.CLIP_DISTANCE3_WEBGL=12291]="CLIP_DISTANCE3_WEBGL",t[t.CLIP_DISTANCE4_WEBGL=12292]="CLIP_DISTANCE4_WEBGL",t[t.CLIP_DISTANCE5_WEBGL=12293]="CLIP_DISTANCE5_WEBGL",t[t.CLIP_DISTANCE6_WEBGL=12294]="CLIP_DISTANCE6_WEBGL",t[t.CLIP_DISTANCE7_WEBGL=12295]="CLIP_DISTANCE7_WEBGL",t[t.POLYGON_OFFSET_CLAMP_EXT=36379]="POLYGON_OFFSET_CLAMP_EXT",t[t.LOWER_LEFT_EXT=36001]="LOWER_LEFT_EXT",t[t.UPPER_LEFT_EXT=36002]="UPPER_LEFT_EXT",t[t.NEGATIVE_ONE_TO_ONE_EXT=37726]="NEGATIVE_ONE_TO_ONE_EXT",t[t.ZERO_TO_ONE_EXT=37727]="ZERO_TO_ONE_EXT",t[t.CLIP_ORIGIN_EXT=37724]="CLIP_ORIGIN_EXT",t[t.CLIP_DEPTH_MODE_EXT=37725]="CLIP_DEPTH_MODE_EXT",t[t.SRC1_COLOR_WEBGL=35065]="SRC1_COLOR_WEBGL",t[t.SRC1_ALPHA_WEBGL=34185]="SRC1_ALPHA_WEBGL",t[t.ONE_MINUS_SRC1_COLOR_WEBGL=35066]="ONE_MINUS_SRC1_COLOR_WEBGL",t[t.ONE_MINUS_SRC1_ALPHA_WEBGL=35067]="ONE_MINUS_SRC1_ALPHA_WEBGL",t[t.MAX_DUAL_SOURCE_DRAW_BUFFERS_WEBGL=35068]="MAX_DUAL_SOURCE_DRAW_BUFFERS_WEBGL",t[t.MIRROR_CLAMP_TO_EDGE_EXT=34627]="MIRROR_CLAMP_TO_EDGE_EXT"})(gi||(gi={}));const Pm={3042:!1,32773:new Float32Array([0,0,0,0]),32777:32774,34877:32774,32969:1,32968:0,32971:1,32970:0,3106:new Float32Array([0,0,0,0]),3107:[!0,!0,!0,!0],2884:!1,2885:1029,2929:!1,2931:1,2932:513,2928:new Float32Array([0,1]),2930:!0,3024:!0,35725:null,36006:null,36007:null,34229:null,34964:null,2886:2305,33170:4352,2849:1,32823:!1,32824:0,10752:0,32926:!1,32928:!1,32938:1,32939:!1,3089:!1,3088:new Int32Array([0,0,1024,1024]),2960:!1,2961:0,2968:4294967295,36005:4294967295,2962:519,2967:0,2963:4294967295,34816:519,36003:0,36004:4294967295,2964:7680,2965:7680,2966:7680,34817:7680,34818:7680,34819:7680,2978:[0,0,1024,1024],36389:null,36662:null,36663:null,35053:null,35055:null,35723:4352,36010:null,35977:!1,3333:4,3317:4,37440:!1,37441:!1,37443:37444,3330:0,3332:0,3331:0,3314:0,32878:0,3316:0,3315:0,32877:0},Oe=(t,e,n)=>e?t.enable(n):t.disable(n),J0=(t,e,n)=>t.hint(n,e),St=(t,e,n)=>t.pixelStorei(n,e),q0=(t,e,n)=>{const s=n===36006?36009:36008;return t.bindFramebuffer(s,e)},Ro=(t,e,n)=>{const r={34964:34962,36662:36662,36663:36663,35053:35051,35055:35052}[n];t.bindBuffer(r,e)};function rd(t){return Array.isArray(t)||ArrayBuffer.isView(t)&&!(t instanceof DataView)}const EL={3042:Oe,32773:(t,e)=>t.blendColor(...e),32777:"blendEquation",34877:"blendEquation",32969:"blendFunc",32968:"blendFunc",32971:"blendFunc",32970:"blendFunc",3106:(t,e)=>t.clearColor(...e),3107:(t,e)=>t.colorMask(...e),2884:Oe,2885:(t,e)=>t.cullFace(e),2929:Oe,2931:(t,e)=>t.clearDepth(e),2932:(t,e)=>t.depthFunc(e),2928:(t,e)=>t.depthRange(...e),2930:(t,e)=>t.depthMask(e),3024:Oe,35723:J0,35725:(t,e)=>t.useProgram(e),36007:(t,e)=>t.bindRenderbuffer(36161,e),36389:(t,e)=>{var n;return(n=t.bindTransformFeedback)==null?void 0:n.call(t,36386,e)},34229:(t,e)=>t.bindVertexArray(e),36006:q0,36010:q0,34964:Ro,36662:Ro,36663:Ro,35053:Ro,35055:Ro,2886:(t,e)=>t.frontFace(e),33170:J0,2849:(t,e)=>t.lineWidth(e),32823:Oe,32824:"polygonOffset",10752:"polygonOffset",35977:Oe,32926:Oe,32928:Oe,32938:"sampleCoverage",32939:"sampleCoverage",3089:Oe,3088:(t,e)=>t.scissor(...e),2960:Oe,2961:(t,e)=>t.clearStencil(e),2968:(t,e)=>t.stencilMaskSeparate(1028,e),36005:(t,e)=>t.stencilMaskSeparate(1029,e),2962:"stencilFuncFront",2967:"stencilFuncFront",2963:"stencilFuncFront",34816:"stencilFuncBack",36003:"stencilFuncBack",36004:"stencilFuncBack",2964:"stencilOpFront",2965:"stencilOpFront",2966:"stencilOpFront",34817:"stencilOpBack",34818:"stencilOpBack",34819:"stencilOpBack",2978:(t,e)=>t.viewport(...e),34383:Oe,10754:Oe,12288:Oe,12289:Oe,12290:Oe,12291:Oe,12292:Oe,12293:Oe,12294:Oe,12295:Oe,3333:St,3317:St,37440:St,37441:St,37443:St,3330:St,3332:St,3331:St,3314:St,32878:St,3316:St,3315:St,32877:St,framebuffer:(t,e)=>{const n=e&&"handle"in e?e.handle:e;return t.bindFramebuffer(36160,n)},blend:(t,e)=>e?t.enable(3042):t.disable(3042),blendColor:(t,e)=>t.blendColor(...e),blendEquation:(t,e)=>{const n=typeof e=="number"?[e,e]:e;t.blendEquationSeparate(...n)},blendFunc:(t,e)=>{const n=(e==null?void 0:e.length)===2?[...e,...e]:e;t.blendFuncSeparate(...n)},clearColor:(t,e)=>t.clearColor(...e),clearDepth:(t,e)=>t.clearDepth(e),clearStencil:(t,e)=>t.clearStencil(e),colorMask:(t,e)=>t.colorMask(...e),cull:(t,e)=>e?t.enable(2884):t.disable(2884),cullFace:(t,e)=>t.cullFace(e),depthTest:(t,e)=>e?t.enable(2929):t.disable(2929),depthFunc:(t,e)=>t.depthFunc(e),depthMask:(t,e)=>t.depthMask(e),depthRange:(t,e)=>t.depthRange(...e),dither:(t,e)=>e?t.enable(3024):t.disable(3024),derivativeHint:(t,e)=>{t.hint(35723,e)},frontFace:(t,e)=>t.frontFace(e),mipmapHint:(t,e)=>t.hint(33170,e),lineWidth:(t,e)=>t.lineWidth(e),polygonOffsetFill:(t,e)=>e?t.enable(32823):t.disable(32823),polygonOffset:(t,e)=>t.polygonOffset(...e),sampleCoverage:(t,e)=>t.sampleCoverage(...e),scissorTest:(t,e)=>e?t.enable(3089):t.disable(3089),scissor:(t,e)=>t.scissor(...e),stencilTest:(t,e)=>e?t.enable(2960):t.disable(2960),stencilMask:(t,e)=>{e=rd(e)?e:[e,e];const[n,s]=e;t.stencilMaskSeparate(1028,n),t.stencilMaskSeparate(1029,s)},stencilFunc:(t,e)=>{e=rd(e)&&e.length===3?[...e,...e]:e;const[n,s,r,i,o,a]=e;t.stencilFuncSeparate(1028,n,s,r),t.stencilFuncSeparate(1029,i,o,a)},stencilOp:(t,e)=>{e=rd(e)&&e.length===3?[...e,...e]:e;const[n,s,r,i,o,a]=e;t.stencilOpSeparate(1028,n,s,r),t.stencilOpSeparate(1029,i,o,a)},viewport:(t,e)=>t.viewport(...e)};function be(t,e,n){return e[t]!==void 0?e[t]:n[t]}const SL={blendEquation:(t,e,n)=>t.blendEquationSeparate(be(32777,e,n),be(34877,e,n)),blendFunc:(t,e,n)=>t.blendFuncSeparate(be(32969,e,n),be(32968,e,n),be(32971,e,n),be(32970,e,n)),polygonOffset:(t,e,n)=>t.polygonOffset(be(32824,e,n),be(10752,e,n)),sampleCoverage:(t,e,n)=>t.sampleCoverage(be(32938,e,n),be(32939,e,n)),stencilFuncFront:(t,e,n)=>t.stencilFuncSeparate(1028,be(2962,e,n),be(2967,e,n),be(2963,e,n)),stencilFuncBack:(t,e,n)=>t.stencilFuncSeparate(1029,be(34816,e,n),be(36003,e,n),be(36004,e,n)),stencilOpFront:(t,e,n)=>t.stencilOpSeparate(1028,be(2964,e,n),be(2965,e,n),be(2966,e,n)),stencilOpBack:(t,e,n)=>t.stencilOpSeparate(1029,be(34817,e,n),be(34818,e,n),be(34819,e,n))},Z0={enable:(t,e)=>t({[e]:!0}),disable:(t,e)=>t({[e]:!1}),pixelStorei:(t,e,n)=>t({[e]:n}),hint:(t,e,n)=>t({[e]:n}),useProgram:(t,e)=>t({35725:e}),bindRenderbuffer:(t,e,n)=>t({36007:n}),bindTransformFeedback:(t,e,n)=>t({36389:n}),bindVertexArray:(t,e)=>t({34229:e}),bindFramebuffer:(t,e,n)=>{switch(e){case 36160:return t({36006:n,36010:n});case 36009:return t({36006:n});case 36008:return t({36010:n});default:return null}},bindBuffer:(t,e,n)=>{const s={34962:[34964],36662:[36662],36663:[36663],35051:[35053],35052:[35055]}[e];return s?t({[s]:n}):{valueChanged:!0}},blendColor:(t,e,n,s,r)=>t({32773:new Float32Array([e,n,s,r])}),blendEquation:(t,e)=>t({32777:e,34877:e}),blendEquationSeparate:(t,e,n)=>t({32777:e,34877:n}),blendFunc:(t,e,n)=>t({32969:e,32968:n,32971:e,32970:n}),blendFuncSeparate:(t,e,n,s,r)=>t({32969:e,32968:n,32971:s,32970:r}),clearColor:(t,e,n,s,r)=>t({3106:new Float32Array([e,n,s,r])}),clearDepth:(t,e)=>t({2931:e}),clearStencil:(t,e)=>t({2961:e}),colorMask:(t,e,n,s,r)=>t({3107:[e,n,s,r]}),cullFace:(t,e)=>t({2885:e}),depthFunc:(t,e)=>t({2932:e}),depthRange:(t,e,n)=>t({2928:new Float32Array([e,n])}),depthMask:(t,e)=>t({2930:e}),frontFace:(t,e)=>t({2886:e}),lineWidth:(t,e)=>t({2849:e}),polygonOffset:(t,e,n)=>t({32824:e,10752:n}),sampleCoverage:(t,e,n)=>t({32938:e,32939:n}),scissor:(t,e,n,s,r)=>t({3088:new Int32Array([e,n,s,r])}),stencilMask:(t,e)=>t({2968:e,36005:e}),stencilMaskSeparate:(t,e,n)=>t({[e===1028?2968:36005]:n}),stencilFunc:(t,e,n,s)=>t({2962:e,2967:n,2963:s,34816:e,36003:n,36004:s}),stencilFuncSeparate:(t,e,n,s,r)=>t({[e===1028?2962:34816]:n,[e===1028?2967:36003]:s,[e===1028?2963:36004]:r}),stencilOp:(t,e,n,s)=>t({2964:e,2965:n,2966:s,34817:e,34818:n,34819:s}),stencilOpSeparate:(t,e,n,s,r)=>t({[e===1028?2964:34817]:n,[e===1028?2965:34818]:s,[e===1028?2966:34819]:r}),viewport:(t,e,n,s,r)=>t({2978:[e,n,s,r]})},wn=(t,e)=>t.isEnabled(e),Q0={3042:wn,2884:wn,2929:wn,3024:wn,32823:wn,32926:wn,32928:wn,3089:wn,2960:wn,35977:wn},CL=new Set([34016,36388,36387,35983,35368,34965,35739,35738,3074,34853,34854,34855,34856,34857,34858,34859,34860,34861,34862,34863,34864,34865,34866,34867,34868,35097,32873,35869,32874,34068]);function co(t,e){if(wL(e))return;const n={};for(const r in e){const i=Number(r),o=EL[r];o&&(typeof o=="string"?n[o]=!0:o(t,e[r],i))}const s=t.state&&t.state.cache;if(s)for(const r in n){const i=SL[r];i(t,e,s)}}function bw(t,e=Pm){if(typeof e=="number"){const r=e,i=Q0[r];return i?i(t,r):t.getParameter(r)}const n=Array.isArray(e)?e:Object.keys(e),s={};for(const r of n){const i=Q0[r];s[r]=i?i(t,Number(r)):t.getParameter(Number(r))}return s}function vL(t){co(t,Pm)}function wL(t){for(const e in t)return!1;return!0}function bL(t,e){if(t===e)return!0;const n=Array.isArray(t)||ArrayBuffer.isView(t),s=Array.isArray(e)||ArrayBuffer.isView(e);if(n&&s&&t.length===e.length){for(let r=0;r<t.length;++r)if(t[r]!==e[r])return!1;return!0}return!1}class RL{constructor(e,{copyState:n=!1,log:s=()=>{}}={}){p(this,"gl");p(this,"program",null);p(this,"stateStack",[]);p(this,"enable",!0);p(this,"cache");p(this,"log");this.gl=e,this.cache=n?bw(e):Object.assign({},Pm),this.log=s,this._updateCache=this._updateCache.bind(this),Object.seal(this)}push(e={}){this.stateStack.push({})}pop(){oe(this.stateStack.length>0);const e=this.stateStack[this.stateStack.length-1];co(this.gl,e),this.stateStack.pop()}_updateCache(e){let n=!1,s;const r=this.stateStack.length>0?this.stateStack[this.stateStack.length-1]:null;for(const i in e){oe(i!==void 0);const o=e[i],a=this.cache[i];bL(o,a)||(n=!0,s=a,r&&!(i in r)&&(r[i]=a),this.cache[i]=o)}return{valueChanged:n,oldValue:s}}}function Br(t){return t.state}function Rw(t,e){const{enable:n=!0,copyState:s}=e;if(oe(s!==void 0),!t.state){t.state=new RL(t,{copyState:s}),PL(t);for(const i in Z0){const o=Z0[i];IL(t,i,o)}eT(t,"getParameter"),eT(t,"isEnabled")}const r=Br(t);return r.enable=n,t}function zh(t){let e=Br(t);e||(Rw(t,{copyState:!1}),e=Br(t)),e.push()}function La(t){const e=Br(t);oe(e),e.pop()}function eT(t,e){const n=t[e].bind(t);t[e]=function(r){if(r===void 0||CL.has(r))return n(r);const i=Br(t);return r in i.cache||(i.cache[r]=n(r)),i.enable?i.cache[r]:n(r)},Object.defineProperty(t[e],"name",{value:`${e}-from-cache`,configurable:!1})}function IL(t,e,n){if(!t[e])return;const s=t[e].bind(t);t[e]=function(...i){const o=Br(t),{valueChanged:a,oldValue:c}=n(o._updateCache,...i);return a&&s(...i),c},Object.defineProperty(t[e],"name",{value:`${e}-to-cache`,configurable:!1})}function PL(t){const e=t.useProgram.bind(t);t.useProgram=function(s){const r=Br(t);r.program!==s&&(e(s),r.program=s)}}const xL={powerPreference:"high-performance",onContextLost:()=>console.error("WebGL context lost"),onContextRestored:()=>console.info("WebGL context restored")};function ML(t,e){e={...xL,...e};let n=null;const s=i=>n=i.statusMessage||n;t.addEventListener("webglcontextcreationerror",s,!1);let r=null;if(r||(r=t.getContext("webgl2",e)),t.removeEventListener("webglcontextcreationerror",s,!1),!r)throw new Error(`Failed to create WebGL context: ${n||"Unknown error"}`);if(e.onContextLost){const{onContextLost:i}=e;t.addEventListener("webglcontextlost",o=>i(o),!1)}if(e.onContextRestored){const{onContextRestored:i}=e;t.addEventListener("webglcontextrestored",o=>i(o),!1)}return r}function Ws(t,e,n){return n[e]===void 0&&(n[e]=t.getExtension(e)||null),n[e]}function BL(t,e){const n=t.getParameter(7936),s=t.getParameter(7937);Ws(t,"WEBGL_debug_renderer_info",e);const r=e.WEBGL_debug_renderer_info,i=t.getParameter(r?r.UNMASKED_VENDOR_WEBGL:7936),o=t.getParameter(r?r.UNMASKED_RENDERER_WEBGL:7937),a=i||n,c=o||s,l=t.getParameter(7938),u=Iw(a,c),h=OL(a,c),f=NL(a,c);return{type:"webgl",gpu:u,gpuType:f,gpuBackend:h,vendor:a,renderer:c,version:l,shadingLanguage:"glsl",shadingLanguageVersion:300}}function Iw(t,e){return/NVIDIA/i.exec(t)||/NVIDIA/i.exec(e)?"nvidia":/INTEL/i.exec(t)||/INTEL/i.exec(e)?"intel":/Apple/i.exec(t)||/Apple/i.exec(e)?"apple":/AMD/i.exec(t)||/AMD/i.exec(e)||/ATI/i.exec(t)||/ATI/i.exec(e)?"amd":/SwiftShader/i.exec(t)||/SwiftShader/i.exec(e)?"software":"unknown"}function OL(t,e){return/Metal/i.exec(t)||/Metal/i.exec(e)?"metal":/ANGLE/i.exec(t)||/ANGLE/i.exec(e)?"opengl":"unknown"}function NL(t,e){if(/SwiftShader/i.exec(t)||/SwiftShader/i.exec(e))return"cpu";switch(Iw(t,e)){case"intel":return"integrated";case"software":return"cpu";case"unknown":return"unknown";default:return"discrete"}}function Pw(t){switch(t){case"uint8":return 5121;case"sint8":return 5120;case"unorm8":return 5121;case"snorm8":return 5120;case"uint16":return 5123;case"sint16":return 5122;case"unorm16":return 5123;case"snorm16":return 5122;case"uint32":return 5125;case"sint32":return 5124;case"float16":return 5131;case"float32":return 5126}throw new Error(String(t))}const qe="texture-compression-bc",ue="texture-compression-astc",bn="texture-compression-etc2",FL="texture-compression-etc1-webgl",Gc="texture-compression-pvrtc-webgl",id="texture-compression-atc-webgl",Io="float32-renderable-webgl",od="float16-renderable-webgl",DL="rgb9e5ufloat_renderable-webgl",ad="snorm8-renderable-webgl",Po="norm16-renderable-webgl",cd="snorm16-renderable-webgl",Xc="float32-filterable",tT="float16-filterable-webgl",Go="WEBGL_compressed_texture_s3tc",Xo="WEBGL_compressed_texture_s3tc_srgb",_i="EXT_texture_compression_rgtc",mi="EXT_texture_compression_bptc",LL="WEBGL_compressed_texture_etc",UL="WEBGL_compressed_texture_astc",kL="WEBGL_compressed_texture_etc1",zL="WEBGL_compressed_texture_pvrtc",VL="WEBGL_compressed_texture_atc",nT="EXT_texture_norm16",sT="EXT_render_snorm",HL="EXT_color_buffer_float",xm={"float32-renderable-webgl":["EXT_color_buffer_float"],"float16-renderable-webgl":["EXT_color_buffer_half_float"],"rgb9e5ufloat_renderable-webgl":["WEBGL_render_shared_exponent"],"snorm8-renderable-webgl":[sT],"norm16-renderable-webgl":[nT],"snorm16-renderable-webgl":[nT,sT],"float32-filterable":["OES_texture_float_linear"],"float16-filterable-webgl":["OES_texture_half_float_linear"],"texture-filterable-anisotropic-webgl":["EXT_texture_filter_anisotropic"],"texture-blend-float-webgl":["EXT_float_blend"],"texture-compression-bc":[Go,Xo,_i,mi],"texture-compression-bc5-webgl":[_i],"texture-compression-bc7-webgl":[mi],"texture-compression-etc2":[LL],"texture-compression-astc":[UL],"texture-compression-etc1-webgl":[kL],"texture-compression-pvrtc-webgl":[zL],"texture-compression-atc-webgl":[VL]};function jL(t){return t in xm}function WL(t,e,n){return(xm[e]||[]).every(r=>Ws(t,r,n))}const Vh={"rgb8unorm-unsized":{gl:6407,b:4,c:2,bpp:4,dataFormat:6407,types:[5121,33635]},"rgba8unorm-unsized":{gl:6408,b:4,c:2,bpp:4,dataFormat:6408,types:[5121,32819,32820]},r8unorm:{gl:33321,b:1,c:1,rb:!0},r8snorm:{gl:36756,b:1,c:1,render:ad},r8uint:{gl:33330,b:1,c:1,rb:!0},r8sint:{gl:33329,b:1,c:1,rb:!0},rg8unorm:{gl:33323,b:2,c:2,rb:!0},rg8snorm:{gl:36757,b:2,c:2,render:ad},rg8uint:{gl:33336,b:2,c:2,rb:!0},rg8sint:{gl:33335,b:2,c:2,rb:!0},r16uint:{gl:33332,b:2,c:1,rb:!0},r16sint:{gl:33331,b:2,c:1,rb:!0},r16float:{gl:33325,b:2,c:1,render:od,filter:"float16-filterable-webgl",rb:!0},"r16unorm-webgl":{gl:33322,b:2,c:1,f:Po,rb:!0},"r16snorm-webgl":{gl:36760,b:2,c:1,f:cd},"rgba4unorm-webgl":{gl:32854,b:2,c:4,wgpu:!1,rb:!0},"rgb565unorm-webgl":{gl:36194,b:2,c:4,wgpu:!1,rb:!0},"rgb5a1unorm-webgl":{gl:32855,b:2,c:4,wgpu:!1,rb:!0},"rgb8unorm-webgl":{gl:32849,b:3,c:3,wgpu:!1},"rgb8snorm-webgl":{gl:36758,b:3,c:3,wgpu:!1},rgba8unorm:{gl:32856,b:4,c:2,bpp:4},"rgba8unorm-srgb":{gl:35907,b:4,c:4,bpp:4},rgba8snorm:{gl:36759,b:4,c:4,render:ad},rgba8uint:{gl:36220,b:4,c:4,bpp:4},rgba8sint:{gl:36238,b:4,c:4,bpp:4},bgra8unorm:{b:4,c:4},"bgra8unorm-srgb":{b:4,c:4},rg16uint:{gl:33338,b:4,c:1,bpp:4},rg16sint:{gl:33337,b:4,c:2,bpp:4},rg16float:{gl:33327,bpp:4,b:4,c:2,render:od,filter:tT,rb:!0},"rg16unorm-webgl":{gl:33324,b:2,c:2,render:Po},"rg16snorm-webgl":{gl:36761,b:2,c:2,render:cd},r32uint:{gl:33334,b:4,c:1,bpp:4,rb:!0},r32sint:{gl:33333,b:4,c:1,bpp:4,rb:!0},r32float:{gl:33326,bpp:4,b:4,c:1,render:Io,filter:Xc},rgb9e5ufloat:{gl:35901,b:4,c:3,p:1,render:DL},rg11b10ufloat:{gl:35898,b:4,c:3,p:1,render:Io,rb:!0},rgb10a2unorm:{gl:32857,b:4,c:4,p:1,rb:!0},"rgb10a2uint-webgl":{b:4,c:4,gl:36975,p:1,wgpu:!1,bpp:4,rb:!0},"rgb16unorm-webgl":{gl:32852,b:2,c:3,f:Po},"rgb16snorm-webgl":{gl:36762,b:2,c:3,f:Po},rg32uint:{gl:33340,b:8,c:2,rb:!0},rg32sint:{gl:33339,b:8,c:2,rb:!0},rg32float:{gl:33328,b:8,c:2,render:Io,filter:Xc,rb:!0},rgba16uint:{gl:36214,b:8,c:4,rb:!0},rgba16sint:{gl:36232,b:8,c:4,rb:!0},rgba16float:{gl:34842,b:8,c:4,render:od,filter:tT},"rgba16unorm-webgl":{gl:32859,b:2,c:4,render:Po,rb:!0},"rgba16snorm-webgl":{gl:36763,b:2,c:4,render:cd},"rgb32float-webgl":{gl:34837,render:Io,filter:Xc,gl2ext:HL,dataFormat:6407,types:[5126]},rgba32uint:{gl:36208,b:16,c:4,rb:!0},rgba32sint:{gl:36226,b:16,c:4,rb:!0},rgba32float:{gl:34836,b:16,c:4,render:Io,filter:Xc,rb:!0},stencil8:{gl:36168,b:1,c:1,attachment:36128,rb:!0},depth16unorm:{gl:33189,b:2,c:1,attachment:36096,dataFormat:6402,types:[5123],rb:!0},depth24plus:{gl:33190,b:3,c:1,attachment:36096,dataFormat:6402,types:[5125]},depth32float:{gl:36012,b:4,c:1,attachment:36096,dataFormat:6402,types:[5126],rb:!0},"depth24plus-stencil8":{gl:35056,b:4,c:2,p:1,attachment:33306,rb:!0,depthTexture:!0,dataFormat:34041,types:[34042]},"depth24unorm-stencil8":{gl:35056,b:4,c:2,p:1,attachment:33306,dataFormat:34041,types:[34042],rb:!0},"depth32float-stencil8":{gl:36013,b:5,c:2,p:1,attachment:33306,dataFormat:34041,types:[36269],rb:!0},"bc1-rgb-unorm-webgl":{gl:33776,x:Go,f:qe},"bc1-rgb-unorm-srgb-webgl":{gl:35916,x:Xo,f:qe},"bc1-rgba-unorm":{gl:33777,x:Go,f:qe},"bc1-rgba-unorm-srgb":{gl:35916,x:Xo,f:qe},"bc2-rgba-unorm":{gl:33778,x:Go,f:qe},"bc2-rgba-unorm-srgb":{gl:35918,x:Xo,f:qe},"bc3-rgba-unorm":{gl:33779,x:Go,f:qe},"bc3-rgba-unorm-srgb":{gl:35919,x:Xo,f:qe},"bc4-r-unorm":{gl:36283,x:_i,f:qe},"bc4-r-snorm":{gl:36284,x:_i,f:qe},"bc5-rg-unorm":{gl:36285,x:_i,f:qe},"bc5-rg-snorm":{gl:36286,x:_i,f:qe},"bc6h-rgb-ufloat":{gl:36495,x:mi,f:qe},"bc6h-rgb-float":{gl:36494,x:mi,f:qe},"bc7-rgba-unorm":{gl:36492,x:mi,f:qe},"bc7-rgba-unorm-srgb":{gl:36493,x:mi,f:qe},"etc2-rgb8unorm":{gl:37492,f:bn},"etc2-rgb8unorm-srgb":{gl:37494,f:bn},"etc2-rgb8a1unorm":{gl:37496,f:bn},"etc2-rgb8a1unorm-srgb":{gl:37497,f:bn},"etc2-rgba8unorm":{gl:37493,f:bn},"etc2-rgba8unorm-srgb":{gl:37495,f:bn},"eac-r11unorm":{gl:37488,f:bn},"eac-r11snorm":{gl:37489,f:bn},"eac-rg11unorm":{gl:37490,f:bn},"eac-rg11snorm":{gl:37491,f:bn},"astc-4x4-unorm":{gl:37808,f:ue},"astc-4x4-unorm-srgb":{gl:37840,f:ue},"astc-5x4-unorm":{gl:37809,f:ue},"astc-5x4-unorm-srgb":{gl:37841,f:ue},"astc-5x5-unorm":{gl:37810,f:ue},"astc-5x5-unorm-srgb":{gl:37842,f:ue},"astc-6x5-unorm":{gl:37811,f:ue},"astc-6x5-unorm-srgb":{gl:37843,f:ue},"astc-6x6-unorm":{gl:37812,f:ue},"astc-6x6-unorm-srgb":{gl:37844,f:ue},"astc-8x5-unorm":{gl:37813,f:ue},"astc-8x5-unorm-srgb":{gl:37845,f:ue},"astc-8x6-unorm":{gl:37814,f:ue},"astc-8x6-unorm-srgb":{gl:37846,f:ue},"astc-8x8-unorm":{gl:37815,f:ue},"astc-8x8-unorm-srgb":{gl:37847,f:ue},"astc-10x5-unorm":{gl:37819,f:ue},"astc-10x5-unorm-srgb":{gl:37851,f:ue},"astc-10x6-unorm":{gl:37817,f:ue},"astc-10x6-unorm-srgb":{gl:37849,f:ue},"astc-10x8-unorm":{gl:37818,f:ue},"astc-10x8-unorm-srgb":{gl:37850,f:ue},"astc-10x10-unorm":{gl:37819,f:ue},"astc-10x10-unorm-srgb":{gl:37851,f:ue},"astc-12x10-unorm":{gl:37820,f:ue},"astc-12x10-unorm-srgb":{gl:37852,f:ue},"astc-12x12-unorm":{gl:37821,f:ue},"astc-12x12-unorm-srgb":{gl:37853,f:ue},"pvrtc-rgb4unorm-webgl":{gl:35840,f:Gc},"pvrtc-rgba4unorm-webgl":{gl:35842,f:Gc},"pvrtc-rbg2unorm-webgl":{gl:35841,f:Gc},"pvrtc-rgba2unorm-webgl":{gl:35843,f:Gc},"etc1-rbg-unorm-webgl":{gl:36196,f:FL},"atc-rgb-unorm-webgl":{gl:35986,f:id},"atc-rgba-unorm-webgl":{gl:35986,f:id},"atc-rgbai-unorm-webgl":{gl:34798,f:id}},XL={6403:1,36244:1,33319:2,33320:2,6407:3,36248:3,6408:4,36249:4,6402:1,34041:1,6406:1,6409:1,6410:2},$L={5126:4,5125:4,5124:4,5123:2,5122:2,5131:2,5120:1,5121:1};function Mm(t,e,n){const s=Vh[e];if(!s||s.gl===void 0)return!1;const r=s.x||s.gl2ext;return r?!!Ws(t,r,n):!0}function xw(t){const e=Vh[t],n=e==null?void 0:e.gl;if(n===void 0)throw new Error(`Unsupported texture format ${t}`);return n}function KL(t,e,n){if(!Mm(t,e,n)||e.startsWith("depth")||e.startsWith("stencil"))return!1;try{if(Cv(e).signed)return!1}catch{return!1}return e.endsWith("32float")?!!Ws(t,"OES_texture_float_linear, extensions",n):e.endsWith("16float")?!!Ws(t,"OES_texture_half_float_linear, extensions",n):!0}function YL(t,e,n){return!(!Mm(t,e,n)||typeof e=="number")}function bu(t){var r;const e=Vh[t],n=xw(t),s=Cv(t);return{format:n,dataFormat:(e==null?void 0:e.dataFormat)||qL(s.format,s.integer,s.normalized,n),type:s.dataType?Pw(s.dataType):((r=e==null?void 0:e.types)==null?void 0:r[0])||5121,compressed:s.compressed}}function JL(t){const e=Vh[t];if(!(e!=null&&e.attachment))throw new Error(`${t} is not a depth stencil format`);return e.attachment}function rT(t){const e=bu(t),n=XL[e.dataFormat]||4,s=$L[e.type]||1;return n*s}function qL(t,e,n,s){if(s===6408||s===6407)return s;switch(t){case"r":return e&&!n?36244:6403;case"rg":return e&&!n?33320:33319;case"rgb":return e&&!n?36248:6407;case"rgba":return e&&!n?36249:6408;default:return 6408}}const iT={"depth-clip-control":"EXT_depth_clamp","timer-query-webgl":"EXT_disjoint_timer_query_webgl2","compilation-status-async-webgl":"KHR_parallel_shader_compile","polygon-mode-webgl":"WEBGL_polygon_mode","provoking-vertex-webgl":"WEBGL_provoking_vertex","shader-clip-cull-distance-webgl":"WEBGL_clip_cull_distance","shader-noperspective-interpolation-webgl":"NV_shader_noperspective_interpolation","shader-conservative-depth-webgl":"EXT_conservative_depth"};class ZL extends e2{constructor(n,s,r){super([],r);p(this,"gl");p(this,"extensions");p(this,"testedFeatures",new Set);this.gl=n,this.extensions=s,Ws(n,"EXT_color_buffer_float",s)}*[Symbol.iterator](){const n=this.getFeatures();for(const s of n)this.has(s)&&(yield s);return[]}has(n){return this.disabledFeatures[n]?!1:(this.testedFeatures.has(n)||(this.testedFeatures.add(n),jL(n)&&WL(this.gl,n,this.extensions)&&this.features.add(n),this.getWebGLFeature(n)&&this.features.add(n)),this.features.has(n))}initializeFeatures(){const n=this.getFeatures().filter(s=>s!=="polygon-mode-webgl");for(const s of n)this.has(s)}getFeatures(){return[...Object.keys(iT),...Object.keys(xm)]}getWebGLFeature(n){const s=iT[n];return typeof s=="string"?!!Ws(this.gl,s,this.extensions):!!s}}class QL extends QB{constructor(n){super();p(this,"gl");p(this,"limits",{});this.gl=n}get maxTextureDimension1D(){return 0}get maxTextureDimension2D(){return this.getParameter(3379)}get maxTextureDimension3D(){return this.getParameter(32883)}get maxTextureArrayLayers(){return this.getParameter(35071)}get maxBindGroups(){return 0}get maxDynamicUniformBuffersPerPipelineLayout(){return 0}get maxDynamicStorageBuffersPerPipelineLayout(){return 0}get maxSampledTexturesPerShaderStage(){return this.getParameter(35660)}get maxSamplersPerShaderStage(){return this.getParameter(35661)}get maxStorageBuffersPerShaderStage(){return 0}get maxStorageTexturesPerShaderStage(){return 0}get maxUniformBuffersPerShaderStage(){return this.getParameter(35375)}get maxUniformBufferBindingSize(){return this.getParameter(35376)}get maxStorageBufferBindingSize(){return 0}get minUniformBufferOffsetAlignment(){return this.getParameter(35380)}get minStorageBufferOffsetAlignment(){return 0}get maxVertexBuffers(){return 16}get maxVertexAttributes(){return this.getParameter(34921)}get maxVertexBufferArrayStride(){return 2048}get maxInterStageShaderComponents(){return this.getParameter(35659)}get maxComputeWorkgroupStorageSize(){return 0}get maxComputeInvocationsPerWorkgroup(){return 0}get maxComputeWorkgroupSizeX(){return 0}get maxComputeWorkgroupSizeY(){return 0}get maxComputeWorkgroupSizeZ(){return 0}get maxComputeWorkgroupsPerDimension(){return 0}getParameter(n){return this.limits[n]===void 0&&(this.limits[n]=this.gl.getParameter(n)),this.limits[n]}}function Is(t,e,n){if(eU(e))return n(t);const{nocatch:s=!0}=e;zh(t),co(t,e);let r;if(s)r=n(t),La(t);else try{r=n(t)}finally{La(t)}return r}function eU(t){for(const e in t)return!1;return!0}function tU(t,e,n,s){if(pu(e))return s(t);const r=t;zh(r.gl);try{return nU(t,e),co(r.gl,n),s(t)}finally{La(r.gl)}}function nU(t,e){const n=t,{gl:s}=n;if(e.cullMode)switch(e.cullMode){case"none":s.disable(2884);break;case"front":s.enable(2884),s.cullFace(1028);break;case"back":s.enable(2884),s.cullFace(1029);break}if(e.frontFace&&s.frontFace(wr("frontFace",e.frontFace,{ccw:2305,cw:2304})),e.unclippedDepth&&t.features.has("depth-clip-control")&&s.enable(34383),e.depthBias!==void 0&&(s.enable(32823),s.polygonOffset(e.depthBias,e.depthBiasSlopeScale||0)),e.provokingVertex&&t.features.has("provoking-vertex-webgl")){const i=n.getExtension("WEBGL_provoking_vertex").WEBGL_provoking_vertex,o=wr("provokingVertex",e.provokingVertex,{first:36429,last:36430});i==null||i.provokingVertexWEBGL(o)}if((e.polygonMode||e.polygonOffsetLine)&&t.features.has("polygon-mode-webgl")){if(e.polygonMode){const i=n.getExtension("WEBGL_polygon_mode").WEBGL_polygon_mode,o=wr("polygonMode",e.polygonMode,{fill:6914,line:6913});i==null||i.polygonModeWEBGL(1028,o),i==null||i.polygonModeWEBGL(1029,o)}e.polygonOffsetLine&&s.enable(10754)}if(t.features.has("shader-clip-cull-distance-webgl")&&(e.clipDistance0&&s.enable(12288),e.clipDistance1&&s.enable(12289),e.clipDistance2&&s.enable(12290),e.clipDistance3&&s.enable(12291),e.clipDistance4&&s.enable(12292),e.clipDistance5&&s.enable(12293),e.clipDistance6&&s.enable(12294),e.clipDistance7&&s.enable(12295)),e.depthWriteEnabled!==void 0&&s.depthMask(rU("depthWriteEnabled",e.depthWriteEnabled)),e.depthCompare&&(e.depthCompare!=="always"?s.enable(2929):s.disable(2929),s.depthFunc(hg("depthCompare",e.depthCompare))),e.stencilWriteMask){const r=e.stencilWriteMask;s.stencilMaskSeparate(1028,r),s.stencilMaskSeparate(1029,r)}if(e.stencilReadMask&&U.warn("stencilReadMask not supported under WebGL"),e.stencilCompare){const r=e.stencilReadMask||4294967295,i=hg("depthCompare",e.stencilCompare);e.stencilCompare!=="always"?s.enable(2960):s.disable(2960),s.stencilFuncSeparate(1028,i,0,r),s.stencilFuncSeparate(1029,i,0,r)}if(e.stencilPassOperation&&e.stencilFailOperation&&e.stencilDepthFailOperation){const r=ld("stencilPassOperation",e.stencilPassOperation),i=ld("stencilFailOperation",e.stencilFailOperation),o=ld("stencilDepthFailOperation",e.stencilDepthFailOperation);s.stencilOpSeparate(1028,i,o,r),s.stencilOpSeparate(1029,i,o,r)}if(e.blendColorOperation||e.blendAlphaOperation){s.enable(3042);const r=oT("blendColorOperation",e.blendColorOperation||"add"),i=oT("blendAlphaOperation",e.blendAlphaOperation||"add");s.blendEquationSeparate(r,i);const o=$c("blendColorSrcFactor",e.blendColorSrcFactor||"one"),a=$c("blendColorDstFactor",e.blendColorDstFactor||"zero"),c=$c("blendAlphaSrcFactor",e.blendAlphaSrcFactor||"one"),l=$c("blendAlphaDstFactor",e.blendAlphaDstFactor||"zero");s.blendFuncSeparate(o,a,c,l)}}function hg(t,e){return wr(t,e,{never:512,less:513,equal:514,"less-equal":515,greater:516,"not-equal":517,"greater-equal":518,always:519})}function ld(t,e){return wr(t,e,{keep:7680,zero:0,replace:7681,invert:5386,"increment-clamp":7682,"decrement-clamp":7683,"increment-wrap":34055,"decrement-wrap":34056})}function oT(t,e){return wr(t,e,{add:32774,subtract:32778,"reverse-subtract":32779,min:32775,max:32776})}function $c(t,e){return wr(t,e,{one:1,zero:0,"src-color":768,"one-minus-src-color":769,"dst-color":774,"one-minus-dst-color":775,"src-alpha":770,"one-minus-src-alpha":771,"dst-alpha":772,"one-minus-dst-alpha":773,"src-alpha-saturated":776,"constant-color":32769,"one-minus-constant-color":32770,"constant-alpha":32771,"one-minus-constant-alpha":32772})}function sU(t,e){return`Illegal parameter ${e} for ${t}`}function wr(t,e,n){if(!(e in n))throw new Error(sU(t,e));return n[e]}function rU(t,e){return e}function Mw(t){const e={};return t.addressModeU&&(e[10242]=ud(t.addressModeU)),t.addressModeV&&(e[10243]=ud(t.addressModeV)),t.addressModeW&&(e[32882]=ud(t.addressModeW)),t.magFilter&&(e[10240]=Bw(t.magFilter)),(t.minFilter||t.mipmapFilter)&&(e[10241]=iU(t.minFilter||"linear",t.mipmapFilter)),t.lodMinClamp!==void 0&&(e[33082]=t.lodMinClamp),t.lodMaxClamp!==void 0&&(e[33083]=t.lodMaxClamp),t.type==="comparison-sampler"&&(e[34892]=34894),t.compare&&(e[34893]=hg("compare",t.compare)),t.maxAnisotropy&&(e[34046]=t.maxAnisotropy),e}function ud(t){switch(t){case"clamp-to-edge":return 33071;case"repeat":return 10497;case"mirror-repeat":return 33648}}function Bw(t){switch(t){case"nearest":return 9728;case"linear":return 9729}}function iU(t,e){if(!e)return Bw(t);switch(t){case"nearest":return e==="nearest"?9984:9986;case"linear":return e==="nearest"?9985:9987}}class ks extends Ae{constructor(n,s={}){super(n,s);p(this,"device");p(this,"gl");p(this,"handle");p(this,"glTarget");p(this,"glUsage");p(this,"glIndexType",5123);p(this,"byteLength");p(this,"bytesUsed");this.device=n,this.gl=this.device.gl;const r=typeof s=="object"?s.handle:void 0;this.handle=r||this.gl.createBuffer(),n.setSpectorMetadata(this.handle,{...this.props,data:typeof this.props.data}),this.glTarget=oU(this.props.usage),this.glUsage=aU(this.props.usage),this.glIndexType=this.props.indexType==="uint32"?5125:5123,s.data?this._initWithData(s.data,s.byteOffset,s.byteLength):this._initWithByteLength(s.byteLength||0)}_initWithData(n,s=0,r=n.byteLength+s){const i=this.glTarget;this.gl.bindBuffer(i,this.handle),this.gl.bufferData(i,r,this.glUsage),this.gl.bufferSubData(i,s,n),this.gl.bindBuffer(i,null),this.bytesUsed=r,this.byteLength=r,this._setDebugData(n,s,r),this.trackAllocatedMemory(r)}_initWithByteLength(n){oe(n>=0);let s=n;n===0&&(s=new Float32Array(0));const r=this.glTarget;return this.gl.bindBuffer(r,this.handle),this.gl.bufferData(r,s,this.glUsage),this.gl.bindBuffer(r,null),this.bytesUsed=n,this.byteLength=n,this._setDebugData(null,0,n),this.trackAllocatedMemory(n),this}destroy(){!this.destroyed&&this.handle&&(this.removeStats(),this.trackDeallocatedMemory(),this.gl.deleteBuffer(this.handle),this.destroyed=!0,this.handle=null)}write(n,s=0){this.gl.bindBuffer(36663,this.handle),this.gl.bufferSubData(36663,s,n),this.gl.bindBuffer(36663,null),this._setDebugData(n,s,n.byteLength)}async readAsync(n=0,s){return this.readSyncWebGL(n,s)}readSyncWebGL(n=0,s){s=s??this.byteLength-n;const r=new Uint8Array(s),i=0;return this.gl.bindBuffer(36662,this.handle),this.gl.getBufferSubData(36662,n,r,i,s),this.gl.bindBuffer(36662,null),this._setDebugData(r,n,s),r}}function oU(t){return t&Ae.INDEX?34963:t&Ae.VERTEX?34962:t&Ae.UNIFORM?35345:34962}function aU(t){return t&Ae.INDEX||t&Ae.VERTEX?35044:t&Ae.UNIFORM?35048:35044}class fg extends mu{constructor(n,s){super(n,s);p(this,"device");p(this,"handle");p(this,"parameters");this.device=n,this.parameters=Mw(s),this.handle=this.handle||this.device.gl.createSampler(),this._setSamplerParameters(this.parameters)}destroy(){this.handle&&(this.device.gl.deleteSampler(this.handle),this.handle=void 0)}toString(){return`Sampler(${this.id},${JSON.stringify(this.props)})`}_setSamplerParameters(n){for(const[s,r]of Object.entries(n)){const i=Number(s);switch(i){case 33082:case 33083:this.device.gl.samplerParameterf(this.handle,i,r);break;default:this.device.gl.samplerParameteri(this.handle,i,r);break}}}}class yi extends gu{constructor(n,s){super(n,{...Rt.defaultProps,...s});p(this,"device");p(this,"gl");p(this,"handle");p(this,"texture");this.device=n,this.gl=this.device.gl,this.handle=null,this.texture=s.texture}}const cU={parameters:{},pixelStore:{},pixels:null,border:0,dataFormat:void 0,textureUnit:void 0,target:void 0},ga=class ga extends Rt{constructor(n,s){var r;super(n,{...cU,format:"rgba8unorm",...s});p(this,"MAX_ATTRIBUTES");p(this,"device");p(this,"gl");p(this,"handle");p(this,"sampler");p(this,"view");p(this,"glFormat");p(this,"type");p(this,"dataFormat");p(this,"mipmaps");p(this,"target");p(this,"textureUnit");p(this,"loaded",!1);p(this,"_video");this.device=n,this.gl=this.device.gl,this.handle=this.props.handle||this.gl.createTexture(),this.device.setSpectorMetadata(this.handle,{...this.props,data:typeof this.props.data}),this.glFormat=6408,this.target=lU(this.props),this.loaded=!1,typeof((r=this.props)==null?void 0:r.data)=="string"&&Object.assign(this.props,{data:V2(this.props.data)}),this.initialize(this.props),Object.seal(this)}destroy(){this.handle&&(this.gl.deleteTexture(this.handle),this.removeStats(),this.trackDeallocatedMemory("Texture"),this.destroyed=!0)}toString(){return`Texture(${this.id},${this.width}x${this.height})`}createView(n){return new yi(this.device,{...n,texture:this})}initialize(n={}){if(this.props.dimension==="cube")return this.initializeCube(n);let s=n.data;if(s instanceof Promise)return s.then(m=>this.initialize(Object.assign({},n,{pixels:m,data:m}))),this;const r=typeof HTMLVideoElement<"u"&&s instanceof HTMLVideoElement;if(r&&s.readyState<HTMLVideoElement.HAVE_METADATA)return this._video=null,s.addEventListener("loadeddata",()=>this.initialize(n)),this;const{parameters:i={}}=n,{pixels:o=null,pixelStore:a={},textureUnit:c=void 0,mipmaps:l=!0}=n;s||(s=o);let{width:u,height:h,dataFormat:f,type:d,compressed:g=!1}=n;const{depth:_=0}=n,E=xw(n.format);return{width:u,height:h,compressed:g,dataFormat:f,type:d}=this._deduceParameters({format:n.format,type:d,dataFormat:f,compressed:g,data:s,width:u,height:h}),this.width=u,this.height=h,this.glFormat=E,this.type=d,this.dataFormat=f,this.textureUnit=c,Number.isFinite(this.textureUnit)&&(this.gl.activeTexture(33984+this.textureUnit),this.gl.bindTexture(this.target,this.handle)),this.mipmaps=l,this.setImageData({data:s,width:u,height:h,depth:_,format:E,type:d,dataFormat:f,parameters:a,compressed:g}),this.setSampler(n.sampler),this._setSamplerParameters(i),this.view=this.createView({...this.props,mipLevelCount:1,arrayLayerCount:1}),l&&this.device.isTextureFormatFilterable(n.format)&&this.generateMipmap(),r&&(this._video={video:s,parameters:i,lastTime:s.readyState>=HTMLVideoElement.HAVE_CURRENT_DATA?s.currentTime:-1}),this}initializeCube(n){const{mipmaps:s=!0,parameters:r={}}=n;return this.setCubeMapImageData(n).then(()=>{this.loaded=!0,s&&this.generateMipmap(n),this.setSampler(n.sampler),this._setSamplerParameters(r)}),this}setSampler(n={}){let s;n instanceof fg?(this.sampler=n,s=n.props):(this.sampler=new fg(this.device,n),s=n);const r=Mw(s);return this._setSamplerParameters(r),this}resize(n){const{height:s,width:r,mipmaps:i=!1}=n;return r!==this.width||s!==this.height?this.initialize({width:r,height:s,format:this.format,type:this.type,dataFormat:this.dataFormat,mipmaps:i}):this}update(){if(this._video){const{video:n,parameters:s,lastTime:r}=this._video;if(r===n.currentTime||n.readyState<HTMLVideoElement.HAVE_CURRENT_DATA)return;this.setSubImageData({data:n,parameters:s}),this.mipmaps&&this.generateMipmap(),this._video.lastTime=n.currentTime}}generateMipmap(n={}){return this.mipmaps=!0,this.gl.bindTexture(this.target,this.handle),Is(this.gl,n,()=>{this.gl.generateMipmap(this.target)}),this.gl.bindTexture(this.target,null),this}setImageData(n){if(this.props.dimension==="3d"||this.props.dimension==="2d-array")return this.setImageData3D(n);this.trackDeallocatedMemory("Texture");const{target:s=this.target,pixels:r=null,level:i=0,glFormat:o=this.glFormat,offset:a=0,parameters:c={}}=n;let{data:l=null,type:u=this.type,width:h=this.width,height:f=this.height,dataFormat:d=this.dataFormat,compressed:g=!1}=n;l||(l=r),{type:u,dataFormat:d,compressed:g,width:h,height:f}=this._deduceParameters({format:this.props.format,type:u,dataFormat:d,compressed:g,data:l,width:h,height:f});const{gl:_}=this;_.bindTexture(this.target,this.handle);let E=null;if({data:l,dataType:E}=this._getDataType({data:l,compressed:g}),Is(this.gl,c,()=>{switch(E){case"null":_.texImage2D(s,i,o,h,f,0,d,u,l);break;case"typed-array":_.texImage2D(s,i,o,h,f,0,d,u,l,a);break;case"buffer":this.device.gl.bindBuffer(35052,l.handle||l),this.device.gl.texImage2D(s,i,o,h,f,0,d,u,a),this.device.gl.bindBuffer(35052,null);break;case"browser-object":_.texImage2D(s,i,o,h,f,0,d,u,l);break;case"compressed":for(const[m,y]of l.entries())_.compressedTexImage2D(s,m,y.format,y.width,y.height,0,y.data);break;default:oe(!1,"Unknown image data type")}}),l&&l.byteLength)this.trackAllocatedMemory(l.byteLength,"Texture");else{const m=rT(this.props.format);this.trackAllocatedMemory(this.width*this.height*m,"Texture")}return this.loaded=!0,this}setSubImageData({target:n=this.target,pixels:s=null,data:r=null,x:i=0,y:o=0,width:a=this.width,height:c=this.height,level:l=0,glFormat:u=this.glFormat,type:h=this.type,dataFormat:f=this.dataFormat,compressed:d=!1,offset:g=0,parameters:_={}}){if({type:h,dataFormat:f,compressed:d,width:a,height:c}=this._deduceParameters({format:this.props.format,type:h,dataFormat:f,compressed:d,data:r,width:a,height:c}),oe(this.depth===1,"texSubImage not supported for 3D textures"),r||(r=s),r&&r.data){const E=r;r=E.data,a=E.shape[0],c=E.shape[1]}r instanceof ks&&(r=r.handle),this.gl.bindTexture(this.target,this.handle),Is(this.gl,_,()=>{d?this.gl.compressedTexSubImage2D(n,l,i,o,a,c,u,r):r===null?this.gl.texSubImage2D(n,l,i,o,a,c,f,h,null):ArrayBuffer.isView(r)?this.gl.texSubImage2D(n,l,i,o,a,c,f,h,r,g):typeof WebGLBuffer<"u"&&r instanceof WebGLBuffer?(this.device.gl.bindBuffer(35052,r),this.device.gl.texSubImage2D(n,l,i,o,a,c,f,h,g),this.device.gl.bindBuffer(35052,null)):this.device.gl.texSubImage2D(n,l,i,o,a,c,f,h,r)}),this.gl.bindTexture(this.target,null)}copyFramebuffer(n={}){return U.error("Texture.copyFramebuffer({...}) is no logner supported, use copyToTexture(source, target, opts})")(),null}getActiveUnit(){return this.gl.getParameter(34016)-33984}bind(n=this.textureUnit){const{gl:s}=this;return n!==void 0&&(this.textureUnit=n,s.activeTexture(33984+n)),s.bindTexture(this.target,this.handle),n}unbind(n=this.textureUnit){const{gl:s}=this;return n!==void 0&&(this.textureUnit=n,s.activeTexture(33984+n)),s.bindTexture(this.target,null),n}_getDataType({data:n,compressed:s=!1}){return s?{data:n,dataType:"compressed"}:n===null?{data:n,dataType:"null"}:ArrayBuffer.isView(n)?{data:n,dataType:"typed-array"}:n instanceof ks?{data:n.handle,dataType:"buffer"}:typeof WebGLBuffer<"u"&&n instanceof WebGLBuffer?{data:n,dataType:"buffer"}:{data:n,dataType:"browser-object"}}_deduceParameters(n){const{format:s,data:r}=n;let{width:i,height:o,dataFormat:a,type:c,compressed:l}=n;const u=bu(s);return a=a||u.dataFormat,c=c||u.type,l=l||u.compressed,{width:i,height:o}=this._deduceImageSize(r,i,o),{dataFormat:a,type:c,compressed:l,width:i,height:o,format:s,data:r}}_deduceImageSize(n,s,r){let i;return typeof ImageData<"u"&&n instanceof ImageData?i={width:n.width,height:n.height}:typeof HTMLImageElement<"u"&&n instanceof HTMLImageElement?i={width:n.naturalWidth,height:n.naturalHeight}:typeof HTMLCanvasElement<"u"&&n instanceof HTMLCanvasElement?i={width:n.width,height:n.height}:typeof ImageBitmap<"u"&&n instanceof ImageBitmap?i={width:n.width,height:n.height}:typeof HTMLVideoElement<"u"&&n instanceof HTMLVideoElement?i={width:n.videoWidth,height:n.videoHeight}:n?i={width:s,height:r}:i={width:s>=0?s:1,height:r>=0?r:1},oe(i,"Could not deduced texture size"),oe(s===void 0||i.width===s,"Deduced texture width does not match supplied width"),oe(r===void 0||i.height===r,"Deduced texture height does not match supplied height"),i}async setCubeMapImageData(n){const{gl:s}=this,{width:r,height:i,pixels:o,data:a,format:c=6408,type:l=5121}=n,u=o||a,h=await Promise.all(ga.FACES.map(f=>{const d=u[f];return Promise.all(Array.isArray(d)?d:[d])}));this.bind(),ga.FACES.forEach((f,d)=>{h[d].length>1&&this.props.mipmaps!==!1&&U.warn(`${this.id} has mipmap and multiple LODs.`)(),h[d].forEach((g,_)=>{r&&i?s.texImage2D(f,_,c,r,i,0,c,l,g):s.texImage2D(f,_,c,c,l,g)})}),this.unbind()}setImageDataForFace(n){const{face:s,width:r,height:i,pixels:o,data:a,format:c=6408,type:l=5121}=n,{gl:u}=this,h=o||a;return this.bind(),h instanceof Promise?h.then(f=>this.setImageDataForFace(Object.assign({},n,{face:s,data:f,pixels:f}))):this.width||this.height?u.texImage2D(s,0,c,r,i,0,c,l,h):u.texImage2D(s,0,c,c,l,h),this}setImageData3D(n){const{level:s=0,dataFormat:r,format:i,type:o,width:a,height:c,depth:l=1,offset:u=0,data:h,parameters:f={}}=n;this.trackDeallocatedMemory("Texture"),this.gl.bindTexture(this.target,this.handle);const d=bu(i);if(Is(this.gl,f,()=>{ArrayBuffer.isView(h)&&this.gl.texImage3D(this.target,s,d.format,a,c,l,0,d.dataFormat,d.type,h),h instanceof ks&&(this.gl.bindBuffer(35052,h.handle),this.gl.texImage3D(this.target,s,r,a,c,l,0,i,o,u))}),h&&h.byteLength)this.trackAllocatedMemory(h.byteLength,"Texture");else{const g=rT(this.props.format);this.trackAllocatedMemory(this.width*this.height*this.depth*g,"Texture")}return this.loaded=!0,this}_setSamplerParameters(n){if(!pu(n)){uU(n),this.gl.bindTexture(this.target,this.handle);for(const[s,r]of Object.entries(n)){const i=Number(s),o=r;switch(i){case 33082:case 33083:this.gl.texParameterf(this.target,i,o);break;default:this.gl.texParameteri(this.target,i,o);break}}this.gl.bindTexture(this.target,null)}}};p(ga,"FACES",[34069,34070,34071,34072,34073,34074]);let Nn=ga;function lU(t){switch(t.dimension){case"2d":return 3553;case"cube":return 34067;case"2d-array":return 35866;case"3d":return 32879;case"1d":case"cube-array":default:throw new Error(t.dimension)}}function uU(t){U.log(1,"texture sampler parameters",t)()}class ca extends yu{constructor(n,s){super(n,s);p(this,"device");p(this,"gl");p(this,"handle");const r=s.handle===null;if(this.device=n,this.gl=n.gl,this.handle=this.props.handle||r?this.props.handle:this.gl.createFramebuffer(),!r){n.setSpectorMetadata(this.handle,{id:this.props.id,props:this.props}),this.autoCreateAttachmentTextures();const i=this.gl.bindFramebuffer(36160,this.handle);for(let o=0;o<this.colorAttachments.length;++o){const a=this.colorAttachments[o],c=36064+o;a&&this._attachOne(c,a)}if(this.depthStencilAttachment&&this._attachOne(JL(this.depthStencilAttachment.props.format),this.depthStencilAttachment),s.check!==!1){const o=this.gl.checkFramebufferStatus(36160);if(o!==36053)throw new Error(`Framebuffer ${fU(o)}`)}this.gl.bindFramebuffer(36160,i)}}get texture(){return this.colorAttachments[0]}destroy(){super.destroy(),!this.destroyed&&this.handle!==null&&this.gl.deleteFramebuffer(this.handle)}createDepthStencilTexture(n){return new Nn(this.device,{id:`${this.id}-depth-stencil`,format:n,width:this.width,height:this.height,mipmaps:!1})}resizeAttachments(n,s){if(this.handle===null)return this.width=this.gl.drawingBufferWidth,this.height=this.gl.drawingBufferHeight,this;n===void 0&&(n=this.gl.drawingBufferWidth),s===void 0&&(s=this.gl.drawingBufferHeight);for(const r of this.colorAttachments)r.texture.resize({width:n,height:s});return this.depthStencilAttachment&&this.depthStencilAttachment.texture.resize({width:n,height:s}),this}_attachOne(n,s){if(Array.isArray(s)){const[r,i=0,o=0]=s;return this._attachTexture(n,r,i,o),r}if(s instanceof Nn)return this._attachTexture(n,s,0,0),s;if(s instanceof yi){const r=s;return this._attachTexture(n,r.texture,r.props.baseMipLevel,r.props.baseArrayLayer),s.texture}throw new Error("attach")}_attachTexture(n,s,r,i){const{gl:o}=this.device;switch(o.bindTexture(s.target,s.handle),s.target){case 35866:case 32879:o.framebufferTextureLayer(36160,n,s.target,i,r);break;case 34067:const a=hU(r);o.framebufferTexture2D(36160,n,a,s.handle,i);break;case 3553:o.framebufferTexture2D(36160,n,3553,s.handle,i);break;default:oe(!1,"Illegal texture type")}o.bindTexture(s.target,null)}}function hU(t){return t<34069?t+34069:t}function fU(t){switch(t){case 36053:return"success";case 36054:return"Mismatched attachments";case 36055:return"No attachments";case 36057:return"Height/width mismatch";case 36061:return"Unsupported or split attachments";case 36182:return"Samples mismatch";default:return`${t}`}}class dU extends dm{constructor(n,s){super(s);p(this,"device");p(this,"presentationSize");p(this,"_framebuffer",null);this.device=n,this.presentationSize=[-1,-1],this._setAutoCreatedCanvasId(`${this.device.id}-canvas`),this.update()}getCurrentFramebuffer(){return this.update(),this._framebuffer=this._framebuffer||new ca(this.device,{handle:null}),this._framebuffer}update(){const n=this.getPixelSize();(n[0]!==this.presentationSize[0]||n[1]!==this.presentationSize[1])&&(this.presentationSize=n,this.resize())}resize(n){if(this.device.gl&&this.canvas){const s=this.getDevicePixelRatio(n==null?void 0:n.useDevicePixels);this.setDevicePixelRatio(s,n);return}}commit(){}}const pU={spector:U.get("spector")||U.get("inspect")},gU="https://spectorcdn.babylonjs.com/spector.bundle.js",_U=1;let he=null,aT=!1;async function mU(t){if(!globalThis.SPECTOR)try{await Bv(gU)}catch(e){U.warn(String(e))}}function yU(t){if(t={...pU,...t},!(t!=null&&t.spector)||(!he&&globalThis.SPECTOR&&(U.probe(_U,"SPECTOR found and initialized")(),he=new globalThis.SPECTOR.Spector,globalThis.luma&&(globalThis.luma.spector=he)),!he))return null;if(aT||(aT=!0,he.spyCanvases(),he==null||he.onCaptureStarted.add(e=>U.info("Spector capture started:",e)()),he==null||he.onCapture.add(e=>{U.info("Spector capture complete:",e)(),he==null||he.getResultUI(),he==null||he.resultView.display(),he==null||he.resultView.addCapture(e)})),t!=null&&t.canvas){if(typeof t.spector=="string"&&t.spector!==t.canvas.id)return he;he==null||he.startCapture(t==null?void 0:t.canvas,500),new Promise(e=>setTimeout(e,2e3)).then(e=>{U.info("Spector capture stopped after 2 seconds")(),he==null||he.stopCapture()})}return he}const AU="https://unpkg.com/webgl-debug@2.0.1/index.js";function Ow(t){return t.luma=t.luma||{},t.luma}async function TU(){Ys()&&!globalThis.WebGLDebugUtils&&(globalThis.global=globalThis.global||globalThis,globalThis.global.module={},await Bv(AU))}function EU(t,e={}){return t?e.debug?CU(t,e):SU(t):null}function SU(t){const e=Ow(t);return e.realContext?e.realContext:t}function CU(t,e){if(!globalThis.WebGLDebugUtils)return U.warn("webgl-debug not loaded")(),t;const n=Ow(t);if(n.debugContext)return n.debugContext;globalThis.WebGLDebugUtils.init({...gi,...t});const s=globalThis.WebGLDebugUtils.makeDebugContext(t,vU.bind(null,e),wU.bind(null,e));for(const o in gi)!(o in s)&&typeof gi[o]=="number"&&(s[o]=gi[o]);class r{}Object.setPrototypeOf(s,Object.getPrototypeOf(t)),Object.setPrototypeOf(r,s);const i=Object.create(r);return n.realContext=t,n.debugContext=i,i.debug=!0,i}function hd(t,e){e=Array.from(e).map(s=>s===void 0?"undefined":s);let n=globalThis.WebGLDebugUtils.glFunctionArgsToString(t,e);return n=`${n.slice(0,100)}${n.length>100?"...":""}`,`gl.${t}(${n})`}function vU(t,e,n,s){s=Array.from(s).map(a=>a===void 0?"undefined":a);const r=globalThis.WebGLDebugUtils.glEnumToString(e),i=globalThis.WebGLDebugUtils.glFunctionArgsToString(n,s),o=`${r} in gl.${n}(${i})`;U.error(o)();debugger;if(t.throwOnError)throw new Error(o)}function wU(t,e,n){let s="";if(U.level>=1&&(s=hd(e,n),U.log(1,s)()),t.break&&t.break.length>0&&(s=s||hd(e,n),t.break.every(i=>s.indexOf(i)!==-1)))debugger;for(const r of n)if(r===void 0){if(s=s||hd(e,n),t.throwOnError)throw new Error(`Undefined argument: ${s}`);U.error(`Undefined argument: ${s}`)();debugger}}function bU(t){const e=t.split(/\r?\n/),n=[];for(const s of e){if(s.length<=1)continue;const r=s.split(":");if(r.length===2){const[h,f]=r;n.push({message:f.trim(),type:cT(h),lineNum:0,linePos:0});continue}const[i,o,a,...c]=r;let l=parseInt(a,10);isNaN(l)&&(l=0);let u=parseInt(o,10);isNaN(u)&&(u=0),n.push({message:c.join(":").trim(),type:cT(i),lineNum:l,linePos:u})}return n}function cT(t){const e=["warning","error","info"],n=t.toLowerCase();return e.includes(n)?n:"info"}class RU extends _u{constructor(n,s){super(n,s);p(this,"device");p(this,"handle");switch(this.device=n,this.props.stage){case"vertex":this.handle=this.props.handle||this.device.gl.createShader(35633);break;case"fragment":this.handle=this.props.handle||this.device.gl.createShader(35632);break;default:throw new Error(this.props.stage)}this._compile(this.source)}destroy(){this.handle&&(this.removeStats(),this.device.gl.deleteShader(this.handle),this.destroyed=!0)}async getCompilationInfo(){return await this._waitForCompilationComplete(),this.getCompilationInfoSync()}getCompilationInfoSync(){const n=this.device.gl.getShaderInfoLog(this.handle);return bU(n)}getTranslatedSource(){const s=this.device.getExtension("WEBGL_debug_shaders").WEBGL_debug_shaders;return s==null?void 0:s.getTranslatedShaderSource(this.handle)}async _compile(n){n=(i=>i.startsWith("#version ")?i:`#version 100
${i}`)(n);const{gl:r}=this.device;if(r.shaderSource(this.handle,n),r.compileShader(this.handle),U.level===0){this.compilationStatus="pending";return}if(!this.device.features.has("compilation-status-async-webgl")){if(this._getCompilationStatus(),this.debugShader(),this.compilationStatus==="error")throw new Error(`GLSL compilation errors in ${this.props.stage} shader ${this.props.id}`);return}U.once(1,"Shader compilation is asynchronous")(),await this._waitForCompilationComplete(),U.info(2,`Shader ${this.id} - async compilation complete: ${this.compilationStatus}`)(),this._getCompilationStatus(),this.debugShader()}async _waitForCompilationComplete(){const n=async i=>await new Promise(o=>setTimeout(o,i));if(!this.device.features.has("compilation-status-async-webgl")){await n(10);return}const{gl:r}=this.device;for(;;){if(r.getShaderParameter(this.handle,37297))return;await n(10)}}_getCompilationStatus(){this.compilationStatus=this.device.gl.getShaderParameter(this.handle,35713)?"success":"error"}}const IU=256,PU=1024,xU=16384,fd=6144,MU=[1,2,4,8];class BU extends Xp{constructor(n,s){super(n,s);p(this,"device");p(this,"glParameters");this.device=n,zh(this.device.gl),this.setParameters(this.props.parameters),this.clear()}end(){La(this.device.gl)}pushDebugGroup(n){}popDebugGroup(){}insertDebugMarker(n){}setParameters(n={}){const s={...this.glParameters};this.props.framebuffer&&(s.framebuffer=this.props.framebuffer),this.props.depthReadOnly&&(s.depthMask=!this.props.depthReadOnly),s.stencilMask=this.props.stencilReadOnly?0:1,s[35977]=this.props.discard,n.viewport&&(n.viewport.length>=6?(s.viewport=n.viewport.slice(0,4),s.depthRange=[n.viewport[4],n.viewport[5]]):s.viewport=n.viewport),n.scissorRect&&(s.scissorTest=!0,s.scissor=n.scissorRect),n.blendConstant&&(s.blendColor=n.blendConstant),n.stencilReference&&(console.warn("RenderPassParameters.stencilReference not yet implemented in WebGL"),n[2967]=n.stencilReference),n.colorMask&&(s.colorMask=MU.map(r=>!!(r&n.colorMask))),this.glParameters=s,co(this.device.gl,s)}beginOcclusionQuery(n){const s=this.props.occlusionQuerySet;s==null||s.beginOcclusionQuery()}endOcclusionQuery(){const n=this.props.occlusionQuerySet;n==null||n.endOcclusionQuery()}clear(){const n={...this.glParameters};let s=0;this.props.clearColor!==!1&&(s|=xU,n.clearColor=this.props.clearColor),this.props.clearDepth!==!1&&(s|=IU,n.clearDepth=this.props.clearDepth),this.props.clearStencil!==!1&&(s|=PU,n.clearStencil=this.props.clearStencil),s!==0&&Is(this.device.gl,n,()=>{this.device.gl.clear(s)})}clearColorBuffer(n=0,s=[0,0,0,0]){Is(this.device.gl,{framebuffer:this.props.framebuffer},()=>{switch(s.constructor){case Int32Array:this.device.gl.clearBufferiv(fd,n,s);break;case Uint32Array:this.device.gl.clearBufferuiv(fd,n,s);break;case Float32Array:default:this.device.gl.clearBufferfv(fd,n,s);break}})}}const OU="Failed to deduce GL constant from typed array";function NU(t){switch(ArrayBuffer.isView(t)?t.constructor:t){case Float32Array:return 5126;case Uint16Array:return 5123;case Uint32Array:return 5125;case Uint8Array:return 5121;case Uint8ClampedArray:return 5121;case Int8Array:return 5120;case Int16Array:return 5122;case Int32Array:return 5124;default:throw new Error(OU)}}function dg(t,e){const{clamped:n=!0}=e||{};switch(t){case 5126:return Float32Array;case 5123:case 33635:case 32819:case 32820:return Uint16Array;case 5125:return Uint32Array;case 5121:return n?Uint8ClampedArray:Uint8Array;case 5120:return Int8Array;case 5122:return Int16Array;case 5124:return Int32Array;default:throw new Error("Failed to deduce typed array type from GL constant")}}const FU={offset:0,stride:0,type:5126,size:1,divisor:0,normalized:!1,integer:!1},DU={deprecatedProps:{instanced:"divisor",isInstanced:"divisor"}};class la{constructor(...e){p(this,"offset");p(this,"stride");p(this,"type");p(this,"size");p(this,"divisor");p(this,"normalized");p(this,"integer");p(this,"buffer");p(this,"index");e.forEach(n=>this._assign(n)),Object.freeze(this)}static getBytesPerElement(e){return dg(e.type||5126).BYTES_PER_ELEMENT}static getBytesPerVertex(e){return oe(e.size),dg(e.type||5126).BYTES_PER_ELEMENT*e.size}static resolve(...e){return new la(FU,...e)}toString(){return JSON.stringify(this)}get BYTES_PER_ELEMENT(){return la.getBytesPerElement(this)}get BYTES_PER_VERTEX(){return la.getBytesPerVertex(this)}_assign(e={}){return e=k2("Accessor",e,DU),e.type!==void 0&&(this.type=e.type,(e.type===5124||e.type===5125)&&(this.integer=!0)),e.size!==void 0&&(this.size=e.size),e.offset!==void 0&&(this.offset=e.offset),e.stride!==void 0&&(this.stride=e.stride),e.normalize!==void 0&&(this.normalized=e.normalize),e.normalized!==void 0&&(this.normalized=e.normalized),e.integer!==void 0&&(this.integer=e.integer),e.divisor!==void 0&&(this.divisor=e.divisor),e.buffer!==void 0&&(this.buffer=e.buffer),e.index!==void 0&&(typeof e.index=="boolean"?this.index=e.index?1:0:this.index=e.index),e.instanced!==void 0&&(this.divisor=e.instanced?1:0),e.isInstanced!==void 0&&(this.divisor=e.isInstanced?1:0),this.offset===void 0&&delete this.offset,this.stride===void 0&&delete this.stride,this.type===void 0&&delete this.type,this.size===void 0&&delete this.size,this.divisor===void 0&&delete this.divisor,this.normalized===void 0&&delete this.normalized,this.integer===void 0&&delete this.integer,this.buffer===void 0&&delete this.buffer,this.index===void 0&&delete this.index,this}}function LU(t){return UU.includes(t)}const UU=[35678,35680,35679,35682,36289,36292,36293,36298,36299,36300,36303,36306,36307,36308,36311],Nw={5126:[5126,1,"float","f32","float32"],35664:[5126,2,"vec2","vec2<f32>","float32x2"],35665:[5126,3,"vec3","vec3<f32>","float32x3"],35666:[5126,4,"vec4","vec4<f32>","float32x4"],5124:[5124,1,"int","i32","sint32"],35667:[5124,2,"ivec2","vec2<i32>","sint32x2"],35668:[5124,3,"ivec3","vec3<i32>","sint32x3"],35669:[5124,4,"ivec4","vec4<i32>","sint32x4"],5125:[5125,1,"uint","u32","uint32"],36294:[5125,2,"uvec2","vec2<u32>","uint32x2"],36295:[5125,3,"uvec3","vec3<u32>","uint32x3"],36296:[5125,4,"uvec4","vec4<u32>","uint32x4"],35670:[5126,1,"bool","f32","float32"],35671:[5126,2,"bvec2","vec2<f32>","float32x2"],35672:[5126,3,"bvec3","vec3<f32>","float32x3"],35673:[5126,4,"bvec4","vec4<f32>","float32x4"],35674:[5126,8,"mat2","mat2x2<f32>"],35685:[5126,8,"mat2x3","mat2x3<f32>"],35686:[5126,8,"mat2x4","mat2x4<f32>"],35687:[5126,12,"mat3x2","mat3x2<f32>"],35675:[5126,12,"mat3","mat3x3<f32>"],35688:[5126,12,"mat3x4","mat3x4<f32>"],35689:[5126,16,"mat4x2","mat4x2<f32>"],35690:[5126,16,"mat4x3","mat4x3<f32>"],35676:[5126,16,"mat4","mat4x4<f32>"]};function Fw(t){const e=Nw[t];if(!e)throw new Error("uniform");const[n,s,,r]=e;return{format:r,components:s,glType:n}}function kU(t){const e=Nw[t];if(!e)throw new Error("attribute");const[,n,,s,r]=e;return{attributeType:s,vertexFormat:r,components:n}}function zU(t,e){const n={attributes:[],bindings:[]};n.attributes=VU(t,e);const s=WU(t,e);for(const a of s){const c=a.uniforms.map(l=>({name:l.name,format:l.format,byteOffset:l.byteOffset,byteStride:l.byteStride,arrayLength:l.arrayLength}));n.bindings.push({type:"uniform",name:a.name,location:a.location,visibility:(a.vertex?1:0)&(a.fragment?2:0),minBindingSize:a.byteLength,uniforms:c})}const r=jU(t,e);let i=0;for(const a of r)if(LU(a.type)){const{viewDimension:c,sampleType:l}=XU(a.type);n.bindings.push({type:"texture",name:a.name,location:i,viewDimension:c,sampleType:l}),a.textureUnit=i,i+=1}r.length&&(n.uniforms=r);const o=HU(t,e);return o!=null&&o.length&&(n.varyings=o),n}function VU(t,e){const n=[],s=t.getProgramParameter(e,35721);for(let r=0;r<s;r++){const i=t.getActiveAttrib(e,r);if(!i)throw new Error("activeInfo");const{name:o,type:a}=i,c=t.getAttribLocation(e,o);if(c>=0){const{attributeType:l}=kU(a),u=/instance/i.test(o)?"instance":"vertex";n.push({name:o,location:c,stepMode:u,type:l})}}return n.sort((r,i)=>r.location-i.location),n}function HU(t,e){const n=[],s=t.getProgramParameter(e,35971);for(let r=0;r<s;r++){const i=t.getTransformFeedbackVarying(e,r);if(!i)throw new Error("activeInfo");const{name:o,type:a,size:c}=i,{glType:l,components:u}=Fw(a),h=new la({type:l,size:c*u}),f={location:r,name:o,accessor:h};n.push(f)}return n.sort((r,i)=>r.location-i.location),n}function jU(t,e){const n=[],s=t.getProgramParameter(e,35718);for(let r=0;r<s;r++){const i=t.getActiveUniform(e,r);if(!i)throw new Error("activeInfo");const{name:o,size:a,type:c}=i,{name:l,isArray:u}=$U(o);let h=t.getUniformLocation(e,l);const f={location:h,name:l,size:a,type:c,isArray:u};if(n.push(f),f.size>1)for(let d=0;d<f.size;d++){const g=`${l}[${d}]`;h=t.getUniformLocation(e,g);const _={...f,name:g,location:h};n.push(_)}}return n}function WU(t,e){const n=(i,o)=>t.getActiveUniformBlockParameter(e,i,o),s=[],r=t.getProgramParameter(e,35382);for(let i=0;i<r;i++){const o={name:t.getActiveUniformBlockName(e,i)||"",location:n(i,35391),byteLength:n(i,35392),vertex:n(i,35396),fragment:n(i,35398),uniformCount:n(i,35394),uniforms:[]},a=n(i,35395)||[],c=t.getActiveUniforms(e,a,35383),l=t.getActiveUniforms(e,a,35384),u=t.getActiveUniforms(e,a,35387),h=t.getActiveUniforms(e,a,35388);for(let f=0;f<o.uniformCount;++f){const d=t.getActiveUniform(e,a[f]);if(!d)throw new Error("activeInfo");o.uniforms.push({name:d.name,format:Fw(c[f]).format,type:c[f],arrayLength:l[f],byteOffset:u[f],byteStride:h[f]})}s.push(o)}return s.sort((i,o)=>i.location-o.location),s}const GU={35678:["2d","float"],35680:["cube","float"],35679:["3d","float"],35682:["3d","depth"],36289:["2d-array","float"],36292:["2d-array","depth"],36293:["cube","float"],36298:["2d","sint"],36299:["3d","sint"],36300:["cube","sint"],36303:["2d-array","uint"],36306:["2d","uint"],36307:["3d","uint"],36308:["cube","uint"],36311:["2d-array","uint"]};function XU(t){const e=GU[t];if(!e)throw new Error("sampler");const[n,s]=e;return{viewDimension:n,sampleType:s}}function $U(t){if(t[t.length-1]!=="]")return{name:t,length:1,isArray:!1};const n=/([^[]*)(\[[0-9]+\])?/.exec(t);if(!n||n.length<2)throw new Error(`Failed to parse GLSL uniform name ${t}`);return{name:n[1],length:n[2]?1:0,isArray:!!n[2]}}function KU(t,e,n,s){const r=t;let i=s;i===!0&&(i=1),i===!1&&(i=0);const o=typeof i=="number"?[i]:i;switch(n){case 35678:case 35680:case 35679:case 35682:case 36289:case 36292:case 36293:case 36298:case 36299:case 36300:case 36303:case 36306:case 36307:case 36308:case 36311:if(typeof s!="number")throw new Error("samplers must be set to integers");return t.uniform1i(e,s);case 5126:return t.uniform1fv(e,o);case 35664:return t.uniform2fv(e,o);case 35665:return t.uniform3fv(e,o);case 35666:return t.uniform4fv(e,o);case 5124:return t.uniform1iv(e,o);case 35667:return t.uniform2iv(e,o);case 35668:return t.uniform3iv(e,o);case 35669:return t.uniform4iv(e,o);case 35670:return t.uniform1iv(e,o);case 35671:return t.uniform2iv(e,o);case 35672:return t.uniform3iv(e,o);case 35673:return t.uniform4iv(e,o);case 5125:return r.uniform1uiv(e,o,1);case 36294:return r.uniform2uiv(e,o,2);case 36295:return r.uniform3uiv(e,o,3);case 36296:return r.uniform4uiv(e,o,4);case 35674:return t.uniformMatrix2fv(e,!1,o);case 35675:return t.uniformMatrix3fv(e,!1,o);case 35676:return t.uniformMatrix4fv(e,!1,o);case 35685:return r.uniformMatrix2x3fv(e,!1,o);case 35686:return r.uniformMatrix2x4fv(e,!1,o);case 35687:return r.uniformMatrix3x2fv(e,!1,o);case 35688:return r.uniformMatrix3x4fv(e,!1,o);case 35689:return r.uniformMatrix4x2fv(e,!1,o);case 35690:return r.uniformMatrix4x3fv(e,!1,o)}throw new Error("Illegal uniform")}function YU(t){switch(t){case"point-list":return 0;case"line-list":return 1;case"line-strip":return 3;case"line-loop-webgl":return 2;case"triangle-list":return 4;case"triangle-strip":return 5;case"triangle-fan-webgl":return 6;default:throw new Error(t)}}function JU(t){switch(t){case"point-list":return 0;case"line-list":return 1;case"line-strip":return 1;case"line-loop-webgl":return 1;case"triangle-list":return 4;case"triangle-strip":return 4;case"triangle-fan-webgl":return 4;default:throw new Error(t)}}const lT=4;class qU extends Wi{constructor(n,s){super(n,s);p(this,"device");p(this,"handle");p(this,"vs");p(this,"fs");p(this,"introspectedLayout");p(this,"uniforms",{});p(this,"bindings",{});p(this,"varyings",null);p(this,"_uniformCount",0);p(this,"_uniformSetters",{});this.device=n,this.handle=this.props.handle||this.device.gl.createProgram(),this.device.setSpectorMetadata(this.handle,{id:this.props.id}),this.vs=s.vs,this.fs=s.fs;const{varyings:r,bufferMode:i=35981}=s;switch(r&&r.length>0&&(this.varyings=r,this.device.gl.transformFeedbackVaryings(this.handle,r,i)),this._linkShaders(),U.time(1,`RenderPipeline ${this.id} - shaderLayout introspection`)(),this.introspectedLayout=zU(this.device.gl,this.handle),U.timeEnd(1,`RenderPipeline ${this.id} - shaderLayout introspection`)(),this.shaderLayout=b2(this.introspectedLayout,s.shaderLayout),this.props.topology){case"triangle-fan-webgl":case"line-loop-webgl":U.warn(`Primitive topology ${this.props.topology} is deprecated and will be removed in v9.1`);break}}destroy(){this.handle&&(this.device.gl.deleteProgram(this.handle),this.destroyed=!0)}setBindings(n,s){for(const[r,i]of Object.entries(n)){const o=this.shaderLayout.bindings.find(a=>a.name===r)||this.shaderLayout.bindings.find(a=>a.name===`${r}Uniforms`);if(!o){const a=this.shaderLayout.bindings.map(c=>`"${c.name}"`).join(", ");s!=null&&s.disableWarnings||U.warn(`Unknown binding "${r}" in render pipeline "${this.id}", expected one of ${a}`)();continue}switch(i||U.warn(`Unsetting binding "${r}" in render pipeline "${this.id}"`)(),o.type){case"uniform":if(!(i instanceof ks)&&!(i.buffer instanceof ks))throw new Error("buffer value");break;case"texture":if(!(i instanceof yi||i instanceof Nn||i instanceof ca))throw new Error("texture value");break;case"sampler":U.warn(`Ignoring sampler ${r}`)();break;default:throw new Error(o.type)}this.bindings[r]=i}}draw(n){var E;const{renderPass:s,parameters:r=this.props.parameters,topology:i=this.props.topology,vertexArray:o,vertexCount:a,instanceCount:c,firstVertex:l=0,transformFeedback:u}=n,h=YU(i),f=!!o.indexBuffer,d=(E=o.indexBuffer)==null?void 0:E.glIndexType,g=Number(c)>0;if(this.linkStatus!=="success")return U.info(2,`RenderPipeline:${this.id}.draw() aborted - waiting for shader linking`)(),!1;if(!this._areTexturesRenderable()||a===0)return U.info(2,`RenderPipeline:${this.id}.draw() aborted - textures not yet loaded`)(),!1;if(a===0)return U.info(2,`RenderPipeline:${this.id}.draw() aborted - no vertices to draw`)(),!0;this.device.gl.useProgram(this.handle),o.bindBeforeRender(s),u&&u.begin(this.props.topology),this._applyBindings(),this._applyUniforms();const _=s;return tU(this.device,r,_.glParameters,()=>{f&&g?this.device.gl.drawElementsInstanced(h,a||0,d,l,c||0):f?this.device.gl.drawElements(h,a||0,d,l):g?this.device.gl.drawArraysInstanced(h,l,a||0,c||0):this.device.gl.drawArrays(h,l,a||0),u&&u.end()}),o.unbindAfterRender(s),!0}setUniformsWebGL(n){const{bindings:s}=Mv(n);Object.keys(s).forEach(r=>{U.warn(`Unsupported value "${JSON.stringify(s[r])}" used in setUniforms() for key ${r}. Use setBindings() instead?`)()}),Object.assign(this.uniforms,n)}async _linkShaders(){const{gl:n}=this.device;if(n.attachShader(this.handle,this.vs.handle),n.attachShader(this.handle,this.fs.handle),U.time(lT,`linkProgram for ${this.id}`)(),n.linkProgram(this.handle),U.timeEnd(lT,`linkProgram for ${this.id}`)(),U.level,!this.device.features.has("compilation-status-async-webgl")){const r=this._getLinkStatus();this._reportLinkStatus(r);return}U.once(1,"RenderPipeline linking is asynchronous")(),await this._waitForLinkComplete(),U.info(2,`RenderPipeline ${this.id} - async linking complete: ${this.linkStatus}`)();const s=this._getLinkStatus();this._reportLinkStatus(s)}_reportLinkStatus(n){var s;switch(n){case"success":return;default:throw this.vs.compilationStatus==="error"?(this.vs.debugShader(),new Error(`Error during compilation of shader ${this.vs.id}`)):((s=this.fs)==null?void 0:s.compilationStatus)==="error"?(this.vs.debugShader(),new Error(`Error during compilation of shader ${this.fs.id}`)):new Error(`Error during ${n}: ${this.device.gl.getProgramInfoLog(this.handle)}`)}}_getLinkStatus(){const{gl:n}=this.device;return n.getProgramParameter(this.handle,35714)?(n.validateProgram(this.handle),n.getProgramParameter(this.handle,35715)?(this.linkStatus="success","success"):(this.linkStatus="error","validation")):(this.linkStatus="error","linking")}async _waitForLinkComplete(){const n=async i=>await new Promise(o=>setTimeout(o,i));if(!this.device.features.has("compilation-status-async-webgl")){await n(10);return}const{gl:r}=this.device;for(;;){if(r.getProgramParameter(this.handle,37297))return;await n(10)}}_areTexturesRenderable(){let n=!0;for(const[,s]of Object.entries(this.bindings))s instanceof Nn&&(s.update(),n=n&&s.loaded);return n}_applyBindings(){if(this.linkStatus!=="success")return;const{gl:n}=this.device;n.useProgram(this.handle);let s=0,r=0;for(const i of this.shaderLayout.bindings){const o=this.bindings[i.name]||this.bindings[i.name.replace(/Uniforms$/,"")];if(!o)throw new Error(`No value for binding ${i.name} in ${this.id}`);switch(i.type){case"uniform":const{name:a}=i,c=n.getUniformBlockIndex(this.handle,a);if(c===4294967295)throw new Error(`Invalid uniform block name ${a}`);n.uniformBlockBinding(this.handle,r,c),o instanceof ks?n.bindBufferBase(35345,r,o.handle):n.bindBufferRange(35345,r,o.buffer.handle,o.offset||0,o.size||o.buffer.byteLength-o.offset),r+=1;break;case"texture":if(!(o instanceof yi||o instanceof Nn||o instanceof ca))throw new Error("texture");let l;if(o instanceof yi)l=o.texture;else if(o instanceof Nn)l=o;else if(o instanceof ca&&o.colorAttachments[0]instanceof yi)U.warn("Passing framebuffer in texture binding may be deprecated. Use fbo.colorAttachments[0] instead")(),l=o.colorAttachments[0].texture;else throw new Error("No texture");n.activeTexture(33984+s),n.bindTexture(l.target,l.handle),s+=1;break;case"sampler":break;case"storage":case"read-only-storage":throw new Error(`binding type '${i.type}' not supported in WebGL`)}}}_applyUniforms(){for(const n of this.shaderLayout.uniforms||[]){const{name:s,location:r,type:i,textureUnit:o}=n,a=this.uniforms[s]??o;a!==void 0&&KU(this.device.gl,r,i,a)}}}class ZU extends Kp{constructor(n){super(n,{});p(this,"device");p(this,"commands",[]);this.device=n}submitCommands(n=this.commands){for(const s of n)switch(s.name){case"copy-buffer-to-buffer":QU(this.device,s.options);break;case"copy-buffer-to-texture":ek(this.device,s.options);break;case"copy-texture-to-buffer":tk(this.device,s.options);break;case"copy-texture-to-texture":nk(this.device,s.options);break}}}function QU(t,e){const n=e.source,s=e.destination;t.gl.bindBuffer(36662,n.handle),t.gl.bindBuffer(36663,s.handle),t.gl.copyBufferSubData(36662,36663,e.sourceOffset??0,e.destinationOffset??0,e.size),t.gl.bindBuffer(36662,null),t.gl.bindBuffer(36663,null)}function ek(t,e){throw new Error("Not implemented")}function tk(t,e){const{source:n,mipLevel:s=0,aspect:r="all",width:i=e.source.width,height:o=e.source.height,depthOrArrayLayers:a=0,origin:c=[0,0],destination:l,byteOffset:u=0,bytesPerRow:h,rowsPerImage:f}=e;if(r!=="all")throw new Error("not supported");if(s!==0||a!==0||h||f)throw new Error("not implemented");const{framebuffer:d,destroyFramebuffer:g}=Dw(n);let _;try{const E=l,m=i||d.width,y=o||d.height,A=bu(d.texture.props.format),C=A.dataFormat,b=A.type;t.gl.bindBuffer(35051,E.handle),_=t.gl.bindFramebuffer(36160,d.handle),t.gl.readPixels(c[0],c[1],m,y,C,b,u)}finally{t.gl.bindBuffer(35051,null),_!==void 0&&t.gl.bindFramebuffer(36160,_),g&&d.destroy()}}function nk(t,e){const{source:n,destinationMipLevel:s=0,origin:r=[0,0],destinationOrigin:i=[0,0],destination:o}=e;let{width:a=e.destination.width,height:c=e.destination.height}=e;const{framebuffer:l,destroyFramebuffer:u}=Dw(n),[h,f]=r,[d,g,_]=i,E=t.gl.bindFramebuffer(36160,l.handle);let m=null,y;if(o instanceof Nn)m=o,a=Number.isFinite(a)?a:m.width,c=Number.isFinite(c)?c:m.height,m.bind(0),y=m.target;else throw new Error("invalid destination");switch(y){case 3553:case 34067:t.gl.copyTexSubImage2D(y,s,d,g,h,f,a,c);break;case 35866:case 32879:t.gl.copyTexSubImage3D(y,s,d,g,_,h,f,a,c);break}m&&m.unbind(),t.gl.bindFramebuffer(36160,E),u&&l.destroy()}function Dw(t){if(t instanceof Rt){const{width:e,height:n,id:s}=t;return{framebuffer:t.device.createFramebuffer({id:`framebuffer-for-${s}`,width:e,height:n,colorAttachments:[t]}),destroyFramebuffer:!0}}return{framebuffer:t,destroyFramebuffer:!1}}class sk extends $p{constructor(n,s){super(n,s);p(this,"device");p(this,"commandBuffer");this.device=n,this.commandBuffer=new ZU(n)}destroy(){}finish(){this.commandBuffer.submitCommands()}copyBufferToBuffer(n){this.commandBuffer.commands.push({name:"copy-buffer-to-buffer",options:n})}copyBufferToTexture(n){this.commandBuffer.commands.push({name:"copy-buffer-to-texture",options:n})}copyTextureToBuffer(n){this.commandBuffer.commands.push({name:"copy-texture-to-buffer",options:n})}copyTextureToTexture(n){this.commandBuffer.commands.push({name:"copy-texture-to-texture",options:n})}pushDebugGroup(n){}popDebugGroup(){}insertDebugMarker(n){}resolveQuerySet(n,s,r){}}class Bm extends Yp{constructor(n,s){super(n,s);p(this,"device");p(this,"handle");p(this,"buffer",null);p(this,"bufferValue",null);this.device=n,this.handle=this.device.gl.createVertexArray()}get[Symbol.toStringTag](){return"VertexArray"}static isConstantAttributeZeroSupported(n){return v3()==="Chrome"}destroy(){var n;super.destroy(),this.buffer&&((n=this.buffer)==null||n.destroy()),this.handle&&(this.device.gl.deleteVertexArray(this.handle),this.handle=void 0)}setIndexBuffer(n){const s=n;if(s&&s.glTarget!==34963)throw new Error("Use .setBuffer()");this.device.gl.bindVertexArray(this.handle),this.device.gl.bindBuffer(34963,s?s.handle:null),this.indexBuffer=s,this.device.gl.bindVertexArray(null)}setBuffer(n,s){const r=s;if(r.glTarget===34963)throw new Error("Use .setIndexBuffer()");const{size:i,type:o,stride:a,offset:c,normalized:l,integer:u,divisor:h}=this._getAccessor(n);this.device.gl.bindVertexArray(this.handle),this.device.gl.bindBuffer(34962,r.handle),u?this.device.gl.vertexAttribIPointer(n,i,o,a,c):this.device.gl.vertexAttribPointer(n,i,o,l,a,c),this.device.gl.enableVertexAttribArray(n),this.device.gl.vertexAttribDivisor(n,h||0),this.attributes[n]=r,this.device.gl.bindVertexArray(null)}setConstantWebGL(n,s){this._enable(n,!1),this.attributes[n]=s}bindBeforeRender(){this.device.gl.bindVertexArray(this.handle),this._applyConstantAttributes()}unbindAfterRender(){this.device.gl.bindVertexArray(null)}_applyConstantAttributes(){for(let n=0;n<this.maxVertexAttributes;++n){const s=this.attributes[n];ArrayBuffer.isView(s)&&this.device.setConstantAttributeWebGL(n,s)}}_getAccessor(n){const s=this.attributeInfos[n];if(!s)throw new Error(`Unknown attribute location ${n}`);const r=Pw(s.bufferDataType);return{size:s.bufferComponents,type:r,stride:s.byteStride,offset:s.byteOffset,normalized:s.normalized,integer:s.integer,divisor:s.stepMode==="instance"?1:0}}_enable(n,s=!0){const i=Bm.isConstantAttributeZeroSupported(this.device)||n!==0;(s||i)&&(n=Number(n),this.device.gl.bindVertexArray(this.handle),s?this.device.gl.enableVertexAttribArray(n):this.device.gl.disableVertexAttribArray(n),this.device.gl.bindVertexArray(null))}getConstantBuffer(n,s){const r=rk(s),i=r.byteLength*n,o=r.length*n;if(this.buffer&&i!==this.buffer.byteLength)throw new Error(`Buffer size is immutable, byte length ${i} !== ${this.buffer.byteLength}.`);let a=!this.buffer;if(this.buffer=this.buffer||this.device.createBuffer({byteLength:i}),a=a||!ik(r,this.bufferValue),a){const c=x2(s.constructor,o);M2({target:c,source:r,start:0,count:o}),this.buffer.write(c),this.bufferValue=s}return this.buffer}}function rk(t){return Array.isArray(t)?new Float32Array(t):t}function ik(t,e){if(!t||!e||t.length!==e.length||t.constructor!==e.constructor)return!1;for(let n=0;n<t.length;++n)if(t[n]!==e[n])return!1;return!0}class ok extends Jp{constructor(n,s){super(n,s);p(this,"device");p(this,"gl");p(this,"handle");p(this,"layout");p(this,"buffers",{});p(this,"unusedBuffers",{});p(this,"bindOnUse",!0);p(this,"_bound",!1);this.device=n,this.gl=n.gl,this.handle=this.props.handle||this.gl.createTransformFeedback(),this.layout=this.props.layout,s.buffers&&this.setBuffers(s.buffers),Object.seal(this)}destroy(){this.gl.deleteTransformFeedback(this.handle),super.destroy()}begin(n="point-list"){this.gl.bindTransformFeedback(36386,this.handle),this.bindOnUse&&this._bindBuffers(),this.gl.beginTransformFeedback(JU(n))}end(){this.gl.endTransformFeedback(),this.bindOnUse||this._unbindBuffers(),this.gl.bindTransformFeedback(36386,null)}setBuffers(n){this.buffers={},this.unusedBuffers={},this.bind(()=>{for(const s in n)this.setBuffer(s,n[s])})}setBuffer(n,s){const r=this._getVaryingIndex(n),{buffer:i,byteLength:o,byteOffset:a}=this._getBufferRange(s);if(r<0){this.unusedBuffers[n]=i,U.warn(`${this.id} unusedBuffers varying buffer ${n}`)();return}this.buffers[r]={buffer:i,byteLength:o,byteOffset:a},this.bindOnUse||this._bindBuffer(r,i,a,o)}getBuffer(n){if(uT(n))return this.buffers[n]||null;const s=this._getVaryingIndex(n);return s>=0?this.buffers[s]:null}bind(n=this.handle){if(typeof n!="function")return this.gl.bindTransformFeedback(36386,n),this;let s;return this._bound?s=n():(this.gl.bindTransformFeedback(36386,this.handle),this._bound=!0,s=n(),this._bound=!1,this.gl.bindTransformFeedback(36386,null)),s}unbind(){this.bind(null)}_getBufferRange(n){if(n instanceof ks)return{buffer:n,byteOffset:0,byteLength:n.byteLength};const{buffer:s,byteOffset:r=0,byteLength:i=n.buffer.byteLength}=n;return{buffer:s,byteOffset:r,byteLength:i}}_getVaryingIndex(n){if(uT(n))return Number(n);for(const s of this.layout.varyings)if(n===s.name)return s.location;return-1}_bindBuffers(){for(const n in this.buffers){const{buffer:s,byteLength:r,byteOffset:i}=this._getBufferRange(this.buffers[n]);this._bindBuffer(Number(n),s,i,r)}}_unbindBuffers(){for(const n in this.buffers)this.gl.bindBufferBase(35982,Number(n),null)}_bindBuffer(n,s,r=0,i){const o=s&&s.handle;!o||i===void 0?this.gl.bindBufferBase(35982,n,o):this.gl.bindBufferRange(35982,n,o,r,i)}}function uT(t){return typeof t=="number"?Number.isInteger(t):/^\d+$/.test(t)}class ak extends qp{constructor(n,s){super(n,s);p(this,"device");p(this,"handle");p(this,"target",null);p(this,"_queryPending",!1);p(this,"_pollingPromise",null);if(this.device=n,s.count>1)throw new Error("WebGL QuerySet can only have one value");this.handle=this.device.gl.createQuery(),Object.seal(this)}get[Symbol.toStringTag](){return"Query"}destroy(){this.device.gl.deleteQuery(this.handle)}beginTimestampQuery(){return this._begin(35007)}endTimestampQuery(){this._end()}beginOcclusionQuery(n){return this._begin(n!=null&&n.conservative?36202:35887)}endOcclusionQuery(){this._end()}beginTransformFeedbackQuery(){return this._begin(35976)}endTransformFeedbackQuery(){this._end()}async resolveQuery(){return[await this.pollQuery()]}_begin(n){this._queryPending||(this.target=n,this.device.gl.beginQuery(this.target,this.handle))}_end(){this._queryPending||this.target&&(this.device.gl.endQuery(this.target),this.target=null,this._queryPending=!0)}isResultAvailable(){if(!this._queryPending)return!1;const n=this.device.gl.getQueryParameter(this.handle,34919);return n&&(this._queryPending=!1),n}isTimerDisjoint(){return this.device.gl.getParameter(36795)}getResult(){return this.device.gl.getQueryParameter(this.handle,34918)}getTimerMilliseconds(){return this.getResult()/1e6}pollQuery(n=Number.POSITIVE_INFINITY){if(this._pollingPromise)return this._pollingPromise;let s=0;return this._pollingPromise=new Promise((r,i)=>{const o=()=>{this.isResultAvailable()?(r(this.getResult()),this._pollingPromise=null):s++>n?(i("Timed out"),this._pollingPromise=null):requestAnimationFrame(o)};requestAnimationFrame(o)}),this._pollingPromise}}function Lw(t){switch(t){case 6406:case 33326:case 6403:return 1;case 33328:case 33319:return 2;case 6407:case 34837:return 3;case 6408:case 34836:return 4;default:return oe(!1),0}}function ck(t){switch(t){case 5121:return 1;case 33635:case 32819:case 32820:return 2;case 5126:return 4;default:return oe(!1),0}}function lk(t,e){var E,m;const{sourceX:n=0,sourceY:s=0,sourceFormat:r=6408,sourceAttachment:i=36064}=e||{};let{target:o=null,sourceWidth:a,sourceHeight:c,sourceType:l}=e||{};const{framebuffer:u,deleteFramebuffer:h}=Uw(t);oe(u);const{gl:f,handle:d}=u;a=a||u.width,c=c||u.height;const g=i-36064;l=l||((m=(E=u.colorAttachments[g])==null?void 0:E.texture)==null?void 0:m.type)||5121,o=fk(o,l,r,a,c),l=l||NU(o);const _=f.bindFramebuffer(36160,d);return f.readPixels(n,s,a,c,r,l,o),f.bindFramebuffer(36160,_||null),h&&u.destroy(),o}function uk(t,e){const{target:n,sourceX:s=0,sourceY:r=0,sourceFormat:i=6408,targetByteOffset:o=0}=e||{};let{sourceWidth:a,sourceHeight:c,sourceType:l}=e||{};const{framebuffer:u,deleteFramebuffer:h}=Uw(t);oe(u),a=a||u.width,c=c||u.height;const f=u;l=l||5121;let d=n;if(!d){const _=Lw(i),E=ck(l),m=o+a*c*_*E;d=f.device.createBuffer({byteLength:m})}const g=t.device.createCommandEncoder();return g.copyTextureToBuffer({source:t,width:a,height:c,origin:[s,r],destination:d,byteOffset:o}),g.destroy(),h&&u.destroy(),d}function Uw(t){return t instanceof yu?{framebuffer:t,deleteFramebuffer:!1}:{framebuffer:hk(t),deleteFramebuffer:!0}}function hk(t,e){const{device:n,width:s,height:r,id:i}=t;return n.createFramebuffer({...e,id:`framebuffer-for-${i}`,width:s,height:r,colorAttachments:[t]})}function fk(t,e,n,s,r){if(t)return t;e=e||5121;const i=dg(e,{clamped:!1}),o=Lw(n);return new i(s*r*o)}const dk=256,pk=1024,gk=16384,_k="clear: bad arguments";function mk(t,e){const{framebuffer:n=null,color:s=null,depth:r=null,stencil:i=null}=e||{},o={};n&&(o.framebuffer=n);let a=0;s&&(a|=gk,s!==!0&&(o.clearColor=s)),r&&(a|=dk,r!==!0&&(o.clearDepth=r)),i&&(a|=pk,r!==!0&&(o.clearStencil=r)),oe(a!==0,_k);const c=t.gl;Is(c,o,()=>{c.clear(a)})}const xo=1,hr=class hr extends Sr{constructor(n){var c,l;super({...n,id:n.id||Js("webgl-device")});p(this,"type","webgl");p(this,"handle");p(this,"features");p(this,"limits");p(this,"info");p(this,"canvasContext");p(this,"lost");p(this,"_resolveContextLost");p(this,"renderPass",null);p(this,"gl");p(this,"debug",!1);p(this,"_canvasSizeInfo",{clientWidth:0,clientHeight:0,devicePixelRatio:1});p(this,"_extensions",{});p(this,"_polyfilled",!1);p(this,"spectorJS");p(this,"_constants");const s=(c=n.gl)==null?void 0:c.device;if(s)throw new Error(`WebGL context already attached to device ${s.id}`);const r=((l=n.gl)==null?void 0:l.canvas)||n.canvas;this.canvasContext=new dU(this,{...n,canvas:r}),this.lost=new Promise(u=>{this._resolveContextLost=u});let i=n.gl||null;if(i||(i=ML(this.canvasContext.canvas,{...n,onContextLost:u=>{var h;return(h=this._resolveContextLost)==null?void 0:h.call(this,{reason:"destroyed",message:"Entered sleep mode, or too many apps or browser tabs are using the GPU."})}})),!i)throw new Error("WebGL context creation failed");this.handle=i,this.gl=i,this.gl.device=this,this.gl._version=2,this.info=BL(this.gl,this._extensions),this.limits=new QL(this.gl),this.features=new ZL(this.gl,this._extensions,this.props.disabledFeatures),this.props.initalizeFeatures&&this.features.initializeFeatures(),this.canvasContext.resize();const{enable:o=!0,copyState:a=!1}=n;Rw(this.gl,{enable:o,copyState:a,log:(...u)=>U.log(1,...u)()}),n.debug&&(this.gl=EU(this.gl,{...n,throwOnError:!0}),this.debug=!0,U.level=Math.max(U.level,1),U.warn("WebGL debug mode activated. Performance reduced.")()),n.spector&&(this.spectorJS=yU({...this.props,canvas:this.handle.canvas}))}static isSupported(){return typeof WebGL2RenderingContext<"u"}static attach(n){if(n instanceof hr)return n;if((n==null?void 0:n.device)instanceof Sr)return n.device;if(!yk(n))throw new Error("Invalid WebGL2RenderingContext");return new hr({gl:n})}static async create(n={}){var a;U.groupCollapsed(xo,"WebGLDevice created")();const s=[];n.debug&&s.push(TU()),n.spector&&s.push(mU()),typeof n.canvas=="string"&&s.push(dm.pageLoaded);const r=await Promise.allSettled(s);for(const c of r)c.status==="rejected"&&U.error(`Failed to initialize debug libraries ${c.reason}`)();if(U.probe(xo+1,"DOM is loaded")(),(a=n.gl)!=null&&a.device)return U.warn("reattaching existing device")(),hr.attach(n.gl);const i=new hr(n),o=`Created ${i.type}${i.debug?" debug":""} context: ${i.info.vendor}, ${i.info.renderer} for canvas: ${i.canvasContext.id}`;return U.probe(xo,o)(),U.table(xo,i.info)(),U.groupEnd(xo)(),i}destroy(){}get isLost(){return this.gl.isContextLost()}getSize(){return[this.gl.drawingBufferWidth,this.gl.drawingBufferHeight]}isTextureFormatSupported(n){return Mm(this.gl,n,this._extensions)}isTextureFormatFilterable(n){return KL(this.gl,n,this._extensions)}isTextureFormatRenderable(n){return YL(this.gl,n,this._extensions)}createCanvasContext(n){throw new Error("WebGL only supports a single canvas")}createBuffer(n){const s=this._getBufferProps(n);return new ks(this,s)}_createTexture(n){return new Nn(this,n)}createExternalTexture(n){throw new Error("createExternalTexture() not implemented")}createSampler(n){return new fg(this,n)}createShader(n){return new RU(this,n)}createFramebuffer(n){return new ca(this,n)}createVertexArray(n){return new Bm(this,n)}createTransformFeedback(n){return new ok(this,n)}createQuerySet(n){return new ak(this,n)}createRenderPipeline(n){return new qU(this,n)}beginRenderPass(n){return new BU(this,n)}createComputePipeline(n){throw new Error("ComputePipeline not supported in WebGL")}beginComputePass(n){throw new Error("ComputePass not supported in WebGL")}createCommandEncoder(n){return new sk(this,n)}submit(){var n;(n=this.renderPass)==null||n.end(),this.renderPass=null}readPixelsToArrayWebGL(n,s){return lk(n,s)}readPixelsToBufferWebGL(n,s){return uk(n,s)}setParametersWebGL(n){co(this.gl,n)}getParametersWebGL(n){return bw(this.gl,n)}withParametersWebGL(n,s){return Is(this.gl,n,s)}clearWebGL(n){mk(this,n)}resetWebGL(){U.warn("WebGLDevice.resetWebGL is deprecated, use only for debugging")(),vL(this.gl)}loseDevice(){var i;let n=!1;const r=this.getExtension("WEBGL_lose_context").WEBGL_lose_context;return r&&(n=!0,r.loseContext()),(i=this._resolveContextLost)==null||i.call(this,{reason:"destroyed",message:"Application triggered context loss"}),n}pushState(){zh(this.gl)}popState(){La(this.gl)}setSpectorMetadata(n,s){n.__SPECTOR_Metadata=s}getGLKey(n,s){s=s||this.gl2||this.gl;const r=Number(n);for(const i in s)if(s[i]===r)return`GL.${i}`;return String(n)}setConstantAttributeWebGL(n,s){const r=this.limits.maxVertexAttributes;this._constants=this._constants||new Array(r).fill(null);const i=this._constants[n];switch(i&&Sk(i,s)&&U.info(1,`setConstantAttributeWebGL(${n}) could have been skipped, value unchanged`)(),this._constants[n]=s,s.constructor){case Float32Array:Ak(this,n,s);break;case Int32Array:Tk(this,n,s);break;case Uint32Array:Ek(this,n,s);break;default:oe(!1)}}getExtension(n){return Ws(this.gl,n,this._extensions),this._extensions}};p(hr,"type","webgl");let ua=hr;function yk(t){return typeof WebGL2RenderingContext<"u"&&t instanceof WebGL2RenderingContext?!0:!!(t&&Number.isFinite(t._version))}function Ak(t,e,n){switch(n.length){case 1:t.gl.vertexAttrib1fv(e,n);break;case 2:t.gl.vertexAttrib2fv(e,n);break;case 3:t.gl.vertexAttrib3fv(e,n);break;case 4:t.gl.vertexAttrib4fv(e,n);break;default:oe(!1)}}function Tk(t,e,n){t.gl.vertexAttribI4iv(e,n)}function Ek(t,e,n){t.gl.vertexAttribI4uiv(e,n)}function Sk(t,e){if(!t||!e||t.length!==e.length||t.constructor!==e.constructor)return!1;for(let n=0;n<t.length;++n)if(t[n]!==e[n])return!1;return!0}var kw={exports:{}};/*! Hammer.JS - v2.0.7 - 2016-04-22
 * http://hammerjs.github.io/
 *
 * Copyright (c) 2016 Jorik Tangelder;
 * Licensed under the MIT license */(function(t){(function(e,n,s,r){var i=["","webkit","Moz","MS","ms","o"],o=n.createElement("div"),a="function",c=Math.round,l=Math.abs,u=Date.now;function h(T,S,w){return setTimeout(A(T,w),S)}function f(T,S,w){return Array.isArray(T)?(d(T,w[S],w),!0):!1}function d(T,S,w){var M;if(T)if(T.forEach)T.forEach(S,w);else if(T.length!==r)for(M=0;M<T.length;)S.call(w,T[M],M,T),M++;else for(M in T)T.hasOwnProperty(M)&&S.call(w,T[M],M,T)}function g(T,S,w){var M="DEPRECATED METHOD: "+S+`
`+w+` AT 
`;return function(){var L=new Error("get-stack-trace"),j=L&&L.stack?L.stack.replace(/^[^\(]+?[\n$]/gm,"").replace(/^\s+at\s+/gm,"").replace(/^Object.<anonymous>\s*\(/gm,"{anonymous}()@"):"Unknown Stack Trace",Q=e.console&&(e.console.warn||e.console.log);return Q&&Q.call(e.console,M,j),T.apply(this,arguments)}}var _;typeof Object.assign!="function"?_=function(S){if(S===r||S===null)throw new TypeError("Cannot convert undefined or null to object");for(var w=Object(S),M=1;M<arguments.length;M++){var L=arguments[M];if(L!==r&&L!==null)for(var j in L)L.hasOwnProperty(j)&&(w[j]=L[j])}return w}:_=Object.assign;var E=g(function(S,w,M){for(var L=Object.keys(w),j=0;j<L.length;)(!M||M&&S[L[j]]===r)&&(S[L[j]]=w[L[j]]),j++;return S},"extend","Use `assign`."),m=g(function(S,w){return E(S,w,!0)},"merge","Use `assign`.");function y(T,S,w){var M=S.prototype,L;L=T.prototype=Object.create(M),L.constructor=T,L._super=M,w&&_(L,w)}function A(T,S){return function(){return T.apply(S,arguments)}}function C(T,S){return typeof T==a?T.apply(S&&S[0]||r,S):T}function b(T,S){return T===r?S:T}function P(T,S,w){d(F(S),function(M){T.addEventListener(M,w,!1)})}function B(T,S,w){d(F(S),function(M){T.removeEventListener(M,w,!1)})}function O(T,S){for(;T;){if(T==S)return!0;T=T.parentNode}return!1}function N(T,S){return T.indexOf(S)>-1}function F(T){return T.trim().split(/\s+/g)}function H(T,S,w){if(T.indexOf&&!w)return T.indexOf(S);for(var M=0;M<T.length;){if(w&&T[M][w]==S||!w&&T[M]===S)return M;M++}return-1}function X(T){return Array.prototype.slice.call(T,0)}function G(T,S,w){for(var M=[],L=[],j=0;j<T.length;){var Q=S?T[j][S]:T[j];H(L,Q)<0&&M.push(T[j]),L[j]=Q,j++}return w&&(S?M=M.sort(function(je,it){return je[S]>it[S]}):M=M.sort()),M}function $(T,S){for(var w,M,L=S[0].toUpperCase()+S.slice(1),j=0;j<i.length;){if(w=i[j],M=w?w+L:S,M in T)return M;j++}return r}var Te=1;function Nt(){return Te++}function Et(T){var S=T.ownerDocument||T;return S.defaultView||S.parentWindow||e}var V=/mobile|tablet|ip(ad|hone|od)|android/i,K="ontouchstart"in e,Y=$(e,"PointerEvent")!==r,se=K&&V.test(navigator.userAgent),ae="touch",us="pen",Ft="mouse",Qs="kinect",kn=25,Me=1,er=2,Be=4,ht=8,ic=1,lo=2,uo=4,ho=8,fo=16,Tn=lo|uo,tr=ho|fo,sy=Tn|tr,ry=["x","y"],oc=["clientX","clientY"];function Dt(T,S){var w=this;this.manager=T,this.callback=S,this.element=T.element,this.target=T.options.inputTarget,this.domHandler=function(M){C(T.options.enable,[T])&&w.handler(M)},this.init()}Dt.prototype={handler:function(){},init:function(){this.evEl&&P(this.element,this.evEl,this.domHandler),this.evTarget&&P(this.target,this.evTarget,this.domHandler),this.evWin&&P(Et(this.element),this.evWin,this.domHandler)},destroy:function(){this.evEl&&B(this.element,this.evEl,this.domHandler),this.evTarget&&B(this.target,this.evTarget,this.domHandler),this.evWin&&B(Et(this.element),this.evWin,this.domHandler)}};function IR(T){var S,w=T.options.inputClass;return w?S=w:Y?S=ef:se?S=lc:K?S=tf:S=cc,new S(T,PR)}function PR(T,S,w){var M=w.pointers.length,L=w.changedPointers.length,j=S&Me&&M-L===0,Q=S&(Be|ht)&&M-L===0;w.isFirst=!!j,w.isFinal=!!Q,j&&(T.session={}),w.eventType=S,xR(T,w),T.emit("hammer.input",w),T.recognize(w),T.session.prevInput=w}function xR(T,S){var w=T.session,M=S.pointers,L=M.length;w.firstInput||(w.firstInput=iy(S)),L>1&&!w.firstMultiple?w.firstMultiple=iy(S):L===1&&(w.firstMultiple=!1);var j=w.firstInput,Q=w.firstMultiple,ke=Q?Q.center:j.center,je=S.center=oy(M);S.timeStamp=u(),S.deltaTime=S.timeStamp-j.timeStamp,S.angle=Qh(ke,je),S.distance=ac(ke,je),MR(w,S),S.offsetDirection=cy(S.deltaX,S.deltaY);var it=ay(S.deltaTime,S.deltaX,S.deltaY);S.overallVelocityX=it.x,S.overallVelocityY=it.y,S.overallVelocity=l(it.x)>l(it.y)?it.x:it.y,S.scale=Q?NR(Q.pointers,M):1,S.rotation=Q?OR(Q.pointers,M):0,S.maxPointers=w.prevInput?S.pointers.length>w.prevInput.maxPointers?S.pointers.length:w.prevInput.maxPointers:S.pointers.length,BR(w,S);var Sn=T.element;O(S.srcEvent.target,Sn)&&(Sn=S.srcEvent.target),S.target=Sn}function MR(T,S){var w=S.center,M=T.offsetDelta||{},L=T.prevDelta||{},j=T.prevInput||{};(S.eventType===Me||j.eventType===Be)&&(L=T.prevDelta={x:j.deltaX||0,y:j.deltaY||0},M=T.offsetDelta={x:w.x,y:w.y}),S.deltaX=L.x+(w.x-M.x),S.deltaY=L.y+(w.y-M.y)}function BR(T,S){var w=T.lastInterval||S,M=S.timeStamp-w.timeStamp,L,j,Q,ke;if(S.eventType!=ht&&(M>kn||w.velocity===r)){var je=S.deltaX-w.deltaX,it=S.deltaY-w.deltaY,Sn=ay(M,je,it);j=Sn.x,Q=Sn.y,L=l(Sn.x)>l(Sn.y)?Sn.x:Sn.y,ke=cy(je,it),T.lastInterval=S}else L=w.velocity,j=w.velocityX,Q=w.velocityY,ke=w.direction;S.velocity=L,S.velocityX=j,S.velocityY=Q,S.direction=ke}function iy(T){for(var S=[],w=0;w<T.pointers.length;)S[w]={clientX:c(T.pointers[w].clientX),clientY:c(T.pointers[w].clientY)},w++;return{timeStamp:u(),pointers:S,center:oy(S),deltaX:T.deltaX,deltaY:T.deltaY}}function oy(T){var S=T.length;if(S===1)return{x:c(T[0].clientX),y:c(T[0].clientY)};for(var w=0,M=0,L=0;L<S;)w+=T[L].clientX,M+=T[L].clientY,L++;return{x:c(w/S),y:c(M/S)}}function ay(T,S,w){return{x:S/T||0,y:w/T||0}}function cy(T,S){return T===S?ic:l(T)>=l(S)?T<0?lo:uo:S<0?ho:fo}function ac(T,S,w){w||(w=ry);var M=S[w[0]]-T[w[0]],L=S[w[1]]-T[w[1]];return Math.sqrt(M*M+L*L)}function Qh(T,S,w){w||(w=ry);var M=S[w[0]]-T[w[0]],L=S[w[1]]-T[w[1]];return Math.atan2(L,M)*180/Math.PI}function OR(T,S){return Qh(S[1],S[0],oc)+Qh(T[1],T[0],oc)}function NR(T,S){return ac(S[0],S[1],oc)/ac(T[0],T[1],oc)}var FR={mousedown:Me,mousemove:er,mouseup:Be},DR="mousedown",LR="mousemove mouseup";function cc(){this.evEl=DR,this.evWin=LR,this.pressed=!1,Dt.apply(this,arguments)}y(cc,Dt,{handler:function(S){var w=FR[S.type];w&Me&&S.button===0&&(this.pressed=!0),w&er&&S.which!==1&&(w=Be),this.pressed&&(w&Be&&(this.pressed=!1),this.callback(this.manager,w,{pointers:[S],changedPointers:[S],pointerType:Ft,srcEvent:S}))}});var UR={pointerdown:Me,pointermove:er,pointerup:Be,pointercancel:ht,pointerout:ht},kR={2:ae,3:us,4:Ft,5:Qs},ly="pointerdown",uy="pointermove pointerup pointercancel";e.MSPointerEvent&&!e.PointerEvent&&(ly="MSPointerDown",uy="MSPointerMove MSPointerUp MSPointerCancel");function ef(){this.evEl=ly,this.evWin=uy,Dt.apply(this,arguments),this.store=this.manager.session.pointerEvents=[]}y(ef,Dt,{handler:function(S){var w=this.store,M=!1,L=S.type.toLowerCase().replace("ms",""),j=UR[L],Q=kR[S.pointerType]||S.pointerType,ke=Q==ae,je=H(w,S.pointerId,"pointerId");j&Me&&(S.button===0||ke)?je<0&&(w.push(S),je=w.length-1):j&(Be|ht)&&(M=!0),!(je<0)&&(w[je]=S,this.callback(this.manager,j,{pointers:w,changedPointers:[S],pointerType:Q,srcEvent:S}),M&&w.splice(je,1))}});var zR={touchstart:Me,touchmove:er,touchend:Be,touchcancel:ht},VR="touchstart",HR="touchstart touchmove touchend touchcancel";function hy(){this.evTarget=VR,this.evWin=HR,this.started=!1,Dt.apply(this,arguments)}y(hy,Dt,{handler:function(S){var w=zR[S.type];if(w===Me&&(this.started=!0),!!this.started){var M=jR.call(this,S,w);w&(Be|ht)&&M[0].length-M[1].length===0&&(this.started=!1),this.callback(this.manager,w,{pointers:M[0],changedPointers:M[1],pointerType:ae,srcEvent:S})}}});function jR(T,S){var w=X(T.touches),M=X(T.changedTouches);return S&(Be|ht)&&(w=G(w.concat(M),"identifier",!0)),[w,M]}var WR={touchstart:Me,touchmove:er,touchend:Be,touchcancel:ht},GR="touchstart touchmove touchend touchcancel";function lc(){this.evTarget=GR,this.targetIds={},Dt.apply(this,arguments)}y(lc,Dt,{handler:function(S){var w=WR[S.type],M=XR.call(this,S,w);M&&this.callback(this.manager,w,{pointers:M[0],changedPointers:M[1],pointerType:ae,srcEvent:S})}});function XR(T,S){var w=X(T.touches),M=this.targetIds;if(S&(Me|er)&&w.length===1)return M[w[0].identifier]=!0,[w,w];var L,j,Q=X(T.changedTouches),ke=[],je=this.target;if(j=w.filter(function(it){return O(it.target,je)}),S===Me)for(L=0;L<j.length;)M[j[L].identifier]=!0,L++;for(L=0;L<Q.length;)M[Q[L].identifier]&&ke.push(Q[L]),S&(Be|ht)&&delete M[Q[L].identifier],L++;if(ke.length)return[G(j.concat(ke),"identifier",!0),ke]}var $R=2500,fy=25;function tf(){Dt.apply(this,arguments);var T=A(this.handler,this);this.touch=new lc(this.manager,T),this.mouse=new cc(this.manager,T),this.primaryTouch=null,this.lastTouches=[]}y(tf,Dt,{handler:function(S,w,M){var L=M.pointerType==ae,j=M.pointerType==Ft;if(!(j&&M.sourceCapabilities&&M.sourceCapabilities.firesTouchEvents)){if(L)KR.call(this,w,M);else if(j&&YR.call(this,M))return;this.callback(S,w,M)}},destroy:function(){this.touch.destroy(),this.mouse.destroy()}});function KR(T,S){T&Me?(this.primaryTouch=S.changedPointers[0].identifier,dy.call(this,S)):T&(Be|ht)&&dy.call(this,S)}function dy(T){var S=T.changedPointers[0];if(S.identifier===this.primaryTouch){var w={x:S.clientX,y:S.clientY};this.lastTouches.push(w);var M=this.lastTouches,L=function(){var j=M.indexOf(w);j>-1&&M.splice(j,1)};setTimeout(L,$R)}}function YR(T){for(var S=T.srcEvent.clientX,w=T.srcEvent.clientY,M=0;M<this.lastTouches.length;M++){var L=this.lastTouches[M],j=Math.abs(S-L.x),Q=Math.abs(w-L.y);if(j<=fy&&Q<=fy)return!0}return!1}var py=$(o.style,"touchAction"),gy=py!==r,_y="compute",my="auto",nf="manipulation",nr="none",po="pan-x",go="pan-y",uc=qR();function sf(T,S){this.manager=T,this.set(S)}sf.prototype={set:function(T){T==_y&&(T=this.compute()),gy&&this.manager.element.style&&uc[T]&&(this.manager.element.style[py]=T),this.actions=T.toLowerCase().trim()},update:function(){this.set(this.manager.options.touchAction)},compute:function(){var T=[];return d(this.manager.recognizers,function(S){C(S.options.enable,[S])&&(T=T.concat(S.getTouchAction()))}),JR(T.join(" "))},preventDefaults:function(T){var S=T.srcEvent,w=T.offsetDirection;if(this.manager.session.prevented){S.preventDefault();return}var M=this.actions,L=N(M,nr)&&!uc[nr],j=N(M,go)&&!uc[go],Q=N(M,po)&&!uc[po];if(L){var ke=T.pointers.length===1,je=T.distance<2,it=T.deltaTime<250;if(ke&&je&&it)return}if(!(Q&&j)&&(L||j&&w&Tn||Q&&w&tr))return this.preventSrc(S)},preventSrc:function(T){this.manager.session.prevented=!0,T.preventDefault()}};function JR(T){if(N(T,nr))return nr;var S=N(T,po),w=N(T,go);return S&&w?nr:S||w?S?po:go:N(T,nf)?nf:my}function qR(){if(!gy)return!1;var T={},S=e.CSS&&e.CSS.supports;return["auto","manipulation","pan-y","pan-x","pan-x pan-y","none"].forEach(function(w){T[w]=S?e.CSS.supports("touch-action",w):!0}),T}var hc=1,Lt=2,Hr=4,hs=8,zn=hs,_o=16,En=32;function Vn(T){this.options=_({},this.defaults,T||{}),this.id=Nt(),this.manager=null,this.options.enable=b(this.options.enable,!0),this.state=hc,this.simultaneous={},this.requireFail=[]}Vn.prototype={defaults:{},set:function(T){return _(this.options,T),this.manager&&this.manager.touchAction.update(),this},recognizeWith:function(T){if(f(T,"recognizeWith",this))return this;var S=this.simultaneous;return T=fc(T,this),S[T.id]||(S[T.id]=T,T.recognizeWith(this)),this},dropRecognizeWith:function(T){return f(T,"dropRecognizeWith",this)?this:(T=fc(T,this),delete this.simultaneous[T.id],this)},requireFailure:function(T){if(f(T,"requireFailure",this))return this;var S=this.requireFail;return T=fc(T,this),H(S,T)===-1&&(S.push(T),T.requireFailure(this)),this},dropRequireFailure:function(T){if(f(T,"dropRequireFailure",this))return this;T=fc(T,this);var S=H(this.requireFail,T);return S>-1&&this.requireFail.splice(S,1),this},hasRequireFailures:function(){return this.requireFail.length>0},canRecognizeWith:function(T){return!!this.simultaneous[T.id]},emit:function(T){var S=this,w=this.state;function M(L){S.manager.emit(L,T)}w<hs&&M(S.options.event+yy(w)),M(S.options.event),T.additionalEvent&&M(T.additionalEvent),w>=hs&&M(S.options.event+yy(w))},tryEmit:function(T){if(this.canEmit())return this.emit(T);this.state=En},canEmit:function(){for(var T=0;T<this.requireFail.length;){if(!(this.requireFail[T].state&(En|hc)))return!1;T++}return!0},recognize:function(T){var S=_({},T);if(!C(this.options.enable,[this,S])){this.reset(),this.state=En;return}this.state&(zn|_o|En)&&(this.state=hc),this.state=this.process(S),this.state&(Lt|Hr|hs|_o)&&this.tryEmit(S)},process:function(T){},getTouchAction:function(){},reset:function(){}};function yy(T){return T&_o?"cancel":T&hs?"end":T&Hr?"move":T&Lt?"start":""}function Ay(T){return T==fo?"down":T==ho?"up":T==lo?"left":T==uo?"right":""}function fc(T,S){var w=S.manager;return w?w.get(T):T}function Zt(){Vn.apply(this,arguments)}y(Zt,Vn,{defaults:{pointers:1},attrTest:function(T){var S=this.options.pointers;return S===0||T.pointers.length===S},process:function(T){var S=this.state,w=T.eventType,M=S&(Lt|Hr),L=this.attrTest(T);return M&&(w&ht||!L)?S|_o:M||L?w&Be?S|hs:S&Lt?S|Hr:Lt:En}});function dc(){Zt.apply(this,arguments),this.pX=null,this.pY=null}y(dc,Zt,{defaults:{event:"pan",threshold:10,pointers:1,direction:sy},getTouchAction:function(){var T=this.options.direction,S=[];return T&Tn&&S.push(go),T&tr&&S.push(po),S},directionTest:function(T){var S=this.options,w=!0,M=T.distance,L=T.direction,j=T.deltaX,Q=T.deltaY;return L&S.direction||(S.direction&Tn?(L=j===0?ic:j<0?lo:uo,w=j!=this.pX,M=Math.abs(T.deltaX)):(L=Q===0?ic:Q<0?ho:fo,w=Q!=this.pY,M=Math.abs(T.deltaY))),T.direction=L,w&&M>S.threshold&&L&S.direction},attrTest:function(T){return Zt.prototype.attrTest.call(this,T)&&(this.state&Lt||!(this.state&Lt)&&this.directionTest(T))},emit:function(T){this.pX=T.deltaX,this.pY=T.deltaY;var S=Ay(T.direction);S&&(T.additionalEvent=this.options.event+S),this._super.emit.call(this,T)}});function rf(){Zt.apply(this,arguments)}y(rf,Zt,{defaults:{event:"pinch",threshold:0,pointers:2},getTouchAction:function(){return[nr]},attrTest:function(T){return this._super.attrTest.call(this,T)&&(Math.abs(T.scale-1)>this.options.threshold||this.state&Lt)},emit:function(T){if(T.scale!==1){var S=T.scale<1?"in":"out";T.additionalEvent=this.options.event+S}this._super.emit.call(this,T)}});function of(){Vn.apply(this,arguments),this._timer=null,this._input=null}y(of,Vn,{defaults:{event:"press",pointers:1,time:251,threshold:9},getTouchAction:function(){return[my]},process:function(T){var S=this.options,w=T.pointers.length===S.pointers,M=T.distance<S.threshold,L=T.deltaTime>S.time;if(this._input=T,!M||!w||T.eventType&(Be|ht)&&!L)this.reset();else if(T.eventType&Me)this.reset(),this._timer=h(function(){this.state=zn,this.tryEmit()},S.time,this);else if(T.eventType&Be)return zn;return En},reset:function(){clearTimeout(this._timer)},emit:function(T){this.state===zn&&(T&&T.eventType&Be?this.manager.emit(this.options.event+"up",T):(this._input.timeStamp=u(),this.manager.emit(this.options.event,this._input)))}});function af(){Zt.apply(this,arguments)}y(af,Zt,{defaults:{event:"rotate",threshold:0,pointers:2},getTouchAction:function(){return[nr]},attrTest:function(T){return this._super.attrTest.call(this,T)&&(Math.abs(T.rotation)>this.options.threshold||this.state&Lt)}});function cf(){Zt.apply(this,arguments)}y(cf,Zt,{defaults:{event:"swipe",threshold:10,velocity:.3,direction:Tn|tr,pointers:1},getTouchAction:function(){return dc.prototype.getTouchAction.call(this)},attrTest:function(T){var S=this.options.direction,w;return S&(Tn|tr)?w=T.overallVelocity:S&Tn?w=T.overallVelocityX:S&tr&&(w=T.overallVelocityY),this._super.attrTest.call(this,T)&&S&T.offsetDirection&&T.distance>this.options.threshold&&T.maxPointers==this.options.pointers&&l(w)>this.options.velocity&&T.eventType&Be},emit:function(T){var S=Ay(T.offsetDirection);S&&this.manager.emit(this.options.event+S,T),this.manager.emit(this.options.event,T)}});function pc(){Vn.apply(this,arguments),this.pTime=!1,this.pCenter=!1,this._timer=null,this._input=null,this.count=0}y(pc,Vn,{defaults:{event:"tap",pointers:1,taps:1,interval:300,time:250,threshold:9,posThreshold:10},getTouchAction:function(){return[nf]},process:function(T){var S=this.options,w=T.pointers.length===S.pointers,M=T.distance<S.threshold,L=T.deltaTime<S.time;if(this.reset(),T.eventType&Me&&this.count===0)return this.failTimeout();if(M&&L&&w){if(T.eventType!=Be)return this.failTimeout();var j=this.pTime?T.timeStamp-this.pTime<S.interval:!0,Q=!this.pCenter||ac(this.pCenter,T.center)<S.posThreshold;this.pTime=T.timeStamp,this.pCenter=T.center,!Q||!j?this.count=1:this.count+=1,this._input=T;var ke=this.count%S.taps;if(ke===0)return this.hasRequireFailures()?(this._timer=h(function(){this.state=zn,this.tryEmit()},S.interval,this),Lt):zn}return En},failTimeout:function(){return this._timer=h(function(){this.state=En},this.options.interval,this),En},reset:function(){clearTimeout(this._timer)},emit:function(){this.state==zn&&(this._input.tapCount=this.count,this.manager.emit(this.options.event,this._input))}});function Hn(T,S){return S=S||{},S.recognizers=b(S.recognizers,Hn.defaults.preset),new lf(T,S)}Hn.VERSION="2.0.7",Hn.defaults={domEvents:!1,touchAction:_y,enable:!0,inputTarget:null,inputClass:null,preset:[[af,{enable:!1}],[rf,{enable:!1},["rotate"]],[cf,{direction:Tn}],[dc,{direction:Tn},["swipe"]],[pc],[pc,{event:"doubletap",taps:2},["tap"]],[of]],cssProps:{userSelect:"none",touchSelect:"none",touchCallout:"none",contentZooming:"none",userDrag:"none",tapHighlightColor:"rgba(0,0,0,0)"}};var ZR=1,Ty=2;function lf(T,S){this.options=_({},Hn.defaults,S||{}),this.options.inputTarget=this.options.inputTarget||T,this.handlers={},this.session={},this.recognizers=[],this.oldCssProps={},this.element=T,this.input=IR(this),this.touchAction=new sf(this,this.options.touchAction),Ey(this,!0),d(this.options.recognizers,function(w){var M=this.add(new w[0](w[1]));w[2]&&M.recognizeWith(w[2]),w[3]&&M.requireFailure(w[3])},this)}lf.prototype={set:function(T){return _(this.options,T),T.touchAction&&this.touchAction.update(),T.inputTarget&&(this.input.destroy(),this.input.target=T.inputTarget,this.input.init()),this},stop:function(T){this.session.stopped=T?Ty:ZR},recognize:function(T){var S=this.session;if(!S.stopped){this.touchAction.preventDefaults(T);var w,M=this.recognizers,L=S.curRecognizer;(!L||L&&L.state&zn)&&(L=S.curRecognizer=null);for(var j=0;j<M.length;)w=M[j],S.stopped!==Ty&&(!L||w==L||w.canRecognizeWith(L))?w.recognize(T):w.reset(),!L&&w.state&(Lt|Hr|hs)&&(L=S.curRecognizer=w),j++}},get:function(T){if(T instanceof Vn)return T;for(var S=this.recognizers,w=0;w<S.length;w++)if(S[w].options.event==T)return S[w];return null},add:function(T){if(f(T,"add",this))return this;var S=this.get(T.options.event);return S&&this.remove(S),this.recognizers.push(T),T.manager=this,this.touchAction.update(),T},remove:function(T){if(f(T,"remove",this))return this;if(T=this.get(T),T){var S=this.recognizers,w=H(S,T);w!==-1&&(S.splice(w,1),this.touchAction.update())}return this},on:function(T,S){if(T!==r&&S!==r){var w=this.handlers;return d(F(T),function(M){w[M]=w[M]||[],w[M].push(S)}),this}},off:function(T,S){if(T!==r){var w=this.handlers;return d(F(T),function(M){S?w[M]&&w[M].splice(H(w[M],S),1):delete w[M]}),this}},emit:function(T,S){this.options.domEvents&&QR(T,S);var w=this.handlers[T]&&this.handlers[T].slice();if(!(!w||!w.length)){S.type=T,S.preventDefault=function(){S.srcEvent.preventDefault()};for(var M=0;M<w.length;)w[M](S),M++}},destroy:function(){this.element&&Ey(this,!1),this.handlers={},this.session={},this.input.destroy(),this.element=null}};function Ey(T,S){var w=T.element;if(w.style){var M;d(T.options.cssProps,function(L,j){M=$(w.style,j),S?(T.oldCssProps[M]=w.style[M],w.style[M]=L):w.style[M]=T.oldCssProps[M]||""}),S||(T.oldCssProps={})}}function QR(T,S){var w=n.createEvent("Event");w.initEvent(T,!0,!0),w.gesture=S,S.target.dispatchEvent(w)}_(Hn,{INPUT_START:Me,INPUT_MOVE:er,INPUT_END:Be,INPUT_CANCEL:ht,STATE_POSSIBLE:hc,STATE_BEGAN:Lt,STATE_CHANGED:Hr,STATE_ENDED:hs,STATE_RECOGNIZED:zn,STATE_CANCELLED:_o,STATE_FAILED:En,DIRECTION_NONE:ic,DIRECTION_LEFT:lo,DIRECTION_RIGHT:uo,DIRECTION_UP:ho,DIRECTION_DOWN:fo,DIRECTION_HORIZONTAL:Tn,DIRECTION_VERTICAL:tr,DIRECTION_ALL:sy,Manager:lf,Input:Dt,TouchAction:sf,TouchInput:lc,MouseInput:cc,PointerEventInput:ef,TouchMouseInput:tf,SingleTouchInput:hy,Recognizer:Vn,AttrRecognizer:Zt,Tap:pc,Pan:dc,Swipe:cf,Pinch:rf,Rotate:af,Press:of,on:P,off:B,each:d,merge:m,extend:E,assign:_,inherit:y,bindFn:A,prefixed:$});var eI=typeof e<"u"?e:typeof self<"u"?self:{};eI.Hammer=Hn,typeof r=="function"&&r.amd?r(function(){return Hn}):t.exports?t.exports=Hn:e[s]=Hn})(window,document,"Hammer")})(kw);var tc=kw.exports;const Ck=i_(tc),Rn=sI({__proto__:null,default:Ck},[tc]),zw=1,Vw=2,pg=4,vk={mousedown:zw,mousemove:Vw,mouseup:pg};function wk(t,e){for(let n=0;n<t.length;n++)if(e(t[n]))return!0;return!1}function bk(t){const e=t.prototype.handler;t.prototype.handler=function(s){const r=this.store;s.button>0&&s.type==="pointerdown"&&(wk(r,i=>i.pointerId===s.pointerId)||r.push(s)),e.call(this,s)}}function Rk(t){t.prototype.handler=function(n){let s=vk[n.type];s&zw&&n.button>=0&&(this.pressed=!0),s&Vw&&n.which===0&&(s=pg),this.pressed&&(s&pg&&(this.pressed=!1),this.callback(this.manager,s,{pointers:[n],changedPointers:[n],pointerType:"mouse",srcEvent:n}))}}bk(tc.PointerEventInput);Rk(tc.MouseInput);const Ik=tc.Manager;class Hh{constructor(e,n,s){this.element=e,this.callback=n,this.options={enable:!0,...s}}}const Pk=Rn?[[Rn.Pan,{event:"tripan",pointers:3,threshold:0,enable:!1}],[Rn.Rotate,{enable:!1}],[Rn.Pinch,{enable:!1}],[Rn.Swipe,{enable:!1}],[Rn.Pan,{threshold:0,enable:!1}],[Rn.Press,{enable:!1}],[Rn.Tap,{event:"doubletap",taps:2,enable:!1}],[Rn.Tap,{event:"anytap",enable:!1}],[Rn.Tap,{enable:!1}]]:null,hT={tripan:["rotate","pinch","pan"],rotate:["pinch"],pinch:["pan"],pan:["press","doubletap","anytap","tap"],doubletap:["anytap"],anytap:["tap"]},xk={doubletap:["tap"]},Mk={pointerdown:"pointerdown",pointermove:"pointermove",pointerup:"pointerup",touchstart:"pointerdown",touchmove:"pointermove",touchend:"pointerup",mousedown:"pointerdown",mousemove:"pointermove",mouseup:"pointerup"},Om={KEY_EVENTS:["keydown","keyup"],MOUSE_EVENTS:["mousedown","mousemove","mouseup","mouseover","mouseout","mouseleave"],WHEEL_EVENTS:["wheel","mousewheel"]},Bk={tap:"tap",anytap:"anytap",doubletap:"doubletap",press:"press",pinch:"pinch",pinchin:"pinch",pinchout:"pinch",pinchstart:"pinch",pinchmove:"pinch",pinchend:"pinch",pinchcancel:"pinch",rotate:"rotate",rotatestart:"rotate",rotatemove:"rotate",rotateend:"rotate",rotatecancel:"rotate",tripan:"tripan",tripanstart:"tripan",tripanmove:"tripan",tripanup:"tripan",tripandown:"tripan",tripanleft:"tripan",tripanright:"tripan",tripanend:"tripan",tripancancel:"tripan",pan:"pan",panstart:"pan",panmove:"pan",panup:"pan",pandown:"pan",panleft:"pan",panright:"pan",panend:"pan",pancancel:"pan",swipe:"swipe",swipeleft:"swipe",swiperight:"swipe",swipeup:"swipe",swipedown:"swipe"},fT={click:"tap",anyclick:"anytap",dblclick:"doubletap",mousedown:"pointerdown",mousemove:"pointermove",mouseup:"pointerup",mouseover:"pointerover",mouseout:"pointerout",mouseleave:"pointerleave"},Ok=typeof navigator<"u"&&navigator.userAgent?navigator.userAgent.toLowerCase():"",Ai=typeof window<"u"?window:global;let gg=!1;try{const t={get passive(){return gg=!0,!0}};Ai.addEventListener("test",null,t),Ai.removeEventListener("test",null)}catch{gg=!1}const Nk=Ok.indexOf("firefox")!==-1,{WHEEL_EVENTS:Fk}=Om,dT="wheel",pT=4.000244140625,Dk=40,Lk=.25;class Uk extends Hh{constructor(e,n,s){super(e,n,s),this.handleEvent=r=>{if(!this.options.enable)return;let i=r.deltaY;Ai.WheelEvent&&(Nk&&r.deltaMode===Ai.WheelEvent.DOM_DELTA_PIXEL&&(i/=Ai.devicePixelRatio),r.deltaMode===Ai.WheelEvent.DOM_DELTA_LINE&&(i*=Dk)),i!==0&&i%pT===0&&(i=Math.floor(i/pT)),r.shiftKey&&i&&(i=i*Lk),this.callback({type:dT,center:{x:r.clientX,y:r.clientY},delta:-i,srcEvent:r,pointerType:"mouse",target:r.target})},this.events=(this.options.events||[]).concat(Fk),this.events.forEach(r=>e.addEventListener(r,this.handleEvent,gg?{passive:!1}:!1))}destroy(){this.events.forEach(e=>this.element.removeEventListener(e,this.handleEvent))}enableEventType(e,n){e===dT&&(this.options.enable=n)}}const{MOUSE_EVENTS:kk}=Om,gT="pointermove",_T="pointerover",mT="pointerout",yT="pointerenter",AT="pointerleave";class zk extends Hh{constructor(e,n,s){super(e,n,s),this.handleEvent=i=>{this.handleOverEvent(i),this.handleOutEvent(i),this.handleEnterEvent(i),this.handleLeaveEvent(i),this.handleMoveEvent(i)},this.pressed=!1;const{enable:r}=this.options;this.enableMoveEvent=r,this.enableLeaveEvent=r,this.enableEnterEvent=r,this.enableOutEvent=r,this.enableOverEvent=r,this.events=(this.options.events||[]).concat(kk),this.events.forEach(i=>e.addEventListener(i,this.handleEvent))}destroy(){this.events.forEach(e=>this.element.removeEventListener(e,this.handleEvent))}enableEventType(e,n){e===gT&&(this.enableMoveEvent=n),e===_T&&(this.enableOverEvent=n),e===mT&&(this.enableOutEvent=n),e===yT&&(this.enableEnterEvent=n),e===AT&&(this.enableLeaveEvent=n)}handleOverEvent(e){this.enableOverEvent&&e.type==="mouseover"&&this._emit(_T,e)}handleOutEvent(e){this.enableOutEvent&&e.type==="mouseout"&&this._emit(mT,e)}handleEnterEvent(e){this.enableEnterEvent&&e.type==="mouseenter"&&this._emit(yT,e)}handleLeaveEvent(e){this.enableLeaveEvent&&e.type==="mouseleave"&&this._emit(AT,e)}handleMoveEvent(e){if(this.enableMoveEvent)switch(e.type){case"mousedown":e.button>=0&&(this.pressed=!0);break;case"mousemove":e.which===0&&(this.pressed=!1),this.pressed||this._emit(gT,e);break;case"mouseup":this.pressed=!1;break}}_emit(e,n){this.callback({type:e,center:{x:n.clientX,y:n.clientY},srcEvent:n,pointerType:"mouse",target:n.target})}}const{KEY_EVENTS:Vk}=Om,TT="keydown",ET="keyup";class Hk extends Hh{constructor(e,n,s){super(e,n,s),this.handleEvent=r=>{const i=r.target||r.srcElement;i.tagName==="INPUT"&&i.type==="text"||i.tagName==="TEXTAREA"||(this.enableDownEvent&&r.type==="keydown"&&this.callback({type:TT,srcEvent:r,key:r.key,target:r.target}),this.enableUpEvent&&r.type==="keyup"&&this.callback({type:ET,srcEvent:r,key:r.key,target:r.target}))},this.enableDownEvent=this.options.enable,this.enableUpEvent=this.options.enable,this.events=(this.options.events||[]).concat(Vk),e.tabIndex=this.options.tabIndex||0,e.style.outline="none",this.events.forEach(r=>e.addEventListener(r,this.handleEvent))}destroy(){this.events.forEach(e=>this.element.removeEventListener(e,this.handleEvent))}enableEventType(e,n){e===TT&&(this.enableDownEvent=n),e===ET&&(this.enableUpEvent=n)}}const ST="contextmenu";class jk extends Hh{constructor(e,n,s){super(e,n,s),this.handleEvent=r=>{this.options.enable&&this.callback({type:ST,center:{x:r.clientX,y:r.clientY},srcEvent:r,pointerType:"mouse",target:r.target})},e.addEventListener("contextmenu",this.handleEvent)}destroy(){this.element.removeEventListener("contextmenu",this.handleEvent)}enableEventType(e,n){e===ST&&(this.options.enable=n)}}const _g=1,Ru=2,mg=4,Wk={pointerdown:_g,pointermove:Ru,pointerup:mg,mousedown:_g,mousemove:Ru,mouseup:mg},Gk=1,Xk=2,$k=3,Kk=0,Yk=1,Jk=2,qk=1,Zk=2,Qk=4;function e4(t){const e=Wk[t.srcEvent.type];if(!e)return null;const{buttons:n,button:s,which:r}=t.srcEvent;let i=!1,o=!1,a=!1;return e===mg||e===Ru&&!Number.isFinite(n)?(i=r===Gk,o=r===Xk,a=r===$k):e===Ru?(i=!!(n&qk),o=!!(n&Qk),a=!!(n&Zk)):e===_g&&(i=s===Kk,o=s===Yk,a=s===Jk),{leftButton:i,middleButton:o,rightButton:a}}function t4(t,e){const n=t.center;if(!n)return null;const s=e.getBoundingClientRect(),r=s.width/e.offsetWidth||1,i=s.height/e.offsetHeight||1,o={x:(n.x-s.left-e.clientLeft)/r,y:(n.y-s.top-e.clientTop)/i};return{center:n,offsetCenter:o}}const dd={srcElement:"root",priority:0};class n4{constructor(e){this.handleEvent=n=>{if(this.isEmpty())return;const s=this._normalizeEvent(n);let r=n.srcEvent.target;for(;r&&r!==s.rootElement;){if(this._emit(s,r),s.handled)return;r=r.parentNode}this._emit(s,"root")},this.eventManager=e,this.handlers=[],this.handlersByElement=new Map,this._active=!1}isEmpty(){return!this._active}add(e,n,s,r=!1,i=!1){const{handlers:o,handlersByElement:a}=this;let c=dd;typeof s=="string"||s&&s.addEventListener?c={...dd,srcElement:s}:s&&(c={...dd,...s});let l=a.get(c.srcElement);l||(l=[],a.set(c.srcElement,l));const u={type:e,handler:n,srcElement:c.srcElement,priority:c.priority};r&&(u.once=!0),i&&(u.passive=!0),o.push(u),this._active=this._active||!u.passive;let h=l.length-1;for(;h>=0&&!(l[h].priority>=u.priority);)h--;l.splice(h+1,0,u)}remove(e,n){const{handlers:s,handlersByElement:r}=this;for(let i=s.length-1;i>=0;i--){const o=s[i];if(o.type===e&&o.handler===n){s.splice(i,1);const a=r.get(o.srcElement);a.splice(a.indexOf(o),1),a.length===0&&r.delete(o.srcElement)}}this._active=s.some(i=>!i.passive)}_emit(e,n){const s=this.handlersByElement.get(n);if(s){let r=!1;const i=()=>{e.handled=!0},o=()=>{e.handled=!0,r=!0},a=[];for(let c=0;c<s.length;c++){const{type:l,handler:u,once:h}=s[c];if(u({...e,type:l,stopPropagation:i,stopImmediatePropagation:o}),h&&a.push(s[c]),r)break}for(let c=0;c<a.length;c++){const{type:l,handler:u}=a[c];this.remove(l,u)}}}_normalizeEvent(e){const n=this.eventManager.getElement();return{...e,...e4(e),...t4(e,n),preventDefault:()=>{e.srcEvent.preventDefault()},stopImmediatePropagation:null,stopPropagation:null,handled:!1,rootElement:n}}}const s4={events:null,recognizers:null,recognizerOptions:{},Manager:Ik,touchAction:"none",tabIndex:0};class r4{constructor(e=null,n){this._onBasicInput=r=>{const{srcEvent:i}=r,o=Mk[i.type];o&&this.manager.emit(o,r)},this._onOtherEvent=r=>{this.manager.emit(r.type,r)},this.options={...s4,...n},this.events=new Map,this.setElement(e);const{events:s}=this.options;s&&this.on(s)}getElement(){return this.element}setElement(e){if(this.element&&this.destroy(),this.element=e,!e)return;const{options:n}=this,s=n.Manager;this.manager=new s(e,{touchAction:n.touchAction,recognizers:n.recognizers||Pk}).on("hammer.input",this._onBasicInput),n.recognizers||Object.keys(hT).forEach(r=>{const i=this.manager.get(r);i&&hT[r].forEach(o=>{i.recognizeWith(o)})});for(const r in n.recognizerOptions){const i=this.manager.get(r);if(i){const o=n.recognizerOptions[r];delete o.enable,i.set(o)}}this.wheelInput=new Uk(e,this._onOtherEvent,{enable:!1}),this.moveInput=new zk(e,this._onOtherEvent,{enable:!1}),this.keyInput=new Hk(e,this._onOtherEvent,{enable:!1,tabIndex:n.tabIndex}),this.contextmenuInput=new jk(e,this._onOtherEvent,{enable:!1});for(const[r,i]of this.events)i.isEmpty()||(this._toggleRecognizer(i.recognizerName,!0),this.manager.on(r,i.handleEvent))}destroy(){this.element&&(this.wheelInput.destroy(),this.moveInput.destroy(),this.keyInput.destroy(),this.contextmenuInput.destroy(),this.manager.destroy(),this.wheelInput=null,this.moveInput=null,this.keyInput=null,this.contextmenuInput=null,this.manager=null,this.element=null)}on(e,n,s){this._addEventHandler(e,n,s,!1)}once(e,n,s){this._addEventHandler(e,n,s,!0)}watch(e,n,s){this._addEventHandler(e,n,s,!1,!0)}off(e,n){this._removeEventHandler(e,n)}_toggleRecognizer(e,n){const{manager:s}=this;if(!s)return;const r=s.get(e);if(r&&r.options.enable!==n){r.set({enable:n});const i=xk[e];i&&!this.options.recognizers&&i.forEach(o=>{const a=s.get(o);n?(a.requireFailure(e),r.dropRequireFailure(o)):a.dropRequireFailure(e)})}this.wheelInput.enableEventType(e,n),this.moveInput.enableEventType(e,n),this.keyInput.enableEventType(e,n),this.contextmenuInput.enableEventType(e,n)}_addEventHandler(e,n,s,r,i){if(typeof e!="string"){s=n;for(const u in e)this._addEventHandler(u,e[u],s,r,i);return}const{manager:o,events:a}=this,c=fT[e]||e;let l=a.get(c);l||(l=new n4(this),a.set(c,l),l.recognizerName=Bk[c]||c,o&&o.on(c,l.handleEvent)),l.add(e,n,s,r,i),l.isEmpty()||this._toggleRecognizer(l.recognizerName,!0)}_removeEventHandler(e,n){if(typeof e!="string"){for(const o in e)this._removeEventHandler(o,e[o]);return}const{events:s}=this,r=fT[e]||e,i=s.get(r);if(i&&(i.remove(e,n),i.isEmpty())){const{recognizerName:o}=i;let a=!1;for(const c of s.values())if(c.recognizerName===o&&!c.isEmpty()){a=!0;break}a||this._toggleRecognizer(o,!1)}}}function _s(){}const i4=({isDragging:t})=>t?"grabbing":"grab",CT={id:"",width:"100%",height:"100%",style:null,viewState:null,initialViewState:null,pickingRadius:0,layerFilter:null,parameters:{},parent:null,device:null,deviceProps:{type:"webgl"},gl:null,glOptions:{},canvas:null,layers:[],effects:[],views:null,controller:null,useDevicePixels:!0,touchAction:"none",eventRecognizerOptions:{},_framebuffer:null,_animate:!1,_pickable:!0,_typedArrayManagerProps:{},_customRender:null,widgets:[],onDeviceInitialized:_s,onWebGLInitialized:_s,onResize:_s,onViewStateChange:_s,onInteractionStateChange:_s,onBeforeRender:_s,onAfterRender:_s,onLoad:_s,onError:t=>J.error(t.message,t.cause)(),onHover:null,onClick:null,onDragStart:null,onDrag:null,onDragEnd:null,_onMetrics:null,getCursor:i4,getTooltip:null,debug:!1,drawPickingColors:!1},eh=class eh{constructor(e){this.width=0,this.height=0,this.userData={},this.device=null,this.canvas=null,this.viewManager=null,this.layerManager=null,this.effectManager=null,this.deckRenderer=null,this.deckPicker=null,this.eventManager=null,this.widgetManager=null,this.tooltip=null,this.animationLoop=null,this.cursorState={isHovering:!1,isDragging:!1},this.stats=new oo({id:"deck.gl"}),this.metrics={fps:0,setPropsTime:0,updateAttributesTime:0,framesRedrawn:0,pickTime:0,pickCount:0,gpuTime:0,gpuTimePerFrame:0,cpuTime:0,cpuTimePerFrame:0,bufferMemory:0,textureMemory:0,renderbufferMemory:0,gpuMemory:0},this._metricsCounter=0,this._needsRedraw="Initial render",this._pickRequest={mode:"hover",x:-1,y:-1,radius:0,event:null},this._lastPointerDownInfo=null,this._onPointerMove=s=>{const{_pickRequest:r}=this;if(s.type==="pointerleave")r.x=-1,r.y=-1,r.radius=0;else{if(s.leftButton||s.rightButton)return;{const i=s.offsetCenter;if(!i)return;r.x=i.x,r.y=i.y,r.radius=this.props.pickingRadius}}this.layerManager&&(this.layerManager.context.mousePosition={x:r.x,y:r.y}),r.event=s},this._onEvent=s=>{const r=ng[s.type],i=s.offsetCenter;if(!r||!i||!this.layerManager)return;const o=this.layerManager.getLayers(),a=this.deckPicker.getLastPickedObject({x:i.x,y:i.y,layers:o,viewports:this.getViewports(i)},this._lastPointerDownInfo),{layer:c}=a,l=c&&(c[r.handler]||c.props[r.handler]),u=this.props[r.handler];let h=!1;l&&(h=l.call(c,a,s)),h||(u==null||u(a,s),this.widgetManager.onEvent(a,s))},this._onPointerDown=s=>{const r=s.offsetCenter,i=this._pick("pickObject","pickObject Time",{x:r.x,y:r.y,radius:this.props.pickingRadius});this._lastPointerDownInfo=i.result[0]||i.emptyInfo},this.props={...CT,...e},e=this.props,e.viewState&&e.initialViewState&&J.warn("View state tracking is disabled. Use either `initialViewState` for auto update or `viewState` for manual update.")(),this.viewState=this.props.initialViewState,e.device?this.device=e.device:e.gl&&(e.gl instanceof WebGLRenderingContext&&J.error("WebGL1 context not supported.")(),this.device=ua.attach(e.gl));let n=this.device;n||(Cr.registerDevices([ua]),n=Cr.createDevice({...e.deviceProps,canvas:this._createCanvas(e)})),this.animationLoop=this._createAnimationLoop(n,e),this.setProps(e),e._typedArrayManagerProps&&Yi.setOptions(e._typedArrayManagerProps),this.animationLoop.start()}finalize(){var e,n,s,r,i,o,a,c,l,u;(e=this.animationLoop)==null||e.stop(),(n=this.animationLoop)==null||n.destroy(),this.animationLoop=null,this._lastPointerDownInfo=null,(s=this.layerManager)==null||s.finalize(),this.layerManager=null,(r=this.viewManager)==null||r.finalize(),this.viewManager=null,(i=this.effectManager)==null||i.finalize(),this.effectManager=null,(o=this.deckRenderer)==null||o.finalize(),this.deckRenderer=null,(a=this.deckPicker)==null||a.finalize(),this.deckPicker=null,(c=this.eventManager)==null||c.destroy(),this.eventManager=null,(l=this.widgetManager)==null||l.finalize(),this.widgetManager=null,!this.props.canvas&&!this.props.device&&this.canvas&&((u=this.canvas.parentElement)==null||u.removeChild(this.canvas),this.canvas=null)}setProps(e){var s;this.stats.get("setProps Time").timeStart(),"onLayerHover"in e&&J.removed("onLayerHover","onHover")(),"onLayerClick"in e&&J.removed("onLayerClick","onClick")(),e.initialViewState&&!hn(this.props.initialViewState,e.initialViewState,3)&&(this.viewState=e.initialViewState),Object.assign(this.props,e),this._setCanvasSize(this.props);const n=Object.create(this.props);Object.assign(n,{views:this._getViews(),width:this.width,height:this.height,viewState:this._getViewState()}),(s=this.animationLoop)==null||s.setProps(n),this.layerManager&&(this.viewManager.setProps(n),this.layerManager.activateViewport(this.getViewports()[0]),this.layerManager.setProps(n),this.effectManager.setProps(n),this.deckRenderer.setProps(n),this.deckPicker.setProps(n),this.widgetManager.setProps(n)),this.stats.get("setProps Time").timeEnd()}needsRedraw(e={clearRedrawFlags:!1}){if(!this.layerManager)return!1;if(this.props._animate)return"Deck._animate";let n=this._needsRedraw;e.clearRedrawFlags&&(this._needsRedraw=!1);const s=this.viewManager.needsRedraw(e),r=this.layerManager.needsRedraw(e),i=this.effectManager.needsRedraw(e),o=this.deckRenderer.needsRedraw(e);return n=n||s||r||i||o,n}redraw(e){if(!this.layerManager)return;let n=this.needsRedraw({clearRedrawFlags:!0});n=e||n,n&&(this.stats.get("Redraw Count").incrementCount(),this.props._customRender?this.props._customRender(n):this._drawLayers(n))}get isInitialized(){return this.viewManager!==null}getViews(){return Xe(this.viewManager),this.viewManager.views}getViewports(e){return Xe(this.viewManager),this.viewManager.getViewports(e)}getCanvas(){return this.canvas}pickObject(e){const n=this._pick("pickObject","pickObject Time",e).result;return n.length?n[0]:null}pickMultipleObjects(e){return e.depth=e.depth||10,this._pick("pickObject","pickMultipleObjects Time",e).result}pickObjects(e){return this._pick("pickObjects","pickObjects Time",e)}_addResources(e,n=!1){for(const s in e)this.layerManager.resourceManager.add({resourceId:s,data:e[s],forceUpdate:n})}_removeResources(e){for(const n of e)this.layerManager.resourceManager.remove(n)}_addDefaultEffect(e){this.effectManager.addDefaultEffect(e)}_addDefaultShaderModule(e){this.layerManager.addDefaultShaderModule(e)}_removeDefaultShaderModule(e){var n;(n=this.layerManager)==null||n.removeDefaultShaderModule(e)}_pick(e,n,s){Xe(this.deckPicker);const{stats:r}=this;r.get("Pick Count").incrementCount(),r.get(n).timeStart();const i=this.deckPicker[e]({layers:this.layerManager.getLayers(s),views:this.viewManager.getViews(),viewports:this.getViewports(s),onViewportActive:this.layerManager.activateViewport,effects:this.effectManager.getEffects(),...s});return r.get(n).timeEnd(),i}_createCanvas(e){let n=e.canvas;return typeof n=="string"&&(n=document.getElementById(n),Xe(n)),n||(n=document.createElement("canvas"),n.id=e.id||"deckgl-overlay",(e.parent||document.body).appendChild(n)),Object.assign(n.style,e.style),n}_setCanvasSize(e){var r;if(!this.canvas)return;const{width:n,height:s}=e;if(n||n===0){const i=Number.isFinite(n)?`${n}px`:n;this.canvas.style.width=i}if(s||s===0){const i=Number.isFinite(s)?`${s}px`:s;this.canvas.style.position=((r=e.style)==null?void 0:r.position)||"absolute",this.canvas.style.height=i}}_updateCanvasSize(){var r,i;const{canvas:e}=this;if(!e)return;const n=e.clientWidth??e.width,s=e.clientHeight??e.height;(n!==this.width||s!==this.height)&&(this.width=n,this.height=s,(r=this.viewManager)==null||r.setProps({width:n,height:s}),(i=this.layerManager)==null||i.activateViewport(this.getViewports()[0]),this.props.onResize({width:n,height:s}))}_createAnimationLoop(e,n){const{gl:s,onError:r,useDevicePixels:i}=n;return new bD({device:e,useDevicePixels:i,autoResizeDrawingBuffer:!s,autoResizeViewport:!1,onInitialize:o=>this._setDevice(o.device),onRender:this._onRenderFrame.bind(this),onError:r})}_getViewState(){return this.props.viewState||this.viewState}_getViews(){const{views:e}=this.props,n=Array.isArray(e)?e:e?[e]:[new ug({id:"default-view"})];return n.length&&this.props.controller&&(n[0].props.controller=this.props.controller),n}_onContextLost(){const{onError:e}=this.props;this.animationLoop&&e&&e(new Error("WebGL context is lost"))}_pickAndCallback(){var n,s,r;const{_pickRequest:e}=this;if(e.event){const{result:i,emptyInfo:o}=this._pick("pickObject","pickObject Time",e);this.cursorState.isHovering=i.length>0;let a=o,c=!1;for(const l of i)a=l,c=((n=l.layer)==null?void 0:n.onHover(l,e.event))||c;c||((r=(s=this.props).onHover)==null||r.call(s,a,e.event),this.widgetManager.onHover(a,e.event)),e.event=null}}_updateCursor(){const e=this.props.parent||this.canvas;e&&(e.style.cursor=this.props.getCursor(this.cursorState))}_setDevice(e){var r,i;if(this.device=e,!this.animationLoop)return;this.canvas||(this.canvas=(r=this.device.canvasContext)==null?void 0:r.canvas),this.device.setParametersWebGL({blend:!0,blendFunc:[770,771,1,771],polygonOffsetFill:!0,depthTest:!0,depthFunc:515}),this.props.onDeviceInitialized(this.device),this.device instanceof ua&&this.props.onWebGLInitialized(this.device.gl);const n=new Tw;n.play(),this.animationLoop.attachTimeline(n),this.eventManager=new r4(this.props.parent||this.canvas,{touchAction:this.props.touchAction,recognizerOptions:this.props.eventRecognizerOptions,events:{pointerdown:this._onPointerDown,pointermove:this._onPointerMove,pointerleave:this._onPointerMove}});for(const o in ng)this.eventManager.on(o,this._onEvent);this.viewManager=new WD({timeline:n,eventManager:this.eventManager,onViewStateChange:this._onViewStateChange.bind(this),onInteractionStateChange:this._onInteractionStateChange.bind(this),views:this._getViews(),viewState:this._getViewState(),width:this.width,height:this.height});const s=this.viewManager.getViewports()[0];this.layerManager=new jD(this.device,{deck:this,stats:this.stats,viewport:s,timeline:n}),this.effectManager=new oL({deck:this,device:this.device}),this.deckRenderer=new lL(this.device),this.deckPicker=new gL(this.device),this.widgetManager=new yL({deck:this,parentElement:(i=this.canvas)==null?void 0:i.parentElement}),this.widgetManager.addDefault(new TL),this.setProps(this.props),this._updateCanvasSize(),this.props.onLoad()}_drawLayers(e,n){var o;const{device:s,gl:r}=this.layerManager.context;this.props.onBeforeRender({device:s,gl:r});const i={target:this.props._framebuffer,layers:this.layerManager.getLayers(),viewports:this.viewManager.getViewports(),onViewportActive:this.layerManager.activateViewport,views:this.viewManager.getViews(),pass:"screen",effects:this.effectManager.getEffects(),...n};(o=this.deckRenderer)==null||o.renderLayers(i),i.pass==="screen"&&this.widgetManager.onRedraw({viewports:i.viewports,layers:i.layers}),this.props.onAfterRender({device:s,gl:r})}_onRenderFrame(){this._getFrameStats(),this._metricsCounter++%60===0&&(this._getMetrics(),this.stats.reset(),J.table(4,this.metrics)(),this.props._onMetrics&&this.props._onMetrics(this.metrics)),this._updateCanvasSize(),this._updateCursor(),this.layerManager.updateLayers(),this._pickAndCallback(),this.redraw(),this.viewManager&&this.viewManager.updateViewStates()}_onViewStateChange(e){const n=this.props.onViewStateChange(e)||e.viewState;this.viewState&&(this.viewState={...this.viewState,[e.viewId]:n},this.props.viewState||this.viewManager&&this.viewManager.setProps({viewState:this.viewState}))}_onInteractionStateChange(e){this.cursorState.isDragging=e.isDragging||!1,this.props.onInteractionStateChange(e)}_getFrameStats(){const{stats:e}=this;e.get("frameRate").timeEnd(),e.get("frameRate").timeStart();const n=this.animationLoop.stats;e.get("GPU Time").addTime(n.get("GPU Time").lastTiming),e.get("CPU Time").addTime(n.get("CPU Time").lastTiming)}_getMetrics(){const{metrics:e,stats:n}=this;e.fps=n.get("frameRate").getHz(),e.setPropsTime=n.get("setProps Time").time,e.updateAttributesTime=n.get("Update Attributes").time,e.framesRedrawn=n.get("Redraw Count").count,e.pickTime=n.get("pickObject Time").time+n.get("pickMultipleObjects Time").time+n.get("pickObjects Time").time,e.pickCount=n.get("Pick Count").count,e.gpuTime=n.get("GPU Time").time,e.cpuTime=n.get("CPU Time").time,e.gpuTimePerFrame=n.get("GPU Time").getAverageTime(),e.cpuTimePerFrame=n.get("CPU Time").getAverageTime();const s=Cr.stats.get("Memory Usage");e.bufferMemory=s.get("Buffer Memory").count,e.textureMemory=s.get("Texture Memory").count,e.renderbufferMemory=s.get("Renderbuffer Memory").count,e.gpuMemory=s.get("GPU Memory").count}};eh.defaultProps=CT,eh.VERSION=fB;let yg=eh;function o4(t){switch(t){case"float64":return Float64Array;case"uint8":case"unorm8":return Uint8ClampedArray;default:return xv(t)}}const a4=Pv;function Kc(t,e){return{attribute:t,format:e.size>1?`${e.type}x${e.size}`:e.type,byteOffset:e.offset||0}}function mr(t){return t.stride||t.size*t.bytesPerElement}function c4(t,e){return t.type===e.type&&t.size===e.size&&mr(t)===mr(e)&&(t.offset||0)===(e.offset||0)}function Ag(t,e){e.offset&&J.removed("shaderAttribute.offset","vertexOffset, elementOffset")();const n=mr(t),s=e.vertexOffset!==void 0?e.vertexOffset:t.vertexOffset||0,r=e.elementOffset||0,i=s*n+r*t.bytesPerElement+(t.offset||0);return{...e,offset:i,stride:n}}function l4(t,e){const n=Ag(t,e);return{high:n,low:{...n,offset:n.offset+t.size*4}}}class u4{constructor(e,n,s){this._buffer=null,this.device=e,this.id=n.id||"",this.size=n.size||1;const r=n.logicalType||n.type,i=r==="float64";let{defaultValue:o}=n;o=Number.isFinite(o)?[o]:o||new Array(this.size).fill(0);let a;i?a="float32":!r&&n.isIndexed?a="uint32":a=r||"float32";let c=o4(r||a);this.doublePrecision=i,i&&n.fp64===!1&&(c=Float32Array),this.value=null,this.settings={...n,defaultType:c,defaultValue:o,logicalType:r,type:a,normalized:a.includes("norm"),size:this.size,bytesPerElement:c.BYTES_PER_ELEMENT},this.state={...s,externalBuffer:null,bufferAccessor:this.settings,allocatedValue:null,numInstances:0,bounds:null,constant:!1}}get isConstant(){return this.state.constant}get buffer(){return this._buffer}get byteOffset(){const e=this.getAccessor();return e.vertexOffset?e.vertexOffset*mr(e):0}get numInstances(){return this.state.numInstances}set numInstances(e){this.state.numInstances=e}delete(){this._buffer&&(this._buffer.delete(),this._buffer=null),Yi.release(this.state.allocatedValue)}getBuffer(){return this.state.constant?null:this.state.externalBuffer||this._buffer}getValue(e=this.id,n=null){const s={};if(this.state.constant){const r=this.value;if(n){const i=Ag(this.getAccessor(),n),o=i.offset/r.BYTES_PER_ELEMENT,a=i.size||this.size;s[e]=r.subarray(o,o+a)}else s[e]=r}else s[e]=this.getBuffer();return this.doublePrecision&&(this.value instanceof Float64Array?s[`${e}64Low`]=s[e]:s[`${e}64Low`]=new Float32Array(this.size)),s}getBufferLayout(e=this.id,n=null){const s=this.getAccessor(),r=[],i={name:this.id,byteStride:mr(s),attributes:r};if(this.doublePrecision){const o=l4(s,n||{});r.push(Kc(e,{...s,...o.high}),Kc(`${e}64Low`,{...s,...o.low}))}else if(n){const o=Ag(s,n);r.push(Kc(e,{...s,...o}))}else r.push(Kc(e,s));return i}setAccessor(e){this.state.bufferAccessor=e}getAccessor(){return this.state.bufferAccessor}getBounds(){if(this.state.bounds)return this.state.bounds;let e=null;if(this.state.constant&&this.value){const n=Array.from(this.value);e=[n,n]}else{const{value:n,numInstances:s,size:r}=this,i=s*r;if(n&&i&&n.length>=i){const o=new Array(r).fill(1/0),a=new Array(r).fill(-1/0);for(let c=0;c<i;)for(let l=0;l<r;l++){const u=n[c++];u<o[l]&&(o[l]=u),u>a[l]&&(a[l]=u)}e=[o,a]}}return this.state.bounds=e,e}setData(e){const{state:n}=this;let s;ArrayBuffer.isView(e)?s={value:e}:e instanceof Ae?s={buffer:e}:s=e;const r={...this.settings,...s};if(ArrayBuffer.isView(s.value)){if(!s.type)if(this.doublePrecision&&s.value instanceof Float64Array)r.type="float32";else{const o=a4(s.value);r.type=r.normalized?o.replace("int","norm"):o}r.bytesPerElement=s.value.BYTES_PER_ELEMENT,r.stride=mr(r)}if(n.bounds=null,s.constant){let i=s.value;if(i=this._normalizeValue(i,[],0),this.settings.normalized&&(i=this.normalizeConstant(i)),!(!n.constant||!this._areValuesEqual(i,this.value)))return!1;n.externalBuffer=null,n.constant=!0,this.value=ArrayBuffer.isView(i)?i:new Float32Array(i)}else if(s.buffer){const i=s.buffer;n.externalBuffer=i,n.constant=!1,this.value=s.value||null}else if(s.value){this._checkExternalBuffer(s);let i=s.value;n.externalBuffer=null,n.constant=!1,this.value=i;let{buffer:o}=this;const a=mr(r),c=(r.vertexOffset||0)*a;if(this.doublePrecision&&i instanceof Float64Array&&(i=ed(i,r)),this.settings.isIndexed){const u=this.settings.defaultType;i.constructor!==u&&(i=new u(i))}const l=i.byteLength+c+a*2;(!o||o.byteLength<l)&&(o=this._createBuffer(l)),o.write(i,c)}return this.setAccessor(r),!0}updateSubBuffer(e={}){this.state.bounds=null;const n=this.value,{startOffset:s=0,endOffset:r}=e;this.buffer.write(this.doublePrecision&&n instanceof Float64Array?ed(n,{size:this.size,startIndex:s,endIndex:r}):n.subarray(s,r),s*n.BYTES_PER_ELEMENT+this.byteOffset)}allocate(e,n=!1){const{state:s}=this,r=s.allocatedValue,i=Yi.allocate(r,e+1,{size:this.size,type:this.settings.defaultType,copy:n});this.value=i;const{byteOffset:o}=this;let{buffer:a}=this;return(!a||a.byteLength<i.byteLength+o)&&(a=this._createBuffer(i.byteLength+o),n&&r&&a.write(r instanceof Float64Array?ed(r,this):r,o)),s.allocatedValue=i,s.constant=!1,s.externalBuffer=null,this.setAccessor(this.settings),!0}_checkExternalBuffer(e){const{value:n}=e;if(!ArrayBuffer.isView(n))throw new Error(`Attribute ${this.id} value is not TypedArray`);const s=this.settings.defaultType;let r=!1;if(this.doublePrecision&&(r=n.BYTES_PER_ELEMENT<4),r)throw new Error(`Attribute ${this.id} does not support ${n.constructor.name}`);!(n instanceof s)&&this.settings.normalized&&!("normalized"in e)&&J.warn(`Attribute ${this.id} is normalized`)()}normalizeConstant(e){switch(this.settings.type){case"snorm8":return new Float32Array(e).map(n=>(n+128)/255*2-1);case"snorm16":return new Float32Array(e).map(n=>(n+32768)/65535*2-1);case"unorm8":return new Float32Array(e).map(n=>n/255);case"unorm16":return new Float32Array(e).map(n=>n/65535);default:return e}}_normalizeValue(e,n,s){const{defaultValue:r,size:i}=this.settings;if(Number.isFinite(e))return n[s]=e,n;if(!e){let o=i;for(;--o>=0;)n[s+o]=r[o];return n}switch(i){case 4:n[s+3]=Number.isFinite(e[3])?e[3]:r[3];case 3:n[s+2]=Number.isFinite(e[2])?e[2]:r[2];case 2:n[s+1]=Number.isFinite(e[1])?e[1]:r[1];case 1:n[s+0]=Number.isFinite(e[0])?e[0]:r[0];break;default:let o=i;for(;--o>=0;)n[s+o]=Number.isFinite(e[o])?e[o]:r[o]}return n}_areValuesEqual(e,n){if(!e||!n)return!1;const{size:s}=this;for(let r=0;r<s;r++)if(e[r]!==n[r])return!1;return!0}_createBuffer(e){var r;this._buffer&&this._buffer.destroy();const{isIndexed:n,type:s}=this.settings;return this._buffer=this.device.createBuffer({...(r=this._buffer)==null?void 0:r.props,id:this.id,usage:n?Ae.INDEX:Ae.VERTEX,indexType:n?s:void 0,byteLength:e}),this._buffer}}const vT=[],wT=[];function nc(t,e=0,n=1/0){let s=vT;const r={index:-1,data:t,target:[]};return t?typeof t[Symbol.iterator]=="function"?s=t:t.length>0&&(wT.length=t.length,s=wT):s=vT,(e>0||Number.isFinite(n))&&(s=(Array.isArray(s)?s:Array.from(s)).slice(e,n),r.index=e-1),{iterable:s,objectInfo:r}}function Hw(t){return t&&t[Symbol.asyncIterator]}function jw(t,e){const{size:n,stride:s,offset:r,startIndices:i,nested:o}=e,a=t.BYTES_PER_ELEMENT,c=s?s/a:n,l=r?r/a:0,u=Math.floor((t.length-l)/c);return(h,{index:f,target:d})=>{if(!i){const m=f*c+l;for(let y=0;y<n;y++)d[y]=t[m+y];return d}const g=i[f],_=i[f+1]||u;let E;if(o){E=new Array(_-g);for(let m=g;m<_;m++){const y=m*c+l;d=new Array(n);for(let A=0;A<n;A++)d[A]=t[y+A];E[m-g]=d}}else if(c===n)E=t.subarray(g*n+l,_*n+l);else{E=new t.constructor((_-g)*n);let m=0;for(let y=g;y<_;y++){const A=y*c+l;for(let C=0;C<n;C++)E[m++]=t[A+C]}}return E}}const h4=[],xl=[[0,1/0]];function f4(t,e){if(t===xl||(e[0]<0&&(e[0]=0),e[0]>=e[1]))return t;const n=[],s=t.length;let r=0;for(let i=0;i<s;i++){const o=t[i];o[1]<e[0]?(n.push(o),r=i+1):o[0]>e[1]?n.push(o):e=[Math.min(o[0],e[0]),Math.max(o[1],e[1])]}return n.splice(r,0,e),n}const d4={interpolation:{duration:0,easing:t=>t},spring:{stiffness:.05,damping:.5}};function Ww(t,e){if(!t)return null;Number.isFinite(t)&&(t={type:"interpolation",duration:t});const n=t.type||"interpolation";return{...d4[n],...e,...t,type:n}}class Gw extends u4{constructor(e,n){super(e,n,{startIndices:null,lastExternalBuffer:null,binaryValue:null,binaryAccessor:null,needsUpdate:!0,needsRedraw:!1,layoutChanged:!1,updateRanges:xl}),this.constant=!1,this.settings.update=n.update||(n.accessor?this._autoUpdater:void 0),Object.seal(this.settings),Object.seal(this.state),this._validateAttributeUpdaters()}get startIndices(){return this.state.startIndices}set startIndices(e){this.state.startIndices=e}needsUpdate(){return this.state.needsUpdate}needsRedraw({clearChangedFlags:e=!1}={}){const n=this.state.needsRedraw;return this.state.needsRedraw=n&&!e,n}layoutChanged(){return this.state.layoutChanged}setAccessor(e){var n;(n=this.state).layoutChanged||(n.layoutChanged=!c4(e,this.getAccessor())),super.setAccessor(e)}getUpdateTriggers(){const{accessor:e}=this.settings;return[this.id].concat(typeof e!="function"&&e||[])}supportsTransition(){return!!this.settings.transition}getTransitionSetting(e){if(!e||!this.supportsTransition())return null;const{accessor:n}=this.settings,s=this.settings.transition,r=Array.isArray(n)?e[n.find(i=>e[i])]:e[n];return Ww(r,s)}setNeedsUpdate(e=this.id,n){if(this.state.needsUpdate=this.state.needsUpdate||e,this.setNeedsRedraw(e),n){const{startRow:s=0,endRow:r=1/0}=n;this.state.updateRanges=f4(this.state.updateRanges,[s,r])}else this.state.updateRanges=xl}clearNeedsUpdate(){this.state.needsUpdate=!1,this.state.updateRanges=h4}setNeedsRedraw(e=this.id){this.state.needsRedraw=this.state.needsRedraw||e}allocate(e){const{state:n,settings:s}=this;return s.noAlloc?!1:s.update?(super.allocate(e,n.updateRanges!==xl),!0):!1}updateBuffer({numInstances:e,data:n,props:s,context:r}){if(!this.needsUpdate())return!1;const{state:{updateRanges:i},settings:{update:o,noAlloc:a}}=this;let c=!0;if(o){for(const[l,u]of i)o.call(r,this,{data:n,startRow:l,endRow:u,props:s,numInstances:e});if(this.value)if(this.constant||!this.buffer||this.buffer.byteLength<this.value.byteLength+this.byteOffset)this.setData({value:this.value,constant:this.constant}),this.constant=!1;else for(const[l,u]of i){const h=Number.isFinite(l)?this.getVertexOffset(l):0,f=Number.isFinite(u)?this.getVertexOffset(u):a||!Number.isFinite(e)?this.value.length:e*this.size;super.updateSubBuffer({startOffset:h,endOffset:f})}this._checkAttributeArray()}else c=!1;return this.clearNeedsUpdate(),this.setNeedsRedraw(),c}setConstantValue(e){return e===void 0||typeof e=="function"?!1:(this.setData({constant:!0,value:e})&&this.setNeedsRedraw(),this.clearNeedsUpdate(),!0)}setExternalBuffer(e){const{state:n}=this;return e?(this.clearNeedsUpdate(),n.lastExternalBuffer===e||(n.lastExternalBuffer=e,this.setNeedsRedraw(),this.setData(e)),!0):(n.lastExternalBuffer=null,!1)}setBinaryValue(e,n=null){const{state:s,settings:r}=this;if(!e)return s.binaryValue=null,s.binaryAccessor=null,!1;if(r.noAlloc)return!1;if(s.binaryValue===e)return this.clearNeedsUpdate(),!0;if(s.binaryValue=e,this.setNeedsRedraw(),r.transform||n!==this.startIndices){ArrayBuffer.isView(e)&&(e={value:e});const o=e;Xe(ArrayBuffer.isView(o.value),`invalid ${r.accessor}`);const a=!!o.size&&o.size!==this.size;return s.binaryAccessor=jw(o.value,{size:o.size||this.size,stride:o.stride,offset:o.offset,startIndices:n,nested:a}),!1}return this.clearNeedsUpdate(),this.setData(e),!0}getVertexOffset(e){const{startIndices:n}=this;return(n?e<n.length?n[e]:this.numInstances:e)*this.size}getValue(){const e=this.settings.shaderAttributes,n=super.getValue();if(!e)return n;for(const s in e)Object.assign(n,super.getValue(s,e[s]));return n}getBufferLayout(){this.state.layoutChanged=!1;const e=this.settings.shaderAttributes,n=super.getBufferLayout();if(!e)return n;for(const s in e){const r=super.getBufferLayout(s,e[s]);n.attributes.push(...r.attributes)}return n}_autoUpdater(e,{data:n,startRow:s,endRow:r,props:i,numInstances:o}){if(e.constant)return;const{settings:a,state:c,value:l,size:u,startIndices:h}=e,{accessor:f,transform:d}=a,g=c.binaryAccessor||(typeof f=="function"?f:i[f]);Xe(typeof g=="function",`accessor "${f}" is not a function`);let _=e.getVertexOffset(s);const{iterable:E,objectInfo:m}=nc(n,s,r);for(const y of E){m.index++;let A=g(y,m);if(d&&(A=d.call(this,A)),h){const C=(m.index<h.length-1?h[m.index+1]:o)-h[m.index];if(A&&Array.isArray(A[0])){let b=_;for(const P of A)e._normalizeValue(P,l,b),b+=u}else A&&A.length>u?l.set(A,_):(e._normalizeValue(A,m.target,0),UD({target:l,source:m.target,start:_,count:C}));_+=C*u}else e._normalizeValue(A,l,_),_+=u}}_validateAttributeUpdaters(){const{settings:e}=this;if(!(e.noAlloc||typeof e.update=="function"))throw new Error(`Attribute ${this.id} missing update or accessor`)}_checkAttributeArray(){const{value:e}=this,n=Math.min(4,this.size);if(e&&e.length>=n){let s=!0;switch(n){case 4:s=s&&Number.isFinite(e[3]);case 3:s=s&&Number.isFinite(e[2]);case 2:s=s&&Number.isFinite(e[1]);case 1:s=s&&Number.isFinite(e[0]);break;default:s=!1}if(!s)throw new Error(`Illegal attribute generated for ${this.id}`)}}}function pd(t){const{source:e,target:n,start:s=0,size:r,getData:i}=t,o=t.end||n.length,a=e.length,c=o-s;if(a>c){n.set(e.subarray(0,c),s);return}if(n.set(e,s),!i)return;let l=a;for(;l<c;){const u=i(l,e);for(let h=0;h<r;h++)n[s+l]=u[h]||0,l++}}function p4({source:t,target:e,size:n,getData:s,sourceStartIndices:r,targetStartIndices:i}){if(!r||!i)return pd({source:t,target:e,size:n,getData:s}),e;let o=0,a=0;const c=s&&((u,h)=>s(u+a,h)),l=Math.min(r.length,i.length);for(let u=1;u<l;u++){const h=r[u]*n,f=i[u]*n;pd({source:t.subarray(o,h),target:e,start:a,end:f,size:n,getData:c}),o=h,a=f}return a<e.length&&pd({source:[],target:e,start:a,size:n,getData:c}),e}function g4(t){const{device:e,settings:n,value:s}=t,r=new Gw(e,n);return r.setData({value:s instanceof Float64Array?new Float64Array(0):new Float32Array(0),normalized:n.normalized}),r}function Xw(t){switch(t){case 1:return"float";case 2:return"vec2";case 3:return"vec3";case 4:return"vec4";default:throw new Error(`No defined attribute type for size "${t}"`)}}function $w(t){switch(t){case 1:return"float32";case 2:return"float32x2";case 3:return"float32x3";case 4:return"float32x4";default:throw new Error("invalid type size")}}function Kw(t){t.push(t.shift())}function _4(t,e){const{doublePrecision:n,settings:s,value:r,size:i}=t,o=n&&r instanceof Float64Array?2:1;let a=0;const{shaderAttributes:c}=t.settings;if(c)for(const l of Object.values(c))a=Math.max(a,l.vertexOffset??0);return(s.noAlloc?r.length:(e+a)*i)*o}function Yw({device:t,source:e,target:n}){return(!n||n.byteLength<e.byteLength)&&(n==null||n.destroy(),n=t.createBuffer({byteLength:e.byteLength,usage:e.usage})),n}function Jw({device:t,buffer:e,attribute:n,fromLength:s,toLength:r,fromStartIndices:i,getData:o=a=>a}){const a=n.doublePrecision&&n.value instanceof Float64Array?2:1,c=n.size*a,l=n.byteOffset,u=n.settings.bytesPerElement<4?l/n.settings.bytesPerElement*4:l,h=n.startIndices,f=i&&h,d=n.isConstant;if(!f&&e&&s>=r)return e;const g=n.value instanceof Float64Array?Float32Array:n.value.constructor,_=d?n.value:new g(n.getBuffer().readSyncWebGL(l,r*g.BYTES_PER_ELEMENT).buffer);if(n.settings.normalized&&!d){const A=o;o=(C,b)=>n.normalizeConstant(A(C,b))}const E=d?(A,C)=>o(_,C):(A,C)=>o(_.subarray(A+l,A+l+c),C),m=e?new Float32Array(e.readSyncWebGL(u,s*4).buffer):new Float32Array(0),y=new Float32Array(r);return p4({source:m,target:y,sourceStartIndices:i,targetStartIndices:h,size:c,getData:E}),(!e||e.byteLength<y.byteLength+u)&&(e==null||e.destroy(),e=t.createBuffer({byteLength:y.byteLength+u,usage:35050})),e.write(y,u),e}class qw{constructor({device:e,attribute:n,timeline:s}){this.buffers=[],this.currentLength=0,this.device=e,this.transition=new kh(s),this.attribute=n,this.attributeInTransition=g4(n),this.currentStartIndices=n.startIndices}get inProgress(){return this.transition.inProgress}start(e,n,s=1/0){this.settings=e,this.currentStartIndices=this.attribute.startIndices,this.currentLength=_4(this.attribute,n),this.transition.start({...e,duration:s})}update(){const e=this.transition.update();return e&&this.onUpdate(),e}setBuffer(e){this.attributeInTransition.setData({buffer:e,normalized:this.attribute.settings.normalized,value:this.attributeInTransition.value})}cancel(){this.transition.cancel()}delete(){this.cancel();for(const e of this.buffers)e.destroy();this.buffers.length=0}}class m4 extends qw{constructor({device:e,attribute:n,timeline:s}){super({device:e,attribute:n,timeline:s}),this.type="interpolation",this.transform=A4(e,n)}start(e,n){const s=this.currentLength,r=this.currentStartIndices;if(super.start(e,n,e.duration),e.duration<=0){this.transition.cancel();return}const{buffers:i,attribute:o}=this;Kw(i),i[0]=Jw({device:this.device,buffer:i[0],attribute:o,fromLength:s,toLength:this.currentLength,fromStartIndices:r,getData:e.enter}),i[1]=Yw({device:this.device,source:i[0],target:i[1]}),this.setBuffer(i[1]);const{transform:a}=this,c=a.model;c.setVertexCount(Math.floor(this.currentLength/o.size)),o.isConstant?(c.setAttributes({aFrom:i[0]}),c.setConstantAttributes({aTo:o.value})):c.setAttributes({aFrom:i[0],aTo:o.getBuffer()}),a.transformFeedback.setBuffers({vCurrent:i[1]})}onUpdate(){const{duration:e,easing:n}=this.settings,{time:s}=this.transition;let r=s/e;n&&(r=n(r));const{model:i}=this.transform;i.setUniforms({time:r}),i.device.gl.bindBuffer(34962,null),this.transform.run({discard:!0})}delete(){super.delete(),this.transform.destroy()}}const y4=`#version 300 es
#define SHADER_NAME interpolation-transition-vertex-shader

uniform float time;
in ATTRIBUTE_TYPE aFrom;
in ATTRIBUTE_TYPE aTo;
out ATTRIBUTE_TYPE vCurrent;

void main(void) {
  vCurrent = mix(aFrom, aTo, time);
  gl_Position = vec4(0.0);
}
`;function A4(t,e){const n=Xw(e.size);return new Lh(t,{vs:y4,bufferLayout:[{name:"aFrom",format:$w(e.size)},{name:"aTo",format:e.getBufferLayout().attributes[0].format}],defines:{ATTRIBUTE_TYPE:n},varyings:["vCurrent"]})}class T4 extends qw{constructor({device:e,attribute:n,timeline:s}){super({device:e,attribute:n,timeline:s}),this.type="spring",this.texture=v4(e),this.framebuffer=w4(e,this.texture),this.transform=C4(e,n)}start(e,n){const s=this.currentLength,r=this.currentStartIndices;super.start(e,n);const{buffers:i,attribute:o}=this;for(let c=0;c<2;c++)i[c]=Jw({device:this.device,buffer:i[c],attribute:o,fromLength:s,toLength:this.currentLength,fromStartIndices:r,getData:e.enter});i[2]=Yw({device:this.device,source:i[0],target:i[2]}),this.setBuffer(i[1]);const{model:a}=this.transform;a.setVertexCount(Math.floor(this.currentLength/o.size)),o.isConstant?a.setConstantAttributes({aTo:o.value}):a.setAttributes({aTo:o.getBuffer()})}onUpdate(){const{buffers:e,transform:n,framebuffer:s,transition:r}=this,i=this.settings;n.model.setAttributes({aPrev:e[0],aCur:e[1]}),n.transformFeedback.setBuffers({vNext:e[2]}),n.model.setUniforms({stiffness:i.stiffness,damping:i.damping}),n.run({framebuffer:s,discard:!1,parameters:{viewport:[0,0,1,1]},clearColor:[0,0,0,0]}),Kw(e),this.setBuffer(e[1]),this.device.readPixelsToArrayWebGL(s)[0]>0||r.end()}delete(){super.delete(),this.transform.destroy(),this.texture.destroy(),this.framebuffer.destroy()}}const E4=`#version 300 es
#define SHADER_NAME spring-transition-vertex-shader

#define EPSILON 0.00001

uniform float stiffness;
uniform float damping;
in ATTRIBUTE_TYPE aPrev;
in ATTRIBUTE_TYPE aCur;
in ATTRIBUTE_TYPE aTo;
out ATTRIBUTE_TYPE vNext;
out float vIsTransitioningFlag;

ATTRIBUTE_TYPE getNextValue(ATTRIBUTE_TYPE cur, ATTRIBUTE_TYPE prev, ATTRIBUTE_TYPE dest) {
  ATTRIBUTE_TYPE velocity = cur - prev;
  ATTRIBUTE_TYPE delta = dest - cur;
  ATTRIBUTE_TYPE spring = delta * stiffness;
  ATTRIBUTE_TYPE damper = velocity * -1.0 * damping;
  return spring + damper + velocity + cur;
}

void main(void) {
  bool isTransitioning = length(aCur - aPrev) > EPSILON || length(aTo - aCur) > EPSILON;
  vIsTransitioningFlag = isTransitioning ? 1.0 : 0.0;

  vNext = getNextValue(aCur, aPrev, aTo);
  gl_Position = vec4(0, 0, 0, 1);
  gl_PointSize = 100.0;
}
`,S4=`#version 300 es
#define SHADER_NAME spring-transition-is-transitioning-fragment-shader

in float vIsTransitioningFlag;

out vec4 fragColor;

void main(void) {
  if (vIsTransitioningFlag == 0.0) {
    discard;
  }
  fragColor = vec4(1.0);
}`;function C4(t,e){const n=Xw(e.size),s=$w(e.size);return new Lh(t,{vs:E4,fs:S4,bufferLayout:[{name:"aPrev",format:s},{name:"aCur",format:s},{name:"aTo",format:e.getBufferLayout().attributes[0].format}],varyings:["vNext"],defines:{ATTRIBUTE_TYPE:n},parameters:{depthCompare:"always",blendColorOperation:"max",blendColorSrcFactor:"one",blendColorDstFactor:"one",blendAlphaOperation:"max",blendAlphaSrcFactor:"one",blendAlphaDstFactor:"one"}})}function v4(t){return t.createTexture({data:new Uint8Array(4),format:"rgba8unorm",mipmaps:!1,width:1,height:1})}function w4(t,e){return t.createFramebuffer({id:"spring-transition-is-transitioning-framebuffer",width:1,height:1,colorAttachments:[e]})}const b4={interpolation:m4,spring:T4};class R4{constructor(e,{id:n,timeline:s}){if(!e)throw new Error("AttributeTransitionManager is constructed without device");this.id=n,this.device=e,this.timeline=s,this.transitions={},this.needsRedraw=!1,this.numInstances=1}finalize(){for(const e in this.transitions)this._removeTransition(e)}update({attributes:e,transitions:n,numInstances:s}){this.numInstances=s||1;for(const r in e){const i=e[r],o=i.getTransitionSetting(n);o&&this._updateAttribute(r,i,o)}for(const r in this.transitions){const i=e[r];(!i||!i.getTransitionSetting(n))&&this._removeTransition(r)}}hasAttribute(e){const n=this.transitions[e];return n&&n.inProgress}getAttributes(){const e={};for(const n in this.transitions){const s=this.transitions[n];s.inProgress&&(e[n]=s.attributeInTransition)}return e}run(){if(this.numInstances===0)return!1;for(const n in this.transitions)this.transitions[n].update()&&(this.needsRedraw=!0);const e=this.needsRedraw;return this.needsRedraw=!1,e}_removeTransition(e){this.transitions[e].delete(),delete this.transitions[e]}_updateAttribute(e,n,s){const r=this.transitions[e];let i=!r||r.type!==s.type;if(i){r&&this._removeTransition(e);const o=b4[s.type];o?this.transitions[e]=new o({attribute:n,timeline:this.timeline,device:this.device}):(J.error(`unsupported transition type '${s.type}'`)(),i=!1)}(i||n.needsRedraw())&&(this.needsRedraw=!0,this.transitions[e].start(s,this.numInstances))}}const bT="attributeManager.invalidate",I4="attributeManager.updateStart",P4="attributeManager.updateEnd",x4="attribute.updateStart",M4="attribute.allocate",B4="attribute.updateEnd";class O4{constructor(e,{id:n="attribute-manager",stats:s,timeline:r}={}){this.mergeBoundsMemoized=ec(gD),this.id=n,this.device=e,this.attributes={},this.updateTriggers={},this.needsRedraw=!0,this.userData={},this.stats=s,this.attributeTransitionManager=new R4(e,{id:`${n}-transitions`,timeline:r}),Object.seal(this)}finalize(){for(const e in this.attributes)this.attributes[e].delete();this.attributeTransitionManager.finalize()}getNeedsRedraw(e={clearRedrawFlags:!1}){const n=this.needsRedraw;return this.needsRedraw=this.needsRedraw&&!e.clearRedrawFlags,n&&this.id}setNeedsRedraw(){this.needsRedraw=!0}add(e){this._add(e)}addInstanced(e){this._add(e,{instanced:1})}remove(e){for(const n of e)this.attributes[n]!==void 0&&(this.attributes[n].delete(),delete this.attributes[n])}invalidate(e,n){const s=this._invalidateTrigger(e,n);Ze(bT,this,e,s)}invalidateAll(e){for(const n in this.attributes)this.attributes[n].setNeedsUpdate(n,e);Ze(bT,this,"all")}update({data:e,numInstances:n,startIndices:s=null,transitions:r,props:i={},buffers:o={},context:a={}}){let c=!1;Ze(I4,this),this.stats&&this.stats.get("Update Attributes").timeStart();for(const l in this.attributes){const u=this.attributes[l],h=u.settings.accessor;u.startIndices=s,u.numInstances=n,i[l]&&J.removed(`props.${l}`,`data.attributes.${l}`)(),u.setExternalBuffer(o[l])||u.setBinaryValue(typeof h=="string"?o[h]:void 0,e.startIndices)||typeof h=="string"&&!o[h]&&u.setConstantValue(i[h])||u.needsUpdate()&&(c=!0,this._updateAttribute({attribute:u,numInstances:n,data:e,props:i,context:a})),this.needsRedraw=this.needsRedraw||u.needsRedraw()}c&&Ze(P4,this,n),this.stats&&this.stats.get("Update Attributes").timeEnd(),this.attributeTransitionManager.update({attributes:this.attributes,numInstances:n,transitions:r})}updateTransition(){const{attributeTransitionManager:e}=this,n=e.run();return this.needsRedraw=this.needsRedraw||n,n}getAttributes(){return{...this.attributes,...this.attributeTransitionManager.getAttributes()}}getBounds(e){const n=e.map(s=>{var r;return(r=this.attributes[s])==null?void 0:r.getBounds()});return this.mergeBoundsMemoized(n)}getChangedAttributes(e={clearChangedFlags:!1}){const{attributes:n,attributeTransitionManager:s}=this,r={...s.getAttributes()};for(const i in n){const o=n[i];o.needsRedraw(e)&&!s.hasAttribute(i)&&(r[i]=o)}return r}getBufferLayouts(e,n={}){e||(e=this.getAttributes());const s=[];for(const r in e)n[r]||s.push(e[r].getBufferLayout());return s}_add(e,n={}){for(const s in e){const r=e[s];this.attributes[s]=this._createAttribute(s,r,n)}this._mapUpdateTriggersToAttributes()}_createAttribute(e,n,s){const r={...n,id:e,size:n.isIndexed&&1||n.size||1,divisor:s.instanced?1:n.divisor||0};return new Gw(this.device,r)}_mapUpdateTriggersToAttributes(){const e={};for(const n in this.attributes)this.attributes[n].getUpdateTriggers().forEach(r=>{e[r]||(e[r]=[]),e[r].push(n)});this.updateTriggers=e}_invalidateTrigger(e,n){const{attributes:s,updateTriggers:r}=this,i=r[e];return i&&i.forEach(o=>{const a=s[o];a&&a.setNeedsUpdate(a.id,n)}),i}_updateAttribute(e){const{attribute:n,numInstances:s}=e;if(Ze(x4,n),n.constant){n.setConstantValue(n.value);return}n.allocate(s)&&Ze(M4,n,s),n.updateBuffer(e)&&(this.needsRedraw=!0,Ze(B4,n,s))}}class N4 extends kh{get value(){return this._value}_onUpdate(){const{time:e,settings:{fromValue:n,toValue:s,duration:r,easing:i}}=this,o=i(e/r);this._value=Tu(n,s,o)}}const RT=1e-5;function IT(t,e,n,s,r){const i=e-t,a=(n-e)*r,c=-i*s;return a+c+i+e}function F4(t,e,n,s,r){if(Array.isArray(n)){const i=[];for(let o=0;o<n.length;o++)i[o]=IT(t[o],e[o],n[o],s,r);return i}return IT(t,e,n,s,r)}function PT(t,e){if(Array.isArray(t)){let n=0;for(let s=0;s<t.length;s++){const r=t[s]-e[s];n+=r*r}return Math.sqrt(n)}return Math.abs(t-e)}class D4 extends kh{get value(){return this._currValue}_onUpdate(){const{fromValue:e,toValue:n,damping:s,stiffness:r}=this.settings,{_prevValue:i=e,_currValue:o=e}=this;let a=F4(i,o,n,s,r);const c=PT(a,n),l=PT(a,o);c<RT&&l<RT&&(a=n,this.end()),this._prevValue=o,this._currValue=a}}const L4={interpolation:N4,spring:D4};class U4{constructor(e){this.transitions=new Map,this.timeline=e}get active(){return this.transitions.size>0}add(e,n,s,r){const{transitions:i}=this;if(i.has(e)){const c=i.get(e),{value:l=c.settings.fromValue}=c;n=l,this.remove(e)}if(r=Ww(r),!r)return;const o=L4[r.type];if(!o){J.error(`unsupported transition type '${r.type}'`)();return}const a=new o(this.timeline);a.start({...r,fromValue:n,toValue:s}),i.set(e,a)}remove(e){const{transitions:n}=this;n.has(e)&&(n.get(e).cancel(),n.delete(e))}update(){const e={};for(const[n,s]of this.transitions)s.update(),e[n]=s.value,s.inProgress||this.remove(n);return e}clear(){for(const e of this.transitions.keys())this.remove(e)}}function k4(t){const e=t[Us];for(const n in e){const s=e[n],{validate:r}=s;if(r&&!r(t[n],s))throw new Error(`Invalid prop ${n}: ${t[n]}`)}}function z4(t,e){const n=Zw({newProps:t,oldProps:e,propTypes:t[Us],ignoreProps:{data:null,updateTriggers:null,extensions:null,transitions:null}}),s=H4(t,e);let r=!1;return s||(r=j4(t,e)),{dataChanged:s,propsChanged:n,updateTriggersChanged:r,extensionsChanged:W4(t,e),transitionsChanged:V4(t,e)}}function V4(t,e){if(!t.transitions)return!1;const n={},s=t[Us];let r=!1;for(const i in t.transitions){const o=s[i],a=o&&o.type;(a==="number"||a==="color"||a==="array")&&Tg(t[i],e[i],o)&&(n[i]=!0,r=!0)}return r?n:!1}function Zw({newProps:t,oldProps:e,ignoreProps:n={},propTypes:s={},triggerName:r="props"}){if(e===t)return!1;if(typeof t!="object"||t===null)return`${r} changed shallowly`;if(typeof e!="object"||e===null)return`${r} changed shallowly`;for(const i of Object.keys(t))if(!(i in n)){if(!(i in e))return`${r}.${i} added`;const o=Tg(t[i],e[i],s[i]);if(o)return`${r}.${i} ${o}`}for(const i of Object.keys(e))if(!(i in n)){if(!(i in t))return`${r}.${i} dropped`;if(!Object.hasOwnProperty.call(t,i)){const o=Tg(t[i],e[i],s[i]);if(o)return`${r}.${i} ${o}`}}return!1}function Tg(t,e,n){let s=n&&n.equal;return s&&!s(t,e,n)||!s&&(s=t&&e&&t.equals,s&&!s.call(t,e))?"changed deeply":!s&&e!==t?"changed shallowly":null}function H4(t,e){if(e===null)return"oldProps is null, initial diff";let n=!1;const{dataComparator:s,_dataDiff:r}=t;return s?s(t.data,e.data)||(n="Data comparator detected a change"):t.data!==e.data&&(n="A new data container was supplied"),n&&r&&(n=r(t.data,e.data)||n),n}function j4(t,e){if(e===null)return{all:!0};if("all"in t.updateTriggers&&xT(t,e,"all"))return{all:!0};const n={};let s=!1;for(const r in t.updateTriggers)r!=="all"&&xT(t,e,r)&&(n[r]=!0,s=!0);return s?n:!1}function W4(t,e){if(e===null)return!0;const n=e.extensions,{extensions:s}=t;if(s===n)return!1;if(!n||!s||s.length!==n.length)return!0;for(let r=0;r<s.length;r++)if(!s[r].equals(n[r]))return!0;return!1}function xT(t,e,n){let s=t.updateTriggers[n];s=s??{};let r=e.updateTriggers[n];return r=r??{},Zw({oldProps:r,newProps:s,triggerName:n})}const G4="count(): argument not an object",X4="count(): argument not a container";function $4(t){if(!Y4(t))throw new Error(G4);if(typeof t.count=="function")return t.count();if(Number.isFinite(t.size))return t.size;if(Number.isFinite(t.length))return t.length;if(K4(t))return Object.keys(t).length;throw new Error(X4)}function K4(t){return t!==null&&typeof t=="object"&&t.constructor===Object}function Y4(t){return t!==null&&typeof t=="object"}function MT(t,e){if(!e)return t;const n={...t,...e};if("defines"in e&&(n.defines={...t.defines,...e.defines}),"modules"in e&&(n.modules=(t.modules||[]).concat(e.modules),e.modules.some(s=>s.name==="project64"))){const s=n.modules.findIndex(r=>r.name==="project32");s>=0&&n.modules.splice(s,1)}if("inject"in e)if(!t.inject)n.inject=e.inject;else{const s={...t.inject};for(const r in e.inject)s[r]=(s[r]||"")+e.inject[r];n.inject=s}return n}const J4={minFilter:"linear",mipmapFilter:"linear",magFilter:"linear",addressModeU:"clamp-to-edge",addressModeV:"clamp-to-edge"},Eg={};function q4(t,e,n,s){if(n instanceof Rt)return n;n.constructor&&n.constructor.name!=="Object"&&(n={data:n});let r=null;n.compressed&&(r={minFilter:"linear",mipmapFilter:n.data.length>1?"nearest":"linear"});const i=e.createTexture({...n,sampler:{...J4,...r,...s}});return Eg[i.id]=t,i}function Z4(t,e){!e||!(e instanceof Rt)||Eg[e.id]===t&&(e.delete(),delete Eg[e.id])}const Q4={boolean:{validate(t,e){return!0},equal(t,e,n){return!!t==!!e}},number:{validate(t,e){return Number.isFinite(t)&&(!("max"in e)||t<=e.max)&&(!("min"in e)||t>=e.min)}},color:{validate(t,e){return e.optional&&!t||Sg(t)&&(t.length===3||t.length===4)},equal(t,e,n){return hn(t,e,1)}},accessor:{validate(t,e){const n=Iu(t);return n==="function"||n===Iu(e.value)},equal(t,e,n){return typeof e=="function"?!0:hn(t,e,1)}},array:{validate(t,e){return e.optional&&!t||Sg(t)},equal(t,e,n){const{compare:s}=n,r=Number.isInteger(s)?s:s?1:0;return s?hn(t,e,r):t===e}},object:{equal(t,e,n){if(n.ignore)return!0;const{compare:s}=n,r=Number.isInteger(s)?s:s?1:0;return s?hn(t,e,r):t===e}},function:{validate(t,e){return e.optional&&!t||typeof t=="function"},equal(t,e,n){return!n.compare&&n.ignore!==!1||t===e}},data:{transform:(t,e,n)=>{if(!t)return t;const{dataTransform:s}=n.props;return s?s(t):typeof t.shape=="string"&&t.shape.endsWith("-table")&&Array.isArray(t.data)?t.data:t}},image:{transform:(t,e,n)=>{const s=n.context;return!s||!s.device?null:q4(n.id,s.device,t,{...e.parameters,...n.props.textureParameters})},release:(t,e,n)=>{Z4(n.id,t)}}};function e6(t){const e={},n={},s={};for(const[r,i]of Object.entries(t)){const o=i==null?void 0:i.deprecatedFor;if(o)s[r]=Array.isArray(o)?o:[o];else{const a=t6(r,i);e[r]=a,n[r]=a.value}}return{propTypes:e,defaultProps:n,deprecatedProps:s}}function t6(t,e){switch(Iu(e)){case"object":return Mo(t,e);case"array":return Mo(t,{type:"array",value:e,compare:!1});case"boolean":return Mo(t,{type:"boolean",value:e});case"number":return Mo(t,{type:"number",value:e});case"function":return Mo(t,{type:"function",value:e,compare:!0});default:return{name:t,type:"unknown",value:e}}}function Mo(t,e){return"type"in e?{name:t,...Q4[e.type],...e}:"value"in e?{name:t,type:Iu(e.value),...e}:{name:t,type:"object",value:e}}function Sg(t){return Array.isArray(t)||ArrayBuffer.isView(t)}function Iu(t){return Sg(t)?"array":t===null?"null":typeof t}function n6(t,e){let n;for(let i=e.length-1;i>=0;i--){const o=e[i];"extensions"in o&&(n=o.extensions)}const s=Cg(t.constructor,n),r=Object.create(s);r[wu]=t,r[Mr]={},r[Rs]={};for(let i=0;i<e.length;++i){const o=e[i];for(const a in o)r[a]=o[a]}return Object.freeze(r),r}const s6="_mergedDefaultProps";function Cg(t,e){let n=s6;if(e)for(const r of e){const i=r.constructor;i&&(n+=`:${i.extensionName||i.name}`)}const s=Qw(t,n);return s||(t[n]=r6(t,e||[]))}function r6(t,e){if(!t.prototype)return null;const s=Object.getPrototypeOf(t),r=Cg(s),i=Qw(t,"defaultProps")||{},o=e6(i),a=Object.assign(Object.create(null),r,o.defaultProps),c=Object.assign(Object.create(null),r==null?void 0:r[Us],o.propTypes),l=Object.assign(Object.create(null),r==null?void 0:r[sd],o.deprecatedProps);for(const u of e){const h=Cg(u.constructor);h&&(Object.assign(a,h),Object.assign(c,h[Us]),Object.assign(l,h[sd]))}return i6(a,t),a6(a,c),o6(a,l),a[Us]=c,a[sd]=l,e.length===0&&!Nm(t,"_propTypes")&&(t._propTypes=c),a}function i6(t,e){const n=l6(e);Object.defineProperties(t,{id:{writable:!0,value:n}})}function o6(t,e){for(const n in e)Object.defineProperty(t,n,{enumerable:!1,set(s){const r=`${this.id}: ${n}`;for(const i of e[n])Nm(this,i)||(this[i]=s);J.deprecated(r,e[n].join("/"))()}})}function a6(t,e){const n={},s={};for(const r in e){const i=e[r],{name:o,value:a}=i;i.async&&(n[o]=a,s[o]=c6(o))}t[Fi]=n,t[Mr]={},Object.defineProperties(t,s)}function c6(t){return{enumerable:!0,set(e){typeof e=="string"||e instanceof Promise||Hw(e)?this[Mr][t]=e:this[Rs][t]=e},get(){if(this[Rs]){if(t in this[Rs])return this[Rs][t]||this[Fi][t];if(t in this[Mr]){const e=this[wu]&&this[wu].internalState;if(e&&e.hasAsyncProp(t))return e.getAsyncProp(t)||this[Fi][t]}}return this[Fi][t]}}}function Nm(t,e){return Object.prototype.hasOwnProperty.call(t,e)}function Qw(t,e){return Nm(t,e)&&t[e]}function l6(t){const e=t.componentName;return e||J.warn(`${t.name}.componentName not specified`)(),e||t.name}let u6=0;const th=class th{constructor(...e){this.props=n6(this,e),this.id=this.props.id,this.count=u6++}clone(e){const{props:n}=this,s={};for(const r in n[Fi])r in n[Rs]?s[r]=n[Rs][r]:r in n[Mr]&&(s[r]=n[Mr][r]);return new this.constructor({...n,...s,...e})}};th.componentName="Component",th.defaultProps={};let vg=th;const h6=Object.freeze({});class f6{constructor(e){this.component=e,this.asyncProps={},this.onAsyncPropUpdated=()=>{},this.oldProps=null,this.oldAsyncProps=null}finalize(){for(const e in this.asyncProps){const n=this.asyncProps[e];n&&n.type&&n.type.release&&n.type.release(n.resolvedValue,n.type,this.component)}this.asyncProps={},this.component=null,this.resetOldProps()}getOldProps(){return this.oldAsyncProps||this.oldProps||h6}resetOldProps(){this.oldAsyncProps=null,this.oldProps=this.component?this.component.props:null}hasAsyncProp(e){return e in this.asyncProps}getAsyncProp(e){const n=this.asyncProps[e];return n&&n.resolvedValue}isAsyncPropLoading(e){if(e){const n=this.asyncProps[e];return!!(n&&n.pendingLoadCount>0&&n.pendingLoadCount!==n.resolvedLoadCount)}for(const n in this.asyncProps)if(this.isAsyncPropLoading(n))return!0;return!1}reloadAsyncProp(e,n){this._watchPromise(e,Promise.resolve(n))}setAsyncProps(e){this.component=e[wu]||this.component;const n=e[Rs]||{},s=e[Mr]||e,r=e[Fi]||{};for(const i in n){const o=n[i];this._createAsyncPropData(i,r[i]),this._updateAsyncProp(i,o),n[i]=this.getAsyncProp(i)}for(const i in s){const o=s[i];this._createAsyncPropData(i,r[i]),this._updateAsyncProp(i,o)}}_fetch(e,n){return null}_onResolve(e,n){}_onError(e,n){}_updateAsyncProp(e,n){if(this._didAsyncInputValueChange(e,n)){if(typeof n=="string"&&(n=this._fetch(e,n)),n instanceof Promise){this._watchPromise(e,n);return}if(Hw(n)){this._resolveAsyncIterable(e,n);return}this._setPropValue(e,n)}}_freezeAsyncOldProps(){if(!this.oldAsyncProps&&this.oldProps){this.oldAsyncProps=Object.create(this.oldProps);for(const e in this.asyncProps)Object.defineProperty(this.oldAsyncProps,e,{enumerable:!0,value:this.oldProps[e]})}}_didAsyncInputValueChange(e,n){const s=this.asyncProps[e];return n===s.resolvedValue||n===s.lastValue?!1:(s.lastValue=n,!0)}_setPropValue(e,n){this._freezeAsyncOldProps();const s=this.asyncProps[e];s&&(n=this._postProcessValue(s,n),s.resolvedValue=n,s.pendingLoadCount++,s.resolvedLoadCount=s.pendingLoadCount)}_setAsyncPropValue(e,n,s){const r=this.asyncProps[e];r&&s>=r.resolvedLoadCount&&n!==void 0&&(this._freezeAsyncOldProps(),r.resolvedValue=n,r.resolvedLoadCount=s,this.onAsyncPropUpdated(e,n))}_watchPromise(e,n){const s=this.asyncProps[e];if(s){s.pendingLoadCount++;const r=s.pendingLoadCount;n.then(i=>{this.component&&(i=this._postProcessValue(s,i),this._setAsyncPropValue(e,i,r),this._onResolve(e,i))}).catch(i=>{this._onError(e,i)})}}async _resolveAsyncIterable(e,n){if(e!=="data"){this._setPropValue(e,n);return}const s=this.asyncProps[e];if(!s)return;s.pendingLoadCount++;const r=s.pendingLoadCount;let i=[],o=0;for await(const a of n){if(!this.component)return;const{dataTransform:c}=this.component.props;c?i=c(a,i):i=i.concat(a),Object.defineProperty(i,"__diff",{enumerable:!1,value:[{startRow:o,endRow:i.length}]}),o=i.length,this._setAsyncPropValue(e,i,r)}this._onResolve(e,i)}_postProcessValue(e,n){const s=e.type;return s&&this.component&&(s.release&&s.release(e.resolvedValue,s,this.component),s.transform)?s.transform(n,s,this.component):n}_createAsyncPropData(e,n){if(!this.asyncProps[e]){const r=this.component&&this.component.props[Us];this.asyncProps[e]={type:r&&r[e],lastValue:null,resolvedValue:n,pendingLoadCount:0,resolvedLoadCount:0}}}}class d6 extends f6{constructor({attributeManager:e,layer:n}){super(n),this.attributeManager=e,this.needsRedraw=!0,this.needsUpdate=!0,this.subLayers=null,this.usesPickingColorCache=!1}get layer(){return this.component}_fetch(e,n){const s=this.layer,r=s==null?void 0:s.props.fetch;return r?r(n,{propName:e,layer:s}):super._fetch(e,n)}_onResolve(e,n){const s=this.layer;if(s){const r=s.props.onDataLoad;e==="data"&&r&&r(n,{propName:e,layer:s})}}_onError(e,n){const s=this.layer;s&&s.raiseError(n,`loading ${e} of ${this.layer}`)}}const p6="layer.changeFlag",g6="layer.initialize",_6="layer.update",m6="layer.finalize",y6="layer.matched",BT=2**24-1,A6=Object.freeze([]),T6=ec(({oldViewport:t,viewport:e})=>t.equals(e));let In=new Uint8ClampedArray(0);const E6={data:{type:"data",value:A6,async:!0},dataComparator:{type:"function",value:null,optional:!0},_dataDiff:{type:"function",value:t=>t&&t.__diff,optional:!0},dataTransform:{type:"function",value:null,optional:!0},onDataLoad:{type:"function",value:null,optional:!0},onError:{type:"function",value:null,optional:!0},fetch:{type:"function",value:(t,{propName:e,layer:n,loaders:s,loadOptions:r,signal:i})=>{const{resourceManager:o}=n.context;r=r||n.getLoadOptions(),s=s||n.props.loaders,i&&(r={...r,fetch:{...r==null?void 0:r.fetch,signal:i}});let a=o.contains(t);return!a&&!r&&(o.add({resourceId:t,data:os(t,s),persistent:!1}),a=!0),a?o.subscribe({resourceId:t,onChange:c=>{var l;return(l=n.internalState)==null?void 0:l.reloadAsyncProp(e,c)},consumerId:n.id,requestId:e}):os(t,s,r)}},updateTriggers:{},visible:!0,pickable:!1,opacity:{type:"number",min:0,max:1,value:1},operation:"draw",onHover:{type:"function",value:null,optional:!0},onClick:{type:"function",value:null,optional:!0},onDragStart:{type:"function",value:null,optional:!0},onDrag:{type:"function",value:null,optional:!0},onDragEnd:{type:"function",value:null,optional:!0},coordinateSystem:Z.DEFAULT,coordinateOrigin:{type:"array",value:[0,0,0],compare:!0},modelMatrix:{type:"array",value:null,compare:!0,optional:!0},wrapLongitude:!1,positionFormat:"XYZ",colorFormat:"RGBA",parameters:{type:"object",value:{},optional:!0,compare:2},loadOptions:{type:"object",value:null,optional:!0,ignore:!0},transitions:null,extensions:[],loaders:{type:"array",value:[],optional:!0,ignore:!0},getPolygonOffset:{type:"function",value:({layerIndex:t})=>[0,-t*100]},highlightedObjectIndex:null,autoHighlight:!1,highlightColor:{type:"accessor",value:[0,0,128,128]}},nh=class nh extends vg{constructor(){super(...arguments),this.internalState=null,this.lifecycle=ei.NO_STATE,this.parent=null}static get componentName(){return Object.prototype.hasOwnProperty.call(this,"layerName")?this.layerName:""}get root(){let e=this;for(;e.parent;)e=e.parent;return e}toString(){return`${this.constructor.layerName||this.constructor.name}({id: '${this.props.id}'})`}project(e){Xe(this.internalState);const n=this.internalState.viewport||this.context.viewport,s=Aw(e,{viewport:n,modelMatrix:this.props.modelMatrix,coordinateOrigin:this.props.coordinateOrigin,coordinateSystem:this.props.coordinateSystem}),[r,i,o]=_w(s,n.pixelProjectionMatrix);return e.length===2?[r,i]:[r,i,o]}unproject(e){return Xe(this.internalState),(this.internalState.viewport||this.context.viewport).unproject(e)}projectPosition(e,n){Xe(this.internalState);const s=this.internalState.viewport||this.context.viewport;return ED(e,{viewport:s,modelMatrix:this.props.modelMatrix,coordinateOrigin:this.props.coordinateOrigin,coordinateSystem:this.props.coordinateSystem,...n})}get isComposite(){return!1}setState(e){this.setChangeFlags({stateChanged:!0}),Object.assign(this.state,e),this.setNeedsRedraw()}setNeedsRedraw(){this.internalState&&(this.internalState.needsRedraw=!0)}setNeedsUpdate(){this.internalState&&(this.context.layerManager.setNeedsUpdate(String(this)),this.internalState.needsUpdate=!0)}get isLoaded(){return this.internalState?!this.internalState.isAsyncPropLoading():!1}get wrapLongitude(){return this.props.wrapLongitude}isPickable(){return this.props.pickable&&this.props.visible}getModels(){const e=this.state;return e&&(e.models||e.model&&[e.model])||[]}setModuleParameters(e){for(const n of this.getModels())n.updateModuleSettings(e)}setShaderModuleProps(...e){for(const n of this.getModels())n.shaderInputs.setProps(...e)}getAttributeManager(){return this.internalState&&this.internalState.attributeManager}getCurrentLayer(){return this.internalState&&this.internalState.layer}getLoadOptions(){return this.props.loadOptions}use64bitPositions(){const{coordinateSystem:e}=this.props;return e===Z.DEFAULT||e===Z.LNGLAT||e===Z.CARTESIAN}onHover(e,n){return this.props.onHover&&this.props.onHover(e,n)||!1}onClick(e,n){return this.props.onClick&&this.props.onClick(e,n)||!1}nullPickingColor(){return[0,0,0]}encodePickingColor(e,n=[]){return n[0]=e+1&255,n[1]=e+1>>8&255,n[2]=e+1>>8>>8&255,n}decodePickingColor(e){Xe(e instanceof Uint8Array);const[n,s,r]=e;return n+s*256+r*65536-1}getNumInstances(){return Number.isFinite(this.props.numInstances)?this.props.numInstances:this.state&&this.state.numInstances!==void 0?this.state.numInstances:$4(this.props.data)}getStartIndices(){return this.props.startIndices?this.props.startIndices:this.state&&this.state.startIndices?this.state.startIndices:null}getBounds(){var e;return(e=this.getAttributeManager())==null?void 0:e.getBounds(["positions","instancePositions"])}getShaders(e){e=MT(e,{disableWarnings:!0,modules:this.context.defaultShaderModules});for(const n of this.props.extensions)e=MT(e,n.getShaders.call(this,n));return e}shouldUpdateState(e){return e.changeFlags.propsOrDataChanged}updateState(e){const n=this.getAttributeManager(),{dataChanged:s}=e.changeFlags;if(s&&n)if(Array.isArray(s))for(const r of s)n.invalidateAll(r);else n.invalidateAll();if(n){const{props:r}=e,i=this.internalState.hasPickingBuffer,o=Number.isInteger(r.highlightedObjectIndex)||r.pickable||r.extensions.some(a=>a.getNeedsPickingBuffer.call(this,a));if(i!==o){this.internalState.hasPickingBuffer=o;const{pickingColors:a,instancePickingColors:c}=n.attributes,l=a||c;l&&(o&&l.constant&&(l.constant=!1,n.invalidate(l.id)),!l.value&&!o&&(l.constant=!0,l.value=[0,0,0]))}}}finalizeState(e){for(const s of this.getModels())s.destroy();const n=this.getAttributeManager();n&&n.finalize(),this.context&&this.context.resourceManager.unsubscribe({consumerId:this.id}),this.internalState&&(this.internalState.uniformTransitions.clear(),this.internalState.finalize())}draw(e){for(const n of this.getModels())n.draw(e)}getPickingInfo({info:e,mode:n,sourceLayer:s}){const{index:r}=e;return r>=0&&Array.isArray(this.props.data)&&(e.object=this.props.data[r]),e}raiseError(e,n){var s,r,i,o;n&&(e=new Error(`${n}: ${e.message}`,{cause:e})),(r=(s=this.props).onError)!=null&&r.call(s,e)||(o=(i=this.context)==null?void 0:i.onError)==null||o.call(i,e,this)}getNeedsRedraw(e={clearRedrawFlags:!1}){return this._getNeedsRedraw(e)}needsUpdate(){return this.internalState?this.internalState.needsUpdate||this.hasUniformTransition()||this.shouldUpdateState(this._getUpdateParams()):!1}hasUniformTransition(){var e;return((e=this.internalState)==null?void 0:e.uniformTransitions.active)||!1}activateViewport(e){if(!this.internalState)return;const n=this.internalState.viewport;this.internalState.viewport=e,(!n||!T6({oldViewport:n,viewport:e}))&&(this.setChangeFlags({viewportChanged:!0}),this.isComposite?this.needsUpdate()&&this.setNeedsUpdate():this._update())}invalidateAttribute(e="all"){const n=this.getAttributeManager();n&&(e==="all"?n.invalidateAll():n.invalidate(e))}updateAttributes(e){let n=!1;for(const s in e)e[s].layoutChanged()&&(n=!0);for(const s of this.getModels())this._setModelAttributes(s,e,n)}_updateAttributes(){const e=this.getAttributeManager();if(!e)return;const n=this.props,s=this.getNumInstances(),r=this.getStartIndices();e.update({data:n.data,numInstances:s,startIndices:r,props:n,transitions:n.transitions,buffers:n.data.attributes,context:this});const i=e.getChangedAttributes({clearChangedFlags:!0});this.updateAttributes(i)}_updateAttributeTransition(){const e=this.getAttributeManager();e&&e.updateTransition()}_updateUniformTransition(){const{uniformTransitions:e}=this.internalState;if(e.active){const n=e.update(),s=Object.create(this.props);for(const r in n)Object.defineProperty(s,r,{value:n[r]});return s}return this.props}calculateInstancePickingColors(e,{numInstances:n}){if(e.constant)return;const s=Math.floor(In.length/4);if(this.internalState.usesPickingColorCache=!0,s<n){n>BT&&J.warn("Layer has too many data objects. Picking might not be able to distinguish all objects.")(),In=Yi.allocate(In,n,{size:4,copy:!0,maxCount:Math.max(n,BT)});const r=Math.floor(In.length/4),i=[];for(let o=s;o<r;o++)this.encodePickingColor(o,i),In[o*4+0]=i[0],In[o*4+1]=i[1],In[o*4+2]=i[2]}e.value=In.subarray(0,n*4)}_setModelAttributes(e,n,s=!1){var a;if(!Object.keys(n).length)return;if(s){const c=this.getAttributeManager();e.setBufferLayout(c.getBufferLayouts()),n=c.getAttributes()}const r=((a=e.userData)==null?void 0:a.excludeAttributes)||{},i={},o={};for(const c in n){if(r[c])continue;const l=n[c].getValue();for(const u in l){const h=l[u];h instanceof Ae?n[c].settings.isIndexed?e.setIndexBuffer(h):i[u]=h:h&&(o[u]=h)}}e.setAttributes(i),e.setConstantAttributes(o)}disablePickingIndex(e){const n=this.props.data;if(!("attributes"in n)){this._disablePickingIndex(e);return}const{pickingColors:s,instancePickingColors:r}=this.getAttributeManager().attributes,i=s||r,o=i&&n.attributes&&n.attributes[i.id];if(o&&o.value){const a=o.value,c=this.encodePickingColor(e);for(let l=0;l<n.length;l++){const u=i.getVertexOffset(l);a[u]===c[0]&&a[u+1]===c[1]&&a[u+2]===c[2]&&this._disablePickingIndex(l)}}else this._disablePickingIndex(e)}_disablePickingIndex(e){const{pickingColors:n,instancePickingColors:s}=this.getAttributeManager().attributes,r=n||s;if(!r)return;const i=r.getVertexOffset(e),o=r.getVertexOffset(e+1);r.buffer.write(new Uint8Array(o-i),i)}restorePickingColors(){const{pickingColors:e,instancePickingColors:n}=this.getAttributeManager().attributes,s=e||n;s&&(this.internalState.usesPickingColorCache&&s.value.buffer!==In.buffer&&(s.value=In.subarray(0,s.value.length)),s.updateSubBuffer({startOffset:0}))}_initialize(){Xe(!this.internalState),Xe(Number.isFinite(this.props.coordinateSystem)),Ze(g6,this);const e=this._getAttributeManager();e&&e.addInstanced({instancePickingColors:{type:"uint8",size:4,noAlloc:!0,update:this.calculateInstancePickingColors}}),this.internalState=new d6({attributeManager:e,layer:this}),this._clearChangeFlags(),this.state={},Object.defineProperty(this.state,"attributeManager",{get:()=>(J.deprecated("layer.state.attributeManager","layer.getAttributeManager()")(),e)}),this.internalState.uniformTransitions=new U4(this.context.timeline),this.internalState.onAsyncPropUpdated=this._onAsyncPropUpdated.bind(this),this.internalState.setAsyncProps(this.props),this.initializeState(this.context);for(const n of this.props.extensions)n.initializeState.call(this,this.context,n);this.setChangeFlags({dataChanged:"init",propsChanged:"init",viewportChanged:!0,extensionsChanged:!0}),this._update()}_transferState(e){Ze(y6,this,this===e);const{state:n,internalState:s}=e;this!==e&&(this.internalState=s,this.state=n,this.internalState.setAsyncProps(this.props),this._diffProps(this.props,this.internalState.getOldProps()))}_update(){const e=this.needsUpdate();if(Ze(_6,this,e),!e)return;const n=this.props,s=this.context,r=this.internalState,i=s.viewport,o=this._updateUniformTransition();r.propsInTransition=o,s.viewport=r.viewport||i,this.props=o;try{const a=this._getUpdateParams(),c=this.getModels();if(s.device)this.updateState(a);else try{this.updateState(a)}catch{}for(const u of this.props.extensions)u.updateState.call(this,a,u);const l=this.getModels()[0]!==c[0];this._postUpdate(a,l)}finally{s.viewport=i,this.props=n,this._clearChangeFlags(),r.needsUpdate=!1,r.resetOldProps()}}_finalize(){Ze(m6,this),this.finalizeState(this.context);for(const e of this.props.extensions)e.finalizeState.call(this,this.context,e)}_drawLayer({renderPass:e,moduleParameters:n=null,uniforms:s={},parameters:r={}}){this._updateAttributeTransition();const i=this.props,o=this.context;this.props=this.internalState.propsInTransition||i;const a=this.props.opacity;s.opacity=Math.pow(a,1/2.2);try{if(n){const{isActive:u,isAttribute:h}=n.picking;this.setModuleParameters(n),this.setShaderModuleProps({picking:{isActive:u,isAttribute:h}})}const{getPolygonOffset:c}=this.props,l=c&&c(s)||[0,0];o.device.setParametersWebGL({polygonOffset:l});for(const u of this.getModels())u.setParameters(r);o.device.withParametersWebGL(r,()=>{const u={renderPass:e,moduleParameters:n,uniforms:s,parameters:r,context:o};for(const h of this.props.extensions)h.draw.call(this,u,h);this.draw(u)})}finally{this.props=i}}getChangeFlags(){var e;return(e=this.internalState)==null?void 0:e.changeFlags}setChangeFlags(e){if(!this.internalState)return;const{changeFlags:n}=this.internalState;for(const r in e)if(e[r]){let i=!1;switch(r){case"dataChanged":const o=e[r],a=n[r];o&&Array.isArray(a)&&(n.dataChanged=Array.isArray(o)?a.concat(o):o,i=!0);default:n[r]||(n[r]=e[r],i=!0)}i&&Ze(p6,this,r,e)}const s=!!(n.dataChanged||n.updateTriggersChanged||n.propsChanged||n.extensionsChanged);n.propsOrDataChanged=s,n.somethingChanged=s||n.viewportChanged||n.stateChanged}_clearChangeFlags(){this.internalState.changeFlags={dataChanged:!1,propsChanged:!1,updateTriggersChanged:!1,viewportChanged:!1,stateChanged:!1,extensionsChanged:!1,propsOrDataChanged:!1,somethingChanged:!1}}_diffProps(e,n){var r;const s=z4(e,n);if(s.updateTriggersChanged)for(const i in s.updateTriggersChanged)s.updateTriggersChanged[i]&&this.invalidateAttribute(i);if(s.transitionsChanged)for(const i in s.transitionsChanged)this.internalState.uniformTransitions.add(i,n[i],e[i],(r=e.transitions)==null?void 0:r[i]);return this.setChangeFlags(s)}validateProps(){k4(this.props)}updateAutoHighlight(e){this.props.autoHighlight&&!Number.isInteger(this.props.highlightedObjectIndex)&&this._updateAutoHighlight(e)}_updateAutoHighlight(e){const n={highlightedObjectColor:e.picked?e.color:null},{highlightColor:s}=this.props;e.picked&&typeof s=="function"&&(n.highlightColor=s(e)),this.setShaderModuleProps({picking:n}),this.setNeedsRedraw()}_getAttributeManager(){const e=this.context;return new O4(e.device,{id:this.props.id,stats:e.stats,timeline:e.timeline})}_postUpdate(e,n){const{props:s,oldProps:r}=e;this.setNeedsRedraw(),this._updateAttributes();const i=this.state.model;i==null||i.setInstanceCount(this.getNumInstances());const{autoHighlight:o,highlightedObjectIndex:a,highlightColor:c}=s;if(n||r.autoHighlight!==o||r.highlightedObjectIndex!==a||r.highlightColor!==c){const l={};o||(l.highlightedObjectColor=null),Array.isArray(c)&&(l.highlightColor=c),(n||a!==r.highlightedObjectIndex)&&(l.highlightedObjectColor=Number.isFinite(a)&&a>=0?this.encodePickingColor(a):null),this.setShaderModuleProps({picking:l})}}_getUpdateParams(){return{props:this.props,oldProps:this.internalState.getOldProps(),context:this.context,changeFlags:this.internalState.changeFlags}}_getNeedsRedraw(e){if(!this.internalState)return!1;let n=!1;n=n||this.internalState.needsRedraw&&this.id;const s=this.getAttributeManager(),r=s?s.getNeedsRedraw(e):!1;if(n=n||r,n)for(const i of this.props.extensions)i.onNeedsRedraw.call(this,i);return this.internalState.needsRedraw=this.internalState.needsRedraw&&!e.clearRedrawFlags,n}_onAsyncPropUpdated(){this._diffProps(this.props,this.internalState.getOldProps()),this.setNeedsUpdate()}};nh.defaultProps=E6,nh.layerName="Layer";let qt=nh;const S6="compositeLayer.renderLayers",ny=class ny extends qt{get isComposite(){return!0}get isLoaded(){return super.isLoaded&&this.getSubLayers().every(e=>e.isLoaded)}getSubLayers(){return this.internalState&&this.internalState.subLayers||[]}initializeState(e){}setState(e){super.setState(e),this.setNeedsUpdate()}getPickingInfo({info:e}){const{object:n}=e;return n&&n.__source&&n.__source.parent&&n.__source.parent.id===this.id&&(e.object=n.__source.object,e.index=n.__source.index),e}filterSubLayer(e){return!0}shouldRenderSubLayer(e,n){return n&&n.length}getSubLayerClass(e,n){const{_subLayerProps:s}=this.props;return s&&s[e]&&s[e].type||n}getSubLayerRow(e,n,s){return e.__source={parent:this,object:n,index:s},e}getSubLayerAccessor(e){if(typeof e=="function"){const n={index:-1,data:this.props.data,target:[]};return(s,r)=>s&&s.__source?(n.index=s.__source.index,e(s.__source.object,n)):e(s,r)}return e}getSubLayerProps(e={}){var B;const{opacity:n,pickable:s,visible:r,parameters:i,getPolygonOffset:o,highlightedObjectIndex:a,autoHighlight:c,highlightColor:l,coordinateSystem:u,coordinateOrigin:h,wrapLongitude:f,positionFormat:d,modelMatrix:g,extensions:_,fetch:E,operation:m,_subLayerProps:y}=this.props,A={id:"",updateTriggers:{},opacity:n,pickable:s,visible:r,parameters:i,getPolygonOffset:o,highlightedObjectIndex:a,autoHighlight:c,highlightColor:l,coordinateSystem:u,coordinateOrigin:h,wrapLongitude:f,positionFormat:d,modelMatrix:g,extensions:_,fetch:E,operation:m},C=y&&e.id&&y[e.id],b=C&&C.updateTriggers,P=e.id||"sublayer";if(C){const O=this.props[Us],N=e.type?e.type._propTypes:{};for(const F in C){const H=N[F]||O[F];H&&H.type==="accessor"&&(C[F]=this.getSubLayerAccessor(C[F]))}}Object.assign(A,e,C),A.id=`${this.props.id}-${P}`,A.updateTriggers={all:(B=this.props.updateTriggers)==null?void 0:B.all,...e.updateTriggers,...b};for(const O of _){const N=O.getSubLayerProps.call(this,O);N&&Object.assign(A,N,{updateTriggers:Object.assign(A.updateTriggers,N.updateTriggers)})}return A}_updateAutoHighlight(e){for(const n of this.getSubLayers())n.updateAutoHighlight(e)}_getAttributeManager(){return null}_postUpdate(e,n){let s=this.internalState.subLayers;const r=!s||this.needsUpdate();if(r){const i=this.renderLayers();s=Uh(i,Boolean),this.internalState.subLayers=s}Ze(S6,this,r,s);for(const i of s)i.parent=this}};ny.layerName="CompositeLayer";let Or=ny;const Yc=Math.PI/180,OT=180/Math.PI,Ml=6370972,Ti=256;function C6(){const t=Ti/Ml,e=Math.PI/180*Ti;return{unitsPerMeter:[t,t,t],unitsPerMeter2:[0,0,0],metersPerUnit:[1/t,1/t,1/t],unitsPerDegree:[e,e,t],unitsPerDegree2:[0,0,0],degreesPerUnit:[1/e,1/e,1/t]}}class v6 extends Da{constructor(e={}){const{latitude:n=0,longitude:s=0,zoom:r=0,nearZMultiplier:i=.1,farZMultiplier:o=2,resolution:a=10}=e;let{height:c,altitude:l=1.5}=e;c=c||1,l=Math.max(.75,l);const u=new q().lookAt({eye:[0,-l,0],up:[0,0,1]}),h=Math.pow(2,r);u.rotateX(n*Yc),u.rotateZ(-s*Yc),u.scale(h/c);const f=Math.atan(.5/l),d=Ti*2*h/c;super({...e,height:c,viewMatrix:u,longitude:s,latitude:n,zoom:r,distanceScales:C6(),fovyRadians:f*2,focalDistance:l,near:i,far:Math.min(2,1/d+1)*l*o}),this.latitude=n,this.longitude=s,this.resolution=a}get projectionMode(){return ln.GLOBE}getDistanceScales(){return this.distanceScales}getBounds(e={}){const n={targetZ:e.z||0},s=this.unproject([0,this.height/2],n),r=this.unproject([this.width/2,0],n),i=this.unproject([this.width,this.height/2],n),o=this.unproject([this.width/2,this.height],n);return i[0]<this.longitude&&(i[0]+=360),s[0]>this.longitude&&(s[0]-=360),[Math.min(s[0],i[0],r[0],o[0]),Math.min(s[1],i[1],r[1],o[1]),Math.max(s[0],i[0],r[0],o[0]),Math.max(s[1],i[1],r[1],o[1])]}unproject(e,{topLeft:n=!0,targetZ:s}={}){const[r,i,o]=e,a=n?i:this.height-i,{pixelUnprojectionMatrix:c}=this;let l;if(Number.isFinite(o))l=gd(c,[r,a,o,1]);else{const d=gd(c,[r,a,-1,1]),g=gd(c,[r,a,1,1]),_=((s||0)/Ml+1)*Ti,E=Kf(Jv([],d,g)),m=Kf(d),y=Kf(g),C=4*((4*m*y-(E-m-y)**2)/16)/E,b=Math.sqrt(m-C),P=Math.sqrt(Math.max(0,_*_-C)),B=(b-P)/Math.sqrt(E);l=ZO([],d,g,B)}const[u,h,f]=this.unprojectPosition(l);return Number.isFinite(o)?[u,h,f]:Number.isFinite(s)?[u,h,s]:[u,h]}projectPosition(e){const[n,s,r=0]=e,i=n*Yc,o=s*Yc,a=Math.cos(o),c=(r/Ml+1)*Ti;return[Math.sin(i)*a*c,-Math.cos(i)*a*c,Math.sin(o)*c]}unprojectPosition(e){const[n,s,r]=e,i=qv(e),o=Math.asin(r/i),c=Math.atan2(n,-s)*OT,l=o*OT,u=(i/Ti-1)*Ml;return[c,l,u]}projectFlat(e){return e}unprojectFlat(e){return e}panByPosition(e,n){const s=this.unproject(n);return{longitude:e[0]-s[0]+this.longitude,latitude:e[1]-s[1]+this.latitude}}}function gd(t,e){const n=ao([],e,t);return Sm(n,n,1/n[3]),n}class eb{constructor(e){this.indexStarts=[0],this.vertexStarts=[0],this.vertexCount=0,this.instanceCount=0;const{attributes:n={}}=e;this.typedArrayManager=Yi,this.attributes={},this._attributeDefs=n,this.opts=e,this.updateGeometry(e)}updateGeometry(e){Object.assign(this.opts,e);const{data:n,buffers:s={},getGeometry:r,geometryBuffer:i,positionFormat:o,dataChanged:a,normalize:c=!0}=this.opts;if(this.data=n,this.getGeometry=r,this.positionSize=i&&i.size||(o==="XY"?2:3),this.buffers=s,this.normalize=c,i&&(Xe(n.startIndices),this.getGeometry=this.getGeometryFromBuffer(i),c||(s.vertexPositions=i)),this.geometryBuffer=s.vertexPositions,Array.isArray(a))for(const l of a)this._rebuildGeometry(l);else this._rebuildGeometry()}updatePartialGeometry({startRow:e,endRow:n}){this._rebuildGeometry({startRow:e,endRow:n})}getGeometryFromBuffer(e){const n=e.value||e;return ArrayBuffer.isView(n)?jw(n,{size:this.positionSize,offset:e.offset,stride:e.stride,startIndices:this.data.startIndices}):null}_allocate(e,n){const{attributes:s,buffers:r,_attributeDefs:i,typedArrayManager:o}=this;for(const a in i)if(a in r)o.release(s[a]),s[a]=null;else{const c=i[a];c.copy=n,s[a]=o.allocate(s[a],e,c)}}_forEachGeometry(e,n,s){const{data:r,getGeometry:i}=this,{iterable:o,objectInfo:a}=nc(r,n,s);for(const c of o){a.index++;const l=i?i(c,a):null;e(l,a.index)}}_rebuildGeometry(e){if(!this.data)return;let{indexStarts:n,vertexStarts:s,instanceCount:r}=this;const{data:i,geometryBuffer:o}=this,{startRow:a=0,endRow:c=1/0}=e||{},l={};if(e||(n=[0],s=[0]),this.normalize||!o)this._forEachGeometry((h,f)=>{const d=h&&this.normalizeGeometry(h);l[f]=d,s[f+1]=s[f]+(d?this.getGeometrySize(d):0)},a,c),r=s[s.length-1];else if(s=i.startIndices,r=s[i.length]||0,ArrayBuffer.isView(o))r=r||o.length/this.positionSize;else if(o instanceof Ae){const h=this.positionSize*4;r=r||o.byteLength/h}else if(o.buffer){const h=o.stride||this.positionSize*4;r=r||o.buffer.byteLength/h}else if(o.value){const h=o.value,f=o.stride/h.BYTES_PER_ELEMENT||this.positionSize;r=r||h.length/f}this._allocate(r,!!e),this.indexStarts=n,this.vertexStarts=s,this.instanceCount=r;const u={};this._forEachGeometry((h,f)=>{const d=l[f]||h;u.vertexStart=s[f],u.indexStart=n[f];const g=f<s.length-1?s[f+1]:r;u.geometrySize=g-s[f],u.geometryIndex=f,this.updateGeometryAttributes(d,u)},a,c),this.vertexCount=n[n.length-1]}}const w6=typeof window<"u"?Ee.useLayoutEffect:Ee.useEffect,b6=w6;function Pu(t,e){for(;t;){if(t===e)return!0;t=Object.getPrototypeOf(t)}return!1}const R6={position:"absolute",zIndex:-1};function tb(t,e){if(typeof t=="function")return t(e);if(Array.isArray(t))return t.map(n=>tb(n,e));if(jh(t)){if(I6(t))return e.style=R6,Ee.cloneElement(t,e);if(P6(t))return Ee.cloneElement(t,e)}return t}function jh(t){return t&&typeof t=="object"&&"type"in t||!1}function I6(t){var e;return(e=t.props)==null?void 0:e.mapStyle}function P6(t){const e=t.type;return e&&e.deckGLViewProps}function wg(t){if(typeof t=="function")return Ee.createElement(qi,{},t);if(Array.isArray(t))return t.map(wg);if(jh(t)){if(t.type===Ee.Fragment)return wg(t.props.children);if(Pu(t.type,qi))return t}return t}function x6({children:t,layers:e=[],views:n=null}){const s=[],r=[],i={};return Ee.Children.forEach(wg(t),o=>{if(jh(o)){const a=o.type;if(Pu(a,qt)){const c=M6(a,o.props);r.push(c)}else s.push(o);if(Pu(a,qi)&&a!==qi&&o.props.id){const c=new a(o.props);i[c.id]=c}}else o&&s.push(o)}),Object.keys(i).length>0&&(Array.isArray(n)?n.forEach(o=>{i[o.id]=o}):n&&(i[n.id]=n),n=Object.values(i)),e=r.length>0?[...r,...e]:e,{layers:e,children:s,views:n}}function M6(t,e){const n={},s=t.defaultProps||{};for(const r in e)s[r]!==e[r]&&(n[r]=e[r]);return new t(n)}function B6({children:t,deck:e,ContextProvider:n}){const{viewManager:s}=e||{};if(!s||!s.views.length)return[];const r={},i=s.views[0].id;for(const o of t){let a=i,c=o;jh(o)&&Pu(o.type,qi)&&(a=o.props.id||i,c=o.props.children);const l=s.getViewport(a),u=s.getViewState(a);if(l){u.padding=l.padding;const{x:h,y:f,width:d,height:g}=l;c=tb(c,{x:h,y:f,width:d,height:g,viewport:l,viewState:u}),r[a]||(r[a]={viewport:l,children:[]}),r[a].children.push(c)}}return Object.keys(r).map(o=>{const{viewport:a,children:c}=r[o],{x:l,y:u,width:h,height:f}=a,d={position:"absolute",left:l,top:u,width:h,height:f},g=`view-${o}`,_=Ee.createElement("div",{key:g,id:g,style:d},...c);if(n){const E={viewport:a,container:e.canvas.offsetParent,eventManager:e.eventManager,onViewStateChange:m=>{m.viewId=o,e._onViewStateChange(m)}};return Ee.createElement(n,{key:g,value:E},_)}return _})}const O6={mixBlendMode:null};function N6({width:t,height:e,style:n}){const s={position:"absolute",zIndex:0,left:0,top:0,width:t,height:e},r={left:0,top:0};if(n)for(const i in n)i in O6?r[i]=n[i]:s[i]=n[i];return{containerStyle:s,canvasStyle:r}}function F6(t){return{get deck(){return t.deck},pickObject:e=>t.deck.pickObject(e),pickMultipleObjects:e=>t.deck.pickMultipleObjects(e),pickObjects:e=>t.deck.pickObjects(e)}}function nb(t){t.redrawReason&&(t.deck._drawLayers(t.redrawReason),t.redrawReason=null)}function D6(t,e,n){const s=new e({...n,_customRender:r=>{t.redrawReason=r;const i=s.getViewports();t.lastRenderedViewports!==i?t.forceUpdate():nb(t)}});return s}function L6(t,e){const[n,s]=Ee.useState(0),i=Ee.useRef({control:null,version:n,forceUpdate:()=>s(b=>b+1)}).current,o=Ee.useRef(null),a=Ee.useRef(null),c=Ee.useMemo(()=>x6(t),[t.layers,t.views,t.children]);let l=!0;const u=b=>{var P;return l&&t.viewState?(i.viewStateUpdateRequested=b,null):(i.viewStateUpdateRequested=null,(P=t.onViewStateChange)==null?void 0:P.call(t,b))},h=b=>{var P;l?i.interactionStateUpdateRequested=b:(i.interactionStateUpdateRequested=null,(P=t.onInteractionStateChange)==null||P.call(t,b))},f=Ee.useMemo(()=>{const b={...t,style:null,width:"100%",height:"100%",parent:o.current,canvas:a.current,layers:c.layers,views:c.views,onViewStateChange:u,onInteractionStateChange:h};return delete b._customRender,i.deck&&i.deck.setProps(b),b},[t]);Ee.useEffect(()=>{const b=t.Deck||yg;return i.deck=D6(i,b,{...f,parent:o.current,canvas:a.current}),()=>{var P;return(P=i.deck)==null?void 0:P.finalize()}},[]),b6(()=>{nb(i);const{viewStateUpdateRequested:b,interactionStateUpdateRequested:P}=i;b&&u(b),P&&h(P)}),Ee.useImperativeHandle(e,()=>F6(i),[]);const d=i.deck&&i.deck.isInitialized?i.deck.getViewports():void 0,{ContextProvider:g,width:_="100%",height:E="100%",id:m,style:y}=t,{containerStyle:A,canvasStyle:C}=Ee.useMemo(()=>N6({width:_,height:E,style:y}),[_,E,y]);if(!i.viewStateUpdateRequested&&i.lastRenderedViewports===d||i.version!==n){i.lastRenderedViewports=d,i.version=n;const b=B6({children:c.children,deck:i.deck,ContextProvider:g}),P=Ee.createElement("canvas",{key:"canvas",id:m||"deckgl-overlay",ref:a,style:C});i.control=Ee.createElement("div",{id:`${m||"deckgl"}-wrapper`,ref:o,style:A},[P,b])}return l=!1,i.control}const U6=Ee.forwardRef(L6),k6=U6,z6=`#version 300 es
#define SHADER_NAME icon-layer-vertex-shader
in vec2 positions;
in vec3 instancePositions;
in vec3 instancePositions64Low;
in float instanceSizes;
in float instanceAngles;
in vec4 instanceColors;
in vec3 instancePickingColors;
in vec4 instanceIconFrames;
in float instanceColorModes;
in vec2 instanceOffsets;
in vec2 instancePixelOffset;
uniform float sizeScale;
uniform vec2 iconsTextureDim;
uniform float sizeMinPixels;
uniform float sizeMaxPixels;
uniform bool billboard;
uniform int sizeUnits;
out float vColorMode;
out vec4 vColor;
out vec2 vTextureCoords;
out vec2 uv;
vec2 rotate_by_angle(vec2 vertex, float angle) {
float angle_radian = angle * PI / 180.0;
float cos_angle = cos(angle_radian);
float sin_angle = sin(angle_radian);
mat2 rotationMatrix = mat2(cos_angle, -sin_angle, sin_angle, cos_angle);
return rotationMatrix * vertex;
}
void main(void) {
geometry.worldPosition = instancePositions;
geometry.uv = positions;
geometry.pickingColor = instancePickingColors;
uv = positions;
vec2 iconSize = instanceIconFrames.zw;
float sizePixels = clamp(
project_size_to_pixel(instanceSizes * sizeScale, sizeUnits),
sizeMinPixels, sizeMaxPixels
);
float instanceScale = iconSize.y == 0.0 ? 0.0 : sizePixels / iconSize.y;
vec2 pixelOffset = positions / 2.0 * iconSize + instanceOffsets;
pixelOffset = rotate_by_angle(pixelOffset, instanceAngles) * instanceScale;
pixelOffset += instancePixelOffset;
pixelOffset.y *= -1.0;
if (billboard)  {
gl_Position = project_position_to_clipspace(instancePositions, instancePositions64Low, vec3(0.0), geometry.position);
DECKGL_FILTER_GL_POSITION(gl_Position, geometry);
vec3 offset = vec3(pixelOffset, 0.0);
DECKGL_FILTER_SIZE(offset, geometry);
gl_Position.xy += project_pixel_size_to_clipspace(offset.xy);
} else {
vec3 offset_common = vec3(project_pixel_size(pixelOffset), 0.0);
DECKGL_FILTER_SIZE(offset_common, geometry);
gl_Position = project_position_to_clipspace(instancePositions, instancePositions64Low, offset_common, geometry.position);
DECKGL_FILTER_GL_POSITION(gl_Position, geometry);
}
vTextureCoords = mix(
instanceIconFrames.xy,
instanceIconFrames.xy + iconSize,
(positions.xy + 1.0) / 2.0
) / iconsTextureDim;
vColor = instanceColors;
DECKGL_FILTER_COLOR(vColor, geometry);
vColorMode = instanceColorModes;
}
`,V6=`#version 300 es
#define SHADER_NAME icon-layer-fragment-shader
precision highp float;
uniform float opacity;
uniform sampler2D iconsTexture;
uniform float alphaCutoff;
in float vColorMode;
in vec4 vColor;
in vec2 vTextureCoords;
in vec2 uv;
out vec4 fragColor;
void main(void) {
geometry.uv = uv;
vec4 texColor = texture(iconsTexture, vTextureCoords);
vec3 color = mix(texColor.rgb, vColor.rgb, vColorMode);
float a = texColor.a * opacity * vColor.a;
if (a < alphaCutoff) {
discard;
}
fragColor = vec4(color, a);
DECKGL_FILTER_COLOR(fragColor, geometry);
}
`,H6=1024,j6=4,NT=()=>{},FT={minFilter:"linear",mipmapFilter:"linear",magFilter:"linear",addressModeU:"clamp-to-edge",addressModeV:"clamp-to-edge"},W6={x:0,y:0,width:0,height:0};function G6(t){return Math.pow(2,Math.ceil(Math.log2(t)))}function X6(t,e,n,s){const r=Math.min(n/e.width,s/e.height),i=Math.floor(e.width*r),o=Math.floor(e.height*r);return r===1?{data:e,width:i,height:o}:(t.canvas.height=o,t.canvas.width=i,t.clearRect(0,0,i,o),t.drawImage(e,0,0,e.width,e.height,0,0,i,o),{data:t.canvas,width:i,height:o})}function Ua(t){return t&&(t.id||t.url)}function $6(t,e,n,s){const{width:r,height:i,device:o}=t,a=o.createTexture({format:"rgba8unorm",width:e,height:n,sampler:s}),c=o.createCommandEncoder();return c.copyTextureToTexture({source:t,destination:a,width:r,height:i}),c.finish(),t.destroy(),a}function DT(t,e,n){for(let s=0;s<e.length;s++){const{icon:r,xOffset:i}=e[s],o=Ua(r);t[o]={...r,x:i,y:n}}}function K6({icons:t,buffer:e,mapping:n={},xOffset:s=0,yOffset:r=0,rowHeight:i=0,canvasWidth:o}){let a=[];for(let c=0;c<t.length;c++){const l=t[c],u=Ua(l);if(!n[u]){const{height:h,width:f}=l;s+f+e>o&&(DT(n,a,r),s=0,r=i+r+e,i=0,a=[]),a.push({icon:l,xOffset:s}),s=s+f+e,i=Math.max(i,h)}}return a.length>0&&DT(n,a,r),{mapping:n,rowHeight:i,xOffset:s,yOffset:r,canvasWidth:o,canvasHeight:G6(i+r+e)}}function Y6(t,e,n){if(!t||!e)return null;n=n||{};const s={},{iterable:r,objectInfo:i}=nc(t);for(const o of r){i.index++;const a=e(o,i),c=Ua(a);if(!a)throw new Error("Icon is missing.");if(!a.url)throw new Error("Icon url is missing.");!s[c]&&(!n[c]||a.url!==n[c].url)&&(s[c]={...a,source:o,sourceIndex:i.index})}return s}class J6{constructor(e,{onUpdate:n=NT,onError:s=NT}){this._loadOptions=null,this._texture=null,this._externalTexture=null,this._mapping={},this._textureParameters=null,this._pendingCount=0,this._autoPacking=!1,this._xOffset=0,this._yOffset=0,this._rowHeight=0,this._buffer=j6,this._canvasWidth=H6,this._canvasHeight=0,this._canvas=null,this.device=e,this.onUpdate=n,this.onError=s}finalize(){var e;(e=this._texture)==null||e.delete()}getTexture(){return this._texture||this._externalTexture}getIconMapping(e){const n=this._autoPacking?Ua(e):e;return this._mapping[n]||W6}setProps({loadOptions:e,autoPacking:n,iconAtlas:s,iconMapping:r,textureParameters:i}){var o;e&&(this._loadOptions=e),n!==void 0&&(this._autoPacking=n),r&&(this._mapping=r),s&&((o=this._texture)==null||o.delete(),this._texture=null,this._externalTexture=s),i&&(this._textureParameters=i)}get isLoaded(){return this._pendingCount===0}packIcons(e,n){if(!this._autoPacking||typeof document>"u")return;const s=Object.values(Y6(e,n,this._mapping)||{});if(s.length>0){const{mapping:r,xOffset:i,yOffset:o,rowHeight:a,canvasHeight:c}=K6({icons:s,buffer:this._buffer,canvasWidth:this._canvasWidth,mapping:this._mapping,rowHeight:this._rowHeight,xOffset:this._xOffset,yOffset:this._yOffset});this._rowHeight=a,this._mapping=r,this._xOffset=i,this._yOffset=o,this._canvasHeight=c,this._texture||(this._texture=this.device.createTexture({format:"rgba8unorm",width:this._canvasWidth,height:this._canvasHeight,sampler:this._textureParameters||FT})),this._texture.height!==this._canvasHeight&&(this._texture=$6(this._texture,this._canvasWidth,this._canvasHeight,this._textureParameters||FT)),this.onUpdate(),this._canvas=this._canvas||document.createElement("canvas"),this._loadIcons(s)}}_loadIcons(e){const n=this._canvas.getContext("2d",{willReadFrequently:!0});for(const s of e)this._pendingCount++,os(s.url,this._loadOptions).then(r=>{const i=Ua(s),o=this._mapping[i],{x:a,y:c,width:l,height:u}=o,{data:h,width:f,height:d}=X6(n,r,l,u);this._texture.setSubImageData({data:h,x:a+(l-f)/2,y:c+(u-d)/2,width:f,height:d}),o.width=f,o.height=d,this._texture.generateMipmap(),this.onUpdate()}).catch(r=>{this.onError({url:s.url,source:s.source,sourceIndex:s.sourceIndex,loadOptions:this._loadOptions,error:r})}).finally(()=>{this._pendingCount--})}}const sb=[0,0,0,255],q6={iconAtlas:{type:"image",value:null,async:!0},iconMapping:{type:"object",value:{},async:!0},sizeScale:{type:"number",value:1,min:0},billboard:!0,sizeUnits:"pixels",sizeMinPixels:{type:"number",min:0,value:0},sizeMaxPixels:{type:"number",min:0,value:Number.MAX_SAFE_INTEGER},alphaCutoff:{type:"number",value:.05,min:0,max:1},getPosition:{type:"accessor",value:t=>t.position},getIcon:{type:"accessor",value:t=>t.icon},getColor:{type:"accessor",value:sb},getSize:{type:"accessor",value:1},getAngle:{type:"accessor",value:0},getPixelOffset:{type:"accessor",value:[0,0]},onIconError:{type:"function",value:null,optional:!0},textureParameters:{type:"object",ignore:!0,value:null}},sh=class sh extends qt{getShaders(){return super.getShaders({vs:z6,fs:V6,modules:[qs,Zs]})}initializeState(){this.state={iconManager:new J6(this.context.device,{onUpdate:this._onUpdate.bind(this),onError:this._onError.bind(this)})},this.getAttributeManager().addInstanced({instancePositions:{size:3,type:"float64",fp64:this.use64bitPositions(),transition:!0,accessor:"getPosition"},instanceSizes:{size:1,transition:!0,accessor:"getSize",defaultValue:1},instanceOffsets:{size:2,accessor:"getIcon",transform:this.getInstanceOffset},instanceIconFrames:{size:4,accessor:"getIcon",transform:this.getInstanceIconFrame},instanceColorModes:{size:1,type:"uint8",accessor:"getIcon",transform:this.getInstanceColorMode},instanceColors:{size:this.props.colorFormat.length,type:"unorm8",transition:!0,accessor:"getColor",defaultValue:sb},instanceAngles:{size:1,transition:!0,accessor:"getAngle"},instancePixelOffset:{size:2,transition:!0,accessor:"getPixelOffset"}})}updateState(e){var d;super.updateState(e);const{props:n,oldProps:s,changeFlags:r}=e,i=this.getAttributeManager(),{iconAtlas:o,iconMapping:a,data:c,getIcon:l,textureParameters:u}=n,{iconManager:h}=this.state;if(typeof o=="string")return;const f=o||this.internalState.isAsyncPropLoading("iconAtlas");h.setProps({loadOptions:n.loadOptions,autoPacking:!f,iconAtlas:o,iconMapping:f?a:null,textureParameters:u}),f?s.iconMapping!==n.iconMapping&&i.invalidate("getIcon"):(r.dataChanged||r.updateTriggersChanged&&(r.updateTriggersChanged.all||r.updateTriggersChanged.getIcon))&&h.packIcons(c,l),r.extensionsChanged&&((d=this.state.model)==null||d.destroy(),this.state.model=this._getModel(),i.invalidateAll())}get isLoaded(){return super.isLoaded&&this.state.iconManager.isLoaded}finalizeState(e){super.finalizeState(e),this.state.iconManager.finalize()}draw({uniforms:e}){const{sizeScale:n,sizeMinPixels:s,sizeMaxPixels:r,sizeUnits:i,billboard:o,alphaCutoff:a}=this.props,{iconManager:c}=this.state,l=c.getTexture();if(l){const u=this.state.model;u.setBindings({iconsTexture:l}),u.setUniforms(e),u.setUniforms({iconsTextureDim:[l.width,l.height],sizeUnits:js[i],sizeScale:n,sizeMinPixels:s,sizeMaxPixels:r,billboard:o,alphaCutoff:a}),u.draw(this.context.renderPass)}}_getModel(){const e=[-1,-1,1,-1,-1,1,1,1];return new ct(this.context.device,{...this.getShaders(),id:this.props.id,bufferLayout:this.getAttributeManager().getBufferLayouts(),geometry:new Kt({topology:"triangle-strip",attributes:{positions:{size:2,value:new Float32Array(e)}}}),isInstanced:!0})}_onUpdate(){this.setNeedsRedraw()}_onError(e){var s;const n=(s=this.getCurrentLayer())==null?void 0:s.props.onIconError;n?n(e):J.error(e.error.message)()}getInstanceOffset(e){const{width:n,height:s,anchorX:r=n/2,anchorY:i=s/2}=this.state.iconManager.getIconMapping(e);return[n/2-r,s/2-i]}getInstanceColorMode(e){return this.state.iconManager.getIconMapping(e).mask?1:0}getInstanceIconFrame(e){const{x:n,y:s,width:r,height:i}=this.state.iconManager.getIconMapping(e);return[n,s,r,i]}};sh.defaultProps=q6,sh.layerName="IconLayer";let xu=sh;const Z6=`#version 300 es
#define SHADER_NAME point-cloud-layer-vertex-shader
in vec3 positions;
in vec3 instanceNormals;
in vec4 instanceColors;
in vec3 instancePositions;
in vec3 instancePositions64Low;
in vec3 instancePickingColors;
uniform float opacity;
uniform float radiusPixels;
uniform int sizeUnits;
out vec4 vColor;
out vec2 unitPosition;
void main(void) {
geometry.worldPosition = instancePositions;
geometry.normal = project_normal(instanceNormals);
unitPosition = positions.xy;
geometry.uv = unitPosition;
geometry.pickingColor = instancePickingColors;
vec3 offset = vec3(positions.xy * project_size_to_pixel(radiusPixels, sizeUnits), 0.0);
DECKGL_FILTER_SIZE(offset, geometry);
gl_Position = project_position_to_clipspace(instancePositions, instancePositions64Low, vec3(0.), geometry.position);
DECKGL_FILTER_GL_POSITION(gl_Position, geometry);
gl_Position.xy += project_pixel_size_to_clipspace(offset.xy);
vec3 lightColor = lighting_getLightColor(instanceColors.rgb, project_uCameraPosition, geometry.position.xyz, geometry.normal);
vColor = vec4(lightColor, instanceColors.a * opacity);
DECKGL_FILTER_COLOR(vColor, geometry);
}
`,Q6=`#version 300 es
#define SHADER_NAME point-cloud-layer-fragment-shader
precision highp float;
in vec4 vColor;
in vec2 unitPosition;
out vec4 fragColor;
void main(void) {
geometry.uv = unitPosition;
float distToCenter = length(unitPosition);
if (distToCenter > 1.0) {
discard;
}
fragColor = vColor;
DECKGL_FILTER_COLOR(fragColor, geometry);
}
`,rb=[0,0,0,255],ib=[0,0,1],e8={sizeUnits:"pixels",pointSize:{type:"number",min:0,value:10},getPosition:{type:"accessor",value:t=>t.position},getNormal:{type:"accessor",value:ib},getColor:{type:"accessor",value:rb},material:!0,radiusPixels:{deprecatedFor:"pointSize"}};function t8(t){const{header:e,attributes:n}=t;if(!(!e||!n)&&(t.length=e.vertexCount,n.POSITION&&(n.instancePositions=n.POSITION),n.NORMAL&&(n.instanceNormals=n.NORMAL),n.COLOR_0)){const{size:s,value:r}=n.COLOR_0;n.instanceColors={size:s,type:"unorm8",value:r}}}const rh=class rh extends qt{getShaders(){return super.getShaders({vs:Z6,fs:Q6,modules:[qs,cw,Zs]})}initializeState(){this.getAttributeManager().addInstanced({instancePositions:{size:3,type:"float64",fp64:this.use64bitPositions(),transition:!0,accessor:"getPosition"},instanceNormals:{size:3,transition:!0,accessor:"getNormal",defaultValue:ib},instanceColors:{size:this.props.colorFormat.length,type:"unorm8",transition:!0,accessor:"getColor",defaultValue:rb}})}updateState(e){var r;const{changeFlags:n,props:s}=e;super.updateState(e),n.extensionsChanged&&((r=this.state.model)==null||r.destroy(),this.state.model=this._getModel(),this.getAttributeManager().invalidateAll()),n.dataChanged&&t8(s.data)}draw({uniforms:e}){const{pointSize:n,sizeUnits:s}=this.props,r=this.state.model;r.setUniforms(e),r.setUniforms({sizeUnits:js[s],radiusPixels:n}),r.draw(this.context.renderPass)}_getModel(){const e=[];for(let n=0;n<3;n++){const s=n/3*Math.PI*2;e.push(Math.cos(s)*2,Math.sin(s)*2,0)}return new ct(this.context.device,{...this.getShaders(),id:this.props.id,bufferLayout:this.getAttributeManager().getBufferLayouts(),geometry:new Kt({topology:"triangle-list",attributes:{positions:new Float32Array(e)}}),isInstanced:!0})}};rh.layerName="PointCloudLayer",rh.defaultProps=e8;let bg=rh;const n8=`#version 300 es
#define SHADER_NAME scatterplot-layer-vertex-shader
in vec3 positions;
in vec3 instancePositions;
in vec3 instancePositions64Low;
in float instanceRadius;
in float instanceLineWidths;
in vec4 instanceFillColors;
in vec4 instanceLineColors;
in vec3 instancePickingColors;
uniform float opacity;
uniform float radiusScale;
uniform float radiusMinPixels;
uniform float radiusMaxPixels;
uniform float lineWidthScale;
uniform float lineWidthMinPixels;
uniform float lineWidthMaxPixels;
uniform float stroked;
uniform bool filled;
uniform bool antialiasing;
uniform bool billboard;
uniform int radiusUnits;
uniform int lineWidthUnits;
out vec4 vFillColor;
out vec4 vLineColor;
out vec2 unitPosition;
out float innerUnitRadius;
out float outerRadiusPixels;
void main(void) {
geometry.worldPosition = instancePositions;
outerRadiusPixels = clamp(
project_size_to_pixel(radiusScale * instanceRadius, radiusUnits),
radiusMinPixels, radiusMaxPixels
);
float lineWidthPixels = clamp(
project_size_to_pixel(lineWidthScale * instanceLineWidths, lineWidthUnits),
lineWidthMinPixels, lineWidthMaxPixels
);
outerRadiusPixels += stroked * lineWidthPixels / 2.0;
float edgePadding = antialiasing ? (outerRadiusPixels + SMOOTH_EDGE_RADIUS) / outerRadiusPixels : 1.0;
unitPosition = edgePadding * positions.xy;
geometry.uv = unitPosition;
geometry.pickingColor = instancePickingColors;
innerUnitRadius = 1.0 - stroked * lineWidthPixels / outerRadiusPixels;
if (billboard) {
gl_Position = project_position_to_clipspace(instancePositions, instancePositions64Low, vec3(0.0), geometry.position);
DECKGL_FILTER_GL_POSITION(gl_Position, geometry);
vec3 offset = edgePadding * positions * outerRadiusPixels;
DECKGL_FILTER_SIZE(offset, geometry);
gl_Position.xy += project_pixel_size_to_clipspace(offset.xy);
} else {
vec3 offset = edgePadding * positions * project_pixel_size(outerRadiusPixels);
DECKGL_FILTER_SIZE(offset, geometry);
gl_Position = project_position_to_clipspace(instancePositions, instancePositions64Low, offset, geometry.position);
DECKGL_FILTER_GL_POSITION(gl_Position, geometry);
}
vFillColor = vec4(instanceFillColors.rgb, instanceFillColors.a * opacity);
DECKGL_FILTER_COLOR(vFillColor, geometry);
vLineColor = vec4(instanceLineColors.rgb, instanceLineColors.a * opacity);
DECKGL_FILTER_COLOR(vLineColor, geometry);
}
`,s8=`#version 300 es
#define SHADER_NAME scatterplot-layer-fragment-shader
precision highp float;
uniform bool filled;
uniform float stroked;
uniform bool antialiasing;
in vec4 vFillColor;
in vec4 vLineColor;
in vec2 unitPosition;
in float innerUnitRadius;
in float outerRadiusPixels;
out vec4 fragColor;
void main(void) {
geometry.uv = unitPosition;
float distToCenter = length(unitPosition) * outerRadiusPixels;
float inCircle = antialiasing ?
smoothedge(distToCenter, outerRadiusPixels) :
step(distToCenter, outerRadiusPixels);
if (inCircle == 0.0) {
discard;
}
if (stroked > 0.5) {
float isLine = antialiasing ?
smoothedge(innerUnitRadius * outerRadiusPixels, distToCenter) :
step(innerUnitRadius * outerRadiusPixels, distToCenter);
if (filled) {
fragColor = mix(vFillColor, vLineColor, isLine);
} else {
if (isLine == 0.0) {
discard;
}
fragColor = vec4(vLineColor.rgb, vLineColor.a * isLine);
}
} else if (!filled) {
discard;
} else {
fragColor = vFillColor;
}
fragColor.a *= inCircle;
DECKGL_FILTER_COLOR(fragColor, geometry);
}
`,LT=[0,0,0,255],r8={radiusUnits:"meters",radiusScale:{type:"number",min:0,value:1},radiusMinPixels:{type:"number",min:0,value:0},radiusMaxPixels:{type:"number",min:0,value:Number.MAX_SAFE_INTEGER},lineWidthUnits:"meters",lineWidthScale:{type:"number",min:0,value:1},lineWidthMinPixels:{type:"number",min:0,value:0},lineWidthMaxPixels:{type:"number",min:0,value:Number.MAX_SAFE_INTEGER},stroked:!1,filled:!0,billboard:!1,antialiasing:!0,getPosition:{type:"accessor",value:t=>t.position},getRadius:{type:"accessor",value:1},getFillColor:{type:"accessor",value:LT},getLineColor:{type:"accessor",value:LT},getLineWidth:{type:"accessor",value:1},strokeWidth:{deprecatedFor:"getLineWidth"},outline:{deprecatedFor:"stroked"},getColor:{deprecatedFor:["getFillColor","getLineColor"]}},ih=class ih extends qt{getShaders(){return super.getShaders({vs:n8,fs:s8,modules:[qs,Zs]})}initializeState(){this.getAttributeManager().addInstanced({instancePositions:{size:3,type:"float64",fp64:this.use64bitPositions(),transition:!0,accessor:"getPosition"},instanceRadius:{size:1,transition:!0,accessor:"getRadius",defaultValue:1},instanceFillColors:{size:this.props.colorFormat.length,transition:!0,type:"unorm8",accessor:"getFillColor",defaultValue:[0,0,0,255]},instanceLineColors:{size:this.props.colorFormat.length,transition:!0,type:"unorm8",accessor:"getLineColor",defaultValue:[0,0,0,255]},instanceLineWidths:{size:1,transition:!0,accessor:"getLineWidth",defaultValue:1}})}updateState(e){var n;super.updateState(e),e.changeFlags.extensionsChanged&&((n=this.state.model)==null||n.destroy(),this.state.model=this._getModel(),this.getAttributeManager().invalidateAll())}draw({uniforms:e}){const{radiusUnits:n,radiusScale:s,radiusMinPixels:r,radiusMaxPixels:i,stroked:o,filled:a,billboard:c,antialiasing:l,lineWidthUnits:u,lineWidthScale:h,lineWidthMinPixels:f,lineWidthMaxPixels:d}=this.props,g=this.state.model;g.setUniforms(e),g.setUniforms({stroked:o?1:0,filled:a,billboard:c,antialiasing:l,radiusUnits:js[n],radiusScale:s,radiusMinPixels:r,radiusMaxPixels:i,lineWidthUnits:js[u],lineWidthScale:h,lineWidthMinPixels:f,lineWidthMaxPixels:d}),g.draw(this.context.renderPass)}_getModel(){const e=[-1,-1,0,1,-1,0,-1,1,0,1,1,0];return new ct(this.context.device,{...this.getShaders(),id:this.props.id,bufferLayout:this.getAttributeManager().getBufferLayouts(),geometry:new Kt({topology:"triangle-strip",attributes:{positions:{size:3,value:new Float32Array(e)}}}),isInstanced:!0})}};ih.defaultProps=r8,ih.layerName="ScatterplotLayer";let Rg=ih;const ob={CLOCKWISE:1,COUNTER_CLOCKWISE:-1};function ab(t,e,n={}){return i8(t,n)!==e?(a8(t,n),!0):!1}function i8(t,e={}){return Math.sign(o8(t,e))}const UT={x:0,y:1,z:2};function o8(t,e={}){const{start:n=0,end:s=t.length,plane:r="xy"}=e,i=e.size||2;let o=0;const a=UT[r[0]],c=UT[r[1]];for(let l=n,u=s-i;l<s;l+=i)o+=(t[l+a]-t[u+a])*(t[l+c]+t[u+c]),u=l;return o/2}function a8(t,e){const{start:n=0,end:s=t.length,size:r=2}=e,i=(s-n)/r,o=Math.floor(i/2);for(let a=0;a<o;++a){const c=n+a*r,l=n+(i-1-a)*r;for(let u=0;u<r;++u){const h=t[c+u];t[c+u]=t[l+u],t[l+u]=h}}}function fn(t,e){const n=e.length,s=t.length;if(s>0){let r=!0;for(let i=0;i<n;i++)if(t[s-n+i]!==e[i]){r=!1;break}if(r)return!1}for(let r=0;r<n;r++)t[s+r]=e[r];return!0}function Ig(t,e){const n=e.length;for(let s=0;s<n;s++)t[s]=e[s]}function ka(t,e,n,s,r=[]){const i=s+e*n;for(let o=0;o<n;o++)r[o]=t[i+o];return r}function Pg(t,e,n,s,r=[]){let i,o;if(n&8)i=(s[3]-t[1])/(e[1]-t[1]),o=3;else if(n&4)i=(s[1]-t[1])/(e[1]-t[1]),o=1;else if(n&2)i=(s[2]-t[0])/(e[0]-t[0]),o=2;else if(n&1)i=(s[0]-t[0])/(e[0]-t[0]),o=0;else return null;for(let a=0;a<t.length;a++)r[a]=(o&1)===a?s[o]:i*(e[a]-t[a])+t[a];return r}function Bl(t,e){let n=0;return t[0]<e[0]?n|=1:t[0]>e[2]&&(n|=2),t[1]<e[1]?n|=4:t[1]>e[3]&&(n|=8),n}function cb(t,e){const{size:n=2,broken:s=!1,gridResolution:r=10,gridOffset:i=[0,0],startIndex:o=0,endIndex:a=t.length}=e||{},c=(a-o)/n;let l=[];const u=[l],h=ka(t,0,n,o);let f,d;const g=ub(h,r,i,[]),_=[];fn(l,h);for(let E=1;E<c;E++){for(f=ka(t,E,n,o,f),d=Bl(f,g);d;){Pg(h,f,d,g,_);const m=Bl(_,g);m&&(Pg(h,_,m,g,_),d=m),fn(l,_),Ig(h,_),l8(g,r,d),s&&l.length>n&&(l=[],u.push(l),fn(l,h)),d=Bl(f,g)}fn(l,f),Ig(h,f)}return s?u:u[0]}const kT=0,c8=1;function lb(t,e=null,n){if(!t.length)return[];const{size:s=2,gridResolution:r=10,gridOffset:i=[0,0],edgeTypes:o=!1}=n||{},a=[],c=[{pos:t,types:o?new Array(t.length/s).fill(c8):null,holes:e||[]}],l=[[],[]];let u=[];for(;c.length;){const{pos:h,types:f,holes:d}=c.shift();u8(h,s,d[0]||h.length,l),u=ub(l[0],r,i,u);const g=Bl(l[1],u);if(g){let _=zT(h,f,s,0,d[0]||h.length,u,g);const E={pos:_[0].pos,types:_[0].types,holes:[]},m={pos:_[1].pos,types:_[1].types,holes:[]};c.push(E,m);for(let y=0;y<d.length;y++)_=zT(h,f,s,d[y],d[y+1]||h.length,u,g),_[0]&&(E.holes.push(E.pos.length),E.pos=Jc(E.pos,_[0].pos),o&&(E.types=Jc(E.types,_[0].types))),_[1]&&(m.holes.push(m.pos.length),m.pos=Jc(m.pos,_[1].pos),o&&(m.types=Jc(m.types,_[1].types)))}else{const _={positions:h};o&&(_.edgeTypes=f),d.length&&(_.holeIndices=d),a.push(_)}}return a}function zT(t,e,n,s,r,i,o){const a=(r-s)/n,c=[],l=[],u=[],h=[],f=[];let d,g,_;const E=ka(t,a-1,n,s);let m=Math.sign(o&8?E[1]-i[3]:E[0]-i[2]),y=e&&e[a-1],A=0,C=0;for(let b=0;b<a;b++)d=ka(t,b,n,s,d),g=Math.sign(o&8?d[1]-i[3]:d[0]-i[2]),_=e&&e[s/n+b],g&&m&&m!==g&&(Pg(E,d,o,i,f),fn(c,f)&&u.push(y),fn(l,f)&&h.push(y)),g<=0?(fn(c,d)&&u.push(_),A-=g):u.length&&(u[u.length-1]=kT),g>=0?(fn(l,d)&&h.push(_),C+=g):h.length&&(h[h.length-1]=kT),Ig(E,d),m=g,y=_;return[A?{pos:c,types:e&&u}:null,C?{pos:l,types:e&&h}:null]}function ub(t,e,n,s){const r=Math.floor((t[0]-n[0])/e)*e+n[0],i=Math.floor((t[1]-n[1])/e)*e+n[1];return s[0]=r,s[1]=i,s[2]=r+e,s[3]=i+e,s}function l8(t,e,n){n&8?(t[1]+=e,t[3]+=e):n&4?(t[1]-=e,t[3]-=e):n&2?(t[0]+=e,t[2]+=e):n&1&&(t[0]-=e,t[2]-=e)}function u8(t,e,n,s){let r=1/0,i=-1/0,o=1/0,a=-1/0;for(let c=0;c<n;c+=e){const l=t[c],u=t[c+1];r=l<r?l:r,i=l>i?l:i,o=u<o?u:o,a=u>a?u:a}return s[0][0]=r,s[0][1]=o,s[1][0]=i,s[1][1]=a,s}function Jc(t,e){for(let n=0;n<e.length;n++)t.push(e[n]);return t}const h8=85.051129;function f8(t,e){const{size:n=2,startIndex:s=0,endIndex:r=t.length,normalize:i=!0}=e||{},o=t.slice(s,r);hb(o,n,0,r-s);const a=cb(o,{size:n,broken:!0,gridResolution:360,gridOffset:[-180,-180]});if(i)for(const c of a)fb(c,n);return a}function d8(t,e=null,n){const{size:s=2,normalize:r=!0,edgeTypes:i=!1}=n||{};e=e||[];const o=[],a=[];let c=0,l=0;for(let h=0;h<=e.length;h++){const f=e[h]||t.length,d=l,g=p8(t,s,c,f);for(let _=g;_<f;_++)o[l++]=t[_];for(let _=c;_<g;_++)o[l++]=t[_];hb(o,s,d,l),g8(o,s,d,l,n==null?void 0:n.maxLatitude),c=f,a[h]=l}a.pop();const u=lb(o,a,{size:s,gridResolution:360,gridOffset:[-180,-180],edgeTypes:i});if(r)for(const h of u)fb(h.positions,s);return u}function p8(t,e,n,s){let r=-1,i=-1;for(let o=n+1;o<s;o+=e){const a=Math.abs(t[o]);a>r&&(r=a,i=o-1)}return i}function g8(t,e,n,s,r=h8){const i=t[n],o=t[s-e];if(Math.abs(i-o)>180){const a=ka(t,0,e,n);a[0]+=Math.round((o-i)/360)*360,fn(t,a),a[1]=Math.sign(a[1])*r,fn(t,a),a[0]=i,fn(t,a)}}function hb(t,e,n,s){let r=t[0],i;for(let o=n;o<s;o+=e){i=t[o];const a=i-r;(a>180||a<-180)&&(i-=Math.round(a/360)*360),t[o]=r=i}}function fb(t,e){let n;const s=t.length/e;for(let i=0;i<s&&(n=t[i*e],(n+180)%360===0);i++);const r=-Math.round(n/360)*360;if(r!==0)for(let i=0;i<s;i++)t[i*e]+=r}function _8(t,e,n,s){let r;if(Array.isArray(t[0])){const i=t.length*e;r=new Array(i);for(let o=0;o<t.length;o++)for(let a=0;a<e;a++)r[o*e+a]=t[o][a]||0}else r=t;return n?cb(r,{size:e,gridResolution:n}):s?f8(r,{size:e}):r}const m8=1,y8=2,_d=4;class A8 extends eb{constructor(e){super({...e,attributes:{positions:{size:3,padding:18,initialize:!0,type:e.fp64?Float64Array:Float32Array},segmentTypes:{size:1,type:Uint8ClampedArray}}})}get(e){return this.attributes[e]}getGeometryFromBuffer(e){return this.normalize?super.getGeometryFromBuffer(e):null}normalizeGeometry(e){return this.normalize?_8(e,this.positionSize,this.opts.resolution,this.opts.wrapLongitude):e}getGeometrySize(e){if(VT(e)){let s=0;for(const r of e)s+=this.getGeometrySize(r);return s}const n=this.getPathLength(e);return n<2?0:this.isClosed(e)?n<3?0:n+2:n}updateGeometryAttributes(e,n){if(n.geometrySize!==0)if(e&&VT(e))for(const s of e){const r=this.getGeometrySize(s);n.geometrySize=r,this.updateGeometryAttributes(s,n),n.vertexStart+=r}else this._updateSegmentTypes(e,n),this._updatePositions(e,n)}_updateSegmentTypes(e,n){const s=this.attributes.segmentTypes,r=e?this.isClosed(e):!1,{vertexStart:i,geometrySize:o}=n;s.fill(0,i,i+o),r?(s[i]=_d,s[i+o-2]=_d):(s[i]+=m8,s[i+o-2]+=y8),s[i+o-1]=_d}_updatePositions(e,n){const{positions:s}=this.attributes;if(!s||!e)return;const{vertexStart:r,geometrySize:i}=n,o=new Array(3);for(let a=r,c=0;c<i;a++,c++)this.getPointOnPath(e,c,o),s[a*3]=o[0],s[a*3+1]=o[1],s[a*3+2]=o[2]}getPathLength(e){return e.length/this.positionSize}getPointOnPath(e,n,s=[]){const{positionSize:r}=this;n*r>=e.length&&(n+=1-e.length/r);const i=n*r;return s[0]=e[i],s[1]=e[i+1],s[2]=r===3&&e[i+2]||0,s}isClosed(e){if(!this.normalize)return!!this.opts.loop;const{positionSize:n}=this,s=e.length-n;return e[0]===e[s]&&e[1]===e[s+1]&&(n===2||e[2]===e[s+2])}}function VT(t){return Array.isArray(t[0])}const T8=`#version 300 es
#define SHADER_NAME path-layer-vertex-shader
in vec2 positions;
in float instanceTypes;
in vec3 instanceStartPositions;
in vec3 instanceEndPositions;
in vec3 instanceLeftPositions;
in vec3 instanceRightPositions;
in vec3 instanceLeftPositions64Low;
in vec3 instanceStartPositions64Low;
in vec3 instanceEndPositions64Low;
in vec3 instanceRightPositions64Low;
in float instanceStrokeWidths;
in vec4 instanceColors;
in vec3 instancePickingColors;
uniform float widthScale;
uniform float widthMinPixels;
uniform float widthMaxPixels;
uniform float jointType;
uniform float capType;
uniform float miterLimit;
uniform bool billboard;
uniform int widthUnits;
uniform float opacity;
out vec4 vColor;
out vec2 vCornerOffset;
out float vMiterLength;
out vec2 vPathPosition;
out float vPathLength;
out float vJointType;
const float EPSILON = 0.001;
const vec3 ZERO_OFFSET = vec3(0.0);
float flipIfTrue(bool flag) {
return -(float(flag) * 2. - 1.);
}
vec3 getLineJoinOffset(
vec3 prevPoint, vec3 currPoint, vec3 nextPoint,
vec2 width
) {
bool isEnd = positions.x > 0.0;
float sideOfPath = positions.y;
float isJoint = float(sideOfPath == 0.0);
vec3 deltaA3 = (currPoint - prevPoint);
vec3 deltaB3 = (nextPoint - currPoint);
mat3 rotationMatrix;
bool needsRotation = !billboard && project_needs_rotation(currPoint, rotationMatrix);
if (needsRotation) {
deltaA3 = deltaA3 * rotationMatrix;
deltaB3 = deltaB3 * rotationMatrix;
}
vec2 deltaA = deltaA3.xy / width;
vec2 deltaB = deltaB3.xy / width;
float lenA = length(deltaA);
float lenB = length(deltaB);
vec2 dirA = lenA > 0. ? normalize(deltaA) : vec2(0.0, 0.0);
vec2 dirB = lenB > 0. ? normalize(deltaB) : vec2(0.0, 0.0);
vec2 perpA = vec2(-dirA.y, dirA.x);
vec2 perpB = vec2(-dirB.y, dirB.x);
vec2 tangent = dirA + dirB;
tangent = length(tangent) > 0. ? normalize(tangent) : perpA;
vec2 miterVec = vec2(-tangent.y, tangent.x);
vec2 dir = isEnd ? dirA : dirB;
vec2 perp = isEnd ? perpA : perpB;
float L = isEnd ? lenA : lenB;
float sinHalfA = abs(dot(miterVec, perp));
float cosHalfA = abs(dot(dirA, miterVec));
float turnDirection = flipIfTrue(dirA.x * dirB.y >= dirA.y * dirB.x);
float cornerPosition = sideOfPath * turnDirection;
float miterSize = 1.0 / max(sinHalfA, EPSILON);
miterSize = mix(
min(miterSize, max(lenA, lenB) / max(cosHalfA, EPSILON)),
miterSize,
step(0.0, cornerPosition)
);
vec2 offsetVec = mix(miterVec * miterSize, perp, step(0.5, cornerPosition))
* (sideOfPath + isJoint * turnDirection);
bool isStartCap = lenA == 0.0 || (!isEnd && (instanceTypes == 1.0 || instanceTypes == 3.0));
bool isEndCap = lenB == 0.0 || (isEnd && (instanceTypes == 2.0 || instanceTypes == 3.0));
bool isCap = isStartCap || isEndCap;
if (isCap) {
offsetVec = mix(perp * sideOfPath, dir * capType * 4.0 * flipIfTrue(isStartCap), isJoint);
vJointType = capType;
} else {
vJointType = jointType;
}
vPathLength = L;
vCornerOffset = offsetVec;
vMiterLength = dot(vCornerOffset, miterVec * turnDirection);
vMiterLength = isCap ? isJoint : vMiterLength;
vec2 offsetFromStartOfPath = vCornerOffset + deltaA * float(isEnd);
vPathPosition = vec2(
dot(offsetFromStartOfPath, perp),
dot(offsetFromStartOfPath, dir)
);
geometry.uv = vPathPosition;
float isValid = step(instanceTypes, 3.5);
vec3 offset = vec3(offsetVec * width * isValid, 0.0);
if (needsRotation) {
offset = rotationMatrix * offset;
}
return offset;
}
void clipLine(inout vec4 position, vec4 refPosition) {
if (position.w < EPSILON) {
float r = (EPSILON - refPosition.w) / (position.w - refPosition.w);
position = refPosition + (position - refPosition) * r;
}
}
void main() {
geometry.pickingColor = instancePickingColors;
vColor = vec4(instanceColors.rgb, instanceColors.a * opacity);
float isEnd = positions.x;
vec3 prevPosition = mix(instanceLeftPositions, instanceStartPositions, isEnd);
vec3 prevPosition64Low = mix(instanceLeftPositions64Low, instanceStartPositions64Low, isEnd);
vec3 currPosition = mix(instanceStartPositions, instanceEndPositions, isEnd);
vec3 currPosition64Low = mix(instanceStartPositions64Low, instanceEndPositions64Low, isEnd);
vec3 nextPosition = mix(instanceEndPositions, instanceRightPositions, isEnd);
vec3 nextPosition64Low = mix(instanceEndPositions64Low, instanceRightPositions64Low, isEnd);
geometry.worldPosition = currPosition;
vec2 widthPixels = vec2(clamp(
project_size_to_pixel(instanceStrokeWidths * widthScale, widthUnits),
widthMinPixels, widthMaxPixels) / 2.0);
vec3 width;
if (billboard) {
vec4 prevPositionScreen = project_position_to_clipspace(prevPosition, prevPosition64Low, ZERO_OFFSET);
vec4 currPositionScreen = project_position_to_clipspace(currPosition, currPosition64Low, ZERO_OFFSET, geometry.position);
vec4 nextPositionScreen = project_position_to_clipspace(nextPosition, nextPosition64Low, ZERO_OFFSET);
clipLine(prevPositionScreen, currPositionScreen);
clipLine(nextPositionScreen, currPositionScreen);
clipLine(currPositionScreen, mix(nextPositionScreen, prevPositionScreen, isEnd));
width = vec3(widthPixels, 0.0);
DECKGL_FILTER_SIZE(width, geometry);
vec3 offset = getLineJoinOffset(
prevPositionScreen.xyz / prevPositionScreen.w,
currPositionScreen.xyz / currPositionScreen.w,
nextPositionScreen.xyz / nextPositionScreen.w,
project_pixel_size_to_clipspace(width.xy)
);
DECKGL_FILTER_GL_POSITION(currPositionScreen, geometry);
gl_Position = vec4(currPositionScreen.xyz + offset * currPositionScreen.w, currPositionScreen.w);
} else {
prevPosition = project_position(prevPosition, prevPosition64Low);
currPosition = project_position(currPosition, currPosition64Low);
nextPosition = project_position(nextPosition, nextPosition64Low);
width = vec3(project_pixel_size(widthPixels), 0.0);
DECKGL_FILTER_SIZE(width, geometry);
vec3 offset = getLineJoinOffset(prevPosition, currPosition, nextPosition, width.xy);
geometry.position = vec4(currPosition + offset, 1.0);
gl_Position = project_common_position_to_clipspace(geometry.position);
DECKGL_FILTER_GL_POSITION(gl_Position, geometry);
}
DECKGL_FILTER_COLOR(vColor, geometry);
}
`,E8=`#version 300 es
#define SHADER_NAME path-layer-fragment-shader
precision highp float;
uniform float miterLimit;
in vec4 vColor;
in vec2 vCornerOffset;
in float vMiterLength;
in vec2 vPathPosition;
in float vPathLength;
in float vJointType;
out vec4 fragColor;
void main(void) {
geometry.uv = vPathPosition;
if (vPathPosition.y < 0.0 || vPathPosition.y > vPathLength) {
if (vJointType > 0.5 && length(vCornerOffset) > 1.0) {
discard;
}
if (vJointType < 0.5 && vMiterLength > miterLimit + 1.0) {
discard;
}
}
fragColor = vColor;
DECKGL_FILTER_COLOR(fragColor, geometry);
}
`,db=[0,0,0,255],S8={widthUnits:"meters",widthScale:{type:"number",min:0,value:1},widthMinPixels:{type:"number",min:0,value:0},widthMaxPixels:{type:"number",min:0,value:Number.MAX_SAFE_INTEGER},jointRounded:!1,capRounded:!1,miterLimit:{type:"number",min:0,value:4},billboard:!1,_pathType:null,getPath:{type:"accessor",value:t=>t.path},getColor:{type:"accessor",value:db},getWidth:{type:"accessor",value:1},rounded:{deprecatedFor:["jointRounded","capRounded"]}},md={enter:(t,e)=>e.length?e.subarray(e.length-t.length):t},oh=class oh extends qt{getShaders(){return super.getShaders({vs:T8,fs:E8,modules:[qs,Zs]})}get wrapLongitude(){return!1}getBounds(){var e;return(e=this.getAttributeManager())==null?void 0:e.getBounds(["vertexPositions"])}initializeState(){this.getAttributeManager().addInstanced({vertexPositions:{size:3,vertexOffset:1,type:"float64",fp64:this.use64bitPositions(),transition:md,accessor:"getPath",update:this.calculatePositions,noAlloc:!0,shaderAttributes:{instanceLeftPositions:{vertexOffset:0},instanceStartPositions:{vertexOffset:1},instanceEndPositions:{vertexOffset:2},instanceRightPositions:{vertexOffset:3}}},instanceTypes:{size:1,type:"uint8",update:this.calculateSegmentTypes,noAlloc:!0},instanceStrokeWidths:{size:1,accessor:"getWidth",transition:md,defaultValue:1},instanceColors:{size:this.props.colorFormat.length,type:"unorm8",accessor:"getColor",transition:md,defaultValue:db},instancePickingColors:{size:4,type:"uint8",accessor:(s,{index:r,target:i})=>this.encodePickingColor(s&&s.__source?s.__source.index:r,i)}}),this.setState({pathTesselator:new A8({fp64:this.use64bitPositions()})})}updateState(e){var o;super.updateState(e);const{props:n,changeFlags:s}=e,r=this.getAttributeManager();if(s.dataChanged||s.updateTriggersChanged&&(s.updateTriggersChanged.all||s.updateTriggersChanged.getPath)){const{pathTesselator:a}=this.state,c=n.data.attributes||{};a.updateGeometry({data:n.data,geometryBuffer:c.getPath,buffers:c,normalize:!n._pathType,loop:n._pathType==="loop",getGeometry:n.getPath,positionFormat:n.positionFormat,wrapLongitude:n.wrapLongitude,resolution:this.context.viewport.resolution,dataChanged:s.dataChanged}),this.setState({numInstances:a.instanceCount,startIndices:a.vertexStarts}),s.dataChanged||r.invalidateAll()}s.extensionsChanged&&((o=this.state.model)==null||o.destroy(),this.state.model=this._getModel(),r.invalidateAll())}getPickingInfo(e){const n=super.getPickingInfo(e),{index:s}=n,r=this.props.data;return r[0]&&r[0].__source&&(n.object=r.find(i=>i.__source.index===s)),n}disablePickingIndex(e){const n=this.props.data;if(n[0]&&n[0].__source)for(let s=0;s<n.length;s++)n[s].__source.index===e&&this._disablePickingIndex(s);else super.disablePickingIndex(e)}draw({uniforms:e}){const{jointRounded:n,capRounded:s,billboard:r,miterLimit:i,widthUnits:o,widthScale:a,widthMinPixels:c,widthMaxPixels:l}=this.props,u=this.state.model;u.setUniforms(e),u.setUniforms({jointType:Number(n),capType:Number(s),billboard:r,widthUnits:js[o],widthScale:a,miterLimit:i,widthMinPixels:c,widthMaxPixels:l}),u.draw(this.context.renderPass)}_getModel(){const e=[0,1,2,1,4,2,1,3,4,3,5,4],n=[0,0,0,-1,0,1,1,-1,1,1,1,0];return new ct(this.context.device,{...this.getShaders(),id:this.props.id,bufferLayout:this.getAttributeManager().getBufferLayouts(),geometry:new Kt({topology:"triangle-list",attributes:{indices:new Uint16Array(e),positions:{value:new Float32Array(n),size:2}}}),isInstanced:!0})}calculatePositions(e){const{pathTesselator:n}=this.state;e.startIndices=n.vertexStarts,e.value=n.get("positions")}calculateSegmentTypes(e){const{pathTesselator:n}=this.state;e.startIndices=n.vertexStarts,e.value=n.get("segmentTypes")}};oh.defaultProps=S8,oh.layerName="PathLayer";let xg=oh;var Fm={exports:{}};Fm.exports=Wh;Fm.exports.default=Wh;function Wh(t,e,n){n=n||2;var s=e&&e.length,r=s?e[0]*n:t.length,i=pb(t,0,r,n,!0),o=[];if(!i||i.next===i.prev)return o;var a,c,l,u,h,f,d;if(s&&(i=R8(t,e,i,n)),t.length>80*n){a=l=t[0],c=u=t[1];for(var g=n;g<r;g+=n)h=t[g],f=t[g+1],h<a&&(a=h),f<c&&(c=f),h>l&&(l=h),f>u&&(u=f);d=Math.max(l-a,u-c),d=d!==0?32767/d:0}return za(i,o,n,a,c,d,0),o}function pb(t,e,n,s,r){var i,o;if(r===Og(t,e,n,s)>0)for(i=e;i<n;i+=s)o=HT(i,t[i],t[i+1],o);else for(i=n-s;i>=e;i-=s)o=HT(i,t[i],t[i+1],o);return o&&Gh(o,o.next)&&(Ha(o),o=o.next),o}function Nr(t,e){if(!t)return t;e||(e=t);var n=t,s;do if(s=!1,!n.steiner&&(Gh(n,n.next)||Ce(n.prev,n,n.next)===0)){if(Ha(n),n=e=n.prev,n===n.next)break;s=!0}else n=n.next;while(s||n!==e);return e}function za(t,e,n,s,r,i,o){if(t){!o&&i&&B8(t,s,r,i);for(var a=t,c,l;t.prev!==t.next;){if(c=t.prev,l=t.next,i?v8(t,s,r,i):C8(t)){e.push(c.i/n|0),e.push(t.i/n|0),e.push(l.i/n|0),Ha(t),t=l.next,a=l.next;continue}if(t=l,t===a){o?o===1?(t=w8(Nr(t),e,n),za(t,e,n,s,r,i,2)):o===2&&b8(t,e,n,s,r,i):za(Nr(t),e,n,s,r,i,1);break}}}}function C8(t){var e=t.prev,n=t,s=t.next;if(Ce(e,n,s)>=0)return!1;for(var r=e.x,i=n.x,o=s.x,a=e.y,c=n.y,l=s.y,u=r<i?r<o?r:o:i<o?i:o,h=a<c?a<l?a:l:c<l?c:l,f=r>i?r>o?r:o:i>o?i:o,d=a>c?a>l?a:l:c>l?c:l,g=s.next;g!==e;){if(g.x>=u&&g.x<=f&&g.y>=h&&g.y<=d&&Ei(r,a,i,c,o,l,g.x,g.y)&&Ce(g.prev,g,g.next)>=0)return!1;g=g.next}return!0}function v8(t,e,n,s){var r=t.prev,i=t,o=t.next;if(Ce(r,i,o)>=0)return!1;for(var a=r.x,c=i.x,l=o.x,u=r.y,h=i.y,f=o.y,d=a<c?a<l?a:l:c<l?c:l,g=u<h?u<f?u:f:h<f?h:f,_=a>c?a>l?a:l:c>l?c:l,E=u>h?u>f?u:f:h>f?h:f,m=Mg(d,g,e,n,s),y=Mg(_,E,e,n,s),A=t.prevZ,C=t.nextZ;A&&A.z>=m&&C&&C.z<=y;){if(A.x>=d&&A.x<=_&&A.y>=g&&A.y<=E&&A!==r&&A!==o&&Ei(a,u,c,h,l,f,A.x,A.y)&&Ce(A.prev,A,A.next)>=0||(A=A.prevZ,C.x>=d&&C.x<=_&&C.y>=g&&C.y<=E&&C!==r&&C!==o&&Ei(a,u,c,h,l,f,C.x,C.y)&&Ce(C.prev,C,C.next)>=0))return!1;C=C.nextZ}for(;A&&A.z>=m;){if(A.x>=d&&A.x<=_&&A.y>=g&&A.y<=E&&A!==r&&A!==o&&Ei(a,u,c,h,l,f,A.x,A.y)&&Ce(A.prev,A,A.next)>=0)return!1;A=A.prevZ}for(;C&&C.z<=y;){if(C.x>=d&&C.x<=_&&C.y>=g&&C.y<=E&&C!==r&&C!==o&&Ei(a,u,c,h,l,f,C.x,C.y)&&Ce(C.prev,C,C.next)>=0)return!1;C=C.nextZ}return!0}function w8(t,e,n){var s=t;do{var r=s.prev,i=s.next.next;!Gh(r,i)&&gb(r,s,s.next,i)&&Va(r,i)&&Va(i,r)&&(e.push(r.i/n|0),e.push(s.i/n|0),e.push(i.i/n|0),Ha(s),Ha(s.next),s=t=i),s=s.next}while(s!==t);return Nr(s)}function b8(t,e,n,s,r,i){var o=t;do{for(var a=o.next.next;a!==o.prev;){if(o.i!==a.i&&F8(o,a)){var c=_b(o,a);o=Nr(o,o.next),c=Nr(c,c.next),za(o,e,n,s,r,i,0),za(c,e,n,s,r,i,0);return}a=a.next}o=o.next}while(o!==t)}function R8(t,e,n,s){var r=[],i,o,a,c,l;for(i=0,o=e.length;i<o;i++)a=e[i]*s,c=i<o-1?e[i+1]*s:t.length,l=pb(t,a,c,s,!1),l===l.next&&(l.steiner=!0),r.push(N8(l));for(r.sort(I8),i=0;i<r.length;i++)n=P8(r[i],n);return n}function I8(t,e){return t.x-e.x}function P8(t,e){var n=x8(t,e);if(!n)return e;var s=_b(n,t);return Nr(s,s.next),Nr(n,n.next)}function x8(t,e){var n=e,s=t.x,r=t.y,i=-1/0,o;do{if(r<=n.y&&r>=n.next.y&&n.next.y!==n.y){var a=n.x+(r-n.y)*(n.next.x-n.x)/(n.next.y-n.y);if(a<=s&&a>i&&(i=a,o=n.x<n.next.x?n:n.next,a===s))return o}n=n.next}while(n!==e);if(!o)return null;var c=o,l=o.x,u=o.y,h=1/0,f;n=o;do s>=n.x&&n.x>=l&&s!==n.x&&Ei(r<u?s:i,r,l,u,r<u?i:s,r,n.x,n.y)&&(f=Math.abs(r-n.y)/(s-n.x),Va(n,t)&&(f<h||f===h&&(n.x>o.x||n.x===o.x&&M8(o,n)))&&(o=n,h=f)),n=n.next;while(n!==c);return o}function M8(t,e){return Ce(t.prev,t,e.prev)<0&&Ce(e.next,t,t.next)<0}function B8(t,e,n,s){var r=t;do r.z===0&&(r.z=Mg(r.x,r.y,e,n,s)),r.prevZ=r.prev,r.nextZ=r.next,r=r.next;while(r!==t);r.prevZ.nextZ=null,r.prevZ=null,O8(r)}function O8(t){var e,n,s,r,i,o,a,c,l=1;do{for(n=t,t=null,i=null,o=0;n;){for(o++,s=n,a=0,e=0;e<l&&(a++,s=s.nextZ,!!s);e++);for(c=l;a>0||c>0&&s;)a!==0&&(c===0||!s||n.z<=s.z)?(r=n,n=n.nextZ,a--):(r=s,s=s.nextZ,c--),i?i.nextZ=r:t=r,r.prevZ=i,i=r;n=s}i.nextZ=null,l*=2}while(o>1);return t}function Mg(t,e,n,s,r){return t=(t-n)*r|0,e=(e-s)*r|0,t=(t|t<<8)&16711935,t=(t|t<<4)&252645135,t=(t|t<<2)&858993459,t=(t|t<<1)&1431655765,e=(e|e<<8)&16711935,e=(e|e<<4)&252645135,e=(e|e<<2)&858993459,e=(e|e<<1)&1431655765,t|e<<1}function N8(t){var e=t,n=t;do(e.x<n.x||e.x===n.x&&e.y<n.y)&&(n=e),e=e.next;while(e!==t);return n}function Ei(t,e,n,s,r,i,o,a){return(r-o)*(e-a)>=(t-o)*(i-a)&&(t-o)*(s-a)>=(n-o)*(e-a)&&(n-o)*(i-a)>=(r-o)*(s-a)}function F8(t,e){return t.next.i!==e.i&&t.prev.i!==e.i&&!D8(t,e)&&(Va(t,e)&&Va(e,t)&&L8(t,e)&&(Ce(t.prev,t,e.prev)||Ce(t,e.prev,e))||Gh(t,e)&&Ce(t.prev,t,t.next)>0&&Ce(e.prev,e,e.next)>0)}function Ce(t,e,n){return(e.y-t.y)*(n.x-e.x)-(e.x-t.x)*(n.y-e.y)}function Gh(t,e){return t.x===e.x&&t.y===e.y}function gb(t,e,n,s){var r=Zc(Ce(t,e,n)),i=Zc(Ce(t,e,s)),o=Zc(Ce(n,s,t)),a=Zc(Ce(n,s,e));return!!(r!==i&&o!==a||r===0&&qc(t,n,e)||i===0&&qc(t,s,e)||o===0&&qc(n,t,s)||a===0&&qc(n,e,s))}function qc(t,e,n){return e.x<=Math.max(t.x,n.x)&&e.x>=Math.min(t.x,n.x)&&e.y<=Math.max(t.y,n.y)&&e.y>=Math.min(t.y,n.y)}function Zc(t){return t>0?1:t<0?-1:0}function D8(t,e){var n=t;do{if(n.i!==t.i&&n.next.i!==t.i&&n.i!==e.i&&n.next.i!==e.i&&gb(n,n.next,t,e))return!0;n=n.next}while(n!==t);return!1}function Va(t,e){return Ce(t.prev,t,t.next)<0?Ce(t,e,t.next)>=0&&Ce(t,t.prev,e)>=0:Ce(t,e,t.prev)<0||Ce(t,t.next,e)<0}function L8(t,e){var n=t,s=!1,r=(t.x+e.x)/2,i=(t.y+e.y)/2;do n.y>i!=n.next.y>i&&n.next.y!==n.y&&r<(n.next.x-n.x)*(i-n.y)/(n.next.y-n.y)+n.x&&(s=!s),n=n.next;while(n!==t);return s}function _b(t,e){var n=new Bg(t.i,t.x,t.y),s=new Bg(e.i,e.x,e.y),r=t.next,i=e.prev;return t.next=e,e.prev=t,n.next=r,r.prev=n,s.next=n,n.prev=s,i.next=s,s.prev=i,s}function HT(t,e,n,s){var r=new Bg(t,e,n);return s?(r.next=s.next,r.prev=s,s.next.prev=r,s.next=r):(r.prev=r,r.next=r),r}function Ha(t){t.next.prev=t.prev,t.prev.next=t.next,t.prevZ&&(t.prevZ.nextZ=t.nextZ),t.nextZ&&(t.nextZ.prevZ=t.prevZ)}function Bg(t,e,n){this.i=t,this.x=e,this.y=n,this.prev=null,this.next=null,this.z=0,this.prevZ=null,this.nextZ=null,this.steiner=!1}Wh.deviation=function(t,e,n,s){var r=e&&e.length,i=r?e[0]*n:t.length,o=Math.abs(Og(t,0,i,n));if(r)for(var a=0,c=e.length;a<c;a++){var l=e[a]*n,u=a<c-1?e[a+1]*n:t.length;o-=Math.abs(Og(t,l,u,n))}var h=0;for(a=0;a<s.length;a+=3){var f=s[a]*n,d=s[a+1]*n,g=s[a+2]*n;h+=Math.abs((t[f]-t[g])*(t[d+1]-t[f+1])-(t[f]-t[d])*(t[g+1]-t[f+1]))}return o===0&&h===0?0:Math.abs((h-o)/o)};function Og(t,e,n,s){for(var r=0,i=e,o=n-s;i<n;i+=s)r+=(t[o]-t[i])*(t[i+1]+t[o+1]),o=i;return r}Wh.flatten=function(t){for(var e=t[0][0].length,n={vertices:[],holes:[],dimensions:e},s=0,r=0;r<t.length;r++){for(var i=0;i<t[r].length;i++)for(var o=0;o<e;o++)n.vertices.push(t[r][i][o]);r>0&&(s+=t[r-1].length,n.holes.push(s))}return n};var U8=Fm.exports;const k8=i_(U8),Qc=ob.CLOCKWISE,jT=ob.COUNTER_CLOCKWISE,Ps={isClosed:!0};function z8(t){if(t=t&&t.positions||t,!Array.isArray(t)&&!ArrayBuffer.isView(t))throw new Error("invalid polygon")}function $o(t){return"positions"in t?t.positions:t}function Ol(t){return"holeIndices"in t?t.holeIndices:null}function V8(t){return Array.isArray(t[0])}function H8(t){return t.length>=1&&t[0].length>=2&&Number.isFinite(t[0][0])}function j8(t){const e=t[0],n=t[t.length-1];return e[0]===n[0]&&e[1]===n[1]&&e[2]===n[2]}function W8(t,e,n,s){for(let r=0;r<e;r++)if(t[n+r]!==t[s-e+r])return!1;return!0}function WT(t,e,n,s,r){let i=e;const o=n.length;for(let a=0;a<o;a++)for(let c=0;c<s;c++)t[i++]=n[a][c]||0;if(!j8(n))for(let a=0;a<s;a++)t[i++]=n[0][a]||0;return Ps.start=e,Ps.end=i,Ps.size=s,ab(t,r,Ps),i}function GT(t,e,n,s,r=0,i,o){i=i||n.length;const a=i-r;if(a<=0)return e;let c=e;for(let l=0;l<a;l++)t[c++]=n[r+l];if(!W8(n,s,r,i))for(let l=0;l<s;l++)t[c++]=n[r+l];return Ps.start=e,Ps.end=c,Ps.size=s,ab(t,o,Ps),c}function G8(t,e){z8(t);const n=[],s=[];if("positions"in t){const{positions:r,holeIndices:i}=t;if(i){let o=0;for(let a=0;a<=i.length;a++)o=GT(n,o,r,e,i[a-1],i[a],a===0?Qc:jT),s.push(o);return s.pop(),{positions:n,holeIndices:s}}t=r}if(!V8(t))return GT(n,0,t,e,0,n.length,Qc),n;if(!H8(t)){let r=0;for(const[i,o]of t.entries())r=WT(n,r,o,e,i===0?Qc:jT),s.push(r);return s.pop(),{positions:n,holeIndices:s}}return WT(n,0,t,e,Qc),n}function yd(t,e,n){const s=t.length/3;let r=0;for(let i=0;i<s;i++){const o=(i+1)%s;r+=t[i*3+e]*t[o*3+n],r-=t[o*3+e]*t[i*3+n]}return Math.abs(r/2)}function XT(t,e,n,s){const r=t.length/3;for(let i=0;i<r;i++){const o=i*3,a=t[o+0],c=t[o+1],l=t[o+2];t[o+e]=a,t[o+n]=c,t[o+s]=l}}function X8(t,e,n,s){let r=Ol(t);r&&(r=r.map(a=>a/e));let i=$o(t);const o=s&&e===3;if(n){const a=i.length;i=i.slice();const c=[];for(let l=0;l<a;l+=e){c[0]=i[l],c[1]=i[l+1],o&&(c[2]=i[l+2]);const u=n(c);i[l]=u[0],i[l+1]=u[1],o&&(i[l+2]=u[2])}}if(o){const a=yd(i,0,1),c=yd(i,0,2),l=yd(i,1,2);if(!a&&!c&&!l)return[];a>c&&a>l||(c>l?(n||(i=i.slice()),XT(i,0,2,1)):(n||(i=i.slice()),XT(i,2,0,1)))}return k8(i,r,e)}class $8 extends eb{constructor(e){const{fp64:n,IndexType:s=Uint32Array}=e;super({...e,attributes:{positions:{size:3,type:n?Float64Array:Float32Array},vertexValid:{type:Uint16Array,size:1},indices:{type:s,size:1}}})}get(e){const{attributes:n}=this;return e==="indices"?n.indices&&n.indices.subarray(0,this.vertexCount):n[e]}updateGeometry(e){super.updateGeometry(e);const n=this.buffers.indices;if(n)this.vertexCount=(n.value||n).length;else if(this.data&&!this.getGeometry)throw new Error("missing indices buffer")}normalizeGeometry(e){if(this.normalize){const n=G8(e,this.positionSize);return this.opts.resolution?lb($o(n),Ol(n),{size:this.positionSize,gridResolution:this.opts.resolution,edgeTypes:!0}):this.opts.wrapLongitude?d8($o(n),Ol(n),{size:this.positionSize,maxLatitude:86,edgeTypes:!0}):n}return e}getGeometrySize(e){if($T(e)){let n=0;for(const s of e)n+=this.getGeometrySize(s);return n}return $o(e).length/this.positionSize}getGeometryFromBuffer(e){return this.normalize||!this.buffers.indices?super.getGeometryFromBuffer(e):null}updateGeometryAttributes(e,n){if(e&&$T(e))for(const s of e){const r=this.getGeometrySize(s);n.geometrySize=r,this.updateGeometryAttributes(s,n),n.vertexStart+=r,n.indexStart=this.indexStarts[n.geometryIndex+1]}else{const s=e;this._updateIndices(s,n),this._updatePositions(s,n),this._updateVertexValid(s,n)}}_updateIndices(e,{geometryIndex:n,vertexStart:s,indexStart:r}){const{attributes:i,indexStarts:o,typedArrayManager:a}=this;let c=i.indices;if(!c||!e)return;let l=r;const u=X8(e,this.positionSize,this.opts.preproject,this.opts.full3d);c=a.allocate(c,r+u.length,{copy:!0});for(let h=0;h<u.length;h++)c[l++]=u[h]+s;o[n+1]=r+u.length,i.indices=c}_updatePositions(e,{vertexStart:n,geometrySize:s}){const{attributes:{positions:r},positionSize:i}=this;if(!r||!e)return;const o=$o(e);for(let a=n,c=0;c<s;a++,c++){const l=o[c*i],u=o[c*i+1],h=i>2?o[c*i+2]:0;r[a*3]=l,r[a*3+1]=u,r[a*3+2]=h}}_updateVertexValid(e,{vertexStart:n,geometrySize:s}){const{positionSize:r}=this,i=this.attributes.vertexValid,o=e&&Ol(e);if(e&&e.edgeTypes?i.set(e.edgeTypes,n):i.fill(1,n,n+s),o)for(let a=0;a<o.length;a++)i[n+o[a]/r-1]=0;i[n+s-1]=0}}function $T(t){return Array.isArray(t)&&t.length>0&&!Number.isFinite(t[0])}const mb=`uniform bool extruded;
uniform bool isWireframe;
uniform float elevationScale;
uniform float opacity;
out vec4 vColor;
struct PolygonProps {
vec4 fillColors;
vec4 lineColors;
vec3 positions;
vec3 positions64Low;
vec3 pickingColors;
vec3 normal;
float elevations;
};
vec3 project_offset_normal(vec3 vector) {
if (project_uCoordinateSystem == COORDINATE_SYSTEM_LNGLAT ||
project_uCoordinateSystem == COORDINATE_SYSTEM_LNGLAT_OFFSETS) {
return normalize(vector * project_uCommonUnitsPerWorldUnit);
}
return project_normal(vector);
}
void calculatePosition(PolygonProps props) {
vec3 pos = props.positions;
vec3 pos64Low = props.positions64Low;
vec3 normal = props.normal;
vec4 colors = isWireframe ? props.lineColors : props.fillColors;
geometry.worldPosition = props.positions;
geometry.pickingColor = props.pickingColors;
if (extruded) {
pos.z += props.elevations * elevationScale;
}
gl_Position = project_position_to_clipspace(pos, pos64Low, vec3(0.), geometry.position);
DECKGL_FILTER_GL_POSITION(gl_Position, geometry);
if (extruded) {
#ifdef IS_SIDE_VERTEX
normal = project_offset_normal(normal);
#else
normal = project_normal(normal);
#endif
geometry.normal = normal;
vec3 lightColor = lighting_getLightColor(colors.rgb, project_uCameraPosition, geometry.position.xyz, geometry.normal);
vColor = vec4(lightColor, colors.a * opacity);
} else {
vColor = vec4(colors.rgb, colors.a * opacity);
}
DECKGL_FILTER_COLOR(vColor, geometry);
}
`,K8=`#version 300 es
#define SHADER_NAME solid-polygon-layer-vertex-shader
in vec3 vertexPositions;
in vec3 vertexPositions64Low;
in float elevations;
in vec4 fillColors;
in vec4 lineColors;
in vec3 pickingColors;
${mb}
void main(void) {
PolygonProps props;
props.positions = vertexPositions;
props.positions64Low = vertexPositions64Low;
props.elevations = elevations;
props.fillColors = fillColors;
props.lineColors = lineColors;
props.pickingColors = pickingColors;
props.normal = vec3(0.0, 0.0, 1.0);
calculatePosition(props);
}
`,Y8=`#version 300 es
#define SHADER_NAME solid-polygon-layer-vertex-shader-side
#define IS_SIDE_VERTEX
in vec2 positions;
in vec3 instancePositions;
in vec3 instanceNextPositions;
in vec3 instancePositions64Low;
in vec3 instanceNextPositions64Low;
in float instanceElevations;
in vec4 instanceFillColors;
in vec4 instanceLineColors;
in vec3 instancePickingColors;
in float instanceVertexValid;
${mb}
void main(void) {
if(instanceVertexValid < 0.5){
gl_Position = vec4(0.);
return;
}
PolygonProps props;
vec3 pos;
vec3 pos64Low;
vec3 nextPos;
vec3 nextPos64Low;
#if RING_WINDING_ORDER_CW == 1
pos = instancePositions;
pos64Low = instancePositions64Low;
nextPos = instanceNextPositions;
nextPos64Low = instanceNextPositions64Low;
#else
pos = instanceNextPositions;
pos64Low = instanceNextPositions64Low;
nextPos = instancePositions;
nextPos64Low = instancePositions64Low;
#endif
props.positions = mix(pos, nextPos, positions.x);
props.positions64Low = mix(pos64Low, nextPos64Low, positions.x);
props.normal = vec3(
pos.y - nextPos.y + (pos64Low.y - nextPos64Low.y),
nextPos.x - pos.x + (nextPos64Low.x - pos64Low.x),
0.0);
props.elevations = instanceElevations * positions.y;
props.fillColors = instanceFillColors;
props.lineColors = instanceLineColors;
props.pickingColors = instancePickingColors;
calculatePosition(props);
}
`,J8=`#version 300 es
#define SHADER_NAME solid-polygon-layer-fragment-shader
precision highp float;
in vec4 vColor;
out vec4 fragColor;
void main(void) {
fragColor = vColor;
DECKGL_FILTER_COLOR(fragColor, geometry);
}
`,Mu=[0,0,0,255],q8={filled:!0,extruded:!1,wireframe:!1,_normalize:!0,_windingOrder:"CW",_full3d:!1,elevationScale:{type:"number",min:0,value:1},getPolygon:{type:"accessor",value:t=>t.polygon},getElevation:{type:"accessor",value:1e3},getFillColor:{type:"accessor",value:Mu},getLineColor:{type:"accessor",value:Mu},material:!0},el={enter:(t,e)=>e.length?e.subarray(e.length-t.length):t},ah=class ah extends qt{getShaders(e){return super.getShaders({vs:e==="top"?K8:Y8,fs:J8,defines:{RING_WINDING_ORDER_CW:!this.props._normalize&&this.props._windingOrder==="CCW"?0:1},modules:[qs,cw,Zs]})}get wrapLongitude(){return!1}getBounds(){var e;return(e=this.getAttributeManager())==null?void 0:e.getBounds(["vertexPositions"])}initializeState(){const{viewport:e}=this.context;let{coordinateSystem:n}=this.props;const{_full3d:s}=this.props;e.isGeospatial&&n===Z.DEFAULT&&(n=Z.LNGLAT);let r;n===Z.LNGLAT&&(s?r=e.projectPosition.bind(e):r=e.projectFlat.bind(e)),this.setState({numInstances:0,polygonTesselator:new $8({preproject:r,fp64:this.use64bitPositions(),IndexType:Uint32Array})});const i=this.getAttributeManager(),o=!0;i.remove(["instancePickingColors"]),i.add({indices:{size:1,isIndexed:!0,update:this.calculateIndices,noAlloc:o},vertexPositions:{size:3,type:"float64",fp64:this.use64bitPositions(),transition:el,accessor:"getPolygon",update:this.calculatePositions,noAlloc:o,shaderAttributes:{instancePositions:{vertexOffset:0,divisor:1},instanceNextPositions:{vertexOffset:1,divisor:1}}},instanceVertexValid:{size:1,type:"uint16",divisor:1,update:this.calculateVertexValid,noAlloc:o},elevations:{size:1,transition:el,accessor:"getElevation",shaderAttributes:{instanceElevations:{divisor:1}}},fillColors:{size:this.props.colorFormat.length,type:"unorm8",transition:el,accessor:"getFillColor",defaultValue:Mu,shaderAttributes:{instanceFillColors:{divisor:1}}},lineColors:{size:this.props.colorFormat.length,type:"unorm8",transition:el,accessor:"getLineColor",defaultValue:Mu,shaderAttributes:{instanceLineColors:{divisor:1}}},pickingColors:{size:4,type:"uint8",accessor:(a,{index:c,target:l})=>this.encodePickingColor(a&&a.__source?a.__source.index:c,l),shaderAttributes:{instancePickingColors:{divisor:1}}}})}getPickingInfo(e){const n=super.getPickingInfo(e),{index:s}=n,r=this.props.data;return r[0]&&r[0].__source&&(n.object=r.find(i=>i.__source.index===s)),n}disablePickingIndex(e){const n=this.props.data;if(n[0]&&n[0].__source)for(let s=0;s<n.length;s++)n[s].__source.index===e&&this._disablePickingIndex(s);else super.disablePickingIndex(e)}draw({uniforms:e}){const{extruded:n,filled:s,wireframe:r,elevationScale:i}=this.props,{topModel:o,sideModel:a,wireframeModel:c,polygonTesselator:l}=this.state,u={...e,extruded:!!n,elevationScale:i};c&&r&&(c.setInstanceCount(l.instanceCount-1),c.setUniforms(u),c.draw(this.context.renderPass)),a&&s&&(a.setInstanceCount(l.instanceCount-1),a.setUniforms(u),a.draw(this.context.renderPass)),o&&s&&(o.setVertexCount(l.vertexCount),o.setUniforms(u),o.draw(this.context.renderPass))}updateState(e){var a;super.updateState(e),this.updateGeometry(e);const{props:n,oldProps:s,changeFlags:r}=e,i=this.getAttributeManager();(r.extensionsChanged||n.filled!==s.filled||n.extruded!==s.extruded)&&((a=this.state.models)==null||a.forEach(c=>c.destroy()),this.setState(this._getModels()),i.invalidateAll())}updateGeometry({props:e,oldProps:n,changeFlags:s}){if(s.dataChanged||s.updateTriggersChanged&&(s.updateTriggersChanged.all||s.updateTriggersChanged.getPolygon)){const{polygonTesselator:i}=this.state,o=e.data.attributes||{};i.updateGeometry({data:e.data,normalize:e._normalize,geometryBuffer:o.getPolygon,buffers:o,getGeometry:e.getPolygon,positionFormat:e.positionFormat,wrapLongitude:e.wrapLongitude,resolution:this.context.viewport.resolution,fp64:this.use64bitPositions(),dataChanged:s.dataChanged,full3d:e._full3d}),this.setState({numInstances:i.instanceCount,startIndices:i.vertexStarts}),s.dataChanged||this.getAttributeManager().invalidateAll()}}_getModels(){const{id:e,filled:n,extruded:s}=this.props;let r,i,o;const a=this.getAttributeManager().getBufferLayouts();if(n){const c=this.getShaders("top");c.defines.NON_INSTANCED_MODEL=1,r=new ct(this.context.device,{...c,id:`${e}-top`,topology:"triangle-list",uniforms:{isWireframe:!1},bufferLayout:a,isIndexed:!0,userData:{excludeAttributes:{instanceVertexValid:!0}}})}return s&&(i=new ct(this.context.device,{...this.getShaders("side"),id:`${e}-side`,bufferLayout:a,uniforms:{isWireframe:!1},geometry:new Kt({topology:"triangle-strip",attributes:{positions:{size:2,value:new Float32Array([1,0,0,0,1,1,0,1])}}}),isInstanced:1,userData:{excludeAttributes:{indices:!0}}}),o=new ct(this.context.device,{...this.getShaders("side"),id:`${e}-wireframe`,bufferLayout:a,uniforms:{isWireframe:!0},geometry:new Kt({topology:"line-strip",attributes:{positions:{size:2,value:new Float32Array([1,0,0,0,0,1,1,1])}}}),isInstanced:1,userData:{excludeAttributes:{indices:!0}}})),{models:[i,o,r].filter(Boolean),topModel:r,sideModel:i,wireframeModel:o}}calculateIndices(e){const{polygonTesselator:n}=this.state;e.startIndices=n.indexStarts,e.value=n.get("indices")}calculatePositions(e){const{polygonTesselator:n}=this.state;e.startIndices=n.vertexStarts,e.value=n.get("positions")}calculateVertexValid(e){e.value=this.state.polygonTesselator.get("vertexValid")}};ah.defaultProps=q8,ah.layerName="SolidPolygonLayer";let Ng=ah;function Z8({data:t,getIndex:e,dataRange:n,replace:s}){const{startRow:r=0,endRow:i=1/0}=n,o=t.length;let a=o,c=o;for(let f=0;f<o;f++){const d=e(t[f]);if(a>f&&d>=r&&(a=f),d>=i){c=f;break}}let l=a;const h=c-a!==s.length?t.slice(c):void 0;for(let f=0;f<s.length;f++)t[l++]=s[f];if(h){for(let f=0;f<h.length;f++)t[l++]=h[f];t.length=l}return{startRow:a,endRow:a+s.length}}function Q8(t,e){if(!t)return null;const n="startIndices"in t?t.startIndices[e]:e,s=t.featureIds.value[n];return n!==-1?e9(t,s,n):null}function e9(t,e,n){const s={properties:{...t.properties[e]}};for(const r in t.numericProps)s.properties[r]=t.numericProps[r].value[n];return s}function t9(t,e){const n={points:null,lines:null,polygons:null};for(const s in n){const r=t[s].globalFeatureIds.value;n[s]=new Uint8ClampedArray(r.length*3);const i=[];for(let o=0;o<r.length;o++)e(r[o],i),n[s][o*3+0]=i[0],n[s][o*3+1]=i[1],n[s][o*3+2]=i[2]}return n}const n9=`#version 300 es
#define SHADER_NAME multi-icon-layer-fragment-shader
precision highp float;
uniform float opacity;
uniform sampler2D iconsTexture;
uniform float gamma;
uniform bool sdf;
uniform float alphaCutoff;
uniform float sdfBuffer;
uniform float outlineBuffer;
uniform vec4 outlineColor;
in vec4 vColor;
in vec2 vTextureCoords;
in vec2 uv;
out vec4 fragColor;
void main(void) {
geometry.uv = uv;
if (!bool(picking.isActive)) {
float alpha = texture(iconsTexture, vTextureCoords).a;
vec4 color = vColor;
if (sdf) {
float distance = alpha;
alpha = smoothstep(sdfBuffer - gamma, sdfBuffer + gamma, distance);
if (outlineBuffer > 0.0) {
float inFill = alpha;
float inBorder = smoothstep(outlineBuffer - gamma, outlineBuffer + gamma, distance);
color = mix(outlineColor, vColor, inFill);
alpha = inBorder;
}
}
float a = alpha * color.a;
if (a < alphaCutoff) {
discard;
}
fragColor = vec4(color.rgb, a * opacity);
}
DECKGL_FILTER_COLOR(fragColor, geometry);
}
`,Ad=192/256,KT=[],s9={getIconOffsets:{type:"accessor",value:t=>t.offsets},alphaCutoff:.001,smoothing:.1,outlineWidth:0,outlineColor:{type:"color",value:[0,0,0,255]}},ch=class ch extends xu{getShaders(){return{...super.getShaders(),fs:n9}}initializeState(){super.initializeState(),this.getAttributeManager().addInstanced({instanceOffsets:{size:2,accessor:"getIconOffsets"},instancePickingColors:{type:"uint8",size:3,accessor:(n,{index:s,target:r})=>this.encodePickingColor(s,r)}})}updateState(e){super.updateState(e);const{props:n,oldProps:s}=e;let{outlineColor:r}=n;r!==s.outlineColor&&(r=r.map(i=>i/255),r[3]=Number.isFinite(r[3])?r[3]:1,this.setState({outlineColor:r})),!n.sdf&&n.outlineWidth&&J.warn(`${this.id}: fontSettings.sdf is required to render outline`)()}draw(e){const{sdf:n,smoothing:s,outlineWidth:r}=this.props,{outlineColor:i}=this.state,o=r?Math.max(s,Ad*(1-r)):-1;if(e.uniforms={...e.uniforms,sdfBuffer:Ad,outlineBuffer:o,gamma:s,sdf:!!n,outlineColor:i},super.draw(e),n&&r){const{iconManager:a}=this.state,c=a.getTexture(),l=this.state.model;c&&(l.setUniforms({outlineBuffer:Ad}),l.draw(this.context.renderPass))}}getInstanceOffset(e){return e?Array.from(e).flatMap(n=>super.getInstanceOffset(n)):KT}getInstanceColorMode(e){return 1}getInstanceIconFrame(e){return e?Array.from(e).flatMap(n=>super.getInstanceIconFrame(n)):KT}};ch.defaultProps=s9,ch.layerName="MultiIconLayer";let Fg=ch;const ha=1e20;class r9{constructor({fontSize:e=24,buffer:n=3,radius:s=8,cutoff:r=.25,fontFamily:i="sans-serif",fontWeight:o="normal",fontStyle:a="normal"}={}){this.buffer=n,this.cutoff=r,this.radius=s;const c=this.size=e+n*4,l=this._createCanvas(c),u=this.ctx=l.getContext("2d",{willReadFrequently:!0});u.font=`${a} ${o} ${e}px ${i}`,u.textBaseline="alphabetic",u.textAlign="left",u.fillStyle="black",this.gridOuter=new Float64Array(c*c),this.gridInner=new Float64Array(c*c),this.f=new Float64Array(c),this.z=new Float64Array(c+1),this.v=new Uint16Array(c)}_createCanvas(e){const n=document.createElement("canvas");return n.width=n.height=e,n}draw(e){const{width:n,actualBoundingBoxAscent:s,actualBoundingBoxDescent:r,actualBoundingBoxLeft:i,actualBoundingBoxRight:o}=this.ctx.measureText(e),a=Math.ceil(s),c=0,l=Math.max(0,Math.min(this.size-this.buffer,Math.ceil(o-i))),u=Math.min(this.size-this.buffer,a+Math.ceil(r)),h=l+2*this.buffer,f=u+2*this.buffer,d=Math.max(h*f,0),g=new Uint8ClampedArray(d),_={data:g,width:h,height:f,glyphWidth:l,glyphHeight:u,glyphTop:a,glyphLeft:c,glyphAdvance:n};if(l===0||u===0)return _;const{ctx:E,buffer:m,gridInner:y,gridOuter:A}=this;E.clearRect(m,m,l,u),E.fillText(e,m,m+a);const C=E.getImageData(m,m,l,u);A.fill(ha,0,d),y.fill(0,0,d);for(let b=0;b<u;b++)for(let P=0;P<l;P++){const B=C.data[4*(b*l+P)+3]/255;if(B===0)continue;const O=(b+m)*h+P+m;if(B===1)A[O]=0,y[O]=ha;else{const N=.5-B;A[O]=N>0?N*N:0,y[O]=N<0?N*N:0}}YT(A,0,0,h,f,h,this.f,this.v,this.z),YT(y,m,m,l,u,h,this.f,this.v,this.z);for(let b=0;b<d;b++){const P=Math.sqrt(A[b])-Math.sqrt(y[b]);g[b]=Math.round(255-255*(P/this.radius+this.cutoff))}return _}}function YT(t,e,n,s,r,i,o,a,c){for(let l=e;l<e+s;l++)JT(t,n*i+l,i,r,o,a,c);for(let l=n;l<n+r;l++)JT(t,l*i+e,1,s,o,a,c)}function JT(t,e,n,s,r,i,o){i[0]=0,o[0]=-ha,o[1]=ha,r[0]=t[e];for(let a=1,c=0,l=0;a<s;a++){r[a]=t[e+a*n];const u=a*a;do{const h=i[c];l=(r[a]-r[h]+u-h*h)/(a-h)/2}while(l<=o[c]&&--c>-1);c++,i[c]=a,o[c]=l,o[c+1]=ha}for(let a=0,c=0;a<s;a++){for(;o[c+1]<a;)c++;const l=i[c],u=a-l;t[e+a*n]=r[l]+u*u}}const i9=32,o9=[];function a9(t){return Math.pow(2,Math.ceil(Math.log2(t)))}function c9({characterSet:t,getFontWidth:e,fontHeight:n,buffer:s,maxCanvasWidth:r,mapping:i={},xOffset:o=0,yOffset:a=0}){let c=0,l=o;const u=n+s*2;for(const h of t)if(!i[h]){const f=e(h);l+f+s*2>r&&(l=0,c++),i[h]={x:l+s,y:a+c*u+s,width:f,height:u,layoutWidth:f,layoutHeight:n},l+=f+s*2}return{mapping:i,xOffset:l,yOffset:a+c*u,canvasHeight:a9(a+(c+1)*u)}}function yb(t,e,n,s){var i;let r=0;for(let o=e;o<n;o++){const a=t[o];r+=((i=s[a])==null?void 0:i.layoutWidth)||0}return r}function Ab(t,e,n,s,r,i){let o=e,a=0;for(let c=e;c<n;c++){const l=yb(t,c,c+1,r);a+l>s&&(o<c&&i.push(c),o=c,a=0),a+=l}return a}function l9(t,e,n,s,r,i){let o=e,a=e,c=e,l=0;for(let u=e;u<n;u++)if((t[u]===" "||t[u+1]===" "||u+1===n)&&(c=u+1),c>a){let h=yb(t,a,c,r);l+h>s&&(o<a&&(i.push(a),o=a,l=0),h>s&&(h=Ab(t,a,c,s,r,i),o=i[i.length-1])),a=c,l+=h}return l}function u9(t,e,n,s,r=0,i){i===void 0&&(i=t.length);const o=[];return e==="break-all"?Ab(t,r,i,n,s,o):l9(t,r,i,n,s,o),o}function h9(t,e,n,s,r,i){let o=0,a=0;for(let c=e;c<n;c++){const l=t[c],u=s[l];u?(a||(a=u.layoutHeight),r[c]=o+u.layoutWidth/2,o+=u.layoutWidth):(J.warn(`Missing character: ${l} (${l.codePointAt(0)})`)(),r[c]=o,o+=i9)}i[0]=o,i[1]=a}function f9(t,e,n,s,r){var E;const i=Array.from(t),o=i.length,a=new Array(o),c=new Array(o),l=new Array(o),u=(n==="break-word"||n==="break-all")&&isFinite(s)&&s>0,h=[0,0],f=[0,0];let d=0,g=0,_=0;for(let m=0;m<=o;m++){const y=i[m];if((y===`
`||m===o)&&(_=m),_>g){const A=u?u9(i,n,s,r,g,_):o9;for(let C=0;C<=A.length;C++){const b=C===0?g:A[C-1],P=C<A.length?A[C]:_;h9(i,b,P,r,a,f);for(let B=b;B<P;B++){const O=i[B],N=((E=r[O])==null?void 0:E.layoutOffsetY)||0;c[B]=d+f[1]/2+N,l[B]=f[0]}d=d+f[1]*e,h[0]=Math.max(h[0],f[0])}g=_}y===`
`&&(a[g]=0,c[g]=0,l[g]=0,g++)}return h[1]=d,{x:a,y:c,rowWidth:l,size:h}}function d9({value:t,length:e,stride:n,offset:s,startIndices:r,characterSet:i}){const o=t.BYTES_PER_ELEMENT,a=n?n/o:1,c=s?s/o:0,l=r[e]||Math.ceil((t.length-c)/a),u=i&&new Set,h=new Array(e);let f=t;if(a>1||c>0){const d=t.constructor;f=new d(l);for(let g=0;g<l;g++)f[g]=t[g*a+c]}for(let d=0;d<e;d++){const g=r[d],_=r[d+1]||l,E=f.subarray(g,_);h[d]=String.fromCodePoint.apply(null,E),u&&E.forEach(u.add,u)}if(u)for(const d of u)i.add(String.fromCodePoint(d));return{texts:h,characterCount:l}}class Tb{constructor(e=5){this._cache={},this._order=[],this.limit=e}get(e){const n=this._cache[e];return n&&(this._deleteOrder(e),this._appendOrder(e)),n}set(e,n){this._cache[e]?(this.delete(e),this._cache[e]=n,this._appendOrder(e)):(Object.keys(this._cache).length===this.limit&&this.delete(this._order[0]),this._cache[e]=n,this._appendOrder(e))}delete(e){this._cache[e]&&(delete this._cache[e],this._deleteOrder(e))}_deleteOrder(e){const n=this._order.indexOf(e);n>=0&&this._order.splice(n,1)}_appendOrder(e){this._order.push(e)}}function p9(){const t=[];for(let e=32;e<128;e++)t.push(String.fromCharCode(e));return t}const Di={fontFamily:"Monaco, monospace",fontWeight:"normal",characterSet:p9(),fontSize:64,buffer:4,sdf:!1,cutoff:.25,radius:12,smoothing:.1},qT=1024,ZT=.9,QT=1.2,Eb=3;let Bu=new Tb(Eb);function g9(t,e){let n;typeof e=="string"?n=new Set(Array.from(e)):n=new Set(e);const s=Bu.get(t);if(!s)return n;for(const r in s.mapping)n.has(r)&&n.delete(r);return n}function _9(t,e){for(let n=0;n<t.length;n++)e.data[4*n+3]=t[n]}function eE(t,e,n,s){t.font=`${s} ${n}px ${e}`,t.fillStyle="#000",t.textBaseline="alphabetic",t.textAlign="left"}function m9(t){J.assert(Number.isFinite(t)&&t>=Eb,"Invalid cache limit"),Bu=new Tb(t)}class y9{constructor(){this.props={...Di}}get atlas(){return this._atlas}get mapping(){return this._atlas&&this._atlas.mapping}get scale(){const{fontSize:e,buffer:n}=this.props;return(e*QT+n*2)/e}setProps(e={}){Object.assign(this.props,e),this._key=this._getKey();const n=g9(this._key,this.props.characterSet),s=Bu.get(this._key);if(s&&n.size===0){this._atlas!==s&&(this._atlas=s);return}const r=this._generateFontAtlas(n,s);this._atlas=r,Bu.set(this._key,r)}_generateFontAtlas(e,n){const{fontFamily:s,fontWeight:r,fontSize:i,buffer:o,sdf:a,radius:c,cutoff:l}=this.props;let u=n&&n.data;u||(u=document.createElement("canvas"),u.width=qT);const h=u.getContext("2d",{willReadFrequently:!0});eE(h,s,i,r);const{mapping:f,canvasHeight:d,xOffset:g,yOffset:_}=c9({getFontWidth:E=>h.measureText(E).width,fontHeight:i*QT,buffer:o,characterSet:e,maxCanvasWidth:qT,...n&&{mapping:n.mapping,xOffset:n.xOffset,yOffset:n.yOffset}});if(u.height!==d){const E=h.getImageData(0,0,u.width,u.height);u.height=d,h.putImageData(E,0,0)}if(eE(h,s,i,r),a){const E=new r9({fontSize:i,buffer:o,radius:c,cutoff:l,fontFamily:s,fontWeight:`${r}`});for(const m of e){const{data:y,width:A,height:C,glyphTop:b}=E.draw(m);f[m].width=A,f[m].layoutOffsetY=i*ZT-b;const P=h.createImageData(A,C);_9(y,P),h.putImageData(P,f[m].x,f[m].y)}}else for(const E of e)h.fillText(E,f[E].x,f[E].y+o+i*ZT);return{xOffset:g,yOffset:_,mapping:f,data:u,width:u.width,height:u.height}}_getKey(){const{fontFamily:e,fontWeight:n,fontSize:s,buffer:r,sdf:i,radius:o,cutoff:a}=this.props;return i?`${e} ${n} ${s} ${r} ${o} ${a}`:`${e} ${n} ${s} ${r}`}}const A9=`#version 300 es
#define SHADER_NAME text-background-layer-vertex-shader
in vec2 positions;
in vec3 instancePositions;
in vec3 instancePositions64Low;
in vec4 instanceRects;
in float instanceSizes;
in float instanceAngles;
in vec2 instancePixelOffsets;
in float instanceLineWidths;
in vec4 instanceFillColors;
in vec4 instanceLineColors;
in vec3 instancePickingColors;
uniform bool billboard;
uniform float opacity;
uniform float sizeScale;
uniform float sizeMinPixels;
uniform float sizeMaxPixels;
uniform vec4 padding;
uniform int sizeUnits;
out vec4 vFillColor;
out vec4 vLineColor;
out float vLineWidth;
out vec2 uv;
out vec2 dimensions;
vec2 rotate_by_angle(vec2 vertex, float angle) {
float angle_radian = radians(angle);
float cos_angle = cos(angle_radian);
float sin_angle = sin(angle_radian);
mat2 rotationMatrix = mat2(cos_angle, -sin_angle, sin_angle, cos_angle);
return rotationMatrix * vertex;
}
void main(void) {
geometry.worldPosition = instancePositions;
geometry.uv = positions;
geometry.pickingColor = instancePickingColors;
uv = positions;
vLineWidth = instanceLineWidths;
float sizePixels = clamp(
project_size_to_pixel(instanceSizes * sizeScale, sizeUnits),
sizeMinPixels, sizeMaxPixels
);
dimensions = instanceRects.zw * sizePixels + padding.xy + padding.zw;
vec2 pixelOffset = (positions * instanceRects.zw + instanceRects.xy) * sizePixels + mix(-padding.xy, padding.zw, positions);
pixelOffset = rotate_by_angle(pixelOffset, instanceAngles);
pixelOffset += instancePixelOffsets;
pixelOffset.y *= -1.0;
if (billboard)  {
gl_Position = project_position_to_clipspace(instancePositions, instancePositions64Low, vec3(0.0), geometry.position);
DECKGL_FILTER_GL_POSITION(gl_Position, geometry);
vec3 offset = vec3(pixelOffset, 0.0);
DECKGL_FILTER_SIZE(offset, geometry);
gl_Position.xy += project_pixel_size_to_clipspace(offset.xy);
} else {
vec3 offset_common = vec3(project_pixel_size(pixelOffset), 0.0);
DECKGL_FILTER_SIZE(offset_common, geometry);
gl_Position = project_position_to_clipspace(instancePositions, instancePositions64Low, offset_common, geometry.position);
DECKGL_FILTER_GL_POSITION(gl_Position, geometry);
}
vFillColor = vec4(instanceFillColors.rgb, instanceFillColors.a * opacity);
DECKGL_FILTER_COLOR(vFillColor, geometry);
vLineColor = vec4(instanceLineColors.rgb, instanceLineColors.a * opacity);
DECKGL_FILTER_COLOR(vLineColor, geometry);
}
`,T9=`#version 300 es
#define SHADER_NAME text-background-layer-fragment-shader
precision highp float;
uniform bool stroked;
in vec4 vFillColor;
in vec4 vLineColor;
in float vLineWidth;
in vec2 uv;
in vec2 dimensions;
out vec4 fragColor;
void main(void) {
geometry.uv = uv;
vec2 pixelPosition = uv * dimensions;
if (stroked) {
float distToEdge = min(
min(pixelPosition.x, dimensions.x - pixelPosition.x),
min(pixelPosition.y, dimensions.y - pixelPosition.y)
);
float isBorder = smoothedge(distToEdge, vLineWidth);
fragColor = mix(vFillColor, vLineColor, isBorder);
} else {
fragColor = vFillColor;
}
DECKGL_FILTER_COLOR(fragColor, geometry);
}
`,E9={billboard:!0,sizeScale:1,sizeUnits:"pixels",sizeMinPixels:0,sizeMaxPixels:Number.MAX_SAFE_INTEGER,padding:{type:"array",value:[0,0,0,0]},getPosition:{type:"accessor",value:t=>t.position},getSize:{type:"accessor",value:1},getAngle:{type:"accessor",value:0},getPixelOffset:{type:"accessor",value:[0,0]},getBoundingRect:{type:"accessor",value:[0,0,0,0]},getFillColor:{type:"accessor",value:[0,0,0,255]},getLineColor:{type:"accessor",value:[0,0,0,255]},getLineWidth:{type:"accessor",value:1}},lh=class lh extends qt{getShaders(){return super.getShaders({vs:A9,fs:T9,modules:[qs,Zs]})}initializeState(){this.getAttributeManager().addInstanced({instancePositions:{size:3,type:"float64",fp64:this.use64bitPositions(),transition:!0,accessor:"getPosition"},instanceSizes:{size:1,transition:!0,accessor:"getSize",defaultValue:1},instanceAngles:{size:1,transition:!0,accessor:"getAngle"},instanceRects:{size:4,accessor:"getBoundingRect"},instancePixelOffsets:{size:2,transition:!0,accessor:"getPixelOffset"},instanceFillColors:{size:4,transition:!0,type:"unorm8",accessor:"getFillColor",defaultValue:[0,0,0,255]},instanceLineColors:{size:4,transition:!0,type:"unorm8",accessor:"getLineColor",defaultValue:[0,0,0,255]},instanceLineWidths:{size:1,transition:!0,accessor:"getLineWidth",defaultValue:1}})}updateState(e){var s;super.updateState(e);const{changeFlags:n}=e;n.extensionsChanged&&((s=this.state.model)==null||s.destroy(),this.state.model=this._getModel(),this.getAttributeManager().invalidateAll())}draw({uniforms:e}){const{billboard:n,sizeScale:s,sizeUnits:r,sizeMinPixels:i,sizeMaxPixels:o,getLineWidth:a}=this.props;let{padding:c}=this.props;c.length<4&&(c=[c[0],c[1],c[0],c[1]]);const l=this.state.model;l.setUniforms(e),l.setUniforms({billboard:n,stroked:!!a,padding:c,sizeUnits:js[r],sizeScale:s,sizeMinPixels:i,sizeMaxPixels:o}),l.draw(this.context.renderPass)}_getModel(){const e=[0,0,1,0,1,1,0,1];return new ct(this.context.device,{...this.getShaders(),id:this.props.id,bufferLayout:this.getAttributeManager().getBufferLayouts(),geometry:new Kt({topology:"triangle-fan-webgl",vertexCount:4,attributes:{positions:{size:2,value:new Float32Array(e)}}}),isInstanced:!0})}};lh.defaultProps=E9,lh.layerName="TextBackgroundLayer";let Dg=lh;const tE={start:1,middle:0,end:-1},nE={top:1,center:0,bottom:-1},Td=[0,0,0,255],S9=1,C9={billboard:!0,sizeScale:1,sizeUnits:"pixels",sizeMinPixels:0,sizeMaxPixels:Number.MAX_SAFE_INTEGER,background:!1,getBackgroundColor:{type:"accessor",value:[255,255,255,255]},getBorderColor:{type:"accessor",value:Td},getBorderWidth:{type:"accessor",value:0},backgroundPadding:{type:"array",value:[0,0,0,0]},characterSet:{type:"object",value:Di.characterSet},fontFamily:Di.fontFamily,fontWeight:Di.fontWeight,lineHeight:S9,outlineWidth:{type:"number",value:0,min:0},outlineColor:{type:"color",value:Td},fontSettings:{type:"object",value:{},compare:1},wordBreak:"break-word",maxWidth:{type:"number",value:-1},getText:{type:"accessor",value:t=>t.text},getPosition:{type:"accessor",value:t=>t.position},getColor:{type:"accessor",value:Td},getSize:{type:"accessor",value:32},getAngle:{type:"accessor",value:0},getTextAnchor:{type:"accessor",value:"middle"},getAlignmentBaseline:{type:"accessor",value:"center"},getPixelOffset:{type:"accessor",value:[0,0]},backgroundColor:{deprecatedFor:["background","getBackgroundColor"]}},uh=class uh extends Or{constructor(){super(...arguments),this.getBoundingRect=(e,n)=>{let{size:[s,r]}=this.transformParagraph(e,n);const{fontSize:i}=this.state.fontAtlasManager.props;s/=i,r/=i;const{getTextAnchor:o,getAlignmentBaseline:a}=this.props,c=tE[typeof o=="function"?o(e,n):o],l=nE[typeof a=="function"?a(e,n):a];return[(c-1)*s/2,(l-1)*r/2,s,r]},this.getIconOffsets=(e,n)=>{const{getTextAnchor:s,getAlignmentBaseline:r}=this.props,{x:i,y:o,rowWidth:a,size:[c,l]}=this.transformParagraph(e,n),u=tE[typeof s=="function"?s(e,n):s],h=nE[typeof r=="function"?r(e,n):r],f=i.length,d=new Array(f*2);let g=0;for(let _=0;_<f;_++){const E=(1-u)*(c-a[_])/2;d[g++]=(u-1)*c/2+E+i[_],d[g++]=(h-1)*l/2+o[_]}return d}}initializeState(){this.state={styleVersion:0,fontAtlasManager:new y9},this.props.maxWidth>0&&J.warn("v8.9 breaking change: TextLayer maxWidth is now relative to text size")()}updateState(e){const{props:n,oldProps:s,changeFlags:r}=e;(r.dataChanged||r.updateTriggersChanged&&(r.updateTriggersChanged.all||r.updateTriggersChanged.getText))&&this._updateText(),(this._updateFontAtlas()||n.lineHeight!==s.lineHeight||n.wordBreak!==s.wordBreak||n.maxWidth!==s.maxWidth)&&this.setState({styleVersion:this.state.styleVersion+1})}getPickingInfo({info:e}){return e.object=e.index>=0?this.props.data[e.index]:null,e}_updateFontAtlas(){const{fontSettings:e,fontFamily:n,fontWeight:s}=this.props,{fontAtlasManager:r,characterSet:i}=this.state,o={...e,characterSet:i,fontFamily:n,fontWeight:s};if(!r.mapping)return r.setProps(o),!0;for(const a in o)if(o[a]!==r.props[a])return r.setProps(o),!0;return!1}_updateText(){var c;const{data:e,characterSet:n}=this.props,s=(c=e.attributes)==null?void 0:c.getText;let{getText:r}=this.props,i=e.startIndices,o;const a=n==="auto"&&new Set;if(s&&i){const{texts:l,characterCount:u}=d9({...ArrayBuffer.isView(s)?{value:s}:s,length:e.length,startIndices:i,characterSet:a});o=u,r=(h,{index:f})=>l[f]}else{const{iterable:l,objectInfo:u}=nc(e);i=[0],o=0;for(const h of l){u.index++;const f=Array.from(r(h,u)||"");a&&f.forEach(a.add,a),o+=f.length,i.push(o)}}this.setState({getText:r,startIndices:i,numInstances:o,characterSet:a||n})}transformParagraph(e,n){const{fontAtlasManager:s}=this.state,r=s.mapping,i=this.state.getText,{wordBreak:o,lineHeight:a,maxWidth:c}=this.props,l=i(e,n)||"";return f9(l,a,o,c*s.props.fontSize,r)}renderLayers(){const{startIndices:e,numInstances:n,getText:s,fontAtlasManager:{scale:r,atlas:i,mapping:o},styleVersion:a}=this.state,{data:c,_dataDiff:l,getPosition:u,getColor:h,getSize:f,getAngle:d,getPixelOffset:g,getBackgroundColor:_,getBorderColor:E,getBorderWidth:m,backgroundPadding:y,background:A,billboard:C,fontSettings:b,outlineWidth:P,outlineColor:B,sizeScale:O,sizeUnits:N,sizeMinPixels:F,sizeMaxPixels:H,transitions:X,updateTriggers:G}=this.props,$=this.getSubLayerClass("characters",Fg),Te=this.getSubLayerClass("background",Dg);return[A&&new Te({getFillColor:_,getLineColor:E,getLineWidth:m,padding:y,getPosition:u,getSize:f,getAngle:d,getPixelOffset:g,billboard:C,sizeScale:O,sizeUnits:N,sizeMinPixels:F,sizeMaxPixels:H,transitions:X&&{getPosition:X.getPosition,getAngle:X.getAngle,getSize:X.getSize,getFillColor:X.getBackgroundColor,getLineColor:X.getBorderColor,getLineWidth:X.getBorderWidth,getPixelOffset:X.getPixelOffset}},this.getSubLayerProps({id:"background",updateTriggers:{getPosition:G.getPosition,getAngle:G.getAngle,getSize:G.getSize,getFillColor:G.getBackgroundColor,getLineColor:G.getBorderColor,getLineWidth:G.getBorderWidth,getPixelOffset:G.getPixelOffset,getBoundingRect:{getText:G.getText,getTextAnchor:G.getTextAnchor,getAlignmentBaseline:G.getAlignmentBaseline,styleVersion:a}}}),{data:c.attributes&&c.attributes.background?{length:c.length,attributes:c.attributes.background}:c,_dataDiff:l,autoHighlight:!1,getBoundingRect:this.getBoundingRect}),new $({sdf:b.sdf,smoothing:Number.isFinite(b.smoothing)?b.smoothing:Di.smoothing,outlineWidth:P/(b.radius||Di.radius),outlineColor:B,iconAtlas:i,iconMapping:o,getPosition:u,getColor:h,getSize:f,getAngle:d,getPixelOffset:g,billboard:C,sizeScale:O*r,sizeUnits:N,sizeMinPixels:F*r,sizeMaxPixels:H*r,transitions:X&&{getPosition:X.getPosition,getAngle:X.getAngle,getColor:X.getColor,getSize:X.getSize,getPixelOffset:X.getPixelOffset}},this.getSubLayerProps({id:"characters",updateTriggers:{all:G.getText,getPosition:G.getPosition,getAngle:G.getAngle,getColor:G.getColor,getSize:G.getSize,getPixelOffset:G.getPixelOffset,getIconOffsets:{getTextAnchor:G.getTextAnchor,getAlignmentBaseline:G.getAlignmentBaseline,styleVersion:a}}}),{data:c,_dataDiff:l,startIndices:e,numInstances:n,getIconOffsets:this.getIconOffsets,getIcon:s})]}static set fontAtlasCacheLimit(e){m9(e)}};uh.defaultProps=C9,uh.layerName="TextLayer";let Lg=uh;const Nl={circle:{type:Rg,props:{filled:"filled",stroked:"stroked",lineWidthMaxPixels:"lineWidthMaxPixels",lineWidthMinPixels:"lineWidthMinPixels",lineWidthScale:"lineWidthScale",lineWidthUnits:"lineWidthUnits",pointRadiusMaxPixels:"radiusMaxPixels",pointRadiusMinPixels:"radiusMinPixels",pointRadiusScale:"radiusScale",pointRadiusUnits:"radiusUnits",pointAntialiasing:"antialiasing",pointBillboard:"billboard",getFillColor:"getFillColor",getLineColor:"getLineColor",getLineWidth:"getLineWidth",getPointRadius:"getRadius"}},icon:{type:xu,props:{iconAtlas:"iconAtlas",iconMapping:"iconMapping",iconSizeMaxPixels:"sizeMaxPixels",iconSizeMinPixels:"sizeMinPixels",iconSizeScale:"sizeScale",iconSizeUnits:"sizeUnits",iconAlphaCutoff:"alphaCutoff",iconBillboard:"billboard",getIcon:"getIcon",getIconAngle:"getAngle",getIconColor:"getColor",getIconPixelOffset:"getPixelOffset",getIconSize:"getSize"}},text:{type:Lg,props:{textSizeMaxPixels:"sizeMaxPixels",textSizeMinPixels:"sizeMinPixels",textSizeScale:"sizeScale",textSizeUnits:"sizeUnits",textBackground:"background",textBackgroundPadding:"backgroundPadding",textFontFamily:"fontFamily",textFontWeight:"fontWeight",textLineHeight:"lineHeight",textMaxWidth:"maxWidth",textOutlineColor:"outlineColor",textOutlineWidth:"outlineWidth",textWordBreak:"wordBreak",textCharacterSet:"characterSet",textBillboard:"billboard",textFontSettings:"fontSettings",getText:"getText",getTextAngle:"getAngle",getTextColor:"getColor",getTextPixelOffset:"getPixelOffset",getTextSize:"getSize",getTextAnchor:"getTextAnchor",getTextAlignmentBaseline:"getAlignmentBaseline",getTextBackgroundColor:"getBackgroundColor",getTextBorderColor:"getBorderColor",getTextBorderWidth:"getBorderWidth"}}},Fl={type:xg,props:{lineWidthUnits:"widthUnits",lineWidthScale:"widthScale",lineWidthMinPixels:"widthMinPixels",lineWidthMaxPixels:"widthMaxPixels",lineJointRounded:"jointRounded",lineCapRounded:"capRounded",lineMiterLimit:"miterLimit",lineBillboard:"billboard",getLineColor:"getColor",getLineWidth:"getWidth"}},Ug={type:Ng,props:{extruded:"extruded",filled:"filled",wireframe:"wireframe",elevationScale:"elevationScale",material:"material",_full3d:"_full3d",getElevation:"getElevation",getFillColor:"getFillColor",getLineColor:"getLineColor"}};function Bo({type:t,props:e}){const n={};for(const s in e)n[s]=t.defaultProps[e[s]];return n}function Ed(t,e){const{transitions:n,updateTriggers:s}=t.props,r={updateTriggers:{},transitions:n&&{getPosition:n.geometry}};for(const i in e){const o=e[i];let a=t.props[i];i.startsWith("get")&&(a=t.getSubLayerAccessor(a),r.updateTriggers[o]=s[i],n&&(r.transitions[o]=n[i])),r[o]=a}return r}function v9(t){if(Array.isArray(t))return t;switch(J.assert(t.type,"GeoJSON does not have type"),t.type){case"Feature":return[t];case"FeatureCollection":return J.assert(Array.isArray(t.features),"GeoJSON does not have features array"),t.features;default:return[{geometry:t}]}}function sE(t,e,n={}){const s={pointFeatures:[],lineFeatures:[],polygonFeatures:[],polygonOutlineFeatures:[]},{startRow:r=0,endRow:i=t.length}=n;for(let o=r;o<i;o++){const a=t[o],{geometry:c}=a;if(c)if(c.type==="GeometryCollection"){J.assert(Array.isArray(c.geometries),"GeoJSON does not have geometries array");const{geometries:l}=c;for(let u=0;u<l.length;u++){const h=l[u];rE(h,s,e,a,o)}}else rE(c,s,e,a,o)}return s}function rE(t,e,n,s,r){const{type:i,coordinates:o}=t,{pointFeatures:a,lineFeatures:c,polygonFeatures:l,polygonOutlineFeatures:u}=e;if(!b9(i,o)){J.warn(`${i} coordinates are malformed`)();return}switch(i){case"Point":a.push(n({geometry:t},s,r));break;case"MultiPoint":o.forEach(h=>{a.push(n({geometry:{type:"Point",coordinates:h}},s,r))});break;case"LineString":c.push(n({geometry:t},s,r));break;case"MultiLineString":o.forEach(h=>{c.push(n({geometry:{type:"LineString",coordinates:h}},s,r))});break;case"Polygon":l.push(n({geometry:t},s,r)),o.forEach(h=>{u.push(n({geometry:{type:"LineString",coordinates:h}},s,r))});break;case"MultiPolygon":o.forEach(h=>{l.push(n({geometry:{type:"Polygon",coordinates:h}},s,r)),h.forEach(f=>{u.push(n({geometry:{type:"LineString",coordinates:f}},s,r))})});break}}const w9={Point:1,MultiPoint:2,LineString:2,MultiLineString:3,Polygon:3,MultiPolygon:4};function b9(t,e){let n=w9[t];for(J.assert(n,`Unknown GeoJSON type ${t}`);e&&--n>0;)e=e[0];return e&&Number.isFinite(e[0])}function Sb(){return{points:{},lines:{},polygons:{},polygonsOutline:{}}}function tl(t){return t.geometry.coordinates}function R9(t,e){const n=Sb(),{pointFeatures:s,lineFeatures:r,polygonFeatures:i,polygonOutlineFeatures:o}=t;return n.points.data=s,n.points._dataDiff=e.pointFeatures&&(()=>e.pointFeatures),n.points.getPosition=tl,n.lines.data=r,n.lines._dataDiff=e.lineFeatures&&(()=>e.lineFeatures),n.lines.getPath=tl,n.polygons.data=i,n.polygons._dataDiff=e.polygonFeatures&&(()=>e.polygonFeatures),n.polygons.getPolygon=tl,n.polygonsOutline.data=o,n.polygonsOutline._dataDiff=e.polygonOutlineFeatures&&(()=>e.polygonOutlineFeatures),n.polygonsOutline.getPath=tl,n}function I9(t,e){const n=Sb(),{points:s,lines:r,polygons:i}=t,o=t9(t,e);return n.points.data={length:s.positions.value.length/s.positions.size,attributes:{...s.attributes,getPosition:s.positions,instancePickingColors:{size:3,value:o.points}},properties:s.properties,numericProps:s.numericProps,featureIds:s.featureIds},n.lines.data={length:r.pathIndices.value.length-1,startIndices:r.pathIndices.value,attributes:{...r.attributes,getPath:r.positions,instancePickingColors:{size:3,value:o.lines}},properties:r.properties,numericProps:r.numericProps,featureIds:r.featureIds},n.lines._pathType="open",n.polygons.data={length:i.polygonIndices.value.length-1,startIndices:i.polygonIndices.value,attributes:{...i.attributes,getPolygon:i.positions,pickingColors:{size:3,value:o.polygons}},properties:i.properties,numericProps:i.numericProps,featureIds:i.featureIds},n.polygons._normalize=!1,i.triangles&&(n.polygons.data.attributes.indices=i.triangles.value),n.polygonsOutline.data={length:i.primitivePolygonIndices.value.length-1,startIndices:i.primitivePolygonIndices.value,attributes:{...i.attributes,getPath:i.positions,instancePickingColors:{size:3,value:o.polygons}},properties:i.properties,numericProps:i.numericProps,featureIds:i.featureIds},n.polygonsOutline._pathType="open",n}const P9=["points","linestrings","polygons"],x9={...Bo(Nl.circle),...Bo(Nl.icon),...Bo(Nl.text),...Bo(Fl),...Bo(Ug),stroked:!0,filled:!0,extruded:!1,wireframe:!1,_full3d:!1,iconAtlas:{type:"object",value:null},iconMapping:{type:"object",value:{}},getIcon:{type:"accessor",value:t=>t.properties.icon},getText:{type:"accessor",value:t=>t.properties.text},pointType:"circle",getRadius:{deprecatedFor:"getPointRadius"}},hh=class hh extends Or{initializeState(){this.state={layerProps:{},features:{},featuresDiff:{}}}updateState({props:e,changeFlags:n}){if(!n.dataChanged)return;const{data:s}=this.props,r=s&&"points"in s&&"polygons"in s&&"lines"in s;this.setState({binary:r}),r?this._updateStateBinary({props:e,changeFlags:n}):this._updateStateJSON({props:e,changeFlags:n})}_updateStateBinary({props:e,changeFlags:n}){const s=I9(e.data,this.encodePickingColor);this.setState({layerProps:s})}_updateStateJSON({props:e,changeFlags:n}){const s=v9(e.data),r=this.getSubLayerRow.bind(this);let i={};const o={};if(Array.isArray(n.dataChanged)){const c=this.state.features;for(const l in c)i[l]=c[l].slice(),o[l]=[];for(const l of n.dataChanged){const u=sE(s,r,l);for(const h in c)o[h].push(Z8({data:i[h],getIndex:f=>f.__source.index,dataRange:l,replace:u[h]}))}}else i=sE(s,r);const a=R9(i,o);this.setState({features:i,featuresDiff:o,layerProps:a})}getPickingInfo(e){const n=super.getPickingInfo(e),{index:s,sourceLayer:r}=n;return n.featureType=P9.find(i=>r.id.startsWith(`${this.id}-${i}-`)),s>=0&&r.id.startsWith(`${this.id}-points-text`)&&this.state.binary&&(n.index=this.props.data.points.globalFeatureIds.value[s]),n}_updateAutoHighlight(e){const n=`${this.id}-points-`,s=e.featureType==="points";for(const r of this.getSubLayers())r.id.startsWith(n)===s&&r.updateAutoHighlight(e)}_renderPolygonLayer(){var o;const{extruded:e,wireframe:n}=this.props,{layerProps:s}=this.state,r="polygons-fill",i=this.shouldRenderSubLayer(r,(o=s.polygons)==null?void 0:o.data)&&this.getSubLayerClass(r,Ug.type);if(i){const a=Ed(this,Ug.props),c=e&&n;return c||delete a.getLineColor,a.updateTriggers.lineColors=c,new i(a,this.getSubLayerProps({id:r,updateTriggers:a.updateTriggers}),s.polygons)}return null}_renderLineLayers(){var c,l;const{extruded:e,stroked:n}=this.props,{layerProps:s}=this.state,r="polygons-stroke",i="linestrings",o=!e&&n&&this.shouldRenderSubLayer(r,(c=s.polygonsOutline)==null?void 0:c.data)&&this.getSubLayerClass(r,Fl.type),a=this.shouldRenderSubLayer(i,(l=s.lines)==null?void 0:l.data)&&this.getSubLayerClass(i,Fl.type);if(o||a){const u=Ed(this,Fl.props);return[o&&new o(u,this.getSubLayerProps({id:r,updateTriggers:u.updateTriggers}),s.polygonsOutline),a&&new a(u,this.getSubLayerProps({id:i,updateTriggers:u.updateTriggers}),s.lines)]}return null}_renderPointLayers(){var a;const{pointType:e}=this.props,{layerProps:n,binary:s}=this.state;let{highlightedObjectIndex:r}=this.props;!s&&Number.isFinite(r)&&(r=n.points.data.findIndex(c=>c.__source.index===r));const i=new Set(e.split("+")),o=[];for(const c of i){const l=`points-${c}`,u=Nl[c],h=u&&this.shouldRenderSubLayer(l,(a=n.points)==null?void 0:a.data)&&this.getSubLayerClass(l,u.type);if(h){const f=Ed(this,u.props);let d=n.points;if(c==="text"&&s){const{instancePickingColors:g,..._}=d.data.attributes;d={...d,data:{...d.data,attributes:_}}}o.push(new h(f,this.getSubLayerProps({id:l,updateTriggers:f.updateTriggers,highlightedObjectIndex:r}),d))}}return o}renderLayers(){const{extruded:e}=this.props,n=this._renderPolygonLayer(),s=this._renderLineLayers(),r=this._renderPointLayers();return[!e&&n,s,r,e&&n]}getSubLayerAccessor(e){const{binary:n}=this.state;return!n||typeof e!="function"?super.getSubLayerAccessor(e):(s,r)=>{const{data:i,index:o}=r,a=Q8(i,o);return e(a,r)}}};hh.layerName="GeoJsonLayer",hh.defaultProps=x9;let kg=hh;class M9{constructor(e){this.index=e,this.isVisible=!1,this.isSelected=!1,this.parent=null,this.children=[],this.content=null,this._loader=void 0,this._abortController=null,this._loaderId=0,this._isLoaded=!1,this._isCancelled=!1,this._needsReload=!1}get bbox(){return this._bbox}set bbox(e){this._bbox||(this._bbox=e,"west"in e?this.boundingBox=[[e.west,e.south],[e.east,e.north]]:this.boundingBox=[[e.left,e.top],[e.right,e.bottom]])}get data(){return this.isLoading&&this._loader?this._loader.then(()=>this.data):this.content}get isLoaded(){return this._isLoaded&&!this._needsReload}get isLoading(){return!!this._loader&&!this._isCancelled}get needsReload(){return this._needsReload||this._isCancelled}get byteLength(){const e=this.content?this.content.byteLength:0;return Number.isFinite(e)||console.error("byteLength not defined in tile data"),e}async _loadData({getData:e,requestScheduler:n,onLoad:s,onError:r}){const{index:i,id:o,bbox:a,userData:c,zoom:l}=this,u=this._loaderId;this._abortController=new AbortController;const{signal:h}=this._abortController,f=await n.scheduleRequest(this,_=>_.isSelected?1:-1);if(!f){this._isCancelled=!0;return}if(this._isCancelled){f.done();return}let d=null,g;try{d=await e({index:i,id:o,bbox:a,userData:c,zoom:l,signal:h})}catch(_){g=_||!0}finally{f.done()}if(u===this._loaderId){if(this._loader=void 0,this.content=d,this._isCancelled&&!d){this._isLoaded=!1;return}this._isLoaded=!0,this._isCancelled=!1,g?r(g,this):s(this)}}loadData(e){return this._isLoaded=!1,this._isCancelled=!1,this._needsReload=!1,this._loaderId++,this._loader=this._loadData(e),this._loader}setNeedsReload(){this.isLoading&&(this.abort(),this._loader=void 0),this._needsReload=!0}abort(){var e;this.isLoaded||(this._isCancelled=!0,(e=this._abortController)==null||e.abort())}}const Qe={OUTSIDE:-1,INTERSECTING:0,INSIDE:1},iE=new x,B9=new x;class Dm{constructor(e=[0,0,0],n=[0,0,0],s){s=s||iE.copy(e).add(n).scale(.5),this.center=new x(s),this.halfDiagonal=new x(n).subtract(this.center),this.minimum=new x(e),this.maximum=new x(n)}clone(){return new Dm(this.minimum,this.maximum,this.center)}equals(e){return this===e||!!e&&this.minimum.equals(e.minimum)&&this.maximum.equals(e.maximum)}transform(e){return this.center.transformAsPoint(e),this.halfDiagonal.transform(e),this.minimum.transform(e),this.maximum.transform(e),this}intersectPlane(e){const{halfDiagonal:n}=this,s=B9.from(e.normal),r=n.x*Math.abs(s.x)+n.y*Math.abs(s.y)+n.z*Math.abs(s.z),i=this.center.dot(s)+e.distance;return i-r>0?Qe.INSIDE:i+r<0?Qe.OUTSIDE:Qe.INTERSECTING}distanceTo(e){return Math.sqrt(this.distanceSquaredTo(e))}distanceSquaredTo(e){const n=iE.from(e).subtract(this.center),{halfDiagonal:s}=this;let r=0,i;return i=Math.abs(n.x)-s.x,i>0&&(r+=i*i),i=Math.abs(n.y)-s.y,i>0&&(r+=i*i),i=Math.abs(n.z)-s.z,i>0&&(r+=i*i),r}}const Oo=new x,oE=new x;class sc{constructor(e=[0,0,0],n=0){this.radius=-0,this.center=new x,this.fromCenterRadius(e,n)}fromCenterRadius(e,n){return this.center.from(e),this.radius=n,this}fromCornerPoints(e,n){return n=Oo.from(n),this.center=new x().from(e).add(n).scale(.5),this.radius=this.center.distance(n),this}equals(e){return this===e||!!e&&this.center.equals(e.center)&&this.radius===e.radius}clone(){return new sc(this.center,this.radius)}union(e){const n=this.center,s=this.radius,r=e.center,i=e.radius,o=Oo.copy(r).subtract(n),a=o.magnitude();if(s>=a+i)return this.clone();if(i>=a+s)return e.clone();const c=(s+a+i)*.5;return oE.copy(o).scale((-s+c)/a).add(n),this.center.copy(oE),this.radius=c,this}expand(e){const s=Oo.from(e).subtract(this.center).magnitude();return s>this.radius&&(this.radius=s),this}transform(e){this.center.transform(e);const n=yN(Oo,e);return this.radius=Math.max(n[0],Math.max(n[1],n[2]))*this.radius,this}distanceSquaredTo(e){const n=this.distanceTo(e);return n*n}distanceTo(e){const s=Oo.from(e).subtract(this.center);return Math.max(0,s.len()-this.radius)}intersectPlane(e){const n=this.center,s=this.radius,i=e.normal.dot(n)+e.distance;return i<-s?Qe.OUTSIDE:i<s?Qe.INTERSECTING:Qe.INSIDE}}const O9=new x,N9=new x,nl=new x,sl=new x,rl=new x,F9=new x,D9=new x,jn={COLUMN0ROW0:0,COLUMN0ROW1:1,COLUMN0ROW2:2,COLUMN1ROW0:3,COLUMN1ROW1:4,COLUMN1ROW2:5,COLUMN2ROW0:6,COLUMN2ROW1:7,COLUMN2ROW2:8};class rc{constructor(e=[0,0,0],n=[0,0,0,0,0,0,0,0,0]){this.center=new x().from(e),this.halfAxes=new Ie(n)}get halfSize(){const e=this.halfAxes.getColumn(0),n=this.halfAxes.getColumn(1),s=this.halfAxes.getColumn(2);return[new x(e).len(),new x(n).len(),new x(s).len()]}get quaternion(){const e=this.halfAxes.getColumn(0),n=this.halfAxes.getColumn(1),s=this.halfAxes.getColumn(2),r=new x(e).normalize(),i=new x(n).normalize(),o=new x(s).normalize();return new Fa().fromMatrix3(new Ie([...r,...i,...o]))}fromCenterHalfSizeQuaternion(e,n,s){const r=new Fa(s),i=new Ie().fromQuaternion(r);return i[0]=i[0]*n[0],i[1]=i[1]*n[0],i[2]=i[2]*n[0],i[3]=i[3]*n[1],i[4]=i[4]*n[1],i[5]=i[5]*n[1],i[6]=i[6]*n[2],i[7]=i[7]*n[2],i[8]=i[8]*n[2],this.center=new x().from(e),this.halfAxes=i,this}clone(){return new rc(this.center,this.halfAxes)}equals(e){return this===e||!!e&&this.center.equals(e.center)&&this.halfAxes.equals(e.halfAxes)}getBoundingSphere(e=new sc){const n=this.halfAxes,s=n.getColumn(0,nl),r=n.getColumn(1,sl),i=n.getColumn(2,rl),o=O9.copy(s).add(r).add(i);return e.center.copy(this.center),e.radius=o.magnitude(),e}intersectPlane(e){const n=this.center,s=e.normal,r=this.halfAxes,i=s.x,o=s.y,a=s.z,c=Math.abs(i*r[jn.COLUMN0ROW0]+o*r[jn.COLUMN0ROW1]+a*r[jn.COLUMN0ROW2])+Math.abs(i*r[jn.COLUMN1ROW0]+o*r[jn.COLUMN1ROW1]+a*r[jn.COLUMN1ROW2])+Math.abs(i*r[jn.COLUMN2ROW0]+o*r[jn.COLUMN2ROW1]+a*r[jn.COLUMN2ROW2]),l=s.dot(n)+e.distance;return l<=-c?Qe.OUTSIDE:l>=c?Qe.INSIDE:Qe.INTERSECTING}distanceTo(e){return Math.sqrt(this.distanceSquaredTo(e))}distanceSquaredTo(e){const n=N9.from(e).subtract(this.center),s=this.halfAxes,r=s.getColumn(0,nl),i=s.getColumn(1,sl),o=s.getColumn(2,rl),a=r.magnitude(),c=i.magnitude(),l=o.magnitude();r.normalize(),i.normalize(),o.normalize();let u=0,h;return h=Math.abs(n.dot(r))-a,h>0&&(u+=h*h),h=Math.abs(n.dot(i))-c,h>0&&(u+=h*h),h=Math.abs(n.dot(o))-l,h>0&&(u+=h*h),u}computePlaneDistances(e,n,s=[-0,-0]){let r=Number.POSITIVE_INFINITY,i=Number.NEGATIVE_INFINITY;const o=this.center,a=this.halfAxes,c=a.getColumn(0,nl),l=a.getColumn(1,sl),u=a.getColumn(2,rl),h=F9.copy(c).add(l).add(u).add(o),f=D9.copy(h).subtract(e);let d=n.dot(f);return r=Math.min(d,r),i=Math.max(d,i),h.copy(o).add(c).add(l).subtract(u),f.copy(h).subtract(e),d=n.dot(f),r=Math.min(d,r),i=Math.max(d,i),h.copy(o).add(c).subtract(l).add(u),f.copy(h).subtract(e),d=n.dot(f),r=Math.min(d,r),i=Math.max(d,i),h.copy(o).add(c).subtract(l).subtract(u),f.copy(h).subtract(e),d=n.dot(f),r=Math.min(d,r),i=Math.max(d,i),o.copy(h).subtract(c).add(l).add(u),f.copy(h).subtract(e),d=n.dot(f),r=Math.min(d,r),i=Math.max(d,i),o.copy(h).subtract(c).add(l).subtract(u),f.copy(h).subtract(e),d=n.dot(f),r=Math.min(d,r),i=Math.max(d,i),o.copy(h).subtract(c).subtract(l).add(u),f.copy(h).subtract(e),d=n.dot(f),r=Math.min(d,r),i=Math.max(d,i),o.copy(h).subtract(c).subtract(l).subtract(u),f.copy(h).subtract(e),d=n.dot(f),r=Math.min(d,r),i=Math.max(d,i),s[0]=r,s[1]=i,s}transform(e){this.center.transformAsPoint(e);const n=this.halfAxes.getColumn(0,nl);n.transformAsPoint(e);const s=this.halfAxes.getColumn(1,sl);s.transformAsPoint(e);const r=this.halfAxes.getColumn(2,rl);return r.transformAsPoint(e),this.halfAxes=new Ie([...n,...s,...r]),this}getTransform(){throw new Error("not implemented")}}const aE=new x,cE=new x;class on{constructor(e=[0,0,1],n=0){this.normal=new x,this.distance=-0,this.fromNormalDistance(e,n)}fromNormalDistance(e,n){return an(Number.isFinite(n)),this.normal.from(e).normalize(),this.distance=n,this}fromPointNormal(e,n){e=aE.from(e),this.normal.from(n).normalize();const s=-this.normal.dot(e);return this.distance=s,this}fromCoefficients(e,n,s,r){return this.normal.set(e,n,s),an(Xt(this.normal.len(),1)),this.distance=r,this}clone(){return new on(this.normal,this.distance)}equals(e){return Xt(this.distance,e.distance)&&Xt(this.normal,e.normal)}getPointDistance(e){return this.normal.dot(e)+this.distance}transform(e){const n=cE.copy(this.normal).transformAsVector(e).normalize(),s=this.normal.scale(-this.distance).transform(e);return this.fromPointNormal(s,n)}projectPointOntoPlane(e,n=[0,0,0]){const s=aE.from(e),r=this.getPointDistance(s),i=cE.copy(this.normal).scale(r);return s.subtract(i).to(n)}}const lE=[new x([1,0,0]),new x([0,1,0]),new x([0,0,1])],uE=new x,L9=new x;class It{constructor(e=[]){this.planes=e}fromBoundingSphere(e){this.planes.length=2*lE.length;const n=e.center,s=e.radius;let r=0;for(const i of lE){let o=this.planes[r],a=this.planes[r+1];o||(o=this.planes[r]=new on),a||(a=this.planes[r+1]=new on);const c=uE.copy(i).scale(-s).add(n);o.fromPointNormal(c,i);const l=uE.copy(i).scale(s).add(n),u=L9.copy(i).negate();a.fromPointNormal(l,u),r+=2}return this}computeVisibility(e){let n=Qe.INSIDE;for(const s of this.planes)switch(e.intersectPlane(s)){case Qe.OUTSIDE:return Qe.OUTSIDE;case Qe.INTERSECTING:n=Qe.INTERSECTING;break}return n}computeVisibilityWithPlaneMask(e,n){if(an(Number.isFinite(n),"parentPlaneMask is required."),n===It.MASK_OUTSIDE||n===It.MASK_INSIDE)return n;let s=It.MASK_INSIDE;const r=this.planes;for(let i=0;i<this.planes.length;++i){const o=i<31?1<<i:0;if(i<31&&!(n&o))continue;const a=r[i],c=e.intersectPlane(a);if(c===Qe.OUTSIDE)return It.MASK_OUTSIDE;c===Qe.INTERSECTING&&(s|=o)}return s}}It.MASK_OUTSIDE=4294967295;It.MASK_INSIDE=0;It.MASK_INDETERMINATE=2147483647;new x;new x;new x;new x;new x;new x;new x;new x;new x;new x;new x;new x;new x;new x;new x;new x;new x;const Pn=new Ie,U9=new Ie,k9=new Ie,il=new Ie,hE=new Ie;function z9(t,e={}){const n=sF,s=10;let r=0,i=0;const o=U9,a=k9;o.identity(),a.copy(t);const c=n*V9(a);for(;i<s&&H9(a)>c;)j9(a,il),hE.copy(il).transpose(),a.multiplyRight(il),a.multiplyLeft(hE),o.multiplyRight(il),++r>2&&(++i,r=0);return e.unitary=o.toTarget(e.unitary),e.diagonal=a.toTarget(e.diagonal),e}function V9(t){let e=0;for(let n=0;n<9;++n){const s=t[n];e+=s*s}return Math.sqrt(e)}const zg=[1,0,0],Vg=[2,2,1];function H9(t){let e=0;for(let n=0;n<3;++n){const s=t[Pn.getElementIndex(Vg[n],zg[n])];e+=2*s*s}return Math.sqrt(e)}function j9(t,e){const n=rw;let s=0,r=1;for(let l=0;l<3;++l){const u=Math.abs(t[Pn.getElementIndex(Vg[l],zg[l])]);u>s&&(r=l,s=u)}const i=zg[r],o=Vg[r];let a=1,c=0;if(Math.abs(t[Pn.getElementIndex(o,i)])>n){const l=t[Pn.getElementIndex(o,o)],u=t[Pn.getElementIndex(i,i)],h=t[Pn.getElementIndex(o,i)],f=(l-u)/2/h;let d;f<0?d=-1/(-f+Math.sqrt(1+f*f)):d=1/(f+Math.sqrt(1+f*f)),a=1/Math.sqrt(1+d*d),c=d*a}return Ie.IDENTITY.to(e),e[Pn.getElementIndex(i,i)]=e[Pn.getElementIndex(o,o)]=a,e[Pn.getElementIndex(o,i)]=c,e[Pn.getElementIndex(i,o)]=-c,e}const ms=new x,W9=new x,G9=new x,X9=new x,$9=new x,K9=new Ie,Y9={diagonal:new Ie,unitary:new Ie};function Cb(t,e=new rc){if(!t||t.length===0)return e.halfAxes=new Ie([0,0,0,0,0,0,0,0,0]),e.center=new x,e;const n=t.length,s=new x(0,0,0);for(const N of t)s.add(N);const r=1/n;s.multiplyByScalar(r);let i=0,o=0,a=0,c=0,l=0,u=0;for(const N of t){const F=ms.copy(N).subtract(s);i+=F.x*F.x,o+=F.x*F.y,a+=F.x*F.z,c+=F.y*F.y,l+=F.y*F.z,u+=F.z*F.z}i*=r,o*=r,a*=r,c*=r,l*=r,u*=r;const h=K9;h[0]=i,h[1]=o,h[2]=a,h[3]=o,h[4]=c,h[5]=l,h[6]=a,h[7]=l,h[8]=u;const{unitary:f}=z9(h,Y9),d=e.halfAxes.copy(f);let g=d.getColumn(0,G9),_=d.getColumn(1,X9),E=d.getColumn(2,$9),m=-Number.MAX_VALUE,y=-Number.MAX_VALUE,A=-Number.MAX_VALUE,C=Number.MAX_VALUE,b=Number.MAX_VALUE,P=Number.MAX_VALUE;for(const N of t)ms.copy(N),m=Math.max(ms.dot(g),m),y=Math.max(ms.dot(_),y),A=Math.max(ms.dot(E),A),C=Math.min(ms.dot(g),C),b=Math.min(ms.dot(_),b),P=Math.min(ms.dot(E),P);g=g.multiplyByScalar(.5*(C+m)),_=_.multiplyByScalar(.5*(b+y)),E=E.multiplyByScalar(.5*(P+A)),e.center.copy(g).add(_).add(E);const B=W9.set(m-C,y-b,A-P).multiplyByScalar(.5),O=new Ie([B[0],0,0,0,B[1],0,0,0,B[2]]);return e.halfAxes.multiplyRight(O),e}const Si=512,fE=3,vb=[[.5,.5],[0,0],[0,1],[1,0],[1,1]],wb=vb.concat([[0,.5],[.5,0],[1,.5],[.5,1]]),J9=wb.concat([[.25,.5],[.75,.5]]);class Ci{constructor(e,n,s){this.x=e,this.y=n,this.z=s}get children(){if(!this._children){const e=this.x*2,n=this.y*2,s=this.z+1;this._children=[new Ci(e,n,s),new Ci(e,n+1,s),new Ci(e+1,n,s),new Ci(e+1,n+1,s)]}return this._children}update(e){const{viewport:n,cullingVolume:s,elevationBounds:r,minZ:i,maxZ:o,bounds:a,offset:c,project:l}=e,u=this.getBoundingVolume(r,c,l);if(a&&!this.insideBounds(a)||s.computeVisibility(u)<0)return!1;if(!this.childVisible){let{z:f}=this;if(f<o&&f>=i){const d=u.distanceTo(n.cameraPosition)*n.scale/n.height;f+=Math.floor(Math.log2(d))}if(f>=o)return this.selected=!0,!0}this.selected=!1,this.childVisible=!0;for(const f of this.children)f.update(e);return!0}getSelected(e=[]){if(this.selected&&e.push(this),this._children)for(const n of this._children)n.getSelected(e);return e}insideBounds([e,n,s,r]){const i=Math.pow(2,this.z),o=Si/i;return this.x*o<s&&this.y*o<r&&(this.x+1)*o>e&&(this.y+1)*o>n}getBoundingVolume(e,n,s){if(s){const c=this.z<1?J9:this.z<2?wb:vb,l=[];for(const u of c){const h=Gg(this.x+u[0],this.y+u[1],this.z);h[2]=e[0],l.push(s(h)),e[0]!==e[1]&&(h[2]=e[1],l.push(s(h)))}return Cb(l)}const r=Math.pow(2,this.z),i=Si/r,o=this.x*i+n*Si,a=Si-(this.y+1)*i;return new Dm([o,a,e[0]],[o+i,a+i,e[1]])}}function q9(t,e,n,s){const r=t instanceof v6&&t.resolution?t.projectPosition:null,i=Object.values(t.getFrustumPlanes()).map(({normal:d,distance:g})=>new on(d.clone().negate(),g)),o=new It(i),a=t.distanceScales.unitsPerMeter[2],c=n&&n[0]*a||0,l=n&&n[1]*a||0,u=t instanceof Ji&&t.pitch<=60?e:0;if(s){const[d,g,_,E]=s,m=$i([d,E]),y=$i([_,g]);s=[m[0],Si-m[1],y[0],Si-y[1]]}const h=new Ci(0,0,0),f={viewport:t,project:r,cullingVolume:o,elevationBounds:[c,l],minZ:u,maxZ:e,bounds:s,offset:0};if(h.update(f),t instanceof Ji&&t.subViewports&&t.subViewports.length>1){for(f.offset=-1;h.update(f)&&!(--f.offset<-fE););for(f.offset=1;h.update(f)&&!(++f.offset>fE););}return h.getSelected()}const cs=512,Z9=[-1/0,-1/0,1/0,1/0],Hg={type:"object",value:null,validate:(t,e)=>e.optional&&t===null||typeof t=="string"||Array.isArray(t)&&t.every(n=>typeof n=="string"),equal:(t,e)=>{if(t===e)return!0;if(!Array.isArray(t)||!Array.isArray(e))return!1;const n=t.length;if(n!==e.length)return!1;for(let s=0;s<n;s++)if(t[s]!==e[s])return!1;return!0}};function bb(t,e){const n=[e.transformAsPoint([t[0],t[1]]),e.transformAsPoint([t[2],t[1]]),e.transformAsPoint([t[0],t[3]]),e.transformAsPoint([t[2],t[3]])];return[Math.min(...n.map(r=>r[0])),Math.min(...n.map(r=>r[1])),Math.max(...n.map(r=>r[0])),Math.max(...n.map(r=>r[1]))]}function Q9(t){return Math.abs(t.split("").reduce((e,n)=>(e<<5)-e+n.charCodeAt(0)|0,0))}function jg(t,e){if(!t||!t.length)return null;const{index:n,id:s}=e;if(Array.isArray(t)){const i=Q9(s)%t.length;t=t[i]}let r=t;for(const i of Object.keys(n)){const o=new RegExp(`{${i}}`,"g");r=r.replace(o,String(n[i]))}return Number.isInteger(n.y)&&Number.isInteger(n.z)&&(r=r.replace(/\{-y\}/g,String(Math.pow(2,n.z)-n.y-1))),r}function ez(t,e,n){let s;if(e&&e.length===2){const[r,i]=e,o=t.getBounds({z:r}),a=t.getBounds({z:i});s=[Math.min(o[0],a[0]),Math.min(o[1],a[1]),Math.max(o[2],a[2]),Math.max(o[3],a[3])]}else s=t.getBounds();return t.isGeospatial?[Math.max(s[0],n[0]),Math.max(s[1],n[1]),Math.min(s[2],n[2]),Math.min(s[3],n[3])]:[Math.max(Math.min(s[0],n[2]),n[0]),Math.max(Math.min(s[1],n[3]),n[1]),Math.min(Math.max(s[2],n[0]),n[2]),Math.min(Math.max(s[3],n[1]),n[3])]}function tz({viewport:t,z:e,cullRect:n}){return(t.subViewports||[t]).map(r=>Wg(r,e||0,n))}function Wg(t,e,n){if(!Array.isArray(e)){const i=n.x-t.x,o=n.y-t.y,{width:a,height:c}=n,l={targetZ:e},u=t.unproject([i,o],l),h=t.unproject([i+a,o],l),f=t.unproject([i,o+c],l),d=t.unproject([i+a,o+c],l);return[Math.min(u[0],h[0],f[0],d[0]),Math.min(u[1],h[1],f[1],d[1]),Math.max(u[0],h[0],f[0],d[0]),Math.max(u[1],h[1],f[1],d[1])]}const s=Wg(t,e[0],n),r=Wg(t,e[1],n);return[Math.min(s[0],r[0]),Math.min(s[1],r[1]),Math.max(s[2],r[2]),Math.max(s[3],r[3])]}function nz(t,e,n){return n?bb(t,n).map(r=>r*e/cs):t.map(s=>s*e/cs)}function Lm(t,e){return Math.pow(2,t)*cs/e}function Gg(t,e,n){const s=Lm(n,cs),r=t/s*360-180,i=Math.PI-2*Math.PI*e/s,o=180/Math.PI*Math.atan(.5*(Math.exp(i)-Math.exp(-i)));return[r,o]}function dE(t,e,n,s){const r=Lm(n,s);return[t/r*cs,e/r*cs]}function sz(t,e,n,s,r=cs){if(t.isGeospatial){const[l,u]=Gg(e,n,s),[h,f]=Gg(e+1,n+1,s);return{west:l,north:u,east:h,south:f}}const[i,o]=dE(e,n,s,r),[a,c]=dE(e+1,n+1,s,r);return{left:i,top:o,right:a,bottom:c}}function rz(t,e,n,s,r){const i=ez(t,null,s),o=Lm(e,n),[a,c,l,u]=nz(i,o,r),h=[];for(let f=Math.floor(a);f<l;f++)for(let d=Math.floor(c);d<u;d++)h.push({x:f,y:d,z:e});return h}function iz({viewport:t,maxZoom:e,minZoom:n,zRange:s,extent:r,tileSize:i=cs,modelMatrix:o,modelMatrixInverse:a,zoomOffset:c=0}){let l=t.isGeospatial?Math.round(t.zoom+Math.log2(cs/i))+c:Math.ceil(t.zoom)+c;if(typeof n=="number"&&Number.isFinite(n)&&l<n){if(!r)return[];l=n}typeof e=="number"&&Number.isFinite(e)&&l>e&&(l=e);let u=r;return o&&a&&r&&!t.isGeospatial&&(u=bb(r,o)),t.isGeospatial?q9(t,l,s,r):rz(t,l,i,u||Z9,a)}function oz(t){let e={},n;return s=>{for(const r in s)if(!az(s[r],e[r])){n=t(s),e=s;break}return n}}function az(t,e){if(t===e)return!0;if(Array.isArray(t)){const n=t.length;if(!e||e.length!==n)return!1;for(let s=0;s<n;s++)if(t[s]!==e[s])return!1;return!0}return!1}const pE=1,Xh=2,cz="never",lz="no-overlap",Um="best-available",uz=5,hz={[Um]:pz,[lz]:gz,[cz]:()=>{}},fz={extent:null,tileSize:512,maxZoom:null,minZoom:null,maxCacheSize:null,maxCacheByteSize:null,refinementStrategy:"best-available",zRange:null,maxRequests:6,debounceTime:0,zoomOffset:0,onTileLoad:()=>{},onTileUnload:()=>{},onTileError:()=>{}};class dz{constructor(e){this._getCullBounds=oz(tz),this.opts={...fz,...e},this.setOptions(this.opts),this.onTileLoad=n=>{var s,r;(r=(s=this.opts).onTileLoad)==null||r.call(s,n),this.opts.maxCacheByteSize&&(this._cacheByteSize+=n.byteLength,this._resizeCache())},this._requestScheduler=new Z1({throttleRequests:this.opts.maxRequests>0||this.opts.debounceTime>0,maxRequests:this.opts.maxRequests,debounceTime:this.opts.debounceTime}),this._cache=new Map,this._tiles=[],this._dirty=!1,this._cacheByteSize=0,this._viewport=null,this._zRange=null,this._selectedTiles=null,this._frameNumber=0,this._modelMatrix=new q,this._modelMatrixInverse=new q}get tiles(){return this._tiles}get selectedTiles(){return this._selectedTiles}get isLoaded(){return this._selectedTiles!==null&&this._selectedTiles.every(e=>e.isLoaded)}get needsReload(){return this._selectedTiles!==null&&this._selectedTiles.some(e=>e.needsReload)}setOptions(e){Object.assign(this.opts,e),Number.isFinite(e.maxZoom)&&(this._maxZoom=Math.floor(e.maxZoom)),Number.isFinite(e.minZoom)&&(this._minZoom=Math.ceil(e.minZoom))}finalize(){for(const e of this._cache.values())e.isLoading&&e.abort();this._cache.clear(),this._tiles=[],this._selectedTiles=null}reloadAll(){for(const e of this._cache.keys()){const n=this._cache.get(e);!this._selectedTiles||!this._selectedTiles.includes(n)?this._cache.delete(e):n.setNeedsReload()}}update(e,{zRange:n,modelMatrix:s}={zRange:null,modelMatrix:null}){const r=s?new q(s):new q,i=!r.equals(this._modelMatrix);if(!this._viewport||!e.equals(this._viewport)||!Xt(this._zRange,n)||i){i&&(this._modelMatrixInverse=r.clone().invert(),this._modelMatrix=r),this._viewport=e,this._zRange=n;const a=this.getTileIndices({viewport:e,maxZoom:this._maxZoom,minZoom:this._minZoom,zRange:n,modelMatrix:this._modelMatrix,modelMatrixInverse:this._modelMatrixInverse});this._selectedTiles=a.map(c=>this._getTile(c,!0)),this._dirty&&this._rebuildTree()}else this.needsReload&&(this._selectedTiles=this._selectedTiles.map(a=>this._getTile(a.index,!0)));const o=this.updateTileStates();return this._pruneRequests(),this._dirty&&this._resizeCache(),o&&this._frameNumber++,this._frameNumber}isTileVisible(e,n){if(!e.isVisible)return!1;if(n&&this._viewport){const s=this._getCullBounds({viewport:this._viewport,z:this._zRange,cullRect:n}),{bbox:r}=e;for(const[i,o,a,c]of s){let l;if("west"in r)l=r.west<a&&r.east>i&&r.south<c&&r.north>o;else{const u=Math.min(r.top,r.bottom),h=Math.max(r.top,r.bottom);l=r.left<a&&r.right>i&&u<c&&h>o}if(l)return!0}return!1}return!0}getTileIndices({viewport:e,maxZoom:n,minZoom:s,zRange:r,modelMatrix:i,modelMatrixInverse:o}){const{tileSize:a,extent:c,zoomOffset:l}=this.opts;return iz({viewport:e,maxZoom:n,minZoom:s,zRange:r,tileSize:a,extent:c,modelMatrix:i,modelMatrixInverse:o,zoomOffset:l})}getTileId(e){return`${e.x}-${e.y}-${e.z}`}getTileZoom(e){return e.z}getTileMetadata(e){const{tileSize:n}=this.opts;return{bbox:sz(this._viewport,e.x,e.y,e.z,n)}}getParentIndex(e){const n=Math.floor(e.x/2),s=Math.floor(e.y/2),r=e.z-1;return{x:n,y:s,z:r}}updateTileStates(){const e=this.opts.refinementStrategy||Um,n=new Array(this._cache.size);let s=0;for(const r of this._cache.values())n[s++]=r.isVisible,r.isSelected=!1,r.isVisible=!1;for(const r of this._selectedTiles)r.isSelected=!0,r.isVisible=!0;(typeof e=="function"?e:hz[e])(Array.from(this._cache.values())),s=0;for(const r of this._cache.values())if(n[s++]!==r.isVisible)return!0;return!1}_pruneRequests(){const{maxRequests:e=0}=this.opts,n=[];let s=0;for(const r of this._cache.values())r.isLoading&&(s++,!r.isSelected&&!r.isVisible&&n.push(r));for(;e>0&&s>e&&n.length>0;)n.shift().abort(),s--}_rebuildTree(){const{_cache:e}=this;for(const n of e.values())n.parent=null,n.children&&(n.children.length=0);for(const n of e.values()){const s=this._getNearestAncestor(n);n.parent=s,s!=null&&s.children&&s.children.push(n)}}_resizeCache(){var o,a;const{_cache:e,opts:n}=this,s=n.maxCacheSize||(n.maxCacheByteSize?1/0:uz*this.selectedTiles.length),r=n.maxCacheByteSize||1/0;if(e.size>s||this._cacheByteSize>r){for(const[c,l]of e)if(!l.isVisible&&!l.isSelected&&(this._cacheByteSize-=n.maxCacheByteSize?l.byteLength:0,e.delete(c),(a=(o=this.opts).onTileUnload)==null||a.call(o,l)),e.size<=s&&this._cacheByteSize<=r)break;this._rebuildTree(),this._dirty=!0}this._dirty&&(this._tiles=Array.from(this._cache.values()).sort((c,l)=>c.zoom-l.zoom),this._dirty=!1)}_getTile(e,n){const s=this.getTileId(e);let r=this._cache.get(s),i=!1;return!r&&n?(r=new M9(e),Object.assign(r,this.getTileMetadata(r.index)),Object.assign(r,{id:s,zoom:this.getTileZoom(r.index)}),i=!0,this._cache.set(s,r),this._dirty=!0):r&&r.needsReload&&(i=!0),r&&i&&r.loadData({getData:this.opts.getTileData,requestScheduler:this._requestScheduler,onLoad:this.onTileLoad,onError:this.opts.onTileError}),r}_getNearestAncestor(e){const{_minZoom:n=0}=this;let s=e.index;for(;this.getTileZoom(s)>n;){s=this.getParentIndex(s);const r=this._getTile(s);if(r)return r}return null}}function pz(t){for(const e of t)e.state=0;for(const e of t)e.isSelected&&!Rb(e)&&km(e);for(const e of t)e.isVisible=!!(e.state&Xh)}function gz(t){for(const n of t)n.state=0;for(const n of t)n.isSelected&&Rb(n);const e=Array.from(t).sort((n,s)=>n.zoom-s.zoom);for(const n of e)if(n.isVisible=!!(n.state&Xh),n.children&&(n.isVisible||n.state&pE))for(const s of n.children)s.state=pE;else n.isSelected&&km(n)}function Rb(t){let e=t;for(;e;){if(e.isLoaded||e.content)return e.state|=Xh,!0;e=e.parent}return!1}function km(t){for(const e of t.children)e.isLoaded||e.content?e.state|=Xh:km(e)}const _z={TilesetClass:dz,data:{type:"data",value:[]},dataComparator:Hg.equal,renderSubLayers:{type:"function",value:t=>new kg(t)},getTileData:{type:"function",optional:!0,value:null},onViewportLoad:{type:"function",optional:!0,value:null},onTileLoad:{type:"function",value:t=>{}},onTileUnload:{type:"function",value:t=>{}},onTileError:{type:"function",value:t=>console.error(t)},extent:{type:"array",optional:!0,value:null,compare:!0},tileSize:512,maxZoom:null,minZoom:0,maxCacheSize:null,maxCacheByteSize:null,refinementStrategy:Um,zRange:null,maxRequests:6,debounceTime:0,zoomOffset:0},fh=class fh extends Or{initializeState(){this.state={tileset:null,isLoaded:!1}}finalizeState(){var e,n;(n=(e=this.state)==null?void 0:e.tileset)==null||n.finalize()}get isLoaded(){var e,n,s;return!!((s=(n=(e=this.state)==null?void 0:e.tileset)==null?void 0:n.selectedTiles)!=null&&s.every(r=>r.isLoaded&&r.layers&&r.layers.every(i=>i.isLoaded)))}shouldUpdateState({changeFlags:e}){return e.somethingChanged}updateState({changeFlags:e}){let{tileset:n}=this.state;const s=e.propsOrDataChanged||e.updateTriggersChanged,r=e.dataChanged||e.updateTriggersChanged&&(e.updateTriggersChanged.all||e.updateTriggersChanged.getTileData);n?s&&(n.setOptions(this._getTilesetOptions()),r?n.reloadAll():n.tiles.forEach(i=>{i.layers=null})):(n=new this.props.TilesetClass(this._getTilesetOptions()),this.setState({tileset:n})),this._updateTileset()}_getTilesetOptions(){const{tileSize:e,maxCacheSize:n,maxCacheByteSize:s,refinementStrategy:r,extent:i,maxZoom:o,minZoom:a,maxRequests:c,debounceTime:l,zoomOffset:u}=this.props;return{maxCacheSize:n,maxCacheByteSize:s,maxZoom:o,minZoom:a,tileSize:e,refinementStrategy:r,extent:i,maxRequests:c,debounceTime:l,zoomOffset:u,getTileData:this.getTileData.bind(this),onTileLoad:this._onTileLoad.bind(this),onTileError:this._onTileError.bind(this),onTileUnload:this._onTileUnload.bind(this)}}_updateTileset(){const e=this.state.tileset,{zRange:n,modelMatrix:s}=this.props,r=e.update(this.context.viewport,{zRange:n,modelMatrix:s}),{isLoaded:i}=e,o=this.state.isLoaded!==i,a=this.state.frameNumber!==r;i&&(o||a)&&this._onViewportLoad(),a&&this.setState({frameNumber:r}),this.state.isLoaded=i}_onViewportLoad(){const{tileset:e}=this.state,{onViewportLoad:n}=this.props;n&&n(e.selectedTiles)}_onTileLoad(e){this.props.onTileLoad(e),e.layers=null,this.setNeedsUpdate()}_onTileError(e,n){this.props.onTileError(e),n.layers=null,this.setNeedsUpdate()}_onTileUnload(e){this.props.onTileUnload(e)}getTileData(e){const{data:n,getTileData:s,fetch:r}=this.props,{signal:i}=e;return e.url=typeof n=="string"||Array.isArray(n)?jg(n,e):null,s?s(e):r&&e.url?r(e.url,{propName:"data",layer:this,signal:i}):null}renderSubLayers(e){return this.props.renderSubLayers(e)}getSubLayerPropsByTile(e){return null}getPickingInfo(e){const n=e.sourceLayer.props.tile,s=e.info;return s.picked&&(s.tile=n),s.sourceTile=n,s}_updateAutoHighlight(e){const n=e.sourceTile;if(n&&n.layers)for(const s of n.layers)s.updateAutoHighlight(e)}renderLayers(){return this.state.tileset.tiles.map(e=>{const n=this.getSubLayerPropsByTile(e);if(!(!e.isLoaded&&!e.content))if(e.layers)n&&e.layers[0]&&Object.keys(n).some(s=>e.layers[0].props[s]!==n[s])&&(e.layers=e.layers.map(s=>s.clone(n)));else{const s=this.renderSubLayers({...this.props,...this.getSubLayerProps({id:e.id,updateTriggers:this.props.updateTriggers}),data:e.content,_offset:0,tile:e});e.layers=Uh(s,Boolean).map(r=>r.clone({tile:e,...n}))}return e.layers})}filterSubLayer({layer:e,cullRect:n}){const{tile:s}=e.props;return this.state.tileset.isTileVisible(s,n)}};fh.defaultProps=_z,fh.layerName="TileLayer";let Ou=fh;const Sd=Math.PI/180,ol=new Float32Array(16),gE=new Float32Array(12);function _E(t,e,n){const s=e[0]*Sd,r=e[1]*Sd,i=e[2]*Sd,o=Math.sin(i),a=Math.sin(s),c=Math.sin(r),l=Math.cos(i),u=Math.cos(s),h=Math.cos(r),f=n[0],d=n[1],g=n[2];t[0]=f*h*u,t[1]=f*c*u,t[2]=f*-a,t[3]=d*(-c*l+h*a*o),t[4]=d*(h*l+c*a*o),t[5]=d*u*o,t[6]=g*(c*o+h*a*l),t[7]=g*(-h*o+c*a*l),t[8]=g*u*l}function mE(t){return t[0]=t[0],t[1]=t[1],t[2]=t[2],t[3]=t[4],t[4]=t[5],t[5]=t[6],t[6]=t[8],t[7]=t[9],t[8]=t[10],t[9]=t[12],t[10]=t[13],t[11]=t[14],t.subarray(0,12)}const Ib={size:12,accessor:["getOrientation","getScale","getTranslation","getTransformMatrix"],shaderAttributes:{instanceModelMatrixCol0:{size:3,elementOffset:0},instanceModelMatrixCol1:{size:3,elementOffset:3},instanceModelMatrixCol2:{size:3,elementOffset:6},instanceTranslation:{size:3,elementOffset:9}},update(t,{startRow:e,endRow:n}){const{data:s,getOrientation:r,getScale:i,getTranslation:o,getTransformMatrix:a}=this.props,c=Array.isArray(a),l=c&&a.length===16,u=Array.isArray(i),h=Array.isArray(r),f=Array.isArray(o),d=l||!c&&!!a(s[0]);d?t.constant=l:t.constant=h&&u&&f;const g=t.value;if(t.constant){let _;d?(ol.set(a),_=mE(ol)):(_=gE,_E(_,r,i),_.set(o,9)),t.value=new Float32Array(_)}else{let _=e*t.size;const{iterable:E,objectInfo:m}=nc(s,e,n);for(const y of E){m.index++;let A;if(d)ol.set(l?a:a(y,m)),A=mE(ol);else{A=gE;const C=h?r:r(y,m),b=u?i:i(y,m);_E(A,C,b),A.set(f?o:o(y,m),9)}g[_++]=A[0],g[_++]=A[1],g[_++]=A[2],g[_++]=A[3],g[_++]=A[4],g[_++]=A[5],g[_++]=A[6],g[_++]=A[7],g[_++]=A[8],g[_++]=A[9],g[_++]=A[10],g[_++]=A[11]}}}};function Pb(t,e){return e===Z.CARTESIAN||e===Z.METER_OFFSETS||e===Z.DEFAULT&&!t.isGeospatial}const mz=`#version 300 es
#define SHADER_NAME simple-mesh-layer-vs
uniform float sizeScale;
uniform bool composeModelMatrix;
in vec3 positions;
in vec3 normals;
in vec3 colors;
in vec2 texCoords;
in vec3 instancePositions;
in vec3 instancePositions64Low;
in vec4 instanceColors;
in vec3 instancePickingColors;
in vec3 instanceModelMatrixCol0;
in vec3 instanceModelMatrixCol1;
in vec3 instanceModelMatrixCol2;
in vec3 instanceTranslation;
out vec2 vTexCoord;
out vec3 cameraPosition;
out vec3 normals_commonspace;
out vec4 position_commonspace;
out vec4 vColor;
void main(void) {
geometry.worldPosition = instancePositions;
geometry.uv = texCoords;
geometry.pickingColor = instancePickingColors;
vTexCoord = texCoords;
cameraPosition = project_uCameraPosition;
vColor = vec4(colors * instanceColors.rgb, instanceColors.a);
mat3 instanceModelMatrix = mat3(instanceModelMatrixCol0, instanceModelMatrixCol1, instanceModelMatrixCol2);
vec3 pos = (instanceModelMatrix * positions) * sizeScale + instanceTranslation;
if (composeModelMatrix) {
DECKGL_FILTER_SIZE(pos, geometry);
normals_commonspace = project_normal(instanceModelMatrix * normals);
geometry.worldPosition += pos;
gl_Position = project_position_to_clipspace(pos + instancePositions, instancePositions64Low, vec3(0.0), position_commonspace);
geometry.position = position_commonspace;
}
else {
pos = project_size(pos);
DECKGL_FILTER_SIZE(pos, geometry);
gl_Position = project_position_to_clipspace(instancePositions, instancePositions64Low, pos, position_commonspace);
geometry.position = position_commonspace;
normals_commonspace = project_normal(instanceModelMatrix * normals);
}
geometry.normal = normals_commonspace;
DECKGL_FILTER_GL_POSITION(gl_Position, geometry);
DECKGL_FILTER_COLOR(vColor, geometry);
}
`,yz=`#version 300 es
#define SHADER_NAME simple-mesh-layer-fs
precision highp float;
uniform bool hasTexture;
uniform sampler2D sampler;
uniform bool flatShading;
uniform float opacity;
in vec2 vTexCoord;
in vec3 cameraPosition;
in vec3 normals_commonspace;
in vec4 position_commonspace;
in vec4 vColor;
out vec4 fragColor;
void main(void) {
geometry.uv = vTexCoord;
vec3 normal;
if (flatShading) {
normal = normalize(cross(dFdx(position_commonspace.xyz), dFdy(position_commonspace.xyz)));
} else {
normal = normals_commonspace;
}
vec4 color = hasTexture ? texture(sampler, vTexCoord) : vColor;
DECKGL_FILTER_COLOR(color, geometry);
vec3 lightColor = lighting_getLightColor(color.rgb, cameraPosition, position_commonspace.xyz, normal);
fragColor = vec4(lightColor, color.a * opacity);
}
`;function Cd(t){const e=t.positions||t.POSITION;J.assert(e,'no "postions" or "POSITION" attribute in mesh');const n=e.value.length/e.size;let s=t.COLOR_0||t.colors;s||(s={size:3,value:new Float32Array(n*3).fill(1)});let r=t.NORMAL||t.normals;r||(r={size:3,value:new Float32Array(n*3).fill(0)});let i=t.TEXCOORD_0||t.texCoords;return i||(i={size:2,value:new Float32Array(n*2).fill(0)}),{positions:e,colors:s,normals:r,texCoords:i}}function yE(t){return t instanceof Kt?(t.attributes=Cd(t.attributes),t):t.attributes?new Kt({...t,topology:"triangle-list",attributes:Cd(t.attributes)}):new Kt({topology:"triangle-list",attributes:Cd(t)})}const Az=[0,0,0,255],Tz={mesh:{type:"object",value:null,async:!0},texture:{type:"image",value:null,async:!0},sizeScale:{type:"number",value:1,min:0},_instanced:!0,wireframe:!1,material:!0,getPosition:{type:"accessor",value:t=>t.position},getColor:{type:"accessor",value:Az},getOrientation:{type:"accessor",value:[0,0,0]},getScale:{type:"accessor",value:[1,1,1]},getTranslation:{type:"accessor",value:[0,0,0]},getTransformMatrix:{type:"accessor",value:[]},textureParameters:{type:"object",ignore:!0,value:null}},dh=class dh extends qt{getShaders(){return super.getShaders({vs:mz,fs:yz,modules:[qs,cF,Zs]})}getBounds(){var s;if(this.props._instanced)return super.getBounds();let e=this.state.positionBounds;if(e)return e;const{mesh:n}=this.props;if(!n)return null;if(e=(s=n.header)==null?void 0:s.boundingBox,!e){const{attributes:r}=yE(n);r.POSITION=r.POSITION||r.positions,e=cm(r)}return this.state.positionBounds=e,e}initializeState(){this.getAttributeManager().addInstanced({instancePositions:{transition:!0,type:"float64",fp64:this.use64bitPositions(),size:3,accessor:"getPosition"},instanceColors:{type:"unorm8",transition:!0,size:this.props.colorFormat.length,accessor:"getColor",defaultValue:[0,0,0,255]},instanceModelMatrix:Ib}),this.setState({emptyTexture:this.context.device.createTexture({data:new Uint8Array(4),width:1,height:1})})}updateState(e){var i;super.updateState(e);const{props:n,oldProps:s,changeFlags:r}=e;if(n.mesh!==s.mesh||r.extensionsChanged){if(this.state.positionBounds=null,(i=this.state.model)==null||i.destroy(),n.mesh){this.state.model=this.getModel(n.mesh);const o=n.mesh.attributes||n.mesh;this.setState({hasNormals:!!(o.NORMAL||o.normals)})}this.getAttributeManager().invalidateAll()}n.texture!==s.texture&&n.texture instanceof Rt&&this.setTexture(n.texture),this.state.model&&this.state.model.setTopology(this.props.wireframe?"line-strip":"triangle-list")}finalizeState(e){super.finalizeState(e),this.state.emptyTexture.delete()}draw({uniforms:e}){const{model:n}=this.state;if(!n)return;const{viewport:s,renderPass:r}=this.context,{sizeScale:i,coordinateSystem:o,_instanced:a}=this.props;n.setUniforms(e),n.setUniforms({sizeScale:i,composeModelMatrix:!a||Pb(s,o),flatShading:!this.state.hasNormals}),n.draw(r)}get isLoaded(){var e;return!!((e=this.state)!=null&&e.model&&super.isLoaded)}getModel(e){const n=new ct(this.context.device,{...this.getShaders(),id:this.props.id,bufferLayout:this.getAttributeManager().getBufferLayouts(),geometry:yE(e),isInstanced:!0}),{texture:s}=this.props,{emptyTexture:r}=this.state;return n.setBindings({sampler:s||r}),n.setUniforms({hasTexture:!!s}),n}setTexture(e){const{emptyTexture:n,model:s}=this.state;s&&(s.setBindings({sampler:e||n}),s.setUniforms({hasTexture:!!e}))}};dh.defaultProps=Tz,dh.layerName="SimpleMeshLayer";let ja=dh;var cn;(function(t){t[t.FUNC_ADD=32774]="FUNC_ADD",t[t.ONE=1]="ONE",t[t.SRC_ALPHA=770]="SRC_ALPHA",t[t.ONE_MINUS_SRC_ALPHA=771]="ONE_MINUS_SRC_ALPHA",t[t.TEXTURE_MIN_FILTER=10241]="TEXTURE_MIN_FILTER",t[t.LINEAR=9729]="LINEAR",t[t.LINEAR_MIPMAP_NEAREST=9985]="LINEAR_MIPMAP_NEAREST",t[t.UNPACK_FLIP_Y_WEBGL=37440]="UNPACK_FLIP_Y_WEBGL"})(cn||(cn={}));function xb(t,e,n,s){const r={defines:{MANUAL_SRGB:1,SRGB_FAST_APPROXIMATION:1},bindings:{},uniforms:{u_Camera:[0,0,0],u_MetallicRoughnessValues:[1,1]},parameters:{},glParameters:{},generatedTextures:[]};r.defines.USE_TEX_LOD=1;const{imageBasedLightingEnvironment:i}=s;return i&&(r.bindings.u_DiffuseEnvSampler=i.diffuseEnvSampler,r.bindings.u_SpecularEnvSampler=i.specularEnvSampler,r.bindings.u_brdfLUT=i.brdfLutTexture,r.uniforms.u_ScaleIBLAmbient=[1,1]),s!=null&&s.pbrDebug&&(r.defines.PBR_DEBUG=1,r.uniforms.u_ScaleDiffBaseMR=[0,0,0,0],r.uniforms.u_ScaleFGDSpec=[0,0,0,0]),n.NORMAL&&(r.defines.HAS_NORMALS=1),n.TANGENT&&(s!=null&&s.useTangents)&&(r.defines.HAS_TANGENTS=1),n.TEXCOORD_0&&(r.defines.HAS_UV=1),s!=null&&s.imageBasedLightingEnvironment&&(r.defines.USE_IBL=1),s!=null&&s.lights&&(r.defines.USE_LIGHTS=1),e&&Ez(t,e,r),r}function Ez(t,e,n){if(n.uniforms.pbr_uUnlit=!!e.unlit,e.pbrMetallicRoughness&&Sz(t,e.pbrMetallicRoughness,n),e.normalTexture){fa(t,e.normalTexture,"u_NormalSampler","HAS_NORMALMAP",n);const{scale:s=1}=e.normalTexture;n.uniforms.u_NormalScale=s}if(e.occlusionTexture){fa(t,e.occlusionTexture,"u_OcclusionSampler","HAS_OCCLUSIONMAP",n);const{strength:s=1}=e.occlusionTexture;n.uniforms.u_OcclusionStrength=s}switch(e.emissiveTexture&&(fa(t,e.emissiveTexture,"u_EmissiveSampler","HAS_EMISSIVEMAP",n),n.uniforms.u_EmissiveFactor=e.emissiveFactor||[0,0,0]),e.alphaMode){case"MASK":const{alphaCutoff:s=.5}=e;n.defines.ALPHA_CUTOFF=1,n.uniforms.u_AlphaCutoff=s;break;case"BLEND":U.warn("glTF BLEND alphaMode might not work well because it requires mesh sorting")(),n.parameters.blendColorOperation="add",n.parameters.blendColorSrcFactor="src-alpha",n.parameters.blendColorDstFactor="one-minus-src-alpha",n.parameters.blendAlphaOperation="add",n.parameters.blendAlphaSrcFactor="one",n.parameters.blendAlphaDstFactor="one-minus-src-alpha",n.glParameters.blend=!0,n.glParameters.blendEquation=cn.FUNC_ADD,n.glParameters.blendFunc=[cn.SRC_ALPHA,cn.ONE_MINUS_SRC_ALPHA,cn.ONE,cn.ONE_MINUS_SRC_ALPHA];break}}function Sz(t,e,n){e.baseColorTexture&&fa(t,e.baseColorTexture,"u_BaseColorSampler","HAS_BASECOLORMAP",n),n.uniforms.u_BaseColorFactor=e.baseColorFactor||[1,1,1,1],e.metallicRoughnessTexture&&fa(t,e.metallicRoughnessTexture,"u_MetallicRoughnessSampler","HAS_METALROUGHNESSMAP",n);const{metallicFactor:s=1,roughnessFactor:r=1}=e;n.uniforms.u_MetallicRoughnessValues=[s,r]}function fa(t,e,n,s=null,r){var u,h;const i=((h=(u=e==null?void 0:e.texture)==null?void 0:u.sampler)==null?void 0:h.parameters)||{},o=e.texture.source.image;let a,c={};o.compressed?(a=o,c={[cn.TEXTURE_MIN_FILTER]:o.data.length>1?cn.LINEAR_MIPMAP_NEAREST:cn.LINEAR}):a={data:o};const l=t.createTexture({id:e.uniformName||e.id,parameters:{...i,...c},pixelStore:{[cn.UNPACK_FLIP_Y_WEBGL]:!1},...a});r.bindings[n]=l,s&&(r.defines[s]=1),r.generatedTextures.push(l)}const Cz="4.2.0-beta.2",Nu={TRANSCODER:"basis_transcoder.js",TRANSCODER_WASM:"basis_transcoder.wasm",ENCODER:"basis_encoder.js",ENCODER_WASM:"basis_encoder.wasm"};let AE;async function TE(t){D3(t.modules);const e=L3("basis");return e||(AE||(AE=vz(t)),await AE)}async function vz(t){let e=null,n=null;return[e,n]=await Promise.all([await Er(Nu.TRANSCODER,"textures",t),await Er(Nu.TRANSCODER_WASM,"textures",t)]),e=e||globalThis.BASIS,await wz(e,n)}function wz(t,e){const n={};return e&&(n.wasmBinary=e),new Promise(s=>{t(n).then(r=>{const{BasisFile:i,initializeBasis:o}=r;o(),s({BasisFile:i})})})}let vd;async function EE(t){const e=t.modules||{};return e.basisEncoder?e.basisEncoder:(vd=vd||bz(t),await vd)}async function bz(t){let e=null,n=null;return[e,n]=await Promise.all([await Er(Nu.ENCODER,"textures",t),await Er(Nu.ENCODER_WASM,"textures",t)]),e=e||globalThis.BASIS,await Rz(e,n)}function Rz(t,e){const n={};return e&&(n.wasmBinary=e),new Promise(s=>{t(n).then(r=>{const{BasisFile:i,KTX2File:o,initializeBasis:a,BasisEncoder:c}=r;a(),s({BasisFile:i,KTX2File:o,BasisEncoder:c})})})}const qr={COMPRESSED_RGB_S3TC_DXT1_EXT:33776,COMPRESSED_RGBA_S3TC_DXT1_EXT:33777,COMPRESSED_RGBA_S3TC_DXT3_EXT:33778,COMPRESSED_RGBA_S3TC_DXT5_EXT:33779,COMPRESSED_R11_EAC:37488,COMPRESSED_SIGNED_R11_EAC:37489,COMPRESSED_RG11_EAC:37490,COMPRESSED_SIGNED_RG11_EAC:37491,COMPRESSED_RGB8_ETC2:37492,COMPRESSED_RGBA8_ETC2_EAC:37493,COMPRESSED_SRGB8_ETC2:37494,COMPRESSED_SRGB8_ALPHA8_ETC2_EAC:37495,COMPRESSED_RGB8_PUNCHTHROUGH_ALPHA1_ETC2:37496,COMPRESSED_SRGB8_PUNCHTHROUGH_ALPHA1_ETC2:37497,COMPRESSED_RGB_PVRTC_4BPPV1_IMG:35840,COMPRESSED_RGBA_PVRTC_4BPPV1_IMG:35842,COMPRESSED_RGB_PVRTC_2BPPV1_IMG:35841,COMPRESSED_RGBA_PVRTC_2BPPV1_IMG:35843,COMPRESSED_RGB_ETC1_WEBGL:36196,COMPRESSED_RGB_ATC_WEBGL:35986,COMPRESSED_RGBA_ATC_EXPLICIT_ALPHA_WEBGL:35987,COMPRESSED_RGBA_ATC_INTERPOLATED_ALPHA_WEBGL:34798,COMPRESSED_RGBA_ASTC_4X4_KHR:37808,COMPRESSED_RGBA_ASTC_5X4_KHR:37809,COMPRESSED_RGBA_ASTC_5X5_KHR:37810,COMPRESSED_RGBA_ASTC_6X5_KHR:37811,COMPRESSED_RGBA_ASTC_6X6_KHR:37812,COMPRESSED_RGBA_ASTC_8X5_KHR:37813,COMPRESSED_RGBA_ASTC_8X6_KHR:37814,COMPRESSED_RGBA_ASTC_8X8_KHR:37815,COMPRESSED_RGBA_ASTC_10X5_KHR:37816,COMPRESSED_RGBA_ASTC_10X6_KHR:37817,COMPRESSED_RGBA_ASTC_10X8_KHR:37818,COMPRESSED_RGBA_ASTC_10X10_KHR:37819,COMPRESSED_RGBA_ASTC_12X10_KHR:37820,COMPRESSED_RGBA_ASTC_12X12_KHR:37821,COMPRESSED_SRGB8_ALPHA8_ASTC_4X4_KHR:37840,COMPRESSED_SRGB8_ALPHA8_ASTC_5X4_KHR:37841,COMPRESSED_SRGB8_ALPHA8_ASTC_5X5_KHR:37842,COMPRESSED_SRGB8_ALPHA8_ASTC_6X5_KHR:37843,COMPRESSED_SRGB8_ALPHA8_ASTC_6X6_KHR:37844,COMPRESSED_SRGB8_ALPHA8_ASTC_8X5_KHR:37845,COMPRESSED_SRGB8_ALPHA8_ASTC_8X6_KHR:37846,COMPRESSED_SRGB8_ALPHA8_ASTC_8X8_KHR:37847,COMPRESSED_SRGB8_ALPHA8_ASTC_10X5_KHR:37848,COMPRESSED_SRGB8_ALPHA8_ASTC_10X6_KHR:37849,COMPRESSED_SRGB8_ALPHA8_ASTC_10X8_KHR:37850,COMPRESSED_SRGB8_ALPHA8_ASTC_10X10_KHR:37851,COMPRESSED_SRGB8_ALPHA8_ASTC_12X10_KHR:37852,COMPRESSED_SRGB8_ALPHA8_ASTC_12X12_KHR:37853,COMPRESSED_RED_RGTC1_EXT:36283,COMPRESSED_SIGNED_RED_RGTC1_EXT:36284,COMPRESSED_RED_GREEN_RGTC2_EXT:36285,COMPRESSED_SIGNED_RED_GREEN_RGTC2_EXT:36286,COMPRESSED_SRGB_S3TC_DXT1_EXT:35916,COMPRESSED_SRGB_ALPHA_S3TC_DXT1_EXT:35917,COMPRESSED_SRGB_ALPHA_S3TC_DXT3_EXT:35918,COMPRESSED_SRGB_ALPHA_S3TC_DXT5_EXT:35919},Iz=["","WEBKIT_","MOZ_"],SE={WEBGL_compressed_texture_s3tc:"dxt",WEBGL_compressed_texture_s3tc_srgb:"dxt-srgb",WEBGL_compressed_texture_etc1:"etc1",WEBGL_compressed_texture_etc:"etc2",WEBGL_compressed_texture_pvrtc:"pvrtc",WEBGL_compressed_texture_atc:"atc",WEBGL_compressed_texture_astc:"astc",EXT_texture_compression_rgtc:"rgtc"};let al=null;function Pz(t){if(!al){t=t||xz()||void 0,al=new Set;for(const e of Iz)for(const n in SE)if(t&&t.getExtension(`${e}${n}`)){const s=SE[n];al.add(s)}}return al}function xz(){try{return document.createElement("canvas").getContext("webgl")}catch{return null}}var CE,vE,wE,bE,RE,IE,PE,xE;(function(t){t[t.NONE=0]="NONE",t[t.BASISLZ=1]="BASISLZ",t[t.ZSTD=2]="ZSTD",t[t.ZLIB=3]="ZLIB"})(CE||(CE={})),function(t){t[t.BASICFORMAT=0]="BASICFORMAT"}(vE||(vE={})),function(t){t[t.UNSPECIFIED=0]="UNSPECIFIED",t[t.ETC1S=163]="ETC1S",t[t.UASTC=166]="UASTC"}(wE||(wE={})),function(t){t[t.UNSPECIFIED=0]="UNSPECIFIED",t[t.SRGB=1]="SRGB"}(bE||(bE={})),function(t){t[t.UNSPECIFIED=0]="UNSPECIFIED",t[t.LINEAR=1]="LINEAR",t[t.SRGB=2]="SRGB",t[t.ITU=3]="ITU",t[t.NTSC=4]="NTSC",t[t.SLOG=5]="SLOG",t[t.SLOG2=6]="SLOG2"}(RE||(RE={})),function(t){t[t.ALPHA_STRAIGHT=0]="ALPHA_STRAIGHT",t[t.ALPHA_PREMULTIPLIED=1]="ALPHA_PREMULTIPLIED"}(IE||(IE={})),function(t){t[t.RGB=0]="RGB",t[t.RRR=3]="RRR",t[t.GGG=4]="GGG",t[t.AAA=15]="AAA"}(PE||(PE={})),function(t){t[t.RGB=0]="RGB",t[t.RGBA=3]="RGBA",t[t.RRR=4]="RRR",t[t.RRRG=5]="RRRG"}(xE||(xE={}));const Ct=[171,75,84,88,32,50,48,187,13,10,26,10];function Mz(t){const e=new Uint8Array(t);return!(e.byteLength<Ct.length||e[0]!==Ct[0]||e[1]!==Ct[1]||e[2]!==Ct[2]||e[3]!==Ct[3]||e[4]!==Ct[4]||e[5]!==Ct[5]||e[6]!==Ct[6]||e[7]!==Ct[7]||e[8]!==Ct[8]||e[9]!==Ct[9]||e[10]!==Ct[10]||e[11]!==Ct[11])}const Bz={etc1:{basisFormat:0,compressed:!0,format:qr.COMPRESSED_RGB_ETC1_WEBGL},etc2:{basisFormat:1,compressed:!0},bc1:{basisFormat:2,compressed:!0,format:qr.COMPRESSED_RGB_S3TC_DXT1_EXT},bc3:{basisFormat:3,compressed:!0,format:qr.COMPRESSED_RGBA_S3TC_DXT5_EXT},bc4:{basisFormat:4,compressed:!0},bc5:{basisFormat:5,compressed:!0},"bc7-m6-opaque-only":{basisFormat:6,compressed:!0},"bc7-m5":{basisFormat:7,compressed:!0},"pvrtc1-4-rgb":{basisFormat:8,compressed:!0,format:qr.COMPRESSED_RGB_PVRTC_4BPPV1_IMG},"pvrtc1-4-rgba":{basisFormat:9,compressed:!0,format:qr.COMPRESSED_RGBA_PVRTC_4BPPV1_IMG},"astc-4x4":{basisFormat:10,compressed:!0,format:qr.COMPRESSED_RGBA_ASTC_4X4_KHR},"atc-rgb":{basisFormat:11,compressed:!0},"atc-rgba-interpolated-alpha":{basisFormat:12,compressed:!0},rgba32:{basisFormat:13,compressed:!1},rgb565:{basisFormat:14,compressed:!1},bgr565:{basisFormat:15,compressed:!1},rgba4444:{basisFormat:16,compressed:!1}};async function Oz(t,e){if(e.basis.containerFormat==="auto"){if(Mz(t)){const s=await EE(e);return ME(s.KTX2File,t,e)}const{BasisFile:n}=await TE(e);return wd(n,t,e)}switch(e.basis.module){case"encoder":const n=await EE(e);switch(e.basis.containerFormat){case"ktx2":return ME(n.KTX2File,t,e);case"basis":default:return wd(n.BasisFile,t,e)}case"transcoder":default:const{BasisFile:s}=await TE(e);return wd(s,t,e)}}function wd(t,e,n){const s=new t(new Uint8Array(e));try{if(!s.startTranscoding())throw new Error("Failed to start basis transcoding");const r=s.getNumImages(),i=[];for(let o=0;o<r;o++){const a=s.getNumLevels(o),c=[];for(let l=0;l<a;l++)c.push(Nz(s,o,l,n));i.push(c)}return i}finally{s.close(),s.delete()}}function Nz(t,e,n,s){const r=t.getImageWidth(e,n),i=t.getImageHeight(e,n),o=t.getHasAlpha(),{compressed:a,format:c,basisFormat:l}=Mb(s,o),u=t.getImageTranscodedSizeInBytes(e,n,l),h=new Uint8Array(u);if(!t.transcodeImage(h,e,n,l,0,0))throw new Error("failed to start Basis transcoding");return{width:r,height:i,data:h,compressed:a,format:c,hasAlpha:o}}function ME(t,e,n){const s=new t(new Uint8Array(e));try{if(!s.startTranscoding())throw new Error("failed to start KTX2 transcoding");const r=s.getLevels(),i=[];for(let o=0;o<r;o++){i.push(Fz(s,o,n));break}return[i]}finally{s.close(),s.delete()}}function Fz(t,e,n){const{alphaFlag:s,height:r,width:i}=t.getImageLevelInfo(e,0,0),{compressed:o,format:a,basisFormat:c}=Mb(n,s),l=t.getImageTranscodedSizeInBytes(e,0,0,c),u=new Uint8Array(l);if(!t.transcodeImage(u,e,0,0,c,0,-1,-1))throw new Error("Failed to transcode KTX2 image");return{width:i,height:r,data:u,compressed:o,levelSize:l,hasAlpha:s,format:a}}function Mb(t,e){let n=t&&t.basis&&t.basis.format;return n==="auto"&&(n=Bb()),typeof n=="object"&&(n=e?n.alpha:n.noAlpha),n=n.toLowerCase(),Bz[n]}function Bb(){const t=Pz();return t.has("astc")?"astc-4x4":t.has("dxt")?{alpha:"bc3",noAlpha:"bc1"}:t.has("pvrtc")?{alpha:"pvrtc1-4-rgba",noAlpha:"pvrtc1-4-rgb"}:t.has("etc1")?"etc1":t.has("etc2")?"etc2":"rgb565"}const Dz={dataType:null,batchType:null,name:"Basis",id:"basis",module:"textures",version:Cz,worker:!0,extensions:["basis","ktx2"],mimeTypes:["application/octet-stream","image/ktx2"],tests:["sB"],binary:!0,options:{basis:{format:"auto",libraryPath:"libs/",containerFormat:"auto",module:"transcoder"}}},Lz={...Dz,parse:Oz},Uz={SCALAR:1,VEC2:2,VEC3:3,VEC4:4,MAT2:4,MAT3:9,MAT4:16},kz={5120:Int8Array,5121:Uint8Array,5122:Int16Array,5123:Uint16Array,5125:Uint32Array,5126:Float32Array};class zz{constructor(e){p(this,"name");p(this,"startTime",0);p(this,"playing",!0);p(this,"speed",1);p(this,"channels",[]);Object.assign(this,e)}animate(e){if(!this.playing)return;const s=(e/1e3-this.startTime)*this.speed;this.channels.forEach(({sampler:r,target:i,path:o})=>{$z(s,r,i,o),jz(i,i._node)})}}class Vz{constructor(e){p(this,"animations");this.animations=e.animations.map((n,s)=>{const r=n.name||`Animation-${s}`,i=n.samplers.map(({input:a,interpolation:c="LINEAR",output:l})=>({input:BE(e.accessors[a]),interpolation:c,output:BE(e.accessors[l])})),o=n.channels.map(({sampler:a,target:c})=>({sampler:i[a],target:e.nodes[c.node],path:c.path}));return new zz({name:r,channels:o})})}animate(e){this.setTime(e)}setTime(e){this.animations.forEach(n=>n.animate(e))}getAnimations(){return this.animations}}function BE(t){if(!t._animation){const e=kz[t.componentType],n=Uz[t.type],s=n*t.count,{buffer:r,byteOffset:i}=t.bufferView.data,o=new e(r,i+(t.byteOffset||0),s);if(n===1)t._animation=Array.from(o);else{const a=[];for(let c=0;c<o.length;c+=n)a.push(Array.from(o.slice(c,c+n)));t._animation=a}}return t._animation}const Hz=new q;function jz(t,e){if(e.matrix.identity(),t.translation&&e.matrix.translate(t.translation),t.rotation){const n=Hz.fromQuaternion(t.rotation);e.matrix.multiplyRight(n)}t.scale&&e.matrix.scale(t.scale)}const bd=new Fa;function Wz(t,e,n,s,r){if(e==="rotation"){bd.slerp({start:n,target:s,ratio:r});for(let i=0;i<bd.length;i++)t[e][i]=bd[i]}else for(let i=0;i<n.length;i++)t[e][i]=r*s[i]+(1-r)*n[i]}function Gz(t,e,{p0:n,outTangent0:s,inTangent1:r,p1:i,tDiff:o,ratio:a}){for(let c=0;c<t[e].length;c++){const l=s[c]*o,u=r[c]*o;t[e][c]=(2*Math.pow(a,3)-3*Math.pow(a,2)+1)*n[c]+(Math.pow(a,3)-2*Math.pow(a,2)+a)*l+(-2*Math.pow(a,3)+3*Math.pow(a,2))*i[c]+(Math.pow(a,3)-Math.pow(a,2))*u}}function Xz(t,e,n){for(let s=0;s<n.length;s++)t[e][s]=n[s]}function $z(t,{input:e,interpolation:n,output:s},r,i){const o=e[e.length-1],a=t%o,c=e.findIndex(f=>f>=a),l=Math.max(0,c-1);if(!Array.isArray(r[i]))switch(i){case"translation":r[i]=[0,0,0];break;case"rotation":r[i]=[0,0,0,1];break;case"scale":r[i]=[1,1,1];break;default:U.warn(`Bad animation path ${i}`)()}oe(r[i].length===s[l].length);const u=e[l],h=e[c];switch(n){case"STEP":Xz(r,i,s[l]);break;case"LINEAR":if(h>u){const f=(a-u)/(h-u);Wz(r,i,s[l],s[c],f)}break;case"CUBICSPLINE":if(h>u){const f=(a-u)/(h-u),d=h-u,g=s[3*l+1],_=s[3*l+2],E=s[3*c+0],m=s[3*c+1];Gz(r,i,{p0:g,outTangent0:_,inTangent1:E,p1:m,tDiff:d,ratio:f})}break;default:U.warn(`Interpolation ${n} not supported`)();break}}const Kz=`
#pragma vscode_glsllint_stage: vert
#if (__VERSION__ < 300)
  #define _attr attribute
#else
  #define _attr in
#endif

  // _attr vec4 POSITION;
  _attr vec4 positions;

  #ifdef HAS_NORMALS
    // _attr vec4 NORMAL;
    _attr vec4 normals;
  #endif

  #ifdef HAS_TANGENTS
    _attr vec4 TANGENT;
  #endif

  #ifdef HAS_UV
    // _attr vec2 TEXCOORD_0;
    _attr vec2 texCoords;
  #endif

  void main(void) {
    vec4 _NORMAL = vec4(0.);
    vec4 _TANGENT = vec4(0.);
    vec2 _TEXCOORD_0 = vec2(0.);

    #ifdef HAS_NORMALS
      _NORMAL = normals;
    #endif

    #ifdef HAS_TANGENTS
      _TANGENT = TANGENT;
    #endif

    #ifdef HAS_UV
      _TEXCOORD_0 = texCoords;
    #endif

    pbr_setPositionNormalTangentUV(positions, _NORMAL, _TANGENT, _TEXCOORD_0);
    gl_Position = u_MVPMatrix * positions;
  }
`,Yz=`
#pragma vscode_glsllint_stage: frag
#if (__VERSION__ < 300)
  #define fragmentColor gl_FragColor
#else
  out vec4 fragmentColor;
#endif

  void main(void) {
    vec3 pos = pbr_vPosition;
    fragmentColor = pbr_filterColor(vec4(1.0));
  }
`;function Jz(t,e){const{id:n,geometry:s,material:r,vertexCount:i,materialOptions:o,modelOptions:a}=e,c=xb(t,r,s.attributes,o);U.info(4,"createGLTFModel defines: ",c.defines)();const l=[],u={depthWriteEnabled:!0,depthCompare:"less",depthFormat:"depth24plus",cullMode:"back"},h={id:n,geometry:s,topology:s.topology,vertexCount:i,modules:[vm],vs:OE(t,Kz),fs:OE(t,Yz),...a,bindings:{...c.bindings,...a.bindings},defines:{...c.defines,...a.defines},parameters:{...u,...c.parameters,...a.parameters},uniforms:{...c.uniforms,...a.uniforms}},f=new ct(t,h);return new cg({managedResources:l,model:f})}function OE(t,e){return`#version 300 es
${e}`}const qz={modelOptions:{},pbrDebug:!1,imageBasedLightingEnvironment:null,lights:!0,useTangents:!1};class Zz{constructor(e,n={}){p(this,"device");p(this,"options");p(this,"gltf");this.device=e,this.options={...qz,...n}}instantiate(e){return this.gltf=e,(e.scenes||[]).map(s=>this.createScene(s))}createAnimator(){return Array.isArray(this.gltf.animations)?new Vz(this.gltf):null}createScene(e){const s=(e.nodes||[]).map(i=>this.createNode(i));return new Ni({id:e.name||e.id,children:s})}createNode(e){if(!e._node){const s=(e.children||[]).map(i=>this.createNode(i));e.mesh&&s.push(this.createMesh(e.mesh));const r=new Ni({id:e.name||e.id,children:s});if(e.matrix)r.setMatrix(e.matrix);else{if(r.matrix.identity(),e.translation&&r.matrix.translate(e.translation),e.rotation){const i=new q().fromQuaternion(e.rotation);r.matrix.multiplyRight(i)}e.scale&&r.matrix.scale(e.scale)}e._node=r}return e._node}createMesh(e){if(!e._mesh){const s=(e.primitives||[]).map((i,o)=>this.createPrimitive(i,o,e)),r=new Ni({id:e.name||e.id,children:s});e._mesh=r}return e._mesh}createPrimitive(e,n,s){const r=e.name||`${s.name||s.id}-primitive-${n}`,i=Qz(e.mode||4),o=e.indices?e.indices.count:this.getVertexCount(e.attributes),a=Jz(this.device,{id:r,geometry:this.createGeometry(r,e,i),material:e.material,materialOptions:this.options,modelOptions:this.options.modelOptions,vertexCount:o});return a.bounds=[e.attributes.POSITION.min,e.attributes.POSITION.max],a}getVertexCount(e){throw new Error("getVertexCount not implemented")}createGeometry(e,n,s){const r={};for(const[i,o]of Object.entries(n.attributes)){const{components:a,size:c,value:l}=o;r[i]={size:c??a,value:l}}return new Kt({id:e,topology:s,indices:n.indices.value,attributes:r})}createBuffer(e,n){e.bufferView||(e.bufferView={});const{bufferView:s}=e;return s.lumaBuffers||(s.lumaBuffers={}),s.lumaBuffers[n]||(s.lumaBuffers[n]=this.device.createBuffer({id:`from-${s.id}`,data:s.data||e.value})),s.lumaBuffers[n]}createSampler(e){return e}needsPOT(){return!1}}var Gn;(function(t){t[t.POINTS=0]="POINTS",t[t.LINES=1]="LINES",t[t.LINE_LOOP=2]="LINE_LOOP",t[t.LINE_STRIP=3]="LINE_STRIP",t[t.TRIANGLES=4]="TRIANGLES",t[t.TRIANGLE_STRIP=5]="TRIANGLE_STRIP",t[t.TRIANGLE_FAN=6]="TRIANGLE_FAN"})(Gn||(Gn={}));function Qz(t){switch(t){case Gn.POINTS:return"point-list";case Gn.LINES:return"line-list";case Gn.LINE_STRIP:return"line-strip";case Gn.LINE_LOOP:return"line-loop-webgl";case Gn.TRIANGLES:return"triangle-list";case Gn.TRIANGLE_STRIP:return"triangle-strip";case Gn.TRIANGLE_FAN:return"triangle-fan-webgl";default:throw new Error(t)}}function eV(t,e,n){const s=new Zz(t,n),r=s.instantiate(e),i=s.createAnimator();return{scenes:r,animator:i}}function Pt(t,e){if(!t)throw new Error(e||"assert failed: gltf")}const Ob={SCALAR:1,VEC2:2,VEC3:3,VEC4:4,MAT2:4,MAT3:9,MAT4:16},Nb={5120:1,5121:1,5122:2,5123:2,5125:4,5126:4},tV=1.33,NE=["SCALAR","VEC2","VEC3","VEC4"],nV=[[Int8Array,5120],[Uint8Array,5121],[Int16Array,5122],[Uint16Array,5123],[Uint32Array,5125],[Float32Array,5126],[Float64Array,5130]],sV=new Map(nV),rV={SCALAR:1,VEC2:2,VEC3:3,VEC4:4,MAT2:4,MAT3:9,MAT4:16},iV={5120:1,5121:1,5122:2,5123:2,5125:4,5126:4},oV={5120:Int8Array,5121:Uint8Array,5122:Int16Array,5123:Uint16Array,5125:Uint32Array,5126:Float32Array};function Fb(t){return NE[t-1]||NE[0]}function zm(t){const e=sV.get(t.constructor);if(!e)throw new Error("Illegal typed array");return e}function Vm(t,e){const n=oV[t.componentType],s=rV[t.type],r=iV[t.componentType],i=t.count*s,o=t.count*s*r;Pt(o>=0&&o<=e.byteLength);const a=Nb[t.componentType],c=Ob[t.type];return{ArrayType:n,length:i,byteLength:o,componentByteSize:a,numberOfComponentsInElement:c}}function Db(t){let{images:e,bufferViews:n}=t;e=e||[],n=n||[];const s=e.map(o=>o.bufferView);n=n.filter(o=>!s.includes(o));const r=n.reduce((o,a)=>o+a.byteLength,0),i=e.reduce((o,a)=>{const{width:c,height:l}=a.image;return o+c*l},0);return r+Math.ceil(4*i*tV)}function aV(t,e,n){const s=t.bufferViews[n];Pt(s);const r=s.buffer,i=e[r];Pt(i);const o=(s.byteOffset||0)+i.byteOffset;return new Uint8Array(i.arrayBuffer,o,s.byteLength)}function cV(t,e,n){var _,E;const s=typeof n=="number"?(_=t.accessors)==null?void 0:_[n]:n;if(!s)throw new Error(`No gltf accessor ${JSON.stringify(n)}`);const r=(E=t.bufferViews)==null?void 0:E[s.bufferView||0];if(!r)throw new Error(`No gltf buffer view for accessor ${r}`);const{arrayBuffer:i,byteOffset:o}=e[r.buffer],a=(o||0)+(s.byteOffset||0)+(r.byteOffset||0),{ArrayType:c,length:l,componentByteSize:u,numberOfComponentsInElement:h}=Vm(s,r),f=u*h,d=r.byteStride||f;if(typeof r.byteStride>"u"||r.byteStride===f)return new c(i,a,l);const g=new c(l);for(let m=0;m<s.count;m++){const y=new c(i,a+m*d,h);g.set(y,m*h)}return g}function lV(){return{asset:{version:"2.0",generator:"loaders.gl"},buffers:[],extensions:{},extensionsRequired:[],extensionsUsed:[]}}class st{constructor(e){p(this,"gltf");p(this,"sourceBuffers");p(this,"byteLength");this.gltf={json:(e==null?void 0:e.json)||lV(),buffers:(e==null?void 0:e.buffers)||[],images:(e==null?void 0:e.images)||[]},this.sourceBuffers=[],this.byteLength=0,this.gltf.buffers&&this.gltf.buffers[0]&&(this.byteLength=this.gltf.buffers[0].byteLength,this.sourceBuffers=[this.gltf.buffers[0]])}get json(){return this.gltf.json}getApplicationData(e){return this.json[e]}getExtraData(e){return(this.json.extras||{})[e]}hasExtension(e){const n=this.getUsedExtensions().find(r=>r===e),s=this.getRequiredExtensions().find(r=>r===e);return typeof n=="string"||typeof s=="string"}getExtension(e){const n=this.getUsedExtensions().find(r=>r===e),s=this.json.extensions||{};return n?s[e]:null}getRequiredExtension(e){return this.getRequiredExtensions().find(s=>s===e)?this.getExtension(e):null}getRequiredExtensions(){return this.json.extensionsRequired||[]}getUsedExtensions(){return this.json.extensionsUsed||[]}getRemovedExtensions(){return this.json.extensionsRemoved||[]}getObjectExtension(e,n){return(e.extensions||{})[n]}getScene(e){return this.getObject("scenes",e)}getNode(e){return this.getObject("nodes",e)}getSkin(e){return this.getObject("skins",e)}getMesh(e){return this.getObject("meshes",e)}getMaterial(e){return this.getObject("materials",e)}getAccessor(e){return this.getObject("accessors",e)}getTexture(e){return this.getObject("textures",e)}getSampler(e){return this.getObject("samplers",e)}getImage(e){return this.getObject("images",e)}getBufferView(e){return this.getObject("bufferViews",e)}getBuffer(e){return this.getObject("buffers",e)}getObject(e,n){if(typeof n=="object")return n;const s=this.json[e]&&this.json[e][n];if(!s)throw new Error(`glTF file error: Could not find ${e}[${n}]`);return s}getTypedArrayForBufferView(e){e=this.getBufferView(e);const n=e.buffer,s=this.gltf.buffers[n];Pt(s);const r=(e.byteOffset||0)+s.byteOffset;return new Uint8Array(s.arrayBuffer,r,e.byteLength)}getTypedArrayForAccessor(e){const n=this.getAccessor(e);return cV(this.gltf.json,this.gltf.buffers,n)}getTypedArrayForImageData(e){e=this.getAccessor(e);const n=this.getBufferView(e.bufferView),r=this.getBuffer(n.buffer).data,i=n.byteOffset||0;return new Uint8Array(r,i,n.byteLength)}addApplicationData(e,n){return this.json[e]=n,this}addExtraData(e,n){return this.json.extras=this.json.extras||{},this.json.extras[e]=n,this}addObjectExtension(e,n,s){return e.extensions=e.extensions||{},e.extensions[n]=s,this.registerUsedExtension(n),this}setObjectExtension(e,n,s){const r=e.extensions||{};r[n]=s}removeObjectExtension(e,n){const s=(e==null?void 0:e.extensions)||{};if(s[n]){this.json.extensionsRemoved=this.json.extensionsRemoved||[];const r=this.json.extensionsRemoved;r.includes(n)||r.push(n)}delete s[n]}addExtension(e,n={}){return Pt(n),this.json.extensions=this.json.extensions||{},this.json.extensions[e]=n,this.registerUsedExtension(e),n}addRequiredExtension(e,n={}){return Pt(n),this.addExtension(e,n),this.registerRequiredExtension(e),n}registerUsedExtension(e){this.json.extensionsUsed=this.json.extensionsUsed||[],this.json.extensionsUsed.find(n=>n===e)||this.json.extensionsUsed.push(e)}registerRequiredExtension(e){this.registerUsedExtension(e),this.json.extensionsRequired=this.json.extensionsRequired||[],this.json.extensionsRequired.find(n=>n===e)||this.json.extensionsRequired.push(e)}removeExtension(e){var n;if((n=this.json.extensions)!=null&&n[e]){this.json.extensionsRemoved=this.json.extensionsRemoved||[];const s=this.json.extensionsRemoved;s.includes(e)||s.push(e)}this.json.extensions&&delete this.json.extensions[e],this.json.extensionsRequired&&this._removeStringFromArray(this.json.extensionsRequired,e),this.json.extensionsUsed&&this._removeStringFromArray(this.json.extensionsUsed,e)}setDefaultScene(e){this.json.scene=e}addScene(e){const{nodeIndices:n}=e;return this.json.scenes=this.json.scenes||[],this.json.scenes.push({nodes:n}),this.json.scenes.length-1}addNode(e){const{meshIndex:n,matrix:s}=e;this.json.nodes=this.json.nodes||[];const r={mesh:n};return s&&(r.matrix=s),this.json.nodes.push(r),this.json.nodes.length-1}addMesh(e){const{attributes:n,indices:s,material:r,mode:i=4}=e,a={primitives:[{attributes:this._addAttributes(n),mode:i}]};if(s){const c=this._addIndices(s);a.primitives[0].indices=c}return Number.isFinite(r)&&(a.primitives[0].material=r),this.json.meshes=this.json.meshes||[],this.json.meshes.push(a),this.json.meshes.length-1}addPointCloud(e){const s={primitives:[{attributes:this._addAttributes(e),mode:0}]};return this.json.meshes=this.json.meshes||[],this.json.meshes.push(s),this.json.meshes.length-1}addImage(e,n){const s=um(e),r=n||(s==null?void 0:s.mimeType),o={bufferView:this.addBufferView(e),mimeType:r};return this.json.images=this.json.images||[],this.json.images.push(o),this.json.images.length-1}addBufferView(e,n=0,s=this.byteLength){const r=e.byteLength;Pt(Number.isFinite(r)),this.sourceBuffers=this.sourceBuffers||[],this.sourceBuffers.push(e);const i={buffer:n,byteOffset:s,byteLength:r};return this.byteLength+=qa(r,4),this.json.bufferViews=this.json.bufferViews||[],this.json.bufferViews.push(i),this.json.bufferViews.length-1}addAccessor(e,n){const s={bufferView:e,type:Fb(n.size),componentType:n.componentType,count:n.count,max:n.max,min:n.min};return this.json.accessors=this.json.accessors||[],this.json.accessors.push(s),this.json.accessors.length-1}addBinaryBuffer(e,n={size:3}){const s=this.addBufferView(e);let r={min:n.min,max:n.max};(!r.min||!r.max)&&(r=this._getAccessorMinMax(e,n.size));const i={size:n.size,componentType:zm(e),count:Math.round(e.length/n.size),min:r.min,max:r.max};return this.addAccessor(s,Object.assign(i,n))}addTexture(e){const{imageIndex:n}=e,s={source:n};return this.json.textures=this.json.textures||[],this.json.textures.push(s),this.json.textures.length-1}addMaterial(e){return this.json.materials=this.json.materials||[],this.json.materials.push(e),this.json.materials.length-1}createBinaryChunk(){var i,o;this.gltf.buffers=[];const e=this.byteLength,n=new ArrayBuffer(e),s=new Uint8Array(n);let r=0;for(const a of this.sourceBuffers||[])r=cx(a,s,r);(o=(i=this.json)==null?void 0:i.buffers)!=null&&o[0]?this.json.buffers[0].byteLength=e:this.json.buffers=[{byteLength:e}],this.gltf.binary=n,this.sourceBuffers=[n]}_removeStringFromArray(e,n){let s=!0;for(;s;){const r=e.indexOf(n);r>-1?e.splice(r,1):s=!1}}_addAttributes(e={}){const n={};for(const s in e){const r=e[s],i=this._getGltfAttributeName(s),o=this.addBinaryBuffer(r.value,r);n[i]=o}return n}_addIndices(e){return this.addBinaryBuffer(e,{size:1})}_getGltfAttributeName(e){switch(e.toLowerCase()){case"position":case"positions":case"vertices":return"POSITION";case"normal":case"normals":return"NORMAL";case"color":case"colors":return"COLOR_0";case"texcoord":case"texcoords":return"TEXCOORD_0";default:return e}}_getAccessorMinMax(e,n){const s={min:null,max:null};if(e.length<n)return s;s.min=[],s.max=[];const r=e.subarray(0,n);for(const i of r)s.min.push(i),s.max.push(i);for(let i=n;i<e.length;i+=n)for(let o=0;o<n;o++)s.min[0+o]=Math.min(s.min[0+o],e[i+o]),s.max[0+o]=Math.max(s.max[0+o],e[i+o]);return s}}function FE(t){return(t%1+1)%1}const Lb={SCALAR:1,VEC2:2,VEC3:3,VEC4:4,MAT2:4,MAT3:9,MAT4:16,BOOLEAN:1,STRING:1,ENUM:1},uV={INT8:Int8Array,UINT8:Uint8Array,INT16:Int16Array,UINT16:Uint16Array,INT32:Int32Array,UINT32:Uint32Array,INT64:BigInt64Array,UINT64:BigUint64Array,FLOAT32:Float32Array,FLOAT64:Float64Array},Ub={INT8:1,UINT8:1,INT16:2,UINT16:2,INT32:4,UINT32:4,INT64:8,UINT64:8,FLOAT32:4,FLOAT64:8};function Hm(t,e){return Ub[e]*Lb[t]}function $h(t,e,n,s){if(n!=="UINT8"&&n!=="UINT16"&&n!=="UINT32"&&n!=="UINT64")return null;const r=t.getTypedArrayForBufferView(e),i=Kh(r,"SCALAR",n,s+1);return i instanceof BigInt64Array||i instanceof BigUint64Array?null:i}function Kh(t,e,n,s=1){const r=Lb[e],i=uV[n],o=Ub[n],a=s*r,c=a*o;let l=t.buffer,u=t.byteOffset;return u%o!==0&&(l=new Uint8Array(l).slice(u,u+c).buffer,u=0),new i(l,u,a)}function jm(t,e,n){var l,u,h,f,d;const s=`TEXCOORD_${e.texCoord||0}`,r=n.attributes[s],i=t.getTypedArrayForAccessor(r),o=t.gltf.json,a=e.index,c=(u=(l=o.textures)==null?void 0:l[a])==null?void 0:u.source;if(typeof c<"u"){const g=(f=(h=o.images)==null?void 0:h[c])==null?void 0:f.mimeType,_=(d=t.gltf.images)==null?void 0:d[c];if(_&&typeof _.width<"u"){const E=[];for(let m=0;m<i.length;m+=2){const y=hV(_,g,i,m,e.channels);E.push(y)}return E}}return[]}function kb(t,e,n,s,r){if(!(n!=null&&n.length))return;const i=[];for(const u of n){let h=s.findIndex(f=>f===u);h===-1&&(h=s.push(u)-1),i.push(h)}const o=new Uint32Array(i),a=t.gltf.buffers.push({arrayBuffer:o.buffer,byteOffset:o.byteOffset,byteLength:o.byteLength})-1,c=t.addBufferView(o,a,0),l=t.addAccessor(c,{size:1,componentType:zm(o),count:o.length});r.attributes[e]=l}function hV(t,e,n,s,r=[0]){const i={r:{offset:0,shift:0},g:{offset:1,shift:8},b:{offset:2,shift:16},a:{offset:3,shift:24}},o=n[s],a=n[s+1];let c=1;e&&(e.indexOf("image/jpeg")!==-1||e.indexOf("image/png")!==-1)&&(c=4);const l=fV(o,a,t,c);let u=0;for(const h of r){const f=typeof h=="number"?Object.values(i)[h]:i[h],d=l+f.offset,g=dv(t);if(g.data.length<=d)throw new Error(`${g.data.length} <= ${d}`);const _=g.data[d];u|=_<<f.shift}return u}function fV(t,e,n,s=1){const r=n.width,i=FE(t)*(r-1),o=Math.round(i),a=n.height,c=FE(e)*(a-1),l=Math.round(c),u=n.components?n.components:s;return(l*r+o)*u}function zb(t,e,n,s,r){const i=[];for(let o=0;o<e;o++){const a=n[o],c=n[o+1]-n[o];if(c+a>s)break;const l=a/r,u=c/r;i.push(t.slice(l,l+u))}return i}function Vb(t,e,n){const s=[];for(let r=0;r<e;r++){const i=r*n;s.push(t.slice(i,i+n))}return s}function Hb(t,e,n,s){if(n)throw new Error("Not implemented - arrayOffsets for strings is specified");if(s){const r=[],i=new TextDecoder("utf8");let o=0;for(let a=0;a<t;a++){const c=s[a+1]-s[a];if(c+o<=e.length){const l=e.subarray(o,c+o),u=i.decode(l);r.push(u),o+=c}}return r}return[]}const jb="EXT_mesh_features",dV=jb;async function pV(t,e){const n=new st(t);gV(n,e)}function gV(t,e){const n=t.gltf.json;if(n.meshes)for(const s of n.meshes)for(const r of s.primitives)_V(t,r,e)}function _V(t,e,n){var i,o,a;if(!((i=n==null?void 0:n.gltf)!=null&&i.loadBuffers))return;const s=(o=e.extensions)==null?void 0:o[jb],r=s==null?void 0:s.featureIds;if(r)for(const c of r){let l;if(typeof c.attribute<"u"){const u=`_FEATURE_ID_${c.attribute}`,h=e.attributes[u];l=t.getTypedArrayForAccessor(h)}else typeof c.texture<"u"&&((a=n==null?void 0:n.gltf)!=null&&a.loadImages)?l=jm(t,c.texture,e):l=[];c.data=l}}const mV=Object.freeze(Object.defineProperty({__proto__:null,decode:pV,name:dV},Symbol.toStringTag,{value:"Module"})),Wm="EXT_structural_metadata",yV=Wm;async function AV(t,e){const n=new st(t);TV(n,e)}function TV(t,e){var s,r;if(!((s=e.gltf)!=null&&s.loadBuffers))return;const n=t.getExtension(Wm);n&&((r=e.gltf)!=null&&r.loadImages&&EV(t,n),SV(t,n))}function EV(t,e){const n=e.propertyTextures,s=t.gltf.json;if(n&&s.meshes)for(const r of s.meshes)for(const i of r.primitives)vV(t,n,i,e)}function SV(t,e){const n=e.schema;if(!n)return;const s=n.classes,r=e.propertyTables;if(s&&r)for(const i in s){const o=CV(r,i);o&&bV(t,n,o)}}function CV(t,e){for(const n of t)if(n.class===e)return n;return null}function vV(t,e,n,s){var o;if(!e)return;const r=(o=n.extensions)==null?void 0:o[Wm],i=r==null?void 0:r.propertyTextures;if(i)for(const a of i){const c=e[a];wV(t,c,n,s)}}function wV(t,e,n,s){var i;if(!e.properties)return;s.dataAttributeNames||(s.dataAttributeNames=[]);const r=e.class;for(const o in e.properties){const a=`${r}_${o}`,c=(i=e.properties)==null?void 0:i[o];if(!c)continue;c.data||(c.data=[]);const l=c.data,u=jm(t,c,n);u!==null&&(kb(t,a,u,l,n),c.data=l,s.dataAttributeNames.push(a))}}function bV(t,e,n){var i,o;const s=(i=e.classes)==null?void 0:i[n.class];if(!s)throw new Error(`Incorrect data in the EXT_structural_metadata extension: no schema class with name ${n.class}`);const r=n.count;for(const a in s.properties){const c=s.properties[a],l=(o=n.properties)==null?void 0:o[a];if(l){const u=RV(t,e,c,r,l);l.data=u}}}function RV(t,e,n,s,r){let i=[];const o=r.values,a=t.getTypedArrayForBufferView(o),c=IV(t,n,r,s),l=PV(t,r,s);switch(n.type){case"SCALAR":case"VEC2":case"VEC3":case"VEC4":case"MAT2":case"MAT3":case"MAT4":{i=xV(n,s,a,c);break}case"BOOLEAN":throw new Error(`Not implemented - classProperty.type=${n.type}`);case"STRING":{i=Hb(s,a,c,l);break}case"ENUM":{i=MV(e,n,s,a,c);break}default:throw new Error(`Unknown classProperty type ${n.type}`)}return i}function IV(t,e,n,s){return e.array&&typeof e.count>"u"&&typeof n.arrayOffsets<"u"?$h(t,n.arrayOffsets,n.arrayOffsetType||"UINT32",s):null}function PV(t,e,n){return typeof e.stringOffsets<"u"?$h(t,e.stringOffsets,e.stringOffsetType||"UINT32",n):null}function xV(t,e,n,s){const r=t.array,i=t.count,o=Hm(t.type,t.componentType),a=n.byteLength/o;let c;return t.componentType?c=Kh(n,t.type,t.componentType,a):c=n,r?s?zb(c,e,s,n.length,o):i?Vb(c,e,i):[]:c}function MV(t,e,n,s,r){var h;const i=e.enumType;if(!i)throw new Error("Incorrect data in the EXT_structural_metadata extension: classProperty.enumType is not set for type ENUM");const o=(h=t.enums)==null?void 0:h[i];if(!o)throw new Error(`Incorrect data in the EXT_structural_metadata extension: schema.enums does't contain ${i}`);const a=o.valueType||"UINT16",c=Hm(e.type,a),l=s.byteLength/c;let u=Kh(s,e.type,a,l);if(u||(u=s),e.array){if(r)return BV({valuesData:u,numberOfElements:n,arrayOffsets:r,valuesDataBytesLength:s.length,elementSize:c,enumEntry:o});const f=e.count;return f?OV(u,n,f,o):[]}return Gm(u,0,n,o)}function BV(t){const{valuesData:e,numberOfElements:n,arrayOffsets:s,valuesDataBytesLength:r,elementSize:i,enumEntry:o}=t,a=[];for(let c=0;c<n;c++){const l=s[c],u=s[c+1]-s[c];if(u+l>r)break;const h=l/i,f=u/i,d=Gm(e,h,f,o);a.push(d)}return a}function OV(t,e,n,s){const r=[];for(let i=0;i<e;i++){const o=n*i,a=Gm(t,o,n,s);r.push(a)}return r}function Gm(t,e,n,s){const r=[];for(let i=0;i<n;i++)if(t instanceof BigInt64Array||t instanceof BigUint64Array)r.push("");else{const o=t[e+i],a=NV(s,o);a?r.push(a.name):r.push("")}return r}function NV(t,e){for(const n of t.values)if(n.value===e)return n;return null}const FV=Object.freeze(Object.defineProperty({__proto__:null,decode:AV,name:yV},Symbol.toStringTag,{value:"Module"})),Wb="EXT_feature_metadata",DV=Wb;async function LV(t,e){const n=new st(t);UV(n,e)}function UV(t,e){var s,r;if(!((s=e.gltf)!=null&&s.loadBuffers))return;const n=t.getExtension(Wb);n&&((r=e.gltf)!=null&&r.loadImages&&kV(t,n),zV(t,n))}function kV(t,e){const n=e.schema;if(!n)return;const s=n.classes,{featureTextures:r}=e;if(s&&r)for(const i in s){const o=s[i],a=HV(r,i);a&&WV(t,a,o)}}function zV(t,e){const n=e.schema;if(!n)return;const s=n.classes,r=e.featureTables;if(s&&r)for(const i in s){const o=VV(r,i);o&&jV(t,n,o)}}function VV(t,e){for(const n in t){const s=t[n];if(s.class===e)return s}return null}function HV(t,e){for(const n in t){const s=t[n];if(s.class===e)return s}return null}function jV(t,e,n){var i,o;if(!n.class)return;const s=(i=e.classes)==null?void 0:i[n.class];if(!s)throw new Error(`Incorrect data in the EXT_structural_metadata extension: no schema class with name ${n.class}`);const r=n.count;for(const a in s.properties){const c=s.properties[a],l=(o=n.properties)==null?void 0:o[a];if(l){const u=GV(t,e,c,r,l);l.data=u}}}function WV(t,e,n){var r;const s=e.class;for(const i in n.properties){const o=(r=e==null?void 0:e.properties)==null?void 0:r[i];if(o){const a=JV(t,o,s);o.data=a}}}function GV(t,e,n,s,r){let i=[];const o=r.bufferView,a=t.getTypedArrayForBufferView(o),c=XV(t,n,r,s),l=$V(t,n,r,s);return n.type==="STRING"||n.componentType==="STRING"?i=Hb(s,a,c,l):KV(n)&&(i=YV(n,s,a,c)),i}function XV(t,e,n,s){return e.type==="ARRAY"&&typeof e.componentCount>"u"&&typeof n.arrayOffsetBufferView<"u"?$h(t,n.arrayOffsetBufferView,n.offsetType||"UINT32",s):null}function $V(t,e,n,s){return typeof n.stringOffsetBufferView<"u"?$h(t,n.stringOffsetBufferView,n.offsetType||"UINT32",s):null}function KV(t){const e=["UINT8","INT16","UINT16","INT32","UINT32","INT64","UINT64","FLOAT32","FLOAT64"];return e.includes(t.type)||typeof t.componentType<"u"&&e.includes(t.componentType)}function YV(t,e,n,s){const r=t.type==="ARRAY",i=t.componentCount,o="SCALAR",a=t.componentType||t.type,c=Hm(o,a),l=n.byteLength/c,u=Kh(n,o,a,l);return r?s?zb(u,e,s,n.length,c):i?Vb(u,e,i):[]:u}function JV(t,e,n){const s=t.gltf.json;if(!s.meshes)return[];const r=[];for(const i of s.meshes)for(const o of i.primitives)qV(t,n,e,r,o);return r}function qV(t,e,n,s,r){const i={channels:n.channels,...n.texture},o=jm(t,i,r);o&&kb(t,e,o,s,r)}const ZV=Object.freeze(Object.defineProperty({__proto__:null,decode:LV,name:DV},Symbol.toStringTag,{value:"Module"})),QV="4.2.0-beta.2",Zi=!0,DE=1735152710,Xm=12,Fu=8,eH=1313821514,tH=5130562,nH=0,sH=0,rH=1;function iH(t,e=0){return`${String.fromCharCode(t.getUint8(e+0))}${String.fromCharCode(t.getUint8(e+1))}${String.fromCharCode(t.getUint8(e+2))}${String.fromCharCode(t.getUint8(e+3))}`}function oH(t,e=0,n={}){const s=new DataView(t),{magic:r=DE}=n,i=s.getUint32(e,!1);return i===r||i===DE}function aH(t,e,n=0,s={}){const r=new DataView(e),i=iH(r,n+0),o=r.getUint32(n+4,Zi),a=r.getUint32(n+8,Zi);switch(Object.assign(t,{header:{byteOffset:n,byteLength:a,hasBinChunk:!1},type:i,version:o,json:{},binChunks:[]}),n+=Xm,t.version){case 1:return cH(t,r,n);case 2:return lH(t,r,n,s={});default:throw new Error(`Invalid GLB version ${t.version}. Only supports version 1 and 2.`)}}function cH(t,e,n){de(t.header.byteLength>Xm+Fu);const s=e.getUint32(n+0,Zi),r=e.getUint32(n+4,Zi);return n+=Fu,de(r===nH),Xg(t,e,n,s),n+=s,n+=$g(t,e,n,t.header.byteLength),n}function lH(t,e,n,s){return de(t.header.byteLength>Xm+Fu),uH(t,e,n,s),n+t.header.byteLength}function uH(t,e,n,s){for(;n+8<=t.header.byteLength;){const r=e.getUint32(n+0,Zi),i=e.getUint32(n+4,Zi);switch(n+=Fu,i){case eH:Xg(t,e,n,r);break;case tH:$g(t,e,n,r);break;case sH:s.strict||Xg(t,e,n,r);break;case rH:s.strict||$g(t,e,n,r);break}n+=qa(r,4)}return n}function Xg(t,e,n,s){const r=new Uint8Array(e.buffer,n,s),o=new TextDecoder("utf8").decode(r);return t.json=JSON.parse(o),qa(s,4)}function $g(t,e,n,s){return t.header.hasBinChunk=!0,t.binChunks.push({byteOffset:n,byteLength:s,arrayBuffer:e.buffer}),qa(s,4)}function Gb(t,e){if(t.startsWith("data:")||t.startsWith("http:")||t.startsWith("https:"))return t;const s=e.baseUri||e.uri;if(!s)throw new Error(`'baseUri' must be provided to resolve relative url ${t}`);return s.substr(0,s.lastIndexOf("/")+1)+t}const hH="B9h9z9tFBBBF8fL9gBB9gLaaaaaFa9gEaaaB9gFaFa9gEaaaFaEMcBFFFGGGEIIILF9wFFFLEFBFKNFaFCx/IFMO/LFVK9tv9t9vq95GBt9f9f939h9z9t9f9j9h9s9s9f9jW9vq9zBBp9tv9z9o9v9wW9f9kv9j9v9kv9WvqWv94h919m9mvqBF8Z9tv9z9o9v9wW9f9kv9j9v9kv9J9u9kv94h919m9mvqBGy9tv9z9o9v9wW9f9kv9j9v9kv9J9u9kv949TvZ91v9u9jvBEn9tv9z9o9v9wW9f9kv9j9v9kv69p9sWvq9P9jWBIi9tv9z9o9v9wW9f9kv9j9v9kv69p9sWvq9R919hWBLn9tv9z9o9v9wW9f9kv9j9v9kv69p9sWvq9F949wBKI9z9iqlBOc+x8ycGBM/qQFTa8jUUUUBCU/EBlHL8kUUUUBC9+RKGXAGCFJAI9LQBCaRKAE2BBC+gF9HQBALAEAIJHOAGlAGTkUUUBRNCUoBAG9uC/wgBZHKCUGAKCUG9JyRVAECFJRICBRcGXEXAcAF9PQFAVAFAclAcAVJAF9JyRMGXGXAG9FQBAMCbJHKC9wZRSAKCIrCEJCGrRQANCUGJRfCBRbAIRTEXGXAOATlAQ9PQBCBRISEMATAQJRIGXAS9FQBCBRtCBREEXGXAOAIlCi9PQBCBRISLMANCU/CBJAEJRKGXGXGXGXGXATAECKrJ2BBAtCKZrCEZfIBFGEBMAKhB83EBAKCNJhB83EBSEMAKAI2BIAI2BBHmCKrHYAYCE6HYy86BBAKCFJAICIJAYJHY2BBAmCIrCEZHPAPCE6HPy86BBAKCGJAYAPJHY2BBAmCGrCEZHPAPCE6HPy86BBAKCEJAYAPJHY2BBAmCEZHmAmCE6Hmy86BBAKCIJAYAmJHY2BBAI2BFHmCKrHPAPCE6HPy86BBAKCLJAYAPJHY2BBAmCIrCEZHPAPCE6HPy86BBAKCKJAYAPJHY2BBAmCGrCEZHPAPCE6HPy86BBAKCOJAYAPJHY2BBAmCEZHmAmCE6Hmy86BBAKCNJAYAmJHY2BBAI2BGHmCKrHPAPCE6HPy86BBAKCVJAYAPJHY2BBAmCIrCEZHPAPCE6HPy86BBAKCcJAYAPJHY2BBAmCGrCEZHPAPCE6HPy86BBAKCMJAYAPJHY2BBAmCEZHmAmCE6Hmy86BBAKCSJAYAmJHm2BBAI2BEHICKrHYAYCE6HYy86BBAKCQJAmAYJHm2BBAICIrCEZHYAYCE6HYy86BBAKCfJAmAYJHm2BBAICGrCEZHYAYCE6HYy86BBAKCbJAmAYJHK2BBAICEZHIAICE6HIy86BBAKAIJRISGMAKAI2BNAI2BBHmCIrHYAYCb6HYy86BBAKCFJAICNJAYJHY2BBAmCbZHmAmCb6Hmy86BBAKCGJAYAmJHm2BBAI2BFHYCIrHPAPCb6HPy86BBAKCEJAmAPJHm2BBAYCbZHYAYCb6HYy86BBAKCIJAmAYJHm2BBAI2BGHYCIrHPAPCb6HPy86BBAKCLJAmAPJHm2BBAYCbZHYAYCb6HYy86BBAKCKJAmAYJHm2BBAI2BEHYCIrHPAPCb6HPy86BBAKCOJAmAPJHm2BBAYCbZHYAYCb6HYy86BBAKCNJAmAYJHm2BBAI2BIHYCIrHPAPCb6HPy86BBAKCVJAmAPJHm2BBAYCbZHYAYCb6HYy86BBAKCcJAmAYJHm2BBAI2BLHYCIrHPAPCb6HPy86BBAKCMJAmAPJHm2BBAYCbZHYAYCb6HYy86BBAKCSJAmAYJHm2BBAI2BKHYCIrHPAPCb6HPy86BBAKCQJAmAPJHm2BBAYCbZHYAYCb6HYy86BBAKCfJAmAYJHm2BBAI2BOHICIrHYAYCb6HYy86BBAKCbJAmAYJHK2BBAICbZHIAICb6HIy86BBAKAIJRISFMAKAI8pBB83BBAKCNJAICNJ8pBB83BBAICTJRIMAtCGJRtAECTJHEAS9JQBMMGXAIQBCBRISEMGXAM9FQBANAbJ2BBRtCBRKAfREEXAEANCU/CBJAKJ2BBHTCFrCBATCFZl9zAtJHt86BBAEAGJREAKCFJHKAM9HQBMMAfCFJRfAIRTAbCFJHbAG9HQBMMABAcAG9sJANCUGJAMAG9sTkUUUBpANANCUGJAMCaJAG9sJAGTkUUUBpMAMCBAIyAcJRcAIQBMC9+RKSFMCBC99AOAIlAGCAAGCA9Ly6yRKMALCU/EBJ8kUUUUBAKM+OmFTa8jUUUUBCoFlHL8kUUUUBC9+RKGXAFCE9uHOCtJAI9LQBCaRKAE2BBHNC/wFZC/gF9HQBANCbZHVCF9LQBALCoBJCgFCUFT+JUUUBpALC84Jha83EBALC8wJha83EBALC8oJha83EBALCAJha83EBALCiJha83EBALCTJha83EBALha83ENALha83EBAEAIJC9wJRcAECFJHNAOJRMGXAF9FQBCQCbAVCF6yRSABRECBRVCBRQCBRfCBRICBRKEXGXAMAcuQBC9+RKSEMGXGXAN2BBHOC/vF9LQBALCoBJAOCIrCa9zAKJCbZCEWJHb8oGIRTAb8oGBRtGXAOCbZHbAS9PQBALAOCa9zAIJCbZCGWJ8oGBAVAbyROAb9FRbGXGXAGCG9HQBABAt87FBABCIJAO87FBABCGJAT87FBSFMAEAtjGBAECNJAOjGBAECIJATjGBMAVAbJRVALCoBJAKCEWJHmAOjGBAmATjGIALAICGWJAOjGBALCoBJAKCFJCbZHKCEWJHTAtjGBATAOjGIAIAbJRIAKCFJRKSGMGXGXAbCb6QBAQAbJAbC989zJCFJRQSFMAM1BBHbCgFZROGXGXAbCa9MQBAMCFJRMSFMAM1BFHbCgBZCOWAOCgBZqROGXAbCa9MQBAMCGJRMSFMAM1BGHbCgBZCfWAOqROGXAbCa9MQBAMCEJRMSFMAM1BEHbCgBZCdWAOqROGXAbCa9MQBAMCIJRMSFMAM2BIC8cWAOqROAMCLJRMMAOCFrCBAOCFZl9zAQJRQMGXGXAGCG9HQBABAt87FBABCIJAQ87FBABCGJAT87FBSFMAEAtjGBAECNJAQjGBAECIJATjGBMALCoBJAKCEWJHOAQjGBAOATjGIALAICGWJAQjGBALCoBJAKCFJCbZHKCEWJHOAtjGBAOAQjGIAICFJRIAKCFJRKSFMGXAOCDF9LQBALAIAcAOCbZJ2BBHbCIrHTlCbZCGWJ8oGBAVCFJHtATyROALAIAblCbZCGWJ8oGBAtAT9FHmJHtAbCbZHTyRbAT9FRTGXGXAGCG9HQBABAV87FBABCIJAb87FBABCGJAO87FBSFMAEAVjGBAECNJAbjGBAECIJAOjGBMALAICGWJAVjGBALCoBJAKCEWJHYAOjGBAYAVjGIALAICFJHICbZCGWJAOjGBALCoBJAKCFJCbZCEWJHYAbjGBAYAOjGIALAIAmJCbZHICGWJAbjGBALCoBJAKCGJCbZHKCEWJHOAVjGBAOAbjGIAKCFJRKAIATJRIAtATJRVSFMAVCBAM2BBHYyHTAOC/+F6HPJROAYCbZRtGXGXAYCIrHmQBAOCFJRbSFMAORbALAIAmlCbZCGWJ8oGBROMGXGXAtQBAbCFJRVSFMAbRVALAIAYlCbZCGWJ8oGBRbMGXGXAP9FQBAMCFJRYSFMAM1BFHYCgFZRTGXGXAYCa9MQBAMCGJRYSFMAM1BGHYCgBZCOWATCgBZqRTGXAYCa9MQBAMCEJRYSFMAM1BEHYCgBZCfWATqRTGXAYCa9MQBAMCIJRYSFMAM1BIHYCgBZCdWATqRTGXAYCa9MQBAMCLJRYSFMAMCKJRYAM2BLC8cWATqRTMATCFrCBATCFZl9zAQJHQRTMGXGXAmCb6QBAYRPSFMAY1BBHMCgFZROGXGXAMCa9MQBAYCFJRPSFMAY1BFHMCgBZCOWAOCgBZqROGXAMCa9MQBAYCGJRPSFMAY1BGHMCgBZCfWAOqROGXAMCa9MQBAYCEJRPSFMAY1BEHMCgBZCdWAOqROGXAMCa9MQBAYCIJRPSFMAYCLJRPAY2BIC8cWAOqROMAOCFrCBAOCFZl9zAQJHQROMGXGXAtCb6QBAPRMSFMAP1BBHMCgFZRbGXGXAMCa9MQBAPCFJRMSFMAP1BFHMCgBZCOWAbCgBZqRbGXAMCa9MQBAPCGJRMSFMAP1BGHMCgBZCfWAbqRbGXAMCa9MQBAPCEJRMSFMAP1BEHMCgBZCdWAbqRbGXAMCa9MQBAPCIJRMSFMAPCLJRMAP2BIC8cWAbqRbMAbCFrCBAbCFZl9zAQJHQRbMGXGXAGCG9HQBABAT87FBABCIJAb87FBABCGJAO87FBSFMAEATjGBAECNJAbjGBAECIJAOjGBMALCoBJAKCEWJHYAOjGBAYATjGIALAICGWJATjGBALCoBJAKCFJCbZCEWJHYAbjGBAYAOjGIALAICFJHICbZCGWJAOjGBALCoBJAKCGJCbZCEWJHOATjGBAOAbjGIALAIAm9FAmCb6qJHICbZCGWJAbjGBAIAt9FAtCb6qJRIAKCEJRKMANCFJRNABCKJRBAECSJREAKCbZRKAICbZRIAfCEJHfAF9JQBMMCBC99AMAc6yRKMALCoFJ8kUUUUBAKM/tIFGa8jUUUUBCTlRLC9+RKGXAFCLJAI9LQBCaRKAE2BBC/+FZC/QF9HQBALhB83ENAECFJRKAEAIJC98JREGXAF9FQBGXAGCG6QBEXGXAKAE9JQBC9+bMAK1BBHGCgFZRIGXGXAGCa9MQBAKCFJRKSFMAK1BFHGCgBZCOWAICgBZqRIGXAGCa9MQBAKCGJRKSFMAK1BGHGCgBZCfWAIqRIGXAGCa9MQBAKCEJRKSFMAK1BEHGCgBZCdWAIqRIGXAGCa9MQBAKCIJRKSFMAK2BIC8cWAIqRIAKCLJRKMALCNJAICFZCGWqHGAICGrCBAICFrCFZl9zAG8oGBJHIjGBABAIjGBABCIJRBAFCaJHFQBSGMMEXGXAKAE9JQBC9+bMAK1BBHGCgFZRIGXGXAGCa9MQBAKCFJRKSFMAK1BFHGCgBZCOWAICgBZqRIGXAGCa9MQBAKCGJRKSFMAK1BGHGCgBZCfWAIqRIGXAGCa9MQBAKCEJRKSFMAK1BEHGCgBZCdWAIqRIGXAGCa9MQBAKCIJRKSFMAK2BIC8cWAIqRIAKCLJRKMABAICGrCBAICFrCFZl9zALCNJAICFZCGWqHI8oGBJHG87FBAIAGjGBABCGJRBAFCaJHFQBMMCBC99AKAE6yRKMAKM+lLKFaF99GaG99FaG99GXGXAGCI9HQBAF9FQFEXGXGX9DBBB8/9DBBB+/ABCGJHG1BB+yAB1BBHE+yHI+L+TABCFJHL1BBHK+yHO+L+THN9DBBBB9gHVyAN9DBB/+hANAN+U9DBBBBANAVyHcAc+MHMAECa3yAI+SHIAI+UAcAMAKCa3yAO+SHcAc+U+S+S+R+VHO+U+SHN+L9DBBB9P9d9FQBAN+oRESFMCUUUU94REMAGAE86BBGXGX9DBBB8/9DBBB+/Ac9DBBBB9gyAcAO+U+SHN+L9DBBB9P9d9FQBAN+oRGSFMCUUUU94RGMALAG86BBGXGX9DBBB8/9DBBB+/AI9DBBBB9gyAIAO+U+SHN+L9DBBB9P9d9FQBAN+oRGSFMCUUUU94RGMABAG86BBABCIJRBAFCaJHFQBSGMMAF9FQBEXGXGX9DBBB8/9DBBB+/ABCIJHG8uFB+yAB8uFBHE+yHI+L+TABCGJHL8uFBHK+yHO+L+THN9DBBBB9gHVyAN9DB/+g6ANAN+U9DBBBBANAVyHcAc+MHMAECa3yAI+SHIAI+UAcAMAKCa3yAO+SHcAc+U+S+S+R+VHO+U+SHN+L9DBBB9P9d9FQBAN+oRESFMCUUUU94REMAGAE87FBGXGX9DBBB8/9DBBB+/Ac9DBBBB9gyAcAO+U+SHN+L9DBBB9P9d9FQBAN+oRGSFMCUUUU94RGMALAG87FBGXGX9DBBB8/9DBBB+/AI9DBBBB9gyAIAO+U+SHN+L9DBBB9P9d9FQBAN+oRGSFMCUUUU94RGMABAG87FBABCNJRBAFCaJHFQBMMM/SEIEaE99EaF99GXAF9FQBCBREABRIEXGXGX9D/zI818/AICKJ8uFBHLCEq+y+VHKAI8uFB+y+UHO9DB/+g6+U9DBBB8/9DBBB+/AO9DBBBB9gy+SHN+L9DBBB9P9d9FQBAN+oRVSFMCUUUU94RVMAICIJ8uFBRcAICGJ8uFBRMABALCFJCEZAEqCFWJAV87FBGXGXAKAM+y+UHN9DB/+g6+U9DBBB8/9DBBB+/AN9DBBBB9gy+SHS+L9DBBB9P9d9FQBAS+oRMSFMCUUUU94RMMABALCGJCEZAEqCFWJAM87FBGXGXAKAc+y+UHK9DB/+g6+U9DBBB8/9DBBB+/AK9DBBBB9gy+SHS+L9DBBB9P9d9FQBAS+oRcSFMCUUUU94RcMABALCaJCEZAEqCFWJAc87FBGXGX9DBBU8/AOAO+U+TANAN+U+TAKAK+U+THO9DBBBBAO9DBBBB9gy+R9DB/+g6+U9DBBB8/+SHO+L9DBBB9P9d9FQBAO+oRcSFMCUUUU94RcMABALCEZAEqCFWJAc87FBAICNJRIAECIJREAFCaJHFQBMMM9JBGXAGCGrAF9sHF9FQBEXABAB8oGBHGCNWCN91+yAGCi91CnWCUUU/8EJ+++U84GBABCIJRBAFCaJHFQBMMM9TFEaCBCB8oGUkUUBHFABCEJC98ZJHBjGUkUUBGXGXAB8/BCTWHGuQBCaREABAGlCggEJCTrXBCa6QFMAFREMAEM/lFFFaGXGXAFABqCEZ9FQBABRESFMGXGXAGCT9PQBABRESFMABREEXAEAF8oGBjGBAECIJAFCIJ8oGBjGBAECNJAFCNJ8oGBjGBAECSJAFCSJ8oGBjGBAECTJREAFCTJRFAGC9wJHGCb9LQBMMAGCI9JQBEXAEAF8oGBjGBAFCIJRFAECIJREAGC98JHGCE9LQBMMGXAG9FQBEXAEAF2BB86BBAECFJREAFCFJRFAGCaJHGQBMMABMoFFGaGXGXABCEZ9FQBABRESFMAFCgFZC+BwsN9sRIGXGXAGCT9PQBABRESFMABREEXAEAIjGBAECSJAIjGBAECNJAIjGBAECIJAIjGBAECTJREAGC9wJHGCb9LQBMMAGCI9JQBEXAEAIjGBAECIJREAGC98JHGCE9LQBMMGXAG9FQBEXAEAF86BBAECFJREAGCaJHGQBMMABMMMFBCUNMIT9kBB",fH="B9h9z9tFBBBF8dL9gBB9gLaaaaaFa9gEaaaB9gGaaB9gFaFaEQSBBFBFFGEGEGIILF9wFFFLEFBFKNFaFCx/aFMO/LFVK9tv9t9vq95GBt9f9f939h9z9t9f9j9h9s9s9f9jW9vq9zBBp9tv9z9o9v9wW9f9kv9j9v9kv9WvqWv94h919m9mvqBG8Z9tv9z9o9v9wW9f9kv9j9v9kv9J9u9kv94h919m9mvqBIy9tv9z9o9v9wW9f9kv9j9v9kv9J9u9kv949TvZ91v9u9jvBLn9tv9z9o9v9wW9f9kv9j9v9kv69p9sWvq9P9jWBKi9tv9z9o9v9wW9f9kv9j9v9kv69p9sWvq9R919hWBNn9tv9z9o9v9wW9f9kv9j9v9kv69p9sWvq9F949wBcI9z9iqlBMc/j9JSIBTEM9+FLa8jUUUUBCTlRBCBRFEXCBRGCBREEXABCNJAGJAECUaAFAGrCFZHIy86BBAEAIJREAGCFJHGCN9HQBMAFCx+YUUBJAE86BBAFCEWCxkUUBJAB8pEN83EBAFCFJHFCUG9HQBMMkRIbaG97FaK978jUUUUBCU/KBlHL8kUUUUBC9+RKGXAGCFJAI9LQBCaRKAE2BBC+gF9HQBALAEAIJHOAGlAG/8cBBCUoBAG9uC/wgBZHKCUGAKCUG9JyRNAECFJRKCBRVGXEXAVAF9PQFANAFAVlAVANJAF9JyRcGXGXAG9FQBAcCbJHIC9wZHMCE9sRSAMCFWRQAICIrCEJCGrRfCBRbEXAKRTCBRtGXEXGXAOATlAf9PQBCBRKSLMALCU/CBJAtAM9sJRmATAfJRKCBREGXAMCoB9JQBAOAKlC/gB9JQBCBRIEXAmAIJREGXGXGXGXGXATAICKrJ2BBHYCEZfIBFGEBMAECBDtDMIBSEMAEAKDBBIAKDBBBHPCID+MFAPDQBTFtGmEYIPLdKeOnHPCGD+MFAPDQBTFtGmEYIPLdKeOnC0+G+MiDtD9OHdCEDbD8jHPD8dBhUg/8/4/w/goB9+h84k7HeCEWCxkUUBJDBEBAeCx+YUUBJDBBBHnAnDQBBBBBBBBBBBBBBBBAPD8dFhUg/8/4/w/goB9+h84k7HeCEWCxkUUBJDBEBD9uDQBFGEILKOTtmYPdenDfAdAPD9SDMIBAKCIJAnDeBJAeCx+YUUBJ2BBJRKSGMAEAKDBBNAKDBBBHPCID+MFAPDQBTFtGmEYIPLdKeOnC+P+e+8/4BDtD9OHdCbDbD8jHPD8dBhUg/8/4/w/goB9+h84k7HeCEWCxkUUBJDBEBAeCx+YUUBJDBBBHnAnDQBBBBBBBBBBBBBBBBAPD8dFhUg/8/4/w/goB9+h84k7HeCEWCxkUUBJDBEBD9uDQBFGEILKOTtmYPdenDfAdAPD9SDMIBAKCNJAnDeBJAeCx+YUUBJ2BBJRKSFMAEAKDBBBDMIBAKCTJRKMGXGXGXGXGXAYCGrCEZfIBFGEBMAECBDtDMITSEMAEAKDBBIAKDBBBHPCID+MFAPDQBTFtGmEYIPLdKeOnHPCGD+MFAPDQBTFtGmEYIPLdKeOnC0+G+MiDtD9OHdCEDbD8jHPD8dBhUg/8/4/w/goB9+h84k7HeCEWCxkUUBJDBEBAeCx+YUUBJDBBBHnAnDQBBBBBBBBBBBBBBBBAPD8dFhUg/8/4/w/goB9+h84k7HeCEWCxkUUBJDBEBD9uDQBFGEILKOTtmYPdenDfAdAPD9SDMITAKCIJAnDeBJAeCx+YUUBJ2BBJRKSGMAEAKDBBNAKDBBBHPCID+MFAPDQBTFtGmEYIPLdKeOnC+P+e+8/4BDtD9OHdCbDbD8jHPD8dBhUg/8/4/w/goB9+h84k7HeCEWCxkUUBJDBEBAeCx+YUUBJDBBBHnAnDQBBBBBBBBBBBBBBBBAPD8dFhUg/8/4/w/goB9+h84k7HeCEWCxkUUBJDBEBD9uDQBFGEILKOTtmYPdenDfAdAPD9SDMITAKCNJAnDeBJAeCx+YUUBJ2BBJRKSFMAEAKDBBBDMITAKCTJRKMGXGXGXGXGXAYCIrCEZfIBFGEBMAECBDtDMIASEMAEAKDBBIAKDBBBHPCID+MFAPDQBTFtGmEYIPLdKeOnHPCGD+MFAPDQBTFtGmEYIPLdKeOnC0+G+MiDtD9OHdCEDbD8jHPD8dBhUg/8/4/w/goB9+h84k7HeCEWCxkUUBJDBEBAeCx+YUUBJDBBBHnAnDQBBBBBBBBBBBBBBBBAPD8dFhUg/8/4/w/goB9+h84k7HeCEWCxkUUBJDBEBD9uDQBFGEILKOTtmYPdenDfAdAPD9SDMIAAKCIJAnDeBJAeCx+YUUBJ2BBJRKSGMAEAKDBBNAKDBBBHPCID+MFAPDQBTFtGmEYIPLdKeOnC+P+e+8/4BDtD9OHdCbDbD8jHPD8dBhUg/8/4/w/goB9+h84k7HeCEWCxkUUBJDBEBAeCx+YUUBJDBBBHnAnDQBBBBBBBBBBBBBBBBAPD8dFhUg/8/4/w/goB9+h84k7HeCEWCxkUUBJDBEBD9uDQBFGEILKOTtmYPdenDfAdAPD9SDMIAAKCNJAnDeBJAeCx+YUUBJ2BBJRKSFMAEAKDBBBDMIAAKCTJRKMGXGXGXGXGXAYCKrfIBFGEBMAECBDtDMI8wSEMAEAKDBBIAKDBBBHPCID+MFAPDQBTFtGmEYIPLdKeOnHPCGD+MFAPDQBTFtGmEYIPLdKeOnC0+G+MiDtD9OHdCEDbD8jHPD8dBhUg/8/4/w/goB9+h84k7HYCEWCxkUUBJDBEBAYCx+YUUBJDBBBHnAnDQBBBBBBBBBBBBBBBBAPD8dFhUg/8/4/w/goB9+h84k7HYCEWCxkUUBJDBEBD9uDQBFGEILKOTtmYPdenDfAdAPD9SDMI8wAKCIJAnDeBJAYCx+YUUBJ2BBJRKSGMAEAKDBBNAKDBBBHPCID+MFAPDQBTFtGmEYIPLdKeOnC+P+e+8/4BDtD9OHdCbDbD8jHPD8dBhUg/8/4/w/goB9+h84k7HYCEWCxkUUBJDBEBAYCx+YUUBJDBBBHnAnDQBBBBBBBBBBBBBBBBAPD8dFhUg/8/4/w/goB9+h84k7HYCEWCxkUUBJDBEBD9uDQBFGEILKOTtmYPdenDfAdAPD9SDMI8wAKCNJAnDeBJAYCx+YUUBJ2BBJRKSFMAEAKDBBBDMI8wAKCTJRKMAICoBJREAICUFJAM9LQFAERIAOAKlC/fB9LQBMMGXAEAM9PQBAECErRIEXGXAOAKlCi9PQBCBRKSOMAmAEJRYGXGXGXGXGXATAECKrJ2BBAICKZrCEZfIBFGEBMAYCBDtDMIBSEMAYAKDBBIAKDBBBHPCID+MFAPDQBTFtGmEYIPLdKeOnHPCGD+MFAPDQBTFtGmEYIPLdKeOnC0+G+MiDtD9OHdCEDbD8jHPD8dBhUg/8/4/w/goB9+h84k7HeCEWCxkUUBJDBEBAeCx+YUUBJDBBBHnAnDQBBBBBBBBBBBBBBBBAPD8dFhUg/8/4/w/goB9+h84k7HeCEWCxkUUBJDBEBD9uDQBFGEILKOTtmYPdenDfAdAPD9SDMIBAKCIJAnDeBJAeCx+YUUBJ2BBJRKSGMAYAKDBBNAKDBBBHPCID+MFAPDQBTFtGmEYIPLdKeOnC+P+e+8/4BDtD9OHdCbDbD8jHPD8dBhUg/8/4/w/goB9+h84k7HeCEWCxkUUBJDBEBAeCx+YUUBJDBBBHnAnDQBBBBBBBBBBBBBBBBAPD8dFhUg/8/4/w/goB9+h84k7HeCEWCxkUUBJDBEBD9uDQBFGEILKOTtmYPdenDfAdAPD9SDMIBAKCNJAnDeBJAeCx+YUUBJ2BBJRKSFMAYAKDBBBDMIBAKCTJRKMAICGJRIAECTJHEAM9JQBMMGXAK9FQBAKRTAtCFJHtCI6QGSFMMCBRKSEMGXAM9FQBALCUGJAbJREALAbJDBGBRnCBRYEXAEALCU/CBJAYJHIDBIBHdCFD9tAdCFDbHPD9OD9hD9RHdAIAMJDBIBHiCFD9tAiAPD9OD9hD9RHiDQBTFtGmEYIPLdKeOnH8ZAIAQJDBIBHpCFD9tApAPD9OD9hD9RHpAIASJDBIBHyCFD9tAyAPD9OD9hD9RHyDQBTFtGmEYIPLdKeOnH8cDQBFTtGEmYILPdKOenHPAPDQBFGEBFGEBFGEBFGEAnD9uHnDyBjGBAEAGJHIAnAPAPDQILKOILKOILKOILKOD9uHnDyBjGBAIAGJHIAnAPAPDQNVcMNVcMNVcMNVcMD9uHnDyBjGBAIAGJHIAnAPAPDQSQfbSQfbSQfbSQfbD9uHnDyBjGBAIAGJHIAnA8ZA8cDQNVi8ZcMpySQ8c8dfb8e8fHPAPDQBFGEBFGEBFGEBFGED9uHnDyBjGBAIAGJHIAnAPAPDQILKOILKOILKOILKOD9uHnDyBjGBAIAGJHIAnAPAPDQNVcMNVcMNVcMNVcMD9uHnDyBjGBAIAGJHIAnAPAPDQSQfbSQfbSQfbSQfbD9uHnDyBjGBAIAGJHIAnAdAiDQNiV8ZcpMyS8cQ8df8eb8fHdApAyDQNiV8ZcpMyS8cQ8df8eb8fHiDQBFTtGEmYILPdKOenHPAPDQBFGEBFGEBFGEBFGED9uHnDyBjGBAIAGJHIAnAPAPDQILKOILKOILKOILKOD9uHnDyBjGBAIAGJHIAnAPAPDQNVcMNVcMNVcMNVcMD9uHnDyBjGBAIAGJHIAnAPAPDQSQfbSQfbSQfbSQfbD9uHnDyBjGBAIAGJHIAnAdAiDQNVi8ZcMpySQ8c8dfb8e8fHPAPDQBFGEBFGEBFGEBFGED9uHnDyBjGBAIAGJHIAnAPAPDQILKOILKOILKOILKOD9uHnDyBjGBAIAGJHIAnAPAPDQNVcMNVcMNVcMNVcMD9uHnDyBjGBAIAGJHIAnAPAPDQSQfbSQfbSQfbSQfbD9uHnDyBjGBAIAGJREAYCTJHYAM9JQBMMAbCIJHbAG9JQBMMABAVAG9sJALCUGJAcAG9s/8cBBALALCUGJAcCaJAG9sJAG/8cBBMAcCBAKyAVJRVAKQBMC9+RKSFMCBC99AOAKlAGCAAGCA9Ly6yRKMALCU/KBJ8kUUUUBAKMNBT+BUUUBM+KmFTa8jUUUUBCoFlHL8kUUUUBC9+RKGXAFCE9uHOCtJAI9LQBCaRKAE2BBHNC/wFZC/gF9HQBANCbZHVCF9LQBALCoBJCgFCUF/8MBALC84Jha83EBALC8wJha83EBALC8oJha83EBALCAJha83EBALCiJha83EBALCTJha83EBALha83ENALha83EBAEAIJC9wJRcAECFJHNAOJRMGXAF9FQBCQCbAVCF6yRSABRECBRVCBRQCBRfCBRICBRKEXGXAMAcuQBC9+RKSEMGXGXAN2BBHOC/vF9LQBALCoBJAOCIrCa9zAKJCbZCEWJHb8oGIRTAb8oGBRtGXAOCbZHbAS9PQBALAOCa9zAIJCbZCGWJ8oGBAVAbyROAb9FRbGXGXAGCG9HQBABAt87FBABCIJAO87FBABCGJAT87FBSFMAEAtjGBAECNJAOjGBAECIJATjGBMAVAbJRVALCoBJAKCEWJHmAOjGBAmATjGIALAICGWJAOjGBALCoBJAKCFJCbZHKCEWJHTAtjGBATAOjGIAIAbJRIAKCFJRKSGMGXGXAbCb6QBAQAbJAbC989zJCFJRQSFMAM1BBHbCgFZROGXGXAbCa9MQBAMCFJRMSFMAM1BFHbCgBZCOWAOCgBZqROGXAbCa9MQBAMCGJRMSFMAM1BGHbCgBZCfWAOqROGXAbCa9MQBAMCEJRMSFMAM1BEHbCgBZCdWAOqROGXAbCa9MQBAMCIJRMSFMAM2BIC8cWAOqROAMCLJRMMAOCFrCBAOCFZl9zAQJRQMGXGXAGCG9HQBABAt87FBABCIJAQ87FBABCGJAT87FBSFMAEAtjGBAECNJAQjGBAECIJATjGBMALCoBJAKCEWJHOAQjGBAOATjGIALAICGWJAQjGBALCoBJAKCFJCbZHKCEWJHOAtjGBAOAQjGIAICFJRIAKCFJRKSFMGXAOCDF9LQBALAIAcAOCbZJ2BBHbCIrHTlCbZCGWJ8oGBAVCFJHtATyROALAIAblCbZCGWJ8oGBAtAT9FHmJHtAbCbZHTyRbAT9FRTGXGXAGCG9HQBABAV87FBABCIJAb87FBABCGJAO87FBSFMAEAVjGBAECNJAbjGBAECIJAOjGBMALAICGWJAVjGBALCoBJAKCEWJHYAOjGBAYAVjGIALAICFJHICbZCGWJAOjGBALCoBJAKCFJCbZCEWJHYAbjGBAYAOjGIALAIAmJCbZHICGWJAbjGBALCoBJAKCGJCbZHKCEWJHOAVjGBAOAbjGIAKCFJRKAIATJRIAtATJRVSFMAVCBAM2BBHYyHTAOC/+F6HPJROAYCbZRtGXGXAYCIrHmQBAOCFJRbSFMAORbALAIAmlCbZCGWJ8oGBROMGXGXAtQBAbCFJRVSFMAbRVALAIAYlCbZCGWJ8oGBRbMGXGXAP9FQBAMCFJRYSFMAM1BFHYCgFZRTGXGXAYCa9MQBAMCGJRYSFMAM1BGHYCgBZCOWATCgBZqRTGXAYCa9MQBAMCEJRYSFMAM1BEHYCgBZCfWATqRTGXAYCa9MQBAMCIJRYSFMAM1BIHYCgBZCdWATqRTGXAYCa9MQBAMCLJRYSFMAMCKJRYAM2BLC8cWATqRTMATCFrCBATCFZl9zAQJHQRTMGXGXAmCb6QBAYRPSFMAY1BBHMCgFZROGXGXAMCa9MQBAYCFJRPSFMAY1BFHMCgBZCOWAOCgBZqROGXAMCa9MQBAYCGJRPSFMAY1BGHMCgBZCfWAOqROGXAMCa9MQBAYCEJRPSFMAY1BEHMCgBZCdWAOqROGXAMCa9MQBAYCIJRPSFMAYCLJRPAY2BIC8cWAOqROMAOCFrCBAOCFZl9zAQJHQROMGXGXAtCb6QBAPRMSFMAP1BBHMCgFZRbGXGXAMCa9MQBAPCFJRMSFMAP1BFHMCgBZCOWAbCgBZqRbGXAMCa9MQBAPCGJRMSFMAP1BGHMCgBZCfWAbqRbGXAMCa9MQBAPCEJRMSFMAP1BEHMCgBZCdWAbqRbGXAMCa9MQBAPCIJRMSFMAPCLJRMAP2BIC8cWAbqRbMAbCFrCBAbCFZl9zAQJHQRbMGXGXAGCG9HQBABAT87FBABCIJAb87FBABCGJAO87FBSFMAEATjGBAECNJAbjGBAECIJAOjGBMALCoBJAKCEWJHYAOjGBAYATjGIALAICGWJATjGBALCoBJAKCFJCbZCEWJHYAbjGBAYAOjGIALAICFJHICbZCGWJAOjGBALCoBJAKCGJCbZCEWJHOATjGBAOAbjGIALAIAm9FAmCb6qJHICbZCGWJAbjGBAIAt9FAtCb6qJRIAKCEJRKMANCFJRNABCKJRBAECSJREAKCbZRKAICbZRIAfCEJHfAF9JQBMMCBC99AMAc6yRKMALCoFJ8kUUUUBAKM/tIFGa8jUUUUBCTlRLC9+RKGXAFCLJAI9LQBCaRKAE2BBC/+FZC/QF9HQBALhB83ENAECFJRKAEAIJC98JREGXAF9FQBGXAGCG6QBEXGXAKAE9JQBC9+bMAK1BBHGCgFZRIGXGXAGCa9MQBAKCFJRKSFMAK1BFHGCgBZCOWAICgBZqRIGXAGCa9MQBAKCGJRKSFMAK1BGHGCgBZCfWAIqRIGXAGCa9MQBAKCEJRKSFMAK1BEHGCgBZCdWAIqRIGXAGCa9MQBAKCIJRKSFMAK2BIC8cWAIqRIAKCLJRKMALCNJAICFZCGWqHGAICGrCBAICFrCFZl9zAG8oGBJHIjGBABAIjGBABCIJRBAFCaJHFQBSGMMEXGXAKAE9JQBC9+bMAK1BBHGCgFZRIGXGXAGCa9MQBAKCFJRKSFMAK1BFHGCgBZCOWAICgBZqRIGXAGCa9MQBAKCGJRKSFMAK1BGHGCgBZCfWAIqRIGXAGCa9MQBAKCEJRKSFMAK1BEHGCgBZCdWAIqRIGXAGCa9MQBAKCIJRKSFMAK2BIC8cWAIqRIAKCLJRKMABAICGrCBAICFrCFZl9zALCNJAICFZCGWqHI8oGBJHG87FBAIAGjGBABCGJRBAFCaJHFQBMMCBC99AKAE6yRKMAKM/xLGEaK978jUUUUBCAlHE8kUUUUBGXGXAGCI9HQBGXAFC98ZHI9FQBABRGCBRLEXAGAGDBBBHKCiD+rFCiD+sFD/6FHOAKCND+rFCiD+sFD/6FAOD/gFAKCTD+rFCiD+sFD/6FHND/gFD/kFD/lFHVCBDtD+2FHcAOCUUUU94DtHMD9OD9RD/kFHO9DBB/+hDYAOAOD/mFAVAVD/mFANAcANAMD9OD9RD/kFHOAOD/mFD/kFD/kFD/jFD/nFHND/mF9DBBX9LDYHcD/kFCgFDtD9OAKCUUU94DtD9OD9QAOAND/mFAcD/kFCND+rFCU/+EDtD9OD9QAVAND/mFAcD/kFCTD+rFCUU/8ODtD9OD9QDMBBAGCTJRGALCIJHLAI9JQBMMAIAF9PQFAEAFCEZHLCGWHGqCBCTAGl/8MBAEABAICGWJHIAG/8cBBGXAL9FQBAEAEDBIBHKCiD+rFCiD+sFD/6FHOAKCND+rFCiD+sFD/6FAOD/gFAKCTD+rFCiD+sFD/6FHND/gFD/kFD/lFHVCBDtD+2FHcAOCUUUU94DtHMD9OD9RD/kFHO9DBB/+hDYAOAOD/mFAVAVD/mFANAcANAMD9OD9RD/kFHOAOD/mFD/kFD/kFD/jFD/nFHND/mF9DBBX9LDYHcD/kFCgFDtD9OAKCUUU94DtD9OD9QAOAND/mFAcD/kFCND+rFCU/+EDtD9OD9QAVAND/mFAcD/kFCTD+rFCUU/8ODtD9OD9QDMIBMAIAEAG/8cBBSFMABAFC98ZHGT+HUUUBAGAF9PQBAEAFCEZHICEWHLJCBCAALl/8MBAEABAGCEWJHGAL/8cBBAEAIT+HUUUBAGAEAL/8cBBMAECAJ8kUUUUBM+yEGGaO97GXAF9FQBCBRGEXABCTJHEAEDBBBHICBDtHLCUU98D8cFCUU98D8cEHKD9OABDBBBHOAIDQILKOSQfbPden8c8d8e8fCggFDtD9OD/6FAOAIDQBFGENVcMTtmYi8ZpyHICTD+sFD/6FHND/gFAICTD+rFCTD+sFD/6FHVD/gFD/kFD/lFHI9DB/+g6DYAVAIALD+2FHLAVCUUUU94DtHcD9OD9RD/kFHVAVD/mFAIAID/mFANALANAcD9OD9RD/kFHIAID/mFD/kFD/kFD/jFD/nFHND/mF9DBBX9LDYHLD/kFCTD+rFAVAND/mFALD/kFCggEDtD9OD9QHVAIAND/mFALD/kFCaDbCBDnGCBDnECBDnKCBDnOCBDncCBDnMCBDnfCBDnbD9OHIDQNVi8ZcMpySQ8c8dfb8e8fD9QDMBBABAOAKD9OAVAIDQBFTtGEmYILPdKOenD9QDMBBABCAJRBAGCIJHGAF9JQBMMM94FEa8jUUUUBCAlHE8kUUUUBABAFC98ZHIT+JUUUBGXAIAF9PQBAEAFCEZHLCEWHFJCBCAAFl/8MBAEABAICEWJHBAF/8cBBAEALT+JUUUBABAEAF/8cBBMAECAJ8kUUUUBM/hEIGaF97FaL978jUUUUBCTlRGGXAF9FQBCBREEXAGABDBBBHIABCTJHLDBBBHKDQILKOSQfbPden8c8d8e8fHOCTD+sFHNCID+rFDMIBAB9DBBU8/DY9D/zI818/DYANCEDtD9QD/6FD/nFHNAIAKDQBFGENVcMTtmYi8ZpyHICTD+rFCTD+sFD/6FD/mFHKAKD/mFANAICTD+sFD/6FD/mFHVAVD/mFANAOCTD+rFCTD+sFD/6FD/mFHOAOD/mFD/kFD/kFD/lFCBDtD+4FD/jF9DB/+g6DYHND/mF9DBBX9LDYHID/kFCggEDtHcD9OAVAND/mFAID/kFCTD+rFD9QHVAOAND/mFAID/kFCTD+rFAKAND/mFAID/kFAcD9OD9QHNDQBFTtGEmYILPdKOenHID8dBAGDBIBDyB+t+J83EBABCNJAID8dFAGDBIBDyF+t+J83EBALAVANDQNVi8ZcMpySQ8c8dfb8e8fHND8dBAGDBIBDyG+t+J83EBABCiJAND8dFAGDBIBDyE+t+J83EBABCAJRBAECIJHEAF9JQBMMM/3FGEaF978jUUUUBCoBlREGXAGCGrAF9sHIC98ZHL9FQBCBRGABRFEXAFAFDBBBHKCND+rFCND+sFD/6FAKCiD+sFCnD+rFCUUU/8EDtD+uFD/mFDMBBAFCTJRFAGCIJHGAL9JQBMMGXALAI9PQBAEAICEZHGCGWHFqCBCoBAFl/8MBAEABALCGWJHLAF/8cBBGXAG9FQBAEAEDBIBHKCND+rFCND+sFD/6FAKCiD+sFCnD+rFCUUU/8EDtD+uFD/mFDMIBMALAEAF/8cBBMM9TFEaCBCB8oGUkUUBHFABCEJC98ZJHBjGUkUUBGXGXAB8/BCTWHGuQBCaREABAGlCggEJCTrXBCa6QFMAFREMAEMMMFBCUNMIT9tBB",dH=new Uint8Array([0,97,115,109,1,0,0,0,1,4,1,96,0,0,3,3,2,0,0,5,3,1,0,1,12,1,0,10,22,2,12,0,65,0,65,0,65,0,252,10,0,0,11,7,0,65,0,253,15,26,11]),pH=new Uint8Array([32,0,65,253,3,1,2,34,4,106,6,5,11,8,7,20,13,33,12,16,128,9,116,64,19,113,127,15,10,21,22,14,255,66,24,54,136,107,18,23,192,26,114,118,132,17,77,101,130,144,27,87,131,44,45,74,156,154,70,167]),gH={0:"",1:"meshopt_decodeFilterOct",2:"meshopt_decodeFilterQuat",3:"meshopt_decodeFilterExp",NONE:"",OCTAHEDRAL:"meshopt_decodeFilterOct",QUATERNION:"meshopt_decodeFilterQuat",EXPONENTIAL:"meshopt_decodeFilterExp"},_H={0:"meshopt_decodeVertexBuffer",1:"meshopt_decodeIndexBuffer",2:"meshopt_decodeIndexSequence",ATTRIBUTES:"meshopt_decodeVertexBuffer",TRIANGLES:"meshopt_decodeIndexBuffer",INDICES:"meshopt_decodeIndexSequence"};async function mH(t,e,n,s,r,i="NONE"){const o=await yH();EH(o,o.exports[_H[r]],t,e,n,s,o.exports[gH[i||"NONE"]])}let Rd;async function yH(){return Rd||(Rd=AH()),Rd}async function AH(){let t=hH;WebAssembly.validate(dH)&&(t=fH,console.log("Warning: meshopt_decoder is using experimental SIMD support"));const e=await WebAssembly.instantiate(TH(t),{});return await e.instance.exports.__wasm_call_ctors(),e.instance}function TH(t){const e=new Uint8Array(t.length);for(let s=0;s<t.length;++s){const r=t.charCodeAt(s);e[s]=r>96?r-71:r>64?r-65:r>47?r+4:r>46?63:62}let n=0;for(let s=0;s<t.length;++s)e[n++]=e[s]<60?pH[e[s]]:(e[s]-60)*64+e[++s];return e.buffer.slice(0,n)}function EH(t,e,n,s,r,i,o){const a=t.exports.sbrk,c=s+3&-4,l=a(c*r),u=a(i.length),h=new Uint8Array(t.exports.memory.buffer);h.set(i,u);const f=e(l,s,r,u,i.length);if(f===0&&o&&o(l,c,r),n.set(h.subarray(l,l+s*r)),a(l-a(0)),f!==0)throw new Error(`Malformed buffer data: ${f}`)}const Du="EXT_meshopt_compression",SH=Du;async function CH(t,e){var r,i;const n=new st(t);if(!((r=e==null?void 0:e.gltf)!=null&&r.decompressMeshes)||!((i=e.gltf)!=null&&i.loadBuffers))return;const s=[];for(const o of t.json.bufferViews||[])s.push(vH(n,o));await Promise.all(s),n.removeExtension(Du)}async function vH(t,e){const n=t.getObjectExtension(e,Du);if(n){const{byteOffset:s=0,byteLength:r=0,byteStride:i,count:o,mode:a,filter:c="NONE",buffer:l}=n,u=t.gltf.buffers[l],h=new Uint8Array(u.arrayBuffer,u.byteOffset+s,r),f=new Uint8Array(t.gltf.buffers[e.buffer].arrayBuffer,e.byteOffset,e.byteLength);await mH(f,o,i,h,a,c),t.removeObjectExtension(e,Du)}}const wH=Object.freeze(Object.defineProperty({__proto__:null,decode:CH,name:SH},Symbol.toStringTag,{value:"Module"})),ti="EXT_texture_webp",bH=ti;function RH(t,e){const n=new st(t);if(!sB("image/webp")){if(n.getRequiredExtensions().includes(ti))throw new Error(`gltf: Required extension ${ti} not supported by browser`);return}const{json:s}=n;for(const r of s.textures||[]){const i=n.getObjectExtension(r,ti);i&&(r.source=i.source),n.removeObjectExtension(r,ti)}n.removeExtension(ti)}const IH=Object.freeze(Object.defineProperty({__proto__:null,name:bH,preprocess:RH},Symbol.toStringTag,{value:"Module"})),Dl="KHR_texture_basisu",PH=Dl;function xH(t,e){const n=new st(t),{json:s}=n;for(const r of s.textures||[]){const i=n.getObjectExtension(r,Dl);i&&(r.source=i.source,n.removeObjectExtension(r,Dl))}n.removeExtension(Dl)}const MH=Object.freeze(Object.defineProperty({__proto__:null,name:PH,preprocess:xH},Symbol.toStringTag,{value:"Module"})),BH="4.2.0-beta.2",OH={dataType:null,batchType:null,name:"Draco",id:"draco",module:"draco",version:BH,worker:!0,extensions:["drc"],mimeTypes:["application/octet-stream"],binary:!0,tests:["DRACO"],options:{draco:{decoderType:typeof WebAssembly=="object"?"wasm":"js",libraryPath:"libs/",extraAttributes:{},attributeNameEntry:void 0}}};function NH(t,e,n){const s=Xb(e.metadata),r=[],i=FH(e.attributes);for(const o in t){const a=t[o],c=LE(o,a,i[o]);r.push(c)}if(n){const o=LE("indices",n);r.push(o)}return{fields:r,metadata:s}}function FH(t){const e={};for(const n in t){const s=t[n];e[s.name||"undefined"]=s}return e}function LE(t,e,n){const s=n?Xb(n.metadata):void 0;return CM(t,e,s)}function Xb(t){Object.entries(t);const e={};for(const n in t)e[`${n}.string`]=JSON.stringify(t[n]);return e}const UE={POSITION:"POSITION",NORMAL:"NORMAL",COLOR:"COLOR_0",TEX_COORD:"TEXCOORD_0"},DH={1:Int8Array,2:Uint8Array,3:Int16Array,4:Uint16Array,5:Int32Array,6:Uint32Array,9:Float32Array},LH=4;class UH{constructor(e){p(this,"draco");p(this,"decoder");p(this,"metadataQuerier");this.draco=e,this.decoder=new this.draco.Decoder,this.metadataQuerier=new this.draco.MetadataQuerier}destroy(){this.draco.destroy(this.decoder),this.draco.destroy(this.metadataQuerier)}parseSync(e,n={}){const s=new this.draco.DecoderBuffer;s.Init(new Int8Array(e),e.byteLength),this._disableAttributeTransforms(n);const r=this.decoder.GetEncodedGeometryType(s),i=r===this.draco.TRIANGULAR_MESH?new this.draco.Mesh:new this.draco.PointCloud;try{let o;switch(r){case this.draco.TRIANGULAR_MESH:o=this.decoder.DecodeBufferToMesh(s,i);break;case this.draco.POINT_CLOUD:o=this.decoder.DecodeBufferToPointCloud(s,i);break;default:throw new Error("DRACO: Unknown geometry type.")}if(!o.ok()||!i.ptr){const f=`DRACO decompression failed: ${o.error_msg()}`;throw new Error(f)}const a=this._getDracoLoaderData(i,r,n),c=this._getMeshData(i,a,n),l=cm(c.attributes),u=NH(c.attributes,a,c.indices);return{loader:"draco",loaderData:a,header:{vertexCount:i.num_points(),boundingBox:l},...c,schema:u}}finally{this.draco.destroy(s),i&&this.draco.destroy(i)}}_getDracoLoaderData(e,n,s){const r=this._getTopLevelMetadata(e),i=this._getDracoAttributes(e,s);return{geometry_type:n,num_attributes:e.num_attributes(),num_points:e.num_points(),num_faces:e instanceof this.draco.Mesh?e.num_faces():0,metadata:r,attributes:i}}_getDracoAttributes(e,n){const s={};for(let r=0;r<e.num_attributes();r++){const i=this.decoder.GetAttribute(e,r),o=this._getAttributeMetadata(e,r);s[i.unique_id()]={unique_id:i.unique_id(),attribute_type:i.attribute_type(),data_type:i.data_type(),num_components:i.num_components(),byte_offset:i.byte_offset(),byte_stride:i.byte_stride(),normalized:i.normalized(),attribute_index:r,metadata:o};const a=this._getQuantizationTransform(i,n);a&&(s[i.unique_id()].quantization_transform=a);const c=this._getOctahedronTransform(i,n);c&&(s[i.unique_id()].octahedron_transform=c)}return s}_getMeshData(e,n,s){const r=this._getMeshAttributes(n,e,s);if(!r.POSITION)throw new Error("DRACO: No position attribute found.");if(e instanceof this.draco.Mesh)switch(s.topology){case"triangle-strip":return{topology:"triangle-strip",mode:4,attributes:r,indices:{value:this._getTriangleStripIndices(e),size:1}};case"triangle-list":default:return{topology:"triangle-list",mode:5,attributes:r,indices:{value:this._getTriangleListIndices(e),size:1}}}return{topology:"point-list",mode:0,attributes:r}}_getMeshAttributes(e,n,s){const r={};for(const i of Object.values(e.attributes)){const o=this._deduceAttributeName(i,s);i.name=o;const a=this._getAttributeValues(n,i);if(a){const{value:c,size:l}=a;r[o]={value:c,size:l,byteOffset:i.byte_offset,byteStride:i.byte_stride,normalized:i.normalized}}}return r}_getTriangleListIndices(e){const s=e.num_faces()*3,r=s*LH,i=this.draco._malloc(r);try{return this.decoder.GetTrianglesUInt32Array(e,r,i),new Uint32Array(this.draco.HEAPF32.buffer,i,s).slice()}finally{this.draco._free(i)}}_getTriangleStripIndices(e){const n=new this.draco.DracoInt32Array;try{return this.decoder.GetTriangleStripsFromMesh(e,n),VH(n)}finally{this.draco.destroy(n)}}_getAttributeValues(e,n){const s=DH[n.data_type];if(!s)return console.warn(`DRACO: Unsupported attribute type ${n.data_type}`),null;const r=n.num_components,o=e.num_points()*r,a=o*s.BYTES_PER_ELEMENT,c=kH(this.draco,s);let l;const u=this.draco._malloc(a);try{const h=this.decoder.GetAttribute(e,n.attribute_index);this.decoder.GetAttributeDataArrayForAllPoints(e,h,c,a,u),l=new s(this.draco.HEAPF32.buffer,u,o).slice()}finally{this.draco._free(u)}return{value:l,size:r}}_deduceAttributeName(e,n){const s=e.unique_id;for(const[o,a]of Object.entries(n.extraAttributes||{}))if(a===s)return o;const r=e.attribute_type;for(const o in UE)if(this.draco[o]===r)return UE[o];const i=n.attributeNameEntry||"name";return e.metadata[i]?e.metadata[i].string:`CUSTOM_ATTRIBUTE_${s}`}_getTopLevelMetadata(e){const n=this.decoder.GetMetadata(e);return this._getDracoMetadata(n)}_getAttributeMetadata(e,n){const s=this.decoder.GetAttributeMetadata(e,n);return this._getDracoMetadata(s)}_getDracoMetadata(e){if(!e||!e.ptr)return{};const n={},s=this.metadataQuerier.NumEntries(e);for(let r=0;r<s;r++){const i=this.metadataQuerier.GetEntryName(e,r);n[i]=this._getDracoMetadataField(e,i)}return n}_getDracoMetadataField(e,n){const s=new this.draco.DracoInt32Array;try{this.metadataQuerier.GetIntEntryArray(e,n,s);const r=zH(s);return{int:this.metadataQuerier.GetIntEntry(e,n),string:this.metadataQuerier.GetStringEntry(e,n),double:this.metadataQuerier.GetDoubleEntry(e,n),intArray:r}}finally{this.draco.destroy(s)}}_disableAttributeTransforms(e){const{quantizedAttributes:n=[],octahedronAttributes:s=[]}=e,r=[...n,...s];for(const i of r)this.decoder.SkipAttributeTransform(this.draco[i])}_getQuantizationTransform(e,n){const{quantizedAttributes:s=[]}=n,r=e.attribute_type();if(s.map(o=>this.decoder[o]).includes(r)){const o=new this.draco.AttributeQuantizationTransform;try{if(o.InitFromAttribute(e))return{quantization_bits:o.quantization_bits(),range:o.range(),min_values:new Float32Array([1,2,3]).map(a=>o.min_value(a))}}finally{this.draco.destroy(o)}}return null}_getOctahedronTransform(e,n){const{octahedronAttributes:s=[]}=n,r=e.attribute_type();if(s.map(o=>this.decoder[o]).includes(r)){const o=new this.draco.AttributeQuantizationTransform;try{if(o.InitFromAttribute(e))return{quantization_bits:o.quantization_bits()}}finally{this.draco.destroy(o)}}return null}}function kH(t,e){switch(e){case Float32Array:return t.DT_FLOAT32;case Int8Array:return t.DT_INT8;case Int16Array:return t.DT_INT16;case Int32Array:return t.DT_INT32;case Uint8Array:return t.DT_UINT8;case Uint16Array:return t.DT_UINT16;case Uint32Array:return t.DT_UINT32;default:return t.DT_INVALID}}function zH(t){const e=t.size(),n=new Int32Array(e);for(let s=0;s<e;s++)n[s]=t.GetValue(s);return n}function VH(t){const e=t.size(),n=new Int32Array(e);for(let s=0;s<e;s++)n[s]=t.GetValue(s);return n}const HH="1.5.6",jH="1.4.1",Id=`https://www.gstatic.com/draco/versioned/decoders/${HH}`,pt={DECODER:"draco_wasm_wrapper.js",DECODER_WASM:"draco_decoder.wasm",FALLBACK_DECODER:"draco_decoder.js",ENCODER:"draco_encoder.js"},Pd={[pt.DECODER]:`${Id}/${pt.DECODER}`,[pt.DECODER_WASM]:`${Id}/${pt.DECODER_WASM}`,[pt.FALLBACK_DECODER]:`${Id}/${pt.FALLBACK_DECODER}`,[pt.ENCODER]:`https://raw.githubusercontent.com/google/draco/${jH}/javascript/${pt.ENCODER}`};let xd;async function WH(t){const e=t.modules||{};return e.draco3d?xd||(xd=e.draco3d.createDecoderModule({}).then(n=>({draco:n}))):xd||(xd=GH(t)),await xd}async function GH(t){let e,n;switch(t.draco&&t.draco.decoderType){case"js":e=await Er(Pd[pt.FALLBACK_DECODER],"draco",t,pt.FALLBACK_DECODER);break;case"wasm":default:[e,n]=await Promise.all([await Er(Pd[pt.DECODER],"draco",t,pt.DECODER),await Er(Pd[pt.DECODER_WASM],"draco",t,pt.DECODER_WASM)])}return e=e||globalThis.DracoDecoderModule,await XH(e,n)}function XH(t,e){const n={};return e&&(n.wasmBinary=e),new Promise(s=>{t({...n,onModuleLoaded:r=>s({draco:r})})})}const $b={...OH,parse:$H};async function $H(t,e){const{draco:n}=await WH(e),s=new UH(n);try{return s.parseSync(t,e==null?void 0:e.draco)}finally{s.destroy()}}function KH(t){const e={};for(const n in t){const s=t[n];if(n!=="indices"){const r=Kb(s);e[n]=r}}return e}function Kb(t){const{buffer:e,size:n,count:s}=YH(t);return{value:e,size:n,byteOffset:0,count:s,type:Fb(n),componentType:zm(e)}}function YH(t){let e=t,n=1,s=0;return t&&t.value&&(e=t.value,n=t.size||1),e&&(ArrayBuffer.isView(e)||(e=JH(e,Float32Array)),s=e.length/n),{buffer:e,size:n,count:s}}function JH(t,e,n=!1){return t?Array.isArray(t)?new e(t):n&&!(t instanceof e)?new e(t):t:null}const Gs="KHR_draco_mesh_compression",qH=Gs;function ZH(t,e,n){const s=new st(t);for(const r of Yb(s))s.getObjectExtension(r,Gs)}async function QH(t,e,n){var i;if(!((i=e==null?void 0:e.gltf)!=null&&i.decompressMeshes))return;const s=new st(t),r=[];for(const o of Yb(s))s.getObjectExtension(o,Gs)&&r.push(t5(s,o,e,n));await Promise.all(r),s.removeExtension(Gs)}function e5(t,e={}){const n=new st(t);for(const s of n.json.meshes||[])n5(s),n.addRequiredExtension(Gs)}async function t5(t,e,n,s){const r=t.getObjectExtension(e,Gs);if(!r)return;const i=t.getTypedArrayForBufferView(r.bufferView),o=nm(i.buffer,i.byteOffset),a={...n};delete a["3d-tiles"];const c=await ro(o,$b,a,s),l=KH(c.attributes);for(const[u,h]of Object.entries(l))if(u in e.attributes){const f=e.attributes[u],d=t.getAccessor(f);d!=null&&d.min&&(d!=null&&d.max)&&(h.min=d.min,h.max=d.max)}e.attributes=l,c.indices&&(e.indices=Kb(c.indices)),t.removeObjectExtension(e,Gs),s5(e)}function n5(t,e,n=4,s,r){var u;if(!s.DracoWriter)throw new Error("options.gltf.DracoWriter not provided");const i=s.DracoWriter.encodeSync({attributes:t}),o=(u=r==null?void 0:r.parseSync)==null?void 0:u.call(r,{attributes:t}),a=s._addFauxAttributes(o.attributes),c=s.addBufferView(i);return{primitives:[{attributes:a,mode:n,extensions:{[Gs]:{bufferView:c,attributes:a}}}]}}function s5(t){if(!t.attributes&&Object.keys(t.attributes).length>0)throw new Error("glTF: Empty primitive detected: Draco decompression failure?")}function*Yb(t){for(const e of t.json.meshes||[])for(const n of e.primitives)yield n}const r5=Object.freeze(Object.defineProperty({__proto__:null,decode:QH,encode:e5,name:qH,preprocess:ZH},Symbol.toStringTag,{value:"Module"})),Yh="KHR_texture_transform",i5=Yh,cl=new x,o5=new Ie,a5=new Ie;async function c5(t,e){var i;if(!new st(t).hasExtension(Yh)||!((i=e.gltf)!=null&&i.loadBuffers))return;const r=t.json.materials||[];for(let o=0;o<r.length;o++)l5(o,t)}function l5(t,e){var i,o,a,c;const n=(i=e.json.materials)==null?void 0:i[t],s=[(o=n==null?void 0:n.pbrMetallicRoughness)==null?void 0:o.baseColorTexture,n==null?void 0:n.emissiveTexture,n==null?void 0:n.normalTexture,n==null?void 0:n.occlusionTexture,(a=n==null?void 0:n.pbrMetallicRoughness)==null?void 0:a.metallicRoughnessTexture],r=[];for(const l of s)l&&((c=l==null?void 0:l.extensions)!=null&&c[Yh])&&u5(e,t,l,r)}function u5(t,e,n,s){const r=h5(n,s);if(!r)return;const i=t.json.meshes||[];for(const o of i)for(const a of o.primitives){const c=a.material;Number.isFinite(c)&&e===c&&f5(t,a,r)}}function h5(t,e){var o;const n=(o=t.extensions)==null?void 0:o[Yh],{texCoord:s=0}=t,{texCoord:r=s}=n;if(!(e.findIndex(([a,c])=>a===s&&c===r)!==-1)){const a=g5(n);return s!==r&&(t.texCoord=r),e.push([s,r]),{originalTexCoord:s,texCoord:r,matrix:a}}return null}function f5(t,e,n){var a,c;const{originalTexCoord:s,texCoord:r,matrix:i}=n,o=e.attributes[`TEXCOORD_${s}`];if(Number.isFinite(o)){const l=(a=t.json.accessors)==null?void 0:a[o];if(l&&l.bufferView){const u=(c=t.json.bufferViews)==null?void 0:c[l.bufferView];if(u){const{arrayBuffer:h,byteOffset:f}=t.buffers[u.buffer],d=(f||0)+(l.byteOffset||0)+(u.byteOffset||0),{ArrayType:g,length:_}=Vm(l,u),E=Nb[l.componentType],m=Ob[l.type],y=u.byteStride||E*m,A=new Float32Array(_);for(let C=0;C<l.count;C++){const b=new g(h,d+C*y,2);cl.set(b[0],b[1],1),cl.transformByMatrix3(i),A.set([cl[0],cl[1]],C*m)}s===r?d5(l,u,t.buffers,A):p5(r,l,e,t,A)}}}}function d5(t,e,n,s){t.componentType=5126,n.push({arrayBuffer:s.buffer,byteOffset:0,byteLength:s.buffer.byteLength}),e.buffer=n.length-1,e.byteLength=s.buffer.byteLength,e.byteOffset=0,delete e.byteStride}function p5(t,e,n,s,r){s.buffers.push({arrayBuffer:r.buffer,byteOffset:0,byteLength:r.buffer.byteLength});const i=s.json.bufferViews;if(!i)return;i.push({buffer:s.buffers.length-1,byteLength:r.buffer.byteLength,byteOffset:0});const o=s.json.accessors;o&&(o.push({bufferView:(i==null?void 0:i.length)-1,byteOffset:0,componentType:5126,count:e.count,type:"VEC2"}),n.attributes[`TEXCOORD_${t}`]=o.length-1)}function g5(t){const{offset:e=[0,0],rotation:n=0,scale:s=[1,1]}=t,r=new Ie().set(1,0,0,0,1,0,e[0],e[1],1),i=o5.set(Math.cos(n),Math.sin(n),0,-Math.sin(n),Math.cos(n),0,0,0,1),o=a5.set(s[0],0,0,0,s[1],0,0,0,1);return r.multiplyRight(i).multiplyRight(o)}const _5=Object.freeze(Object.defineProperty({__proto__:null,decode:c5,name:i5},Symbol.toStringTag,{value:"Module"})),yr="KHR_lights_punctual",m5=yr;async function y5(t){const e=new st(t),{json:n}=e,s=e.getExtension(yr);s&&(e.json.lights=s.lights,e.removeExtension(yr));for(const r of n.nodes||[]){const i=e.getObjectExtension(r,yr);i&&(r.light=i.light),e.removeObjectExtension(r,yr)}}async function A5(t){const e=new st(t),{json:n}=e;if(n.lights){const s=e.addExtension(yr);Pt(!s.lights),s.lights=n.lights,delete n.lights}if(e.json.lights){for(const s of e.json.lights){const r=s.node;e.addObjectExtension(r,yr,s)}delete e.json.lights}}const T5=Object.freeze(Object.defineProperty({__proto__:null,decode:y5,encode:A5,name:m5},Symbol.toStringTag,{value:"Module"})),Wa="KHR_materials_unlit",E5=Wa;async function S5(t){const e=new st(t),{json:n}=e;for(const s of n.materials||[])s.extensions&&s.extensions.KHR_materials_unlit&&(s.unlit=!0),e.removeObjectExtension(s,Wa);e.removeExtension(Wa)}function C5(t){const e=new st(t),{json:n}=e;if(e.materials)for(const s of n.materials||[])s.unlit&&(delete s.unlit,e.addObjectExtension(s,Wa,{}),e.addExtension(Wa))}const v5=Object.freeze(Object.defineProperty({__proto__:null,decode:S5,encode:C5,name:E5},Symbol.toStringTag,{value:"Module"})),Ko="KHR_techniques_webgl",w5=Ko;async function b5(t){const e=new st(t),{json:n}=e,s=e.getExtension(Ko);if(s){const r=I5(s,e);for(const i of n.materials||[]){const o=e.getObjectExtension(i,Ko);o&&(i.technique=Object.assign({},o,r[o.technique]),i.technique.values=P5(i.technique,e)),e.removeObjectExtension(i,Ko)}e.removeExtension(Ko)}}async function R5(t,e){}function I5(t,e){const{programs:n=[],shaders:s=[],techniques:r=[]}=t,i=new TextDecoder;return s.forEach(o=>{if(Number.isFinite(o.bufferView))o.code=i.decode(e.getTypedArrayForBufferView(o.bufferView));else throw new Error("KHR_techniques_webgl: no shader code")}),n.forEach(o=>{o.fragmentShader=s[o.fragmentShader],o.vertexShader=s[o.vertexShader]}),r.forEach(o=>{o.program=n[o.program]}),r}function P5(t,e){const n=Object.assign({},t.values);return Object.keys(t.uniforms||{}).forEach(s=>{t.uniforms[s].value&&!(s in n)&&(n[s]=t.uniforms[s].value)}),Object.keys(n).forEach(s=>{typeof n[s]=="object"&&n[s].index!==void 0&&(n[s].texture=e.getTexture(n[s].index))}),n}const x5=Object.freeze(Object.defineProperty({__proto__:null,decode:b5,encode:R5,name:w5},Symbol.toStringTag,{value:"Module"})),Jb=[FV,mV,wH,IH,MH,r5,T5,v5,x5,_5,ZV];function M5(t,e={},n){var r;const s=Jb.filter(i=>qb(i.name,e));for(const i of s)(r=i.preprocess)==null||r.call(i,t,e,n)}async function B5(t,e={},n){var r;const s=Jb.filter(i=>qb(i.name,e));for(const i of s)await((r=i.decode)==null?void 0:r.call(i,t,e,n))}function qb(t,e){var r;const n=((r=e==null?void 0:e.gltf)==null?void 0:r.excludeExtensions)||{};return!(t in n&&!n[t])}const Md="KHR_binary_glTF";function O5(t){const e=new st(t),{json:n}=e;for(const s of n.images||[]){const r=e.getObjectExtension(s,Md);r&&Object.assign(s,r),e.removeObjectExtension(s,Md)}n.buffers&&n.buffers[0]&&delete n.buffers[0].uri,e.removeExtension(Md)}const kE={accessors:"accessor",animations:"animation",buffers:"buffer",bufferViews:"bufferView",images:"image",materials:"material",meshes:"mesh",nodes:"node",samplers:"sampler",scenes:"scene",skins:"skin",textures:"texture"},N5={accessor:"accessors",animations:"animation",buffer:"buffers",bufferView:"bufferViews",image:"images",material:"materials",mesh:"meshes",node:"nodes",sampler:"samplers",scene:"scenes",skin:"skins",texture:"textures"};class F5{constructor(){p(this,"idToIndexMap",{animations:{},accessors:{},buffers:{},bufferViews:{},images:{},materials:{},meshes:{},nodes:{},samplers:{},scenes:{},skins:{},textures:{}});p(this,"json")}normalize(e,n){this.json=e.json;const s=e.json;switch(s.asset&&s.asset.version){case"2.0":return;case void 0:case"1.0":break;default:console.warn(`glTF: Unknown version ${s.asset.version}`);return}if(!n.normalize)throw new Error("glTF v1 is not supported.");console.warn("Converting glTF v1 to glTF v2 format. This is experimental and may fail."),this._addAsset(s),this._convertTopLevelObjectsToArrays(s),O5(e),this._convertObjectIdsToArrayIndices(s),this._updateObjects(s),this._updateMaterial(s)}_addAsset(e){e.asset=e.asset||{},e.asset.version="2.0",e.asset.generator=e.asset.generator||"Normalized to glTF 2.0 by loaders.gl"}_convertTopLevelObjectsToArrays(e){for(const n in kE)this._convertTopLevelObjectToArray(e,n)}_convertTopLevelObjectToArray(e,n){const s=e[n];if(!(!s||Array.isArray(s))){e[n]=[];for(const r in s){const i=s[r];i.id=i.id||r;const o=e[n].length;e[n].push(i),this.idToIndexMap[n][r]=o}}}_convertObjectIdsToArrayIndices(e){for(const n in kE)this._convertIdsToIndices(e,n);"scene"in e&&(e.scene=this._convertIdToIndex(e.scene,"scene"));for(const n of e.textures)this._convertTextureIds(n);for(const n of e.meshes)this._convertMeshIds(n);for(const n of e.nodes)this._convertNodeIds(n);for(const n of e.scenes)this._convertSceneIds(n)}_convertTextureIds(e){e.source&&(e.source=this._convertIdToIndex(e.source,"image"))}_convertMeshIds(e){for(const n of e.primitives){const{attributes:s,indices:r,material:i}=n;for(const o in s)s[o]=this._convertIdToIndex(s[o],"accessor");r&&(n.indices=this._convertIdToIndex(r,"accessor")),i&&(n.material=this._convertIdToIndex(i,"material"))}}_convertNodeIds(e){e.children&&(e.children=e.children.map(n=>this._convertIdToIndex(n,"node"))),e.meshes&&(e.meshes=e.meshes.map(n=>this._convertIdToIndex(n,"mesh")))}_convertSceneIds(e){e.nodes&&(e.nodes=e.nodes.map(n=>this._convertIdToIndex(n,"node")))}_convertIdsToIndices(e,n){e[n]||(console.warn(`gltf v1: json doesn't contain attribute ${n}`),e[n]=[]);for(const s of e[n])for(const r in s){const i=s[r],o=this._convertIdToIndex(i,r);s[r]=o}}_convertIdToIndex(e,n){const s=N5[n];if(s in this.idToIndexMap){const r=this.idToIndexMap[s][e];if(!Number.isFinite(r))throw new Error(`gltf v1: failed to resolve ${n} with id ${e}`);return r}return e}_updateObjects(e){for(const n of this.json.buffers)delete n.type}_updateMaterial(e){var n,s,r;for(const i of e.materials){i.pbrMetallicRoughness={baseColorFactor:[1,1,1,1],metallicFactor:1,roughnessFactor:1};const o=((n=i.values)==null?void 0:n.tex)||((s=i.values)==null?void 0:s.texture2d_0)||((r=i.values)==null?void 0:r.diffuseTex),a=e.textures.findIndex(c=>c.id===o);a!==-1&&(i.pbrMetallicRoughness.baseColorTexture={index:a})}}}function D5(t,e={}){return new F5().normalize(t,e)}async function L5(t,e,n=0,s,r){var i,o,a;return U5(t,e,n,s),D5(t,{normalize:(i=s==null?void 0:s.gltf)==null?void 0:i.normalize}),M5(t,s,r),(o=s==null?void 0:s.gltf)!=null&&o.loadBuffers&&t.json.buffers&&await k5(t,s,r),(a=s==null?void 0:s.gltf)!=null&&a.loadImages&&await z5(t,s,r),await B5(t,s,r),t}function U5(t,e,n,s){if(s.uri&&(t.baseUri=s.uri),e instanceof ArrayBuffer&&!oH(e,n,s)&&(e=new TextDecoder().decode(e)),typeof e=="string")t.json=rx(e);else if(e instanceof ArrayBuffer){const o={};n=aH(o,e,n,s.glb),Pt(o.type==="glTF",`Invalid GLB magic string ${o.type}`),t._glb=o,t.json=o.json}else Pt(!1,"GLTF: must be ArrayBuffer or string");const r=t.json.buffers||[];if(t.buffers=new Array(r.length).fill(null),t._glb&&t._glb.header.hasBinChunk){const{binChunks:o}=t._glb;t.buffers[0]={arrayBuffer:o[0].arrayBuffer,byteOffset:o[0].byteOffset,byteLength:o[0].byteLength}}const i=t.json.images||[];t.images=new Array(i.length).fill({})}async function k5(t,e,n){var r,i;const s=t.json.buffers||[];for(let o=0;o<s.length;++o){const a=s[o];if(a.uri){const{fetch:c}=n;Pt(c);const l=Gb(a.uri,e),u=await((r=n==null?void 0:n.fetch)==null?void 0:r.call(n,l)),h=await((i=u==null?void 0:u.arrayBuffer)==null?void 0:i.call(u));t.buffers[o]={arrayBuffer:h,byteOffset:0,byteLength:h.byteLength},delete a.uri}else t.buffers[o]===null&&(t.buffers[o]={arrayBuffer:new ArrayBuffer(a.byteLength),byteOffset:0,byteLength:a.byteLength})}}async function z5(t,e,n){const s=V5(t),r=t.json.images||[],i=[];for(const o of s)i.push(H5(t,r[o],o,e,n));return await Promise.all(i)}function V5(t){const e=new Set,n=t.json.textures||[];for(const s of n)s.source!==void 0&&e.add(s.source);return Array.from(e).sort()}async function H5(t,e,n,s,r){let i;if(e.uri&&!e.hasOwnProperty("bufferView")){const a=Gb(e.uri,s),{fetch:c}=r;i=await(await c(a)).arrayBuffer(),e.bufferView={data:i}}if(Number.isFinite(e.bufferView)){const a=aV(t.json,t.buffers,e.bufferView);i=nm(a.buffer,a.byteOffset,a.byteLength)}Pt(i,"glTF image has no data");let o=await ro(i,[_v,Lz],{...s,mimeType:e.mimeType,basis:s.basis||{format:Bb()}},r);o&&o[0]&&(o={compressed:!0,mipmaps:!1,width:o[0].width,height:o[0].height,data:o[0]}),t.images=t.images||[],t.images[n]=o}const Ga={dataType:null,batchType:null,name:"glTF",id:"gltf",module:"gltf",version:QV,extensions:["gltf","glb"],mimeTypes:["model/gltf+json","model/gltf-binary"],text:!0,binary:!0,tests:["glTF"],parse:j5,options:{gltf:{normalize:!0,loadBuffers:!0,loadImages:!0,decompressMeshes:!0},log:console}};async function j5(t,e={},n){e={...Ga.options,...e},e.gltf={...Ga.options.gltf,...e.gltf};const{byteOffset:s=0}=e;return await L5({},t,s,e,n)}const W5={SCALAR:1,VEC2:2,VEC3:3,VEC4:4,MAT2:4,MAT3:9,MAT4:16},G5={5120:1,5121:1,5122:2,5123:2,5125:4,5126:4},Ut={TEXTURE_MAG_FILTER:10240,TEXTURE_MIN_FILTER:10241,TEXTURE_WRAP_S:10242,TEXTURE_WRAP_T:10243,REPEAT:10497,LINEAR:9729,NEAREST_MIPMAP_LINEAR:9986},X5={magFilter:Ut.TEXTURE_MAG_FILTER,minFilter:Ut.TEXTURE_MIN_FILTER,wrapS:Ut.TEXTURE_WRAP_S,wrapT:Ut.TEXTURE_WRAP_T},$5={[Ut.TEXTURE_MAG_FILTER]:Ut.LINEAR,[Ut.TEXTURE_MIN_FILTER]:Ut.NEAREST_MIPMAP_LINEAR,[Ut.TEXTURE_WRAP_S]:Ut.REPEAT,[Ut.TEXTURE_WRAP_T]:Ut.REPEAT};function K5(){return{id:"default-sampler",parameters:$5}}function Y5(t){return G5[t]}function J5(t){return W5[t]}class q5{constructor(){p(this,"baseUri","");p(this,"jsonUnprocessed");p(this,"json");p(this,"buffers",[]);p(this,"images",[])}postProcess(e,n={}){const{json:s,buffers:r=[],images:i=[]}=e,{baseUri:o=""}=e;return Pt(s),this.baseUri=o,this.buffers=r,this.images=i,this.jsonUnprocessed=s,this.json=this._resolveTree(e.json,n),this.json}_resolveTree(e,n={}){const s={...e};return this.json=s,e.bufferViews&&(s.bufferViews=e.bufferViews.map((r,i)=>this._resolveBufferView(r,i))),e.images&&(s.images=e.images.map((r,i)=>this._resolveImage(r,i))),e.samplers&&(s.samplers=e.samplers.map((r,i)=>this._resolveSampler(r,i))),e.textures&&(s.textures=e.textures.map((r,i)=>this._resolveTexture(r,i))),e.accessors&&(s.accessors=e.accessors.map((r,i)=>this._resolveAccessor(r,i))),e.materials&&(s.materials=e.materials.map((r,i)=>this._resolveMaterial(r,i))),e.meshes&&(s.meshes=e.meshes.map((r,i)=>this._resolveMesh(r,i))),e.nodes&&(s.nodes=e.nodes.map((r,i)=>this._resolveNode(r,i)),s.nodes=s.nodes.map((r,i)=>this._resolveNodeChildren(r))),e.skins&&(s.skins=e.skins.map((r,i)=>this._resolveSkin(r,i))),e.scenes&&(s.scenes=e.scenes.map((r,i)=>this._resolveScene(r,i))),typeof this.json.scene=="number"&&s.scenes&&(s.scene=s.scenes[this.json.scene]),s}getScene(e){return this._get(this.json.scenes,e)}getNode(e){return this._get(this.json.nodes,e)}getSkin(e){return this._get(this.json.skins,e)}getMesh(e){return this._get(this.json.meshes,e)}getMaterial(e){return this._get(this.json.materials,e)}getAccessor(e){return this._get(this.json.accessors,e)}getCamera(e){return this._get(this.json.cameras,e)}getTexture(e){return this._get(this.json.textures,e)}getSampler(e){return this._get(this.json.samplers,e)}getImage(e){return this._get(this.json.images,e)}getBufferView(e){return this._get(this.json.bufferViews,e)}getBuffer(e){return this._get(this.json.buffers,e)}_get(e,n){if(typeof n=="object")return n;const s=e&&e[n];return s||console.warn(`glTF file error: Could not find ${e}[${n}]`),s}_resolveScene(e,n){return{...e,id:e.id||`scene-${n}`,nodes:(e.nodes||[]).map(s=>this.getNode(s))}}_resolveNode(e,n){const s={...e,id:(e==null?void 0:e.id)||`node-${n}`};return e.mesh!==void 0&&(s.mesh=this.getMesh(e.mesh)),e.camera!==void 0&&(s.camera=this.getCamera(e.camera)),e.skin!==void 0&&(s.skin=this.getSkin(e.skin)),e.meshes!==void 0&&e.meshes.length&&(s.mesh=e.meshes.reduce((r,i)=>{const o=this.getMesh(i);return r.id=o.id,r.primitives=r.primitives.concat(o.primitives),r},{primitives:[]})),s}_resolveNodeChildren(e){return e.children&&(e.children=e.children.map(n=>this.getNode(n))),e}_resolveSkin(e,n){const s=typeof e.inverseBindMatrices=="number"?this.getAccessor(e.inverseBindMatrices):void 0;return{...e,id:e.id||`skin-${n}`,inverseBindMatrices:s}}_resolveMesh(e,n){const s={...e,id:e.id||`mesh-${n}`,primitives:[]};return e.primitives&&(s.primitives=e.primitives.map(r=>{const i={...r,attributes:{},indices:void 0,material:void 0},o=r.attributes;for(const a in o)i.attributes[a]=this.getAccessor(o[a]);return r.indices!==void 0&&(i.indices=this.getAccessor(r.indices)),r.material!==void 0&&(i.material=this.getMaterial(r.material)),i})),s}_resolveMaterial(e,n){const s={...e,id:e.id||`material-${n}`};if(s.normalTexture&&(s.normalTexture={...s.normalTexture},s.normalTexture.texture=this.getTexture(s.normalTexture.index)),s.occlusionTexture&&(s.occlusionTexture={...s.occlusionTexture},s.occlusionTexture.texture=this.getTexture(s.occlusionTexture.index)),s.emissiveTexture&&(s.emissiveTexture={...s.emissiveTexture},s.emissiveTexture.texture=this.getTexture(s.emissiveTexture.index)),s.emissiveFactor||(s.emissiveFactor=s.emissiveTexture?[1,1,1]:[0,0,0]),s.pbrMetallicRoughness){s.pbrMetallicRoughness={...s.pbrMetallicRoughness};const r=s.pbrMetallicRoughness;r.baseColorTexture&&(r.baseColorTexture={...r.baseColorTexture},r.baseColorTexture.texture=this.getTexture(r.baseColorTexture.index)),r.metallicRoughnessTexture&&(r.metallicRoughnessTexture={...r.metallicRoughnessTexture},r.metallicRoughnessTexture.texture=this.getTexture(r.metallicRoughnessTexture.index))}return s}_resolveAccessor(e,n){const s=Y5(e.componentType),r=J5(e.type),i=s*r,o={...e,id:e.id||`accessor-${n}`,bytesPerComponent:s,components:r,bytesPerElement:i,value:void 0,bufferView:void 0,sparse:void 0};if(e.bufferView!==void 0&&(o.bufferView=this.getBufferView(e.bufferView)),o.bufferView){const a=o.bufferView.buffer,{ArrayType:c,byteLength:l}=Vm(o,o.bufferView),u=(o.bufferView.byteOffset||0)+(o.byteOffset||0)+a.byteOffset;let h=a.arrayBuffer.slice(u,u+l);o.bufferView.byteStride&&(h=this._getValueFromInterleavedBuffer(a,u,o.bufferView.byteStride,o.bytesPerElement,o.count)),o.value=new c(h)}return o}_getValueFromInterleavedBuffer(e,n,s,r,i){const o=new Uint8Array(i*r);for(let a=0;a<i;a++){const c=n+a*s;o.set(new Uint8Array(e.arrayBuffer.slice(c,c+r)),a*r)}return o.buffer}_resolveTexture(e,n){return{...e,id:e.id||`texture-${n}`,sampler:typeof e.sampler=="number"?this.getSampler(e.sampler):K5(),source:typeof e.source=="number"?this.getImage(e.source):void 0}}_resolveSampler(e,n){const s={id:e.id||`sampler-${n}`,...e,parameters:{}};for(const r in s){const i=this._enumSamplerParameter(r);i!==void 0&&(s.parameters[i]=s[r])}return s}_enumSamplerParameter(e){return X5[e]}_resolveImage(e,n){const s={...e,id:e.id||`image-${n}`,image:null,bufferView:e.bufferView!==void 0?this.getBufferView(e.bufferView):void 0},r=this.images[n];return r&&(s.image=r),s}_resolveBufferView(e,n){const s=e.buffer,r=this.buffers[s].arrayBuffer;let i=this.buffers[s].byteOffset||0;return e.byteOffset&&(i+=e.byteOffset),{id:`bufferView-${n}`,...e,buffer:this.buffers[s],data:new Uint8Array(r,i,e.byteLength)}}_resolveCamera(e,n){const s={...e,id:e.id||`camera-${n}`};return s.perspective,s.orthographic,s}}function $m(t,e){return new q5().postProcess(t,e)}async function Z5(t){const e=[];return t.scenes.forEach(n=>{n.traverse(s=>{Object.values(s.model.uniforms).forEach(r=>{r.loaded===!1&&e.push(r)})})}),await Q5(()=>e.some(n=>!n.loaded))}async function Q5(t){for(;t();)await new Promise(e=>requestAnimationFrame(e))}const ej=`#version 300 es
#define SHADER_NAME scenegraph-layer-vertex-shader
in vec3 instancePositions;
in vec3 instancePositions64Low;
in vec4 instanceColors;
in vec3 instancePickingColors;
in vec3 instanceModelMatrixCol0;
in vec3 instanceModelMatrixCol1;
in vec3 instanceModelMatrixCol2;
in vec3 instanceTranslation;
uniform float sizeScale;
uniform float sizeMinPixels;
uniform float sizeMaxPixels;
uniform mat4 sceneModelMatrix;
uniform bool composeModelMatrix;
in vec3 positions;
#ifdef HAS_UV
in vec2 texCoords;
#endif
#ifdef MODULE_PBR
#ifdef HAS_NORMALS
in vec3 normals;
#endif
#endif
out vec4 vColor;
#ifndef MODULE_PBR
#ifdef HAS_UV
out vec2 vTEXCOORD_0;
#endif
#endif
void main(void) {
#if defined(HAS_UV) && !defined(MODULE_PBR)
vTEXCOORD_0 = texCoords;
geometry.uv = texCoords;
#endif
geometry.worldPosition = instancePositions;
geometry.pickingColor = instancePickingColors;
mat3 instanceModelMatrix = mat3(instanceModelMatrixCol0, instanceModelMatrixCol1, instanceModelMatrixCol2);
vec3 normal = vec3(0.0, 0.0, 1.0);
#ifdef MODULE_PBR
#ifdef HAS_NORMALS
normal = instanceModelMatrix * (sceneModelMatrix * vec4(normals, 0.0)).xyz;
#endif
#endif
float originalSize = project_size_to_pixel(sizeScale);
float clampedSize = clamp(originalSize, sizeMinPixels, sizeMaxPixels);
vec3 pos = (instanceModelMatrix * (sceneModelMatrix * vec4(positions, 1.0)).xyz) * sizeScale * (clampedSize / originalSize) + instanceTranslation;
if(composeModelMatrix) {
DECKGL_FILTER_SIZE(pos, geometry);
geometry.normal = project_normal(normal);
geometry.worldPosition += pos;
gl_Position = project_position_to_clipspace(pos + instancePositions, instancePositions64Low, vec3(0.0), geometry.position);
}
else {
pos = project_size(pos);
DECKGL_FILTER_SIZE(pos, geometry);
gl_Position = project_position_to_clipspace(instancePositions, instancePositions64Low, pos, geometry.position);
geometry.normal = project_normal(normal);
}
DECKGL_FILTER_GL_POSITION(gl_Position, geometry);
#ifdef MODULE_PBR
pbr_vPosition = geometry.position.xyz;
#ifdef HAS_NORMALS
pbr_vNormal = geometry.normal;
#endif
#ifdef HAS_UV
pbr_vUV = texCoords;
#else
pbr_vUV = vec2(0., 0.);
#endif
geometry.uv = pbr_vUV;
#endif
vColor = instanceColors;
DECKGL_FILTER_COLOR(vColor, geometry);
}
`,tj=`#version 300 es
#define SHADER_NAME scenegraph-layer-fragment-shader
uniform float opacity;
in vec4 vColor;
out vec4 fragColor;
#ifndef MODULE_PBR
#if defined(HAS_UV) && defined(HAS_BASECOLORMAP)
in vec2 vTEXCOORD_0;
uniform sampler2D u_BaseColorSampler;
#endif
#endif
void main(void) {
#ifdef MODULE_PBR
fragColor = vColor * pbr_filterColor(vec4(0));
geometry.uv = pbr_vUV;
#else
#if defined(HAS_UV) && defined(HAS_BASECOLORMAP)
fragColor = vColor * texture(u_BaseColorSampler, vTEXCOORD_0);
geometry.uv = vTEXCOORD_0;
#else
fragColor = vColor;
#endif
#endif
fragColor.a *= opacity;
DECKGL_FILTER_COLOR(fragColor, geometry);
}
`,Zb=[255,255,255,255],nj={scenegraph:{type:"object",value:null,async:!0},getScene:t=>t&&t.scenes?typeof t.scene=="object"?t.scene:t.scenes[t.scene||0]:t,getAnimator:t=>t&&t.animator,_animations:null,sizeScale:{type:"number",value:1,min:0},sizeMinPixels:{type:"number",min:0,value:0},sizeMaxPixels:{type:"number",min:0,value:Number.MAX_SAFE_INTEGER},getPosition:{type:"accessor",value:t=>t.position},getColor:{type:"accessor",value:Zb},_lighting:"flat",_imageBasedLightingEnvironment:void 0,getOrientation:{type:"accessor",value:[0,0,0]},getScale:{type:"accessor",value:[1,1,1]},getTranslation:{type:"accessor",value:[0,0,0]},getTransformMatrix:{type:"accessor",value:[]},loaders:[Ga]},ph=class ph extends qt{getShaders(){const e=[qs,Zs];return this.props._lighting==="pbr"&&e.push(vm),super.getShaders({vs:ej,fs:tj,modules:e})}initializeState(){this.getAttributeManager().addInstanced({instancePositions:{size:3,type:"float64",fp64:this.use64bitPositions(),accessor:"getPosition",transition:!0},instanceColors:{type:"unorm8",size:this.props.colorFormat.length,accessor:"getColor",defaultValue:Zb,transition:!0},instanceModelMatrix:Ib})}updateState(e){super.updateState(e);const{props:n,oldProps:s}=e;n.scenegraph!==s.scenegraph?this._updateScenegraph():n._animations!==s._animations&&this._applyAnimationsProp(this.state.animator,n._animations)}finalizeState(e){var n;super.finalizeState(e),(n=this.state.scenegraph)==null||n.destroy()}get isLoaded(){var e;return!!((e=this.state)!=null&&e.scenegraph&&super.isLoaded)}_updateScenegraph(){var a;const e=this.props,{device:n}=this.context;let s=null;if(e.scenegraph instanceof vu)s={scenes:[e.scenegraph]};else if(e.scenegraph&&typeof e.scenegraph=="object"){const c=e.scenegraph,l=c.json?$m(c):c,u=eV(n,l,this._getModelOptions());s={gltf:l,...u},Z5(u).then(()=>{this.setNeedsRedraw()}).catch(h=>{this.raiseError(h,"loading glTF")})}const r={layer:this,device:this.context.device},i=e.getScene(s,r),o=e.getAnimator(s,r);if(i instanceof Ni){(a=this.state.scenegraph)==null||a.destroy(),this._applyAnimationsProp(o,e._animations);const c=[];i.traverse(l=>{l instanceof cg&&c.push(l.model)}),this.setState({scenegraph:i,animator:o,models:c}),this.getAttributeManager().invalidateAll()}else i!==null&&J.warn("invalid scenegraph:",i)()}_applyAnimationsProp(e,n){if(!e||!n)return;const s=e.getAnimations();Object.keys(n).sort().forEach(r=>{const i=n[r];if(r==="*")s.forEach(o=>{Object.assign(o,i)});else if(Number.isFinite(Number(r))){const o=Number(r);o>=0&&o<s.length?Object.assign(s[o],i):J.warn(`animation ${r} not found`)()}else{const o=s.find(({name:a})=>a===r);o?Object.assign(o,i):J.warn(`animation ${r} not found`)()}})}_getModelOptions(){const{_imageBasedLightingEnvironment:e}=this.props;let n;return e&&(typeof e=="function"?n=e({gl:this.context.gl,layer:this}):n=e),{imageBasedLightingEnvironment:n,modelOptions:{id:this.props.id,isInstanced:!0,bufferLayout:this.getAttributeManager().getBufferLayouts(),...this.getShaders()},useTangents:!1}}draw({context:e}){if(!this.state.scenegraph)return;this.props._animations&&this.state.animator&&(this.state.animator.animate(e.timeline.getTime()),this.setNeedsRedraw());const{viewport:n,renderPass:s}=this.context,{sizeScale:r,sizeMinPixels:i,sizeMaxPixels:o,opacity:a,coordinateSystem:c}=this.props,l=this.getNumInstances();this.state.scenegraph.traverse((u,{worldMatrix:h})=>{if(u instanceof cg){const{model:f}=u;f.setInstanceCount(l),f.setUniforms({sizeScale:r,opacity:a,sizeMinPixels:i,sizeMaxPixels:o,composeModelMatrix:Pb(n,c),sceneModelMatrix:h,u_Camera:f.uniforms.project_uCameraPosition}),f.draw(s)}})}};ph.defaultProps=nj,ph.layerName="ScenegraphLayer";let Kg=ph;const sj=`#version 300 es
#define SHADER_NAME simple-mesh-layer-vs
uniform float sizeScale;
uniform bool composeModelMatrix;
uniform bool pickFeatureIds;
in vec3 positions;
in vec3 normals;
in vec3 colors;
in vec2 texCoords;
in vec4 uvRegions;
in vec3 featureIdsPickingColors;
in vec4 instanceColors;
in vec3 instancePickingColors;
in vec3 instanceModelMatrixCol0;
in vec3 instanceModelMatrixCol1;
in vec3 instanceModelMatrixCol2;
out vec2 vTexCoord;
out vec3 cameraPosition;
out vec3 normals_commonspace;
out vec4 position_commonspace;
out vec4 vColor;
vec2 applyUVRegion(vec2 uv) {
#ifdef HAS_UV_REGIONS
return fract(uv) * (uvRegions.zw - uvRegions.xy) + uvRegions.xy;
#else
return uv;
#endif
}
void main(void) {
vec2 uv = applyUVRegion(texCoords);
geometry.uv = uv;
if (pickFeatureIds) {
geometry.pickingColor = featureIdsPickingColors;
} else {
geometry.pickingColor = instancePickingColors;
}
mat3 instanceModelMatrix = mat3(instanceModelMatrixCol0, instanceModelMatrixCol1, instanceModelMatrixCol2);
vTexCoord = uv;
cameraPosition = project_uCameraPosition;
vColor = vec4(colors * instanceColors.rgb, instanceColors.a);
vec3 pos = (instanceModelMatrix * positions) * sizeScale;
vec3 projectedPosition = project_position(positions);
position_commonspace = vec4(projectedPosition, 1.0);
gl_Position = project_common_position_to_clipspace(position_commonspace);
geometry.position = position_commonspace;
normals_commonspace = project_normal(instanceModelMatrix * normals);
geometry.normal = normals_commonspace;
DECKGL_FILTER_GL_POSITION(gl_Position, geometry);
#ifdef MODULE_PBR
pbr_vPosition = geometry.position.xyz;
#ifdef HAS_NORMALS
pbr_vNormal = geometry.normal;
#endif
#ifdef HAS_UV
pbr_vUV = uv;
#else
pbr_vUV = vec2(0., 0.);
#endif
geometry.uv = pbr_vUV;
#endif
DECKGL_FILTER_COLOR(vColor, geometry);
}
`,rj=`#version 300 es
#define SHADER_NAME simple-mesh-layer-fs
precision highp float;
uniform bool hasTexture;
uniform sampler2D sampler;
uniform bool flatShading;
uniform float opacity;
in vec2 vTexCoord;
in vec3 cameraPosition;
in vec3 normals_commonspace;
in vec4 position_commonspace;
in vec4 vColor;
out vec4 fragColor;
void main(void) {
#ifdef MODULE_PBR
fragColor = vColor * pbr_filterColor(vec4(0));
geometry.uv = pbr_vUV;
fragColor.a *= opacity;
#else
geometry.uv = vTexCoord;
vec3 normal;
if (flatShading) {
normal = normalize(cross(dFdx(position_commonspace.xyz), dFdy(position_commonspace.xyz)));
} else {
normal = normals_commonspace;
}
vec4 color = hasTexture ? texture(sampler, vTexCoord) : vColor;
vec3 lightColor = lighting_getLightColor(color.rgb, cameraPosition, position_commonspace.xyz, normal);
fragColor = vec4(lightColor, color.a * opacity);
#endif
DECKGL_FILTER_COLOR(fragColor, geometry);
}
`;function ij(t){const e=t.positions||t.POSITION,n=e.value.length/e.size;t.COLOR_0||t.colors||(t.colors={size:4,value:new Uint8Array(n*4).fill(255),normalized:!0})}const oj={pbrMaterial:{type:"object",value:null},featureIds:{type:"array",value:null,optional:!0}},gh=class gh extends ja{getShaders(){const e=super.getShaders();return e.modules.push(vm),{...e,vs:sj,fs:rj}}initializeState(){const{featureIds:e}=this.props;super.initializeState();const n=this.getAttributeManager();e&&n.add({featureIdsPickingColors:{type:"uint8",size:3,noAlloc:!0,update:this.calculateFeatureIdsPickingColors}})}updateState(e){super.updateState(e);const{props:n,oldProps:s}=e;n.pbrMaterial!==s.pbrMaterial&&this.updatePbrMaterialUniforms(n.pbrMaterial)}draw(e){const{featureIds:n}=this.props;this.state.model&&(this.state.model.setUniforms({u_Camera:this.state.model.uniforms.project_uCameraPosition,pickFeatureIds:!!n}),super.draw(e))}getModel(e){const{id:n,pbrMaterial:s}=this.props,r=this.parseMaterial(s,e);this.setState({parsedPBRMaterial:r});const i=this.getShaders();return ij(e.attributes),new ct(this.context.device,{...this.getShaders(),id:n,geometry:e,bufferLayout:this.getAttributeManager().getBufferLayouts(),defines:{...i.defines,...r==null?void 0:r.defines,HAS_UV_REGIONS:e.attributes.uvRegions?1:0},parameters:r==null?void 0:r.parameters,isInstanced:!0})}updatePbrMaterialUniforms(e){const{model:n}=this.state;if(n){const{mesh:s}=this.props,r=this.parseMaterial(e,s);this.setState({parsedPBRMaterial:r}),n.setBindings(r.bindings),n.setUniforms(r.uniforms)}}parseMaterial(e,n){const s=!!(e.pbrMetallicRoughness&&e.pbrMetallicRoughness.baseColorTexture);return xb(this.context.device,{unlit:s,...e},{NORMAL:n.attributes.normals,TEXCOORD_0:n.attributes.texCoords},{pbrDebug:!1,lights:!0,useTangents:!1})}calculateFeatureIdsPickingColors(e){const n=this.props.featureIds,s=new Uint8ClampedArray(n.length*e.size),r=[];for(let i=0;i<n.length;i++)this.encodePickingColor(n[i],r),s[i*3]=r[0],s[i*3+1]=r[1],s[i*3+2]=r[2];e.value=s}finalizeState(e){var n;super.finalizeState(e),(n=this.state.parsedPBRMaterial)==null||n.generatedTextures.forEach(s=>s.destroy()),this.setState({parsedPBRMaterial:null})}};gh.layerName="MeshLayer",gh.defaultProps=oj;let Yg=gh;const aj=6378137,cj=6378137,lj=6356752314245179e-9;function Jh(t){return t}new x;function uj(t,e=[],n=Jh){return"longitude"in t?(e[0]=n(t.longitude),e[1]=n(t.latitude),e[2]=t.height):"x"in t?(e[0]=n(t.x),e[1]=n(t.y),e[2]=t.z):(e[0]=n(t[0]),e[1]=n(t[1]),e[2]=t[2]),e}function hj(t,e=[]){return uj(t,e,Ue._cartographicRadians?Jh:DO)}function fj(t,e,n=Jh){return"longitude"in e?(e.longitude=n(t[0]),e.latitude=n(t[1]),e.height=t[2]):"x"in e?(e.x=n(t[0]),e.y=n(t[1]),e.z=t[2]):(e[0]=n(t[0]),e[1]=n(t[1]),e[2]=t[2]),e}function dj(t,e){return fj(t,e,Ue._cartographicRadians?Jh:LO)}const zE=1e-14,pj=new x,VE={up:{south:"east",north:"west",west:"south",east:"north"},down:{south:"west",north:"east",west:"north",east:"south"},south:{up:"west",down:"east",west:"down",east:"up"},north:{up:"east",down:"west",west:"up",east:"down"},west:{up:"north",down:"south",north:"down",south:"up"},east:{up:"south",down:"north",north:"up",south:"down"}},Bd={north:[-1,0,0],east:[0,1,0],up:[0,0,1],south:[1,0,0],west:[0,-1,0],down:[0,0,-1]},No={east:new x,north:new x,up:new x,west:new x,south:new x,down:new x},gj=new x,_j=new x,mj=new x;function HE(t,e,n,s,r,i){const o=VE[e]&&VE[e][n];an(o&&(!s||s===o));let a,c,l;const u=pj.copy(r);if(Xt(u.x,0,zE)&&Xt(u.y,0,zE)){const f=Math.sign(u.z);a=gj.fromArray(Bd[e]),e!=="east"&&e!=="west"&&a.scale(f),c=_j.fromArray(Bd[n]),n!=="east"&&n!=="west"&&c.scale(f),l=mj.fromArray(Bd[s]),s!=="east"&&s!=="west"&&l.scale(f)}else{const{up:f,east:d,north:g}=No;d.set(-u.y,u.x,0).normalize(),t.geodeticSurfaceNormal(u,f),g.copy(f).cross(d);const{down:_,west:E,south:m}=No;_.copy(f).scale(-1),E.copy(d).scale(-1),m.copy(g).scale(-1),a=No[e],c=No[n],l=No[s]}return i[0]=a.x,i[1]=a.y,i[2]=a.z,i[3]=0,i[4]=c.x,i[5]=c.y,i[6]=c.z,i[7]=0,i[8]=l.x,i[9]=l.y,i[10]=l.z,i[11]=0,i[12]=u.x,i[13]=u.y,i[14]=u.z,i[15]=1,i}const Zr=new x,yj=new x,Aj=new x;function Tj(t,e,n=[]){const{oneOverRadii:s,oneOverRadiiSquared:r,centerToleranceSquared:i}=e;Zr.from(t);const o=Zr.x,a=Zr.y,c=Zr.z,l=s.x,u=s.y,h=s.z,f=o*o*l*l,d=a*a*u*u,g=c*c*h*h,_=f+d+g,E=Math.sqrt(1/_);if(!Number.isFinite(E))return;const m=yj;if(m.copy(t).scale(E),_<i)return m.to(n);const y=r.x,A=r.y,C=r.z,b=Aj;b.set(m.x*y*2,m.y*A*2,m.z*C*2);let P=(1-E)*Zr.len()/(.5*b.len()),B=0,O,N,F,H;do{P-=B,O=1/(1+P*y),N=1/(1+P*A),F=1/(1+P*C);const X=O*O,G=N*N,$=F*F,Te=X*O,Nt=G*N,Et=$*F;H=f*X+d*G+g*$-1;const K=-2*(f*Te*y+d*Nt*A+g*Et*C);B=H/K}while(Math.abs(H)>nF);return Zr.scale([O,N,F]).to(n)}const ll=new x,jE=new x,Ej=new x,en=new x,Sj=new x,ul=new x;class pe{constructor(e=0,n=0,s=0){this.centerToleranceSquared=tF,an(e>=0),an(n>=0),an(s>=0),this.radii=new x(e,n,s),this.radiiSquared=new x(e*e,n*n,s*s),this.radiiToTheFourth=new x(e*e*e*e,n*n*n*n,s*s*s*s),this.oneOverRadii=new x(e===0?0:1/e,n===0?0:1/n,s===0?0:1/s),this.oneOverRadiiSquared=new x(e===0?0:1/(e*e),n===0?0:1/(n*n),s===0?0:1/(s*s)),this.minimumRadius=Math.min(e,n,s),this.maximumRadius=Math.max(e,n,s),this.radiiSquared.z!==0&&(this.squaredXOverSquaredZ=this.radiiSquared.x/this.radiiSquared.z),Object.freeze(this)}equals(e){return this===e||!!(e&&this.radii.equals(e.radii))}toString(){return this.radii.toString()}cartographicToCartesian(e,n=[0,0,0]){const s=jE,r=Ej,[,,i]=e;this.geodeticSurfaceNormalCartographic(e,s),r.copy(this.radiiSquared).scale(s);const o=Math.sqrt(s.dot(r));return r.scale(1/o),s.scale(i),r.add(s),r.to(n)}cartesianToCartographic(e,n=[0,0,0]){ul.from(e);const s=this.scaleToGeodeticSurface(ul,en);if(!s)return;const r=this.geodeticSurfaceNormal(s,jE),i=Sj;i.copy(ul).subtract(s);const o=Math.atan2(r.y,r.x),a=Math.asin(r.z),c=Math.sign(ym(i,ul))*$v(i);return dj([o,a,c],n)}eastNorthUpToFixedFrame(e,n=new q){return HE(this,"east","north","up",e,n)}localFrameToFixedFrame(e,n,s,r,i=new q){return HE(this,e,n,s,r,i)}geocentricSurfaceNormal(e,n=[0,0,0]){return ll.from(e).normalize().to(n)}geodeticSurfaceNormalCartographic(e,n=[0,0,0]){const s=hj(e),r=s[0],i=s[1],o=Math.cos(i);return ll.set(o*Math.cos(r),o*Math.sin(r),Math.sin(i)).normalize(),ll.to(n)}geodeticSurfaceNormal(e,n=[0,0,0]){return ll.from(e).scale(this.oneOverRadiiSquared).normalize().to(n)}scaleToGeodeticSurface(e,n){return Tj(e,this,n)}scaleToGeocentricSurface(e,n=[0,0,0]){en.from(e);const s=en.x,r=en.y,i=en.z,o=this.oneOverRadiiSquared,a=1/Math.sqrt(s*s*o.x+r*r*o.y+i*i*o.z);return en.multiplyScalar(a).to(n)}transformPositionToScaledSpace(e,n=[0,0,0]){return en.from(e).scale(this.oneOverRadii).to(n)}transformPositionFromScaledSpace(e,n=[0,0,0]){return en.from(e).scale(this.radii).to(n)}getSurfaceNormalIntersectionWithZAxis(e,n=0,s=[0,0,0]){an(Xt(this.radii.x,this.radii.y,rw)),an(this.radii.z>0),en.from(e);const r=en.z*(1-this.squaredXOverSquaredZ);if(!(Math.abs(r)>=this.radii.z-n))return en.set(0,0,r).to(s)}}pe.WGS84=new pe(aj,cj,lj);class Cj{constructor(e,n,s){p(this,"item");p(this,"previous");p(this,"next");this.item=e,this.previous=n,this.next=s}}class vj{constructor(){p(this,"head",null);p(this,"tail",null);p(this,"_length",0)}get length(){return this._length}add(e){const n=new Cj(e,this.tail,null);return this.tail?(this.tail.next=n,this.tail=n):(this.head=n,this.tail=n),++this._length,n}remove(e){e&&(e.previous&&e.next?(e.previous.next=e.next,e.next.previous=e.previous):e.previous?(e.previous.next=null,this.tail=e.previous):e.next?(e.next.previous=null,this.head=e.next):(this.head=null,this.tail=null),e.next=null,e.previous=null,--this._length)}splice(e,n){e!==n&&(this.remove(n),this._insert(e,n))}_insert(e,n){const s=e.next;e.next=n,this.tail===e?this.tail=n:s.previous=n,n.next=s,n.previous=e,++this._length}}class wj{constructor(){p(this,"_list");p(this,"_sentinel");p(this,"_trimTiles");this._list=new vj,this._sentinel=this._list.add("sentinel"),this._trimTiles=!1}reset(){this._list.splice(this._list.tail,this._sentinel)}touch(e){const n=e._cacheNode;n&&this._list.splice(this._sentinel,n)}add(e,n,s){n._cacheNode||(n._cacheNode=this._list.add(n),s&&s(e,n))}unloadTile(e,n,s){const r=n._cacheNode;r&&(this._list.remove(r),n._cacheNode=null,s&&s(e,n))}unloadTiles(e,n){const s=this._trimTiles;this._trimTiles=!1;const r=this._list,i=e.maximumMemoryUsage*1024*1024,o=this._sentinel;let a=r.head;for(;a!==o&&(e.gpuMemoryUsageInBytes>i||s);){const c=a.item;a=a.next,this.unloadTile(e,c,n)}}trim(){this._trimTiles=!0}}function bj(t,e){de(t),de(e);const{rtcCenter:n,gltfUpAxis:s}=e,{computedTransform:r,boundingVolume:{center:i}}=t;let o=new q(r);switch(n&&o.translate(n),s){case"Z":break;case"Y":const h=new q().rotateX(Math.PI/2);o=o.multiplyRight(h);break;case"X":const f=new q().rotateY(-Math.PI/2);o=o.multiplyRight(f);break}e.isQuantized&&o.translate(e.quantizedVolumeOffset).scale(e.quantizedVolumeScale);const a=new x(i);e.cartesianModelMatrix=o,e.cartesianOrigin=a;const c=pe.WGS84.cartesianToCartographic(a,new x),u=pe.WGS84.eastNorthUpToFixedFrame(a).invert();e.cartographicModelMatrix=u.multiplyRight(o),e.cartographicOrigin=c,e.coordinateSystem||(e.modelMatrix=e.cartographicModelMatrix)}const WE=new x,Od=new x,Jg=new It([new on,new on,new on,new on,new on,new on]);function Rj(t,e){const{cameraDirection:n,cameraUp:s,height:r}=t,{metersPerUnit:i}=t.distanceScales,o=Ll(t,t.center),a=pe.WGS84.eastNorthUpToFixedFrame(o),c=t.unprojectPosition(t.cameraPosition),l=pe.WGS84.cartographicToCartesian(c,new x),u=new x(a.transformAsVector(new x(n).scale(i))).normalize(),h=new x(a.transformAsVector(new x(s).scale(i))).normalize();Pj(t);const f=t.constructor,{longitude:d,latitude:g,width:_,bearing:E,zoom:m}=t,y=new f({longitude:d,latitude:g,height:r,width:_,bearing:E,zoom:m,pitch:0});return{camera:{position:l,direction:u,up:h},viewport:t,topDownViewport:y,height:r,cullingVolume:Jg,frameNumber:e,sseDenominator:1.15}}function Ij(t,e,n){if(n===0||t.length<=n)return[t,[]];const s=[],{longitude:r,latitude:i}=e.viewport;for(const[l,u]of t.entries()){const[h,f]=u.header.mbs,d=Math.abs(r-h),g=Math.abs(i-f),_=Math.sqrt(g*g+d*d);s.push([l,_])}const o=s.sort((l,u)=>l[1]-u[1]),a=[];for(let l=0;l<n;l++)a.push(t[o[l][0]]);const c=[];for(let l=n;l<o.length;l++)c.push(t[o[l][0]]);return[a,c]}function Pj(t){const e=t.getFrustumPlanes(),n=GE(e.near,t.cameraPosition),s=Ll(t,n),r=Ll(t,t.cameraPosition,Od);let i=0;Jg.planes[i++].fromPointNormal(s,WE.copy(s).subtract(r));for(const o in e){if(o==="near")continue;const a=e[o],c=GE(a,n,Od),l=Ll(t,c,Od);Jg.planes[i++].fromPointNormal(l,WE.copy(s).subtract(l))}}function GE(t,e,n=new x){const s=t.normal.dot(e);return n.copy(t.normal).scale(t.distance-s).add(e),n}function Ll(t,e,n=new x){const s=t.unprojectPosition(e);return pe.WGS84.cartographicToCartesian(s,n)}const xj=6378137,Mj=6378137,qg=6356752314245179e-9,vi=new x;function Bj(t,e){if(t instanceof rc){const{halfAxes:n}=t,s=Nj(n);return Math.log2(qg/(s+e[2]))}else if(t instanceof sc){const{radius:n}=t;return Math.log2(qg/(n+e[2]))}else if(t.width&&t.height){const{width:n,height:s}=t,r=Math.log2(xj/n),i=Math.log2(Mj/s);return(r+i)/2}return 1}function Qb(t,e,n){pe.WGS84.cartographicToCartesian([t.xmax,t.ymax,t.zmax],vi);const s=Math.sqrt(Math.pow(vi[0]-n[0],2)+Math.pow(vi[1]-n[1],2)+Math.pow(vi[2]-n[2],2));return Math.log2(qg/(s+e[2]))}function Oj(t,e,n){const[s,r,i,o]=t;return Qb({xmin:s,xmax:i,ymin:r,ymax:o,zmin:0,zmax:0},e,n)}function Nj(t){t.getColumn(0,vi);const e=t.getColumn(1),n=t.getColumn(2);return vi.add(e).add(n).len()}const vt={UNLOADED:0,LOADING:1,PROCESSING:2,READY:3,EXPIRED:4,FAILED:5};var _n;(function(t){t[t.ADD=1]="ADD",t[t.REPLACE=2]="REPLACE"})(_n||(_n={}));var Zn;(function(t){t.EMPTY="empty",t.SCENEGRAPH="scenegraph",t.POINTCLOUD="pointcloud",t.MESH="mesh"})(Zn||(Zn={}));var dt;(function(t){t.I3S="I3S",t.TILES3D="TILES3D"})(dt||(dt={}));var Qi;(function(t){t.GEOMETRIC_ERROR="geometricError",t.MAX_SCREEN_THRESHOLD="maxScreenThreshold"})(Qi||(Qi={}));const Fj={NOT_COMPUTED:-1,USE_OPTIMIZATION:1,SKIP_OPTIMIZATION:0};function eR(t){return t!=null}const et=new x,Ul=new x,Dj=new x,Lj=new x,rr=new x,XE=new x,$E=new x,KE=new x;function Nd(t,e,n){if(de(t,"3D Tile: boundingVolume must be defined"),t.box)return tR(t.box,e,n);if(t.region)return zj(t.region);if(t.sphere)return kj(t.sphere,e,n);throw new Error("3D Tile: boundingVolume must contain a sphere, region, or box")}function Uj(t,e){if(t.box)return Vj(e);if(t.region){const[n,s,r,i,o,a]=t.region;return[[rn(n),rn(s),o],[rn(r),rn(i),a]]}if(t.sphere)return Hj(e);throw new Error("Unkown boundingVolume type")}function tR(t,e,n){const s=new x(t[0],t[1],t[2]);e.transform(s,s);let r=[];if(t.length===10){const l=t.slice(3,6),u=new Fa;u.fromArray(t,6);const h=new x([1,0,0]),f=new x([0,1,0]),d=new x([0,0,1]);h.transformByQuaternion(u),h.scale(l[0]),f.transformByQuaternion(u),f.scale(l[1]),d.transformByQuaternion(u),d.scale(l[2]),r=[...h.toArray(),...f.toArray(),...d.toArray()]}else r=[...t.slice(3,6),...t.slice(6,9),...t.slice(9,12)];const i=e.transformAsVector(r.slice(0,3)),o=e.transformAsVector(r.slice(3,6)),a=e.transformAsVector(r.slice(6,9)),c=new Ie([i[0],i[1],i[2],o[0],o[1],o[2],a[0],a[1],a[2]]);return eR(n)?(n.center=s,n.halfAxes=c,n):new rc(s,c)}function kj(t,e,n){const s=new x(t[0],t[1],t[2]);e.transform(s,s);const r=e.getScale(Ul),i=Math.max(Math.max(r[0],r[1]),r[2]),o=t[3]*i;return eR(n)?(n.center=s,n.radius=o,n):new sc(s,o)}function zj(t){const[e,n,s,r,i,o]=t,a=pe.WGS84.cartographicToCartesian([rn(e),rn(r),i],Dj),c=pe.WGS84.cartographicToCartesian([rn(s),rn(n),o],Lj),l=new x().addVectors(a,c).multiplyByScalar(.5);return pe.WGS84.cartesianToCartographic(l,rr),pe.WGS84.cartographicToCartesian([rn(s),rr[1],rr[2]],XE),pe.WGS84.cartographicToCartesian([rr[0],rn(r),rr[2]],$E),pe.WGS84.cartographicToCartesian([rr[0],rr[1],o],KE),tR([...l,...XE.subtract(l),...$E.subtract(l),...KE.subtract(l)],new q)}function Vj(t){const e=nR(),{halfAxes:n}=t,s=new x(n.getColumn(0)),r=new x(n.getColumn(1)),i=new x(n.getColumn(2));for(let o=0;o<2;o++){for(let a=0;a<2;a++){for(let c=0;c<2;c++)et.copy(t.center),et.add(s),et.add(r),et.add(i),sR(e,et),i.negate();r.negate()}s.negate()}return e}function Hj(t){const e=nR(),{center:n,radius:s}=t,r=pe.WGS84.scaleToGeodeticSurface(n,et);let i;r?i=pe.WGS84.geodeticSurfaceNormal(r):i=new x(0,0,1);let o=new x(i[2],-i[1],0);o.len()>0?o.normalize():o=new x(0,1,0);const a=o.clone().cross(i);for(const c of[o,a,i]){Ul.copy(c).scale(s);for(let l=0;l<2;l++)et.copy(n),et.add(Ul),sR(e,et),Ul.negate()}return e}function nR(){return[[1/0,1/0,1/0],[-1/0,-1/0,-1/0]]}function sR(t,e){pe.WGS84.cartesianToCartographic(e,et),t[0][0]=Math.min(t[0][0],et[0]),t[0][1]=Math.min(t[0][1],et[1]),t[0][2]=Math.min(t[0][2],et[2]),t[1][0]=Math.max(t[1][0],et[0]),t[1][1]=Math.max(t[1][1],et[1]),t[1][2]=Math.max(t[1][2],et[2])}new x;new x;new q;new x;new x;new x;function jj(t,e){const n=t*e;return 1-Math.exp(-(n*n))}function Wj(t,e){if(t.dynamicScreenSpaceError&&t.dynamicScreenSpaceErrorComputedDensity){const n=t.dynamicScreenSpaceErrorComputedDensity,s=t.dynamicScreenSpaceErrorFactor;return jj(e,n)*s}return 0}function Gj(t,e,n){const s=t.tileset,r=t.parent&&t.parent.lodMetricValue||t.lodMetricValue,i=n?r:t.lodMetricValue;if(i===0)return 0;const o=Math.max(t._distanceToCamera,1e-7),{height:a,sseDenominator:c}=e,{viewDistanceScale:l}=s.options;let u=i*a*(l||1)/(o*c);return u-=Wj(s,o),u}const Fd=new x,YE=new x,ys=new x,JE=new x,Xj=new x,Dd=new q,qE=new q;function $j(t,e){if(t.lodMetricValue===0||isNaN(t.lodMetricValue))return"DIG";const n=2*rR(t,e);return n<2?"OUT":!t.header.children||n<=t.lodMetricValue?"DRAW":t.header.children?"DIG":"OUT"}function rR(t,e){const{topDownViewport:n}=e,s=t.header.mbs[1],r=t.header.mbs[0],i=t.header.mbs[2],o=t.header.mbs[3],a=[...t.boundingVolume.center],c=n.unprojectPosition(n.cameraPosition);pe.WGS84.cartographicToCartesian(c,Fd),YE.copy(Fd).subtract(a).normalize(),pe.WGS84.eastNorthUpToFixedFrame(a,Dd),qE.copy(Dd).invert(),ys.copy(Fd).transform(qE);const l=Math.sqrt(ys[0]*ys[0]+ys[1]*ys[1]),u=l*l/ys[2];JE.copy([ys[0],ys[1],u]);const f=JE.transform(Dd).subtract(a).normalize(),g=YE.cross(f).normalize().scale(o).add(a),_=pe.WGS84.cartesianToCartographic(g),E=n.project([r,s,i]),m=n.project(_);return Xj.copy(E).subtract(m).magnitude()}function Kj(t){return{assetGltfUpAxis:t.asset&&t.asset.gltfUpAxis||"Y"}}class ZE{constructor(e=0){p(this,"_map",new Map);p(this,"_array");p(this,"_length");this._array=new Array(e),this._length=e}get length(){return this._length}set length(e){this._length=e,e>this._array.length&&(this._array.length=e)}get values(){return this._array}get(e){return de(e<this._array.length),this._array[e]}set(e,n){de(e>=0),e>=this.length&&(this.length=e+1),this._map.has(this._array[e])&&this._map.delete(this._array[e]),this._array[e]=n,this._map.set(n,e)}delete(e){const n=this._map.get(e);n>=0&&(this._array.splice(n,1),this._map.delete(e),this.length--)}peek(){return this._array[this._length-1]}push(e){if(!this._map.has(e)){const n=this.length++;this._array[n]=e,this._map.set(e,n)}}pop(){const e=this._array[--this.length];return this._map.delete(e),e}reserve(e){de(e>=0),e>this._array.length&&(this._array.length=e)}resize(e){de(e>=0),this.length=e}trim(e){e==null&&(e=this.length),this._array.length=e}reset(){this._array=[],this._map=new Map,this._length=0}find(e){return this._map.has(e)}}const Yj={loadSiblings:!1,skipLevelOfDetail:!1,updateTransforms:!0,onTraversalEnd:()=>{},viewportTraversersMap:{},basePath:""};class qh{constructor(e){p(this,"options");p(this,"root",null);p(this,"selectedTiles",{});p(this,"requestedTiles",{});p(this,"emptyTiles",{});p(this,"lastUpdate",new Date().getTime());p(this,"updateDebounceTime",1e3);p(this,"_traversalStack",new ZE);p(this,"_emptyTraversalStack",new ZE);p(this,"_frameNumber",null);this.options={...Yj,...e}}traversalFinished(e){return!0}traverse(e,n,s){this.root=e,this.options={...this.options,...s},this.reset(),this.updateTile(e,n),this._frameNumber=n.frameNumber,this.executeTraversal(e,n)}reset(){this.requestedTiles={},this.selectedTiles={},this.emptyTiles={},this._traversalStack.reset(),this._emptyTraversalStack.reset()}executeTraversal(e,n){const s=this._traversalStack;for(e._selectionDepth=1,s.push(e);s.length>0;){const i=s.pop();let o=!1;this.canTraverse(i,n)&&(this.updateChildTiles(i,n),o=this.updateAndPushChildren(i,n,s,i.hasRenderContent?i._selectionDepth+1:i._selectionDepth));const a=i.parent,c=!!(!a||a._shouldRefine),l=!o;i.hasRenderContent?i.refine===_n.ADD?(this.loadTile(i,n),this.selectTile(i,n)):i.refine===_n.REPLACE&&(this.loadTile(i,n),l&&this.selectTile(i,n)):(this.emptyTiles[i.id]=i,this.loadTile(i,n),l&&this.selectTile(i,n)),this.touchTile(i,n),i._shouldRefine=o&&c}const r=new Date().getTime();(this.traversalFinished(n)||r-this.lastUpdate>this.updateDebounceTime)&&(this.lastUpdate=r,this.options.onTraversalEnd(n))}updateChildTiles(e,n){const s=e.children;for(const r of s)this.updateTile(r,n)}updateAndPushChildren(e,n,s,r){const{loadSiblings:i,skipLevelOfDetail:o}=this.options,a=e.children;a.sort(this.compareDistanceToCamera.bind(this));const c=e.refine===_n.REPLACE&&e.hasRenderContent&&!o;let l=!1,u=!0;for(const h of a)if(h._selectionDepth=r,h.isVisibleAndInRequestVolume?(s.find(h)&&s.delete(h),s.push(h),l=!0):(c||i)&&(this.loadTile(h,n),this.touchTile(h,n)),c){let f;if(h._inRequestVolume?h.hasRenderContent?f=h.contentAvailable:f=this.executeEmptyTraversal(h,n):f=!1,u=u&&f,!u)return!1}return l||(u=!1),u}updateTile(e,n){this.updateTileVisibility(e,n)}selectTile(e,n){this.shouldSelectTile(e)&&(e._selectedFrame=n.frameNumber,this.selectedTiles[e.id]=e)}loadTile(e,n){this.shouldLoadTile(e)&&(e._requestedFrame=n.frameNumber,e._priority=e._getPriority(),this.requestedTiles[e.id]=e)}touchTile(e,n){e.tileset._cache.touch(e),e._touchedFrame=n.frameNumber}canTraverse(e,n,s=!1,r=!1){return e.hasChildren?e.hasTilesetContent?!e.contentExpired:!r&&!e.isVisibleAndInRequestVolume?!1:this.shouldRefine(e,n,s):!1}shouldLoadTile(e){return e.hasUnloadedContent||e.contentExpired}shouldSelectTile(e){return e.contentAvailable&&!this.options.skipLevelOfDetail}shouldRefine(e,n,s=!1){let r=e._screenSpaceError;return s&&(r=e.getScreenSpaceError(n,!0)),r>e.tileset.memoryAdjustedScreenSpaceError}updateTileVisibility(e,n){const s=[];if(this.options.viewportTraversersMap)for(const r in this.options.viewportTraversersMap)this.options.viewportTraversersMap[r]===n.viewport.id&&s.push(r);else s.push(n.viewport.id);e.updateVisibility(n,s)}compareDistanceToCamera(e,n){return e._distanceToCamera-n._distanceToCamera}anyChildrenVisible(e,n){let s=!1;for(const r of e.children)r.updateVisibility(n),s=s||r.isVisibleAndInRequestVolume;return s}executeEmptyTraversal(e,n){let s=!0;const r=this._emptyTraversalStack;for(r.push(e);r.length>0;){const i=r.pop(),o=!i.hasRenderContent&&this.canTraverse(i,n,!1,!1),a=!i.hasRenderContent&&i.children.length===0;if(!o&&!i.contentAvailable&&!a&&(s=!1),this.updateTile(i,n),i.isVisibleAndInRequestVolume||(this.loadTile(i,n),this.touchTile(i,n)),o){const c=i.children;for(const l of c)r.push(l)}}return s}}const QE=new x;function Jj(t){return t!=null}class Zg{constructor(e,n,s,r=""){p(this,"tileset");p(this,"header");p(this,"id");p(this,"url");p(this,"parent");p(this,"refine");p(this,"type");p(this,"contentUrl");p(this,"lodMetricType","geometricError");p(this,"lodMetricValue",0);p(this,"boundingVolume",null);p(this,"content",null);p(this,"contentState",vt.UNLOADED);p(this,"gpuMemoryUsageInBytes",0);p(this,"children",[]);p(this,"depth",0);p(this,"viewportIds",[]);p(this,"transform",new q);p(this,"extensions",null);p(this,"implicitTiling",null);p(this,"userData",{});p(this,"computedTransform");p(this,"hasEmptyContent",!1);p(this,"hasTilesetContent",!1);p(this,"traverser",new qh({}));p(this,"_cacheNode",null);p(this,"_frameNumber",null);p(this,"_expireDate",null);p(this,"_expiredContent",null);p(this,"_boundingBox");p(this,"_distanceToCamera",0);p(this,"_screenSpaceError",0);p(this,"_visibilityPlaneMask");p(this,"_visible");p(this,"_contentBoundingVolume");p(this,"_viewerRequestVolume");p(this,"_initialTransform",new q);p(this,"_priority",0);p(this,"_selectedFrame",0);p(this,"_requestedFrame",0);p(this,"_selectionDepth",0);p(this,"_touchedFrame",0);p(this,"_centerZDepth",0);p(this,"_shouldRefine",!1);p(this,"_stackLength",0);p(this,"_visitedFrame",0);p(this,"_inRequestVolume",!1);p(this,"_lodJudge",null);this.header=n,this.tileset=e,this.id=r||n.id,this.url=n.url,this.parent=s,this.refine=this._getRefine(n.refine),this.type=n.type,this.contentUrl=n.contentUrl,this._initializeLodMetric(n),this._initializeTransforms(n),this._initializeBoundingVolumes(n),this._initializeContent(n),this._initializeRenderingState(n),Object.seal(this)}destroy(){this.header=null}isDestroyed(){return this.header===null}get selected(){return this._selectedFrame===this.tileset._frameNumber}get isVisible(){return this._visible}get isVisibleAndInRequestVolume(){return this._visible&&this._inRequestVolume}get hasRenderContent(){return!this.hasEmptyContent&&!this.hasTilesetContent}get hasChildren(){return this.children.length>0||this.header.children&&this.header.children.length>0}get contentReady(){return this.contentState===vt.READY||this.hasEmptyContent}get contentAvailable(){return!!(this.contentReady&&this.hasRenderContent||this._expiredContent&&!this.contentFailed)}get hasUnloadedContent(){return this.hasRenderContent&&this.contentUnloaded}get contentUnloaded(){return this.contentState===vt.UNLOADED}get contentExpired(){return this.contentState===vt.EXPIRED}get contentFailed(){return this.contentState===vt.FAILED}get distanceToCamera(){return this._distanceToCamera}get screenSpaceError(){return this._screenSpaceError}get boundingBox(){return this._boundingBox||(this._boundingBox=Uj(this.header.boundingVolume,this.boundingVolume)),this._boundingBox}getScreenSpaceError(e,n){switch(this.tileset.type){case dt.I3S:return rR(this,e);case dt.TILES3D:return Gj(this,e,n);default:throw new Error("Unsupported tileset type")}}unselect(){this._selectedFrame=0}_getGpuMemoryUsageInBytes(){return this.content.gpuMemoryUsageInBytes||this.content.byteLength||0}_getPriority(){const e=this.tileset._traverser,{skipLevelOfDetail:n}=e.options,s=this.refine===_n.ADD||n;if(s&&!this.isVisible&&this._visible!==void 0||this.tileset._frameNumber-this._touchedFrame>=1||this.contentState===vt.UNLOADED)return-1;const r=this.parent,o=r&&(!s||this._screenSpaceError===0||r.hasTilesetContent)?r._screenSpaceError:this._screenSpaceError,a=e.root?e.root._screenSpaceError:0;return Math.max(a-o,0)}async loadContent(){if(this.hasEmptyContent)return!1;if(this.content)return!0;this.contentExpired&&(this._expireDate=null),this.contentState=vt.LOADING;const n=await this.tileset._requestScheduler.scheduleRequest(this.id,this._getPriority.bind(this));if(!n)return this.contentState=vt.UNLOADED,!1;try{const s=this.tileset.getTileUrl(this.contentUrl),r=this.tileset.loader,i={...this.tileset.loadOptions,[r.id]:{...this.tileset.loadOptions[r.id],isTileset:this.type==="json",...this._getLoaderSpecificOptions(r.id)}};return this.content=await os(s,r,i),this.tileset.options.contentLoader&&await this.tileset.options.contentLoader(this),this._isTileset()&&this.tileset._initializeTileHeaders(this.content,this),this.contentState=vt.READY,this._onContentLoaded(),!0}catch(s){throw this.contentState=vt.FAILED,s}finally{n.done()}}unloadContent(){return this.content&&this.content.destroy&&this.content.destroy(),this.content=null,this.header.content&&this.header.content.destroy&&this.header.content.destroy(),this.header.content=null,this.contentState=vt.UNLOADED,!0}updateVisibility(e,n){if(this._frameNumber===e.frameNumber)return;const s=this.parent,r=s?s._visibilityPlaneMask:It.MASK_INDETERMINATE;if(this.tileset._traverser.options.updateTransforms){const i=s?s.computedTransform:this.tileset.modelMatrix;this._updateTransform(i)}this._distanceToCamera=this.distanceToTile(e),this._screenSpaceError=this.getScreenSpaceError(e,!1),this._visibilityPlaneMask=this.visibility(e,r),this._visible=this._visibilityPlaneMask!==It.MASK_OUTSIDE,this._inRequestVolume=this.insideViewerRequestVolume(e),this._frameNumber=e.frameNumber,this.viewportIds=n}visibility(e,n){const{cullingVolume:s}=e,{boundingVolume:r}=this;return s.computeVisibilityWithPlaneMask(r,n)}contentVisibility(){return!0}distanceToTile(e){const n=this.boundingVolume;return Math.sqrt(Math.max(n.distanceSquaredTo(e.camera.position),0))}cameraSpaceZDepth({camera:e}){const n=this.boundingVolume;return QE.subVectors(n.center,e.position),e.direction.dot(QE)}insideViewerRequestVolume(e){const n=this._viewerRequestVolume;return!n||n.distanceSquaredTo(e.camera.position)<=0}updateExpiration(){if(Jj(this._expireDate)&&this.contentReady&&!this.hasEmptyContent){const e=Date.now();Date.lessThan(this._expireDate,e)&&(this.contentState=vt.EXPIRED,this._expiredContent=this.content)}}get extras(){return this.header.extras}_initializeLodMetric(e){"lodMetricType"in e?this.lodMetricType=e.lodMetricType:(this.lodMetricType=this.parent&&this.parent.lodMetricType||this.tileset.lodMetricType,console.warn("3D Tile: Required prop lodMetricType is undefined. Using parent lodMetricType")),"lodMetricValue"in e?this.lodMetricValue=e.lodMetricValue:(this.lodMetricValue=this.parent&&this.parent.lodMetricValue||this.tileset.lodMetricValue,console.warn("3D Tile: Required prop lodMetricValue is undefined. Using parent lodMetricValue"))}_initializeTransforms(e){this.transform=e.transform?new q(e.transform):new q;const n=this.parent,s=this.tileset,r=n&&n.computedTransform?n.computedTransform.clone():s.modelMatrix.clone();this.computedTransform=new q(r).multiplyRight(this.transform);const i=n&&n._initialTransform?n._initialTransform.clone():new q;this._initialTransform=new q(i).multiplyRight(this.transform)}_initializeBoundingVolumes(e){this._contentBoundingVolume=null,this._viewerRequestVolume=null,this._updateBoundingVolume(e)}_initializeContent(e){this.content={_tileset:this.tileset,_tile:this},this.hasEmptyContent=!0,this.contentState=vt.UNLOADED,this.hasTilesetContent=!1,e.contentUrl&&(this.content=null,this.hasEmptyContent=!1)}_initializeRenderingState(e){this.depth=e.level||(this.parent?this.parent.depth+1:0),this._shouldRefine=!1,this._distanceToCamera=0,this._centerZDepth=0,this._screenSpaceError=0,this._visibilityPlaneMask=It.MASK_INDETERMINATE,this._visible=void 0,this._inRequestVolume=!1,this._stackLength=0,this._selectionDepth=0,this._frameNumber=0,this._touchedFrame=0,this._visitedFrame=0,this._selectedFrame=0,this._requestedFrame=0,this._priority=0}_getRefine(e){return e||this.parent&&this.parent.refine||_n.REPLACE}_isTileset(){return this.contentUrl.indexOf(".json")!==-1}_onContentLoaded(){switch(this.content&&this.content.type){case"vctr":case"geom":this.tileset._traverser.disableSkipLevelOfDetail=!0;break}this._isTileset()?this.hasTilesetContent=!0:this.gpuMemoryUsageInBytes=this._getGpuMemoryUsageInBytes()}_updateBoundingVolume(e){this.boundingVolume=Nd(e.boundingVolume,this.computedTransform,this.boundingVolume);const n=e.content;n&&(n.boundingVolume&&(this._contentBoundingVolume=Nd(n.boundingVolume,this.computedTransform,this._contentBoundingVolume)),e.viewerRequestVolume&&(this._viewerRequestVolume=Nd(e.viewerRequestVolume,this.computedTransform,this._viewerRequestVolume)))}_updateTransform(e=new q){const n=e.clone().multiplyRight(this.transform);n.equals(this.computedTransform)||(this.computedTransform=n,this._updateBoundingVolume(this.header))}_getLoaderSpecificOptions(e){switch(e){case"i3s":return{...this.tileset.options.i3s,_tileOptions:{attributeUrls:this.header.attributeUrls,textureUrl:this.header.textureUrl,textureFormat:this.header.textureFormat,textureLoaderOptions:this.header.textureLoaderOptions,materialDefinition:this.header.materialDefinition,isDracoGeometry:this.header.isDracoGeometry,mbs:this.header.mbs},_tilesetOptions:{store:this.tileset.tileset.store,attributeStorageInfo:this.tileset.tileset.attributeStorageInfo,fields:this.tileset.tileset.fields},isTileHeader:!1};case"3d-tiles":case"cesium-ion":default:return Kj(this.tileset.tileset)}}}class qj extends qh{compareDistanceToCamera(e,n){return n._distanceToCamera===0&&e._distanceToCamera===0?n._centerZDepth-e._centerZDepth:n._distanceToCamera-e._distanceToCamera}updateTileVisibility(e,n){if(super.updateTileVisibility(e,n),!e.isVisibleAndInRequestVolume)return;const s=e.children.length>0;if(e.hasTilesetContent&&s){const o=e.children[0];this.updateTileVisibility(o,n),e._visible=o._visible;return}if(this.meetsScreenSpaceErrorEarly(e,n)){e._visible=!1;return}const r=e.refine===_n.REPLACE,i=e._optimChildrenWithinParent===Fj.USE_OPTIMIZATION;if(r&&i&&s&&!this.anyChildrenVisible(e,n)){e._visible=!1;return}}meetsScreenSpaceErrorEarly(e,n){const{parent:s}=e;return!s||s.hasTilesetContent||s.refine!==_n.ADD?!1:!this.shouldRefine(e,n,!0)}}class Zj{constructor(){p(this,"frameNumberMap",new Map)}register(e,n){const s=this.frameNumberMap.get(e)||new Map,r=s.get(n)||0;s.set(n,r+1),this.frameNumberMap.set(e,s)}deregister(e,n){const s=this.frameNumberMap.get(e);if(!s)return;const r=s.get(n)||1;s.set(n,r-1)}isZero(e,n){var r;return(((r=this.frameNumberMap.get(e))==null?void 0:r.get(n))||0)===0}}const Ld={REQUESTED:"REQUESTED",COMPLETED:"COMPLETED",ERROR:"ERROR"};class Qj{constructor(){p(this,"_statusMap");p(this,"pendingTilesRegister",new Zj);this._statusMap={}}add(e,n,s,r){if(!this._statusMap[n]){const{frameNumber:i,viewport:{id:o}}=r;this._statusMap[n]={request:e,callback:s,key:n,frameState:r,status:Ld.REQUESTED},this.pendingTilesRegister.register(o,i),e().then(a=>{this._statusMap[n].status=Ld.COMPLETED;const{frameNumber:c,viewport:{id:l}}=this._statusMap[n].frameState;this.pendingTilesRegister.deregister(l,c),this._statusMap[n].callback(a,r)}).catch(a=>{this._statusMap[n].status=Ld.ERROR;const{frameNumber:c,viewport:{id:l}}=this._statusMap[n].frameState;this.pendingTilesRegister.deregister(l,c),s(a)})}}update(e,n){if(this._statusMap[e]){const{frameNumber:s,viewport:{id:r}}=this._statusMap[e].frameState;this.pendingTilesRegister.deregister(r,s);const{frameNumber:i,viewport:{id:o}}=n;this.pendingTilesRegister.register(o,i),this._statusMap[e].frameState=n}}find(e){return this._statusMap[e]}hasPendingTiles(e,n){return!this.pendingTilesRegister.isZero(e,n)}}class eW extends qh{constructor(n){super(n);p(this,"_tileManager");this._tileManager=new Qj}traversalFinished(n){return!this._tileManager.hasPendingTiles(n.viewport.id,this._frameNumber||0)}shouldRefine(n,s){return n._lodJudge=$j(n,s),n._lodJudge==="DIG"}updateChildTiles(n,s){const r=n.header.children||[],i=n.children,o=n.tileset;for(const a of r){const c=`${a.id}-${s.viewport.id}`,l=i&&i.find(u=>u.id===c);if(l)l&&this.updateTile(l,s);else{let u=()=>this._loadTile(a.id,o);this._tileManager.find(c)?this._tileManager.update(c,s):(o.tileset.nodePages&&(u=()=>o.tileset.nodePagesTile.formTileFromNodePages(a.id)),this._tileManager.add(u,c,f=>this._onTileLoad(f,n,c),s))}}return!1}async _loadTile(n,s){const{loader:r}=s,i=s.getTileUrl(`${s.url}/nodes/${n}`),o={...s.loadOptions,i3s:{...s.loadOptions.i3s,isTileHeader:!0}};return await os(i,r,o)}_onTileLoad(n,s,r){const i=new Zg(s.tileset,n,s,r);s.children.push(i);const o=this._tileManager.find(i.id).frameState;this.updateTile(i,o),this._frameNumber===o.frameNumber&&(this.traversalFinished(o)||new Date().getTime()-this.lastUpdate>this.updateDebounceTime)&&this.executeTraversal(i,o)}}const tW={description:"",ellipsoid:pe.WGS84,modelMatrix:new q,throttleRequests:!0,maxRequests:64,maximumMemoryUsage:32,memoryCacheOverflow:1,maximumTilesSelected:0,debounceTime:0,onTileLoad:()=>{},onTileUnload:()=>{},onTileError:()=>{},onTraversalComplete:t=>t,contentLoader:void 0,viewDistanceScale:1,maximumScreenSpaceError:8,memoryAdjustedScreenSpaceError:!1,loadTiles:!0,updateTransforms:!0,viewportTraversersMap:null,loadOptions:{fetch:{}},attributions:[],basePath:"",i3s:{}},hl="Tiles In Tileset(s)",Ud="Tiles In Memory",eS="Tiles In View",tS="Tiles To Render",nS="Tiles Loaded",kd="Tiles Loading",sS="Tiles Unloaded",rS="Failed Tile Loads",iS="Points/Vertices",zd="Tile Memory Use",oS="Maximum Screen Space Error";class nW{constructor(e,n){p(this,"options");p(this,"loadOptions");p(this,"type");p(this,"tileset");p(this,"loader");p(this,"url");p(this,"basePath");p(this,"modelMatrix");p(this,"ellipsoid");p(this,"lodMetricType");p(this,"lodMetricValue");p(this,"refine");p(this,"root",null);p(this,"roots",{});p(this,"asset",{});p(this,"description","");p(this,"properties");p(this,"extras",null);p(this,"attributions",{});p(this,"credits",{});p(this,"stats");p(this,"contentFormats",{draco:!1,meshopt:!1,dds:!1,ktx2:!1});p(this,"cartographicCenter",null);p(this,"cartesianCenter",null);p(this,"zoom",1);p(this,"boundingVolume",null);p(this,"dynamicScreenSpaceErrorComputedDensity",0);p(this,"maximumMemoryUsage",32);p(this,"gpuMemoryUsageInBytes",0);p(this,"memoryAdjustedScreenSpaceError",0);p(this,"_cacheBytes",0);p(this,"_cacheOverflowBytes",0);p(this,"_frameNumber",0);p(this,"_queryParams",{});p(this,"_extensionsUsed",[]);p(this,"_tiles",{});p(this,"_pendingCount",0);p(this,"selectedTiles",[]);p(this,"traverseCounter",0);p(this,"geometricError",0);p(this,"lastUpdatedVieports",null);p(this,"_requestedTiles",[]);p(this,"_emptyTiles",[]);p(this,"frameStateData",{});p(this,"_traverser");p(this,"_cache",new wj);p(this,"_requestScheduler");p(this,"updatePromise",null);p(this,"tilesetInitializationPromise");this.options={...tW,...n},this.tileset=e,this.loader=e.loader,this.type=e.type,this.url=e.url,this.basePath=e.basePath||sm(this.url),this.modelMatrix=this.options.modelMatrix,this.ellipsoid=this.options.ellipsoid,this.lodMetricType=e.lodMetricType,this.lodMetricValue=e.lodMetricValue,this.refine=e.root.refine,this.loadOptions=this.options.loadOptions||{},this._traverser=this._initializeTraverser(),this._requestScheduler=new Z1({throttleRequests:this.options.throttleRequests,maxRequests:this.options.maxRequests}),this.memoryAdjustedScreenSpaceError=this.options.maximumScreenSpaceError,this._cacheBytes=this.options.maximumMemoryUsage*1024*1024,this._cacheOverflowBytes=this.options.memoryCacheOverflow*1024*1024,this.stats=new oo({id:this.url}),this._initializeStats(),this.tilesetInitializationPromise=this._initializeTileSet(e)}destroy(){this._destroy()}isLoaded(){return this._pendingCount===0&&this._frameNumber!==0&&this._requestedTiles.length===0}get tiles(){return Object.values(this._tiles)}get frameNumber(){return this._frameNumber}get queryParams(){return new URLSearchParams(this._queryParams).toString()}setProps(e){this.options={...this.options,...e}}getTileUrl(e){if(e.startsWith("data:"))return e;let s=e;return this.queryParams.length&&(s=`${e}${e.includes("?")?"&":"?"}${this.queryParams}`),s}hasExtension(e){return this._extensionsUsed.indexOf(e)>-1}update(e=null){this.tilesetInitializationPromise.then(()=>{!e&&this.lastUpdatedVieports?e=this.lastUpdatedVieports:this.lastUpdatedVieports=e,e&&this.doUpdate(e)})}async selectTiles(e=null){return await this.tilesetInitializationPromise,e&&(this.lastUpdatedVieports=e),this.updatePromise||(this.updatePromise=new Promise(n=>{setTimeout(()=>{this.lastUpdatedVieports&&this.doUpdate(this.lastUpdatedVieports),n(this._frameNumber),this.updatePromise=null},this.options.debounceTime)})),this.updatePromise}adjustScreenSpaceError(){this.gpuMemoryUsageInBytes<this._cacheBytes?this.memoryAdjustedScreenSpaceError=Math.max(this.memoryAdjustedScreenSpaceError/1.02,this.options.maximumScreenSpaceError):this.gpuMemoryUsageInBytes>this._cacheBytes+this._cacheOverflowBytes&&(this.memoryAdjustedScreenSpaceError*=1.02)}doUpdate(e){if("loadTiles"in this.options&&!this.options.loadTiles||this.traverseCounter>0)return;const n=e instanceof Array?e:[e];this._cache.reset(),this._frameNumber++,this.traverseCounter=n.length;const s=[];for(const r of n){const i=r.id;this._needTraverse(i)?s.push(i):this.traverseCounter--}for(const r of n){const i=r.id;if(this.roots[i]||(this.roots[i]=this._initializeTileHeaders(this.tileset,null)),!s.includes(i))continue;const o=Rj(r,this._frameNumber);this._traverser.traverse(this.roots[i],o,this.options)}}_needTraverse(e){let n=e;return this.options.viewportTraversersMap&&(n=this.options.viewportTraversersMap[e]),n===e}_onTraversalEnd(e){const n=e.viewport.id;this.frameStateData[n]||(this.frameStateData[n]={selectedTiles:[],_requestedTiles:[],_emptyTiles:[]});const s=this.frameStateData[n],r=Object.values(this._traverser.selectedTiles),[i,o]=Ij(r,e,this.options.maximumTilesSelected);s.selectedTiles=i;for(const a of o)a.unselect();s._requestedTiles=Object.values(this._traverser.requestedTiles),s._emptyTiles=Object.values(this._traverser.emptyTiles),this.traverseCounter--,!(this.traverseCounter>0)&&this._updateTiles()}_updateTiles(){this.selectedTiles=[],this._requestedTiles=[],this._emptyTiles=[];for(const e in this.frameStateData){const n=this.frameStateData[e];this.selectedTiles=this.selectedTiles.concat(n.selectedTiles),this._requestedTiles=this._requestedTiles.concat(n._requestedTiles),this._emptyTiles=this._emptyTiles.concat(n._emptyTiles)}this.selectedTiles=this.options.onTraversalComplete(this.selectedTiles);for(const e of this.selectedTiles)this._tiles[e.id]=e;this._loadTiles(),this._unloadTiles(),this._updateStats()}_tilesChanged(e,n){if(e.length!==n.length)return!0;const s=new Set(e.map(o=>o.id)),r=new Set(n.map(o=>o.id));let i=e.filter(o=>!r.has(o.id)).length>0;return i=i||n.filter(o=>!s.has(o.id)).length>0,i}_loadTiles(){for(const e of this._requestedTiles)e.contentUnloaded&&this._loadTile(e)}_unloadTiles(){this._cache.unloadTiles(this,(e,n)=>e._unloadTile(n))}_updateStats(){let e=0,n=0;for(const s of this.selectedTiles)s.contentAvailable&&s.content&&(e++,s.content.pointCount?n+=s.content.pointCount:n+=s.content.vertexCount);this.stats.get(eS).count=this.selectedTiles.length,this.stats.get(tS).count=e,this.stats.get(iS).count=n,this.stats.get(oS).count=this.memoryAdjustedScreenSpaceError}async _initializeTileSet(e){this.type===dt.I3S&&(this.calculateViewPropsI3S(),e.root=await e.root),this.root=this._initializeTileHeaders(e,null),this.type===dt.TILES3D&&(this._initializeTiles3DTileset(e),this.calculateViewPropsTiles3D()),this.type===dt.I3S&&this._initializeI3STileset()}calculateViewPropsI3S(){var s;const e=this.tileset.fullExtent;if(e){const{xmin:r,xmax:i,ymin:o,ymax:a,zmin:c,zmax:l}=e;this.cartographicCenter=new x(r+(i-r)/2,o+(a-o)/2,c+(l-c)/2),this.cartesianCenter=new x,pe.WGS84.cartographicToCartesian(this.cartographicCenter,this.cartesianCenter),this.zoom=Qb(e,this.cartographicCenter,this.cartesianCenter);return}const n=(s=this.tileset.store)==null?void 0:s.extent;if(n){const[r,i,o,a]=n;this.cartographicCenter=new x(r+(o-r)/2,i+(a-i)/2,0),this.cartesianCenter=new x,pe.WGS84.cartographicToCartesian(this.cartographicCenter,this.cartesianCenter),this.zoom=Oj(n,this.cartographicCenter,this.cartesianCenter);return}console.warn("Extent is not defined in the tileset header"),this.cartographicCenter=new x,this.zoom=1}calculateViewPropsTiles3D(){const e=this.root,{center:n}=e.boundingVolume;if(!n){console.warn("center was not pre-calculated for the root tile"),this.cartographicCenter=new x,this.zoom=1;return}n[0]!==0||n[1]!==0||n[2]!==0?(this.cartographicCenter=new x,pe.WGS84.cartesianToCartographic(n,this.cartographicCenter)):this.cartographicCenter=new x(0,0,-pe.WGS84.radii[0]),this.cartesianCenter=n,this.zoom=Bj(e.boundingVolume,this.cartographicCenter)}_initializeStats(){this.stats.get(hl),this.stats.get(kd),this.stats.get(Ud),this.stats.get(eS),this.stats.get(tS),this.stats.get(nS),this.stats.get(sS),this.stats.get(rS),this.stats.get(iS),this.stats.get(zd,"memory"),this.stats.get(oS)}_initializeTileHeaders(e,n){var r;const s=new Zg(this,e.root,n);if(n&&(n.children.push(s),s.depth=n.depth+1),this.type===dt.TILES3D){const i=[];for(i.push(s);i.length>0;){const o=i.pop();this.stats.get(hl).incrementCount();const a=o.header.children||[];for(const c of a){const l=new Zg(this,c,o);if((r=l.contentUrl)!=null&&r.includes("?session=")){const h=new URL(l.contentUrl).searchParams.get("session");h&&(this._queryParams.session=h)}o.children.push(l),l.depth=o.depth+1,i.push(l)}}}return s}_initializeTraverser(){let e;switch(this.type){case dt.TILES3D:e=qj;break;case dt.I3S:e=eW;break;default:e=qh}return new e({basePath:this.basePath,onTraversalEnd:this._onTraversalEnd.bind(this)})}_destroyTileHeaders(e){this._destroySubtree(e)}async _loadTile(e){let n;try{this._onStartTileLoading(),n=await e.loadContent()}catch(s){this._onTileLoadError(e,s instanceof Error?s:new Error("load failed"))}finally{this._onEndTileLoading(),this._onTileLoad(e,n)}}_onTileLoadError(e,n){this.stats.get(rS).incrementCount();const s=n.message||n.toString(),r=e.url;console.error(`A 3D tile failed to load: ${e.url} ${s}`),this.options.onTileError(e,s,r)}_onTileLoad(e,n){var s,r;if(n){if(this.type===dt.I3S){const i=((r=(s=this.tileset)==null?void 0:s.nodePagesTile)==null?void 0:r.nodesInNodePages)||0;this.stats.get(hl).reset(),this.stats.get(hl).addCount(i)}e&&e.content&&bj(e,e.content),this.updateContentTypes(e),this._addTileToCache(e),this.options.onTileLoad(e)}}updateContentTypes(e){var n;if(this.type===dt.I3S)switch(e.header.isDracoGeometry&&(this.contentFormats.draco=!0),e.header.textureFormat){case"dds":this.contentFormats.dds=!0;break;case"ktx2":this.contentFormats.ktx2=!0;break}else if(this.type===dt.TILES3D){const{extensionsRemoved:s=[]}=((n=e.content)==null?void 0:n.gltf)||{};s.includes("KHR_draco_mesh_compression")&&(this.contentFormats.draco=!0),s.includes("EXT_meshopt_compression")&&(this.contentFormats.meshopt=!0),s.includes("KHR_texture_basisu")&&(this.contentFormats.ktx2=!0)}}_onStartTileLoading(){this._pendingCount++,this.stats.get(kd).incrementCount()}_onEndTileLoading(){this._pendingCount--,this.stats.get(kd).decrementCount()}_addTileToCache(e){this._cache.add(this,e,n=>n._updateCacheStats(e))}_updateCacheStats(e){this.stats.get(nS).incrementCount(),this.stats.get(Ud).incrementCount(),this.gpuMemoryUsageInBytes+=e.gpuMemoryUsageInBytes||0,this.stats.get(zd).count=this.gpuMemoryUsageInBytes,this.options.memoryAdjustedScreenSpaceError&&this.adjustScreenSpaceError()}_unloadTile(e){this.gpuMemoryUsageInBytes-=e.gpuMemoryUsageInBytes||0,this.stats.get(Ud).decrementCount(),this.stats.get(sS).incrementCount(),this.stats.get(zd).count=this.gpuMemoryUsageInBytes,this.options.onTileUnload(e),e.unloadContent()}_destroy(){const e=[];for(this.root&&e.push(this.root);e.length>0;){const n=e.pop();for(const s of n.children)e.push(s);this._destroyTile(n)}this.root=null}_destroySubtree(e){const n=e,s=[];for(s.push(n);s.length>0;){e=s.pop();for(const r of e.children)s.push(r);e!==n&&this._destroyTile(e)}n.children=[]}_destroyTile(e){this._cache.unloadTile(this,e),this._unloadTile(e),e.destroy()}_initializeTiles3DTileset(e){if(e.queryString){const n=new URLSearchParams(e.queryString),s=Object.fromEntries(n.entries());this._queryParams={...this._queryParams,...s}}if(this.asset=e.asset,!this.asset)throw new Error("Tileset must have an asset property.");if(this.asset.version!=="0.0"&&this.asset.version!=="1.0"&&this.asset.version!=="1.1")throw new Error("The tileset must be 3D Tiles version either 0.0 or 1.0 or 1.1.");"tilesetVersion"in this.asset&&(this._queryParams.v=this.asset.tilesetVersion),this.credits={attributions:this.options.attributions||[]},this.description=this.options.description||"",this.properties=e.properties,this.geometricError=e.geometricError,this._extensionsUsed=e.extensionsUsed||[],this.extras=e.extras}_initializeI3STileset(){this.loadOptions.i3s&&"token"in this.loadOptions.i3s&&(this._queryParams.token=this.loadOptions.i3s.token)}}const iR="4.2.0-beta.2",Fo={COMPOSITE:"cmpt",POINT_CLOUD:"pnts",BATCHED_3D_MODEL:"b3dm",INSTANCED_3D_MODEL:"i3dm",GEOMETRY:"geom",VECTOR:"vect",GLTF:"glTF"};function oR(t,e,n){de(t instanceof ArrayBuffer);const s=new TextDecoder("utf8"),r=new Uint8Array(t,e,n);return s.decode(r)}function sW(t,e=0){const n=new DataView(t);return`${String.fromCharCode(n.getUint8(e+0))}${String.fromCharCode(n.getUint8(e+1))}${String.fromCharCode(n.getUint8(e+2))}${String.fromCharCode(n.getUint8(e+3))}`}const rW={POINTS:0,LINES:1,LINE_LOOP:2,LINE_STRIP:3,TRIANGLES:4,TRIANGLE_STRIP:5,TRIANGLE_FAN:6},Ne={BYTE:5120,UNSIGNED_BYTE:5121,SHORT:5122,UNSIGNED_SHORT:5123,INT:5124,UNSIGNED_INT:5125,FLOAT:5126,DOUBLE:5130},te={...rW,...Ne},Vd={[Ne.DOUBLE]:Float64Array,[Ne.FLOAT]:Float32Array,[Ne.UNSIGNED_SHORT]:Uint16Array,[Ne.UNSIGNED_INT]:Uint32Array,[Ne.UNSIGNED_BYTE]:Uint8Array,[Ne.BYTE]:Int8Array,[Ne.SHORT]:Int16Array,[Ne.INT]:Int32Array},iW={DOUBLE:Ne.DOUBLE,FLOAT:Ne.FLOAT,UNSIGNED_SHORT:Ne.UNSIGNED_SHORT,UNSIGNED_INT:Ne.UNSIGNED_INT,UNSIGNED_BYTE:Ne.UNSIGNED_BYTE,BYTE:Ne.BYTE,SHORT:Ne.SHORT,INT:Ne.INT},Hd="Failed to convert GL type";class Fn{static fromTypedArray(e){e=ArrayBuffer.isView(e)?e.constructor:e;for(const n in Vd)if(Vd[n]===e)return n;throw new Error(Hd)}static fromName(e){const n=iW[e];if(!n)throw new Error(Hd);return n}static getArrayType(e){switch(e){case Ne.UNSIGNED_SHORT_5_6_5:case Ne.UNSIGNED_SHORT_4_4_4_4:case Ne.UNSIGNED_SHORT_5_5_5_1:return Uint16Array;default:const n=Vd[e];if(!n)throw new Error(Hd);return n}}static getByteSize(e){return Fn.getArrayType(e).BYTES_PER_ELEMENT}static validate(e){return!!Fn.getArrayType(e)}static createTypedArray(e,n,s=0,r){r===void 0&&(r=(n.byteLength-s)/Fn.getByteSize(e));const i=Fn.getArrayType(e);return new i(n,s,r)}}function oW(t,e){if(!t)throw new Error(`math.gl assertion failed. ${e}`)}function aW(t,e=[0,0,0]){const n=t>>11&31,s=t>>5&63,r=t&31;return e[0]=n<<3,e[1]=s<<2,e[2]=r<<3,e}new mm;new x;new mm;new mm;function aS(t,e=255){return qn(t,0,e)/e*2-1}function cS(t){return t<0?-1:1}function cW(t,e,n,s){if(oW(s),t<0||t>n||e<0||e>n)throw new Error(`x and y must be unsigned normalized integers between 0 and ${n}`);if(s.x=aS(t,n),s.y=aS(e,n),s.z=1-(Math.abs(s.x)+Math.abs(s.y)),s.z<0){const r=s.x;s.x=(1-Math.abs(s.y))*cS(r),s.y=(1-Math.abs(r))*cS(s.y)}return s.normalize()}function lW(t,e,n){return cW(t,e,255,n)}class Km{constructor(e,n){p(this,"json");p(this,"buffer");p(this,"featuresLength",0);p(this,"_cachedTypedArrays",{});this.json=e,this.buffer=n}getExtension(e){return this.json.extensions&&this.json.extensions[e]}hasProperty(e){return!!this.json[e]}getGlobalProperty(e,n=te.UNSIGNED_INT,s=1){const r=this.json[e];return r&&Number.isFinite(r.byteOffset)?this._getTypedArrayFromBinary(e,n,s,1,r.byteOffset):r}getPropertyArray(e,n,s){const r=this.json[e];return r&&Number.isFinite(r.byteOffset)?("componentType"in r&&(n=Fn.fromName(r.componentType)),this._getTypedArrayFromBinary(e,n,s,this.featuresLength,r.byteOffset)):this._getTypedArrayFromArray(e,n,r)}getProperty(e,n,s,r,i){const o=this.json[e];if(!o)return o;const a=this.getPropertyArray(e,n,s);if(s===1)return a[r];for(let c=0;c<s;++c)i[c]=a[s*r+c];return i}_getTypedArrayFromBinary(e,n,s,r,i){const o=this._cachedTypedArrays;let a=o[e];return a||(a=Fn.createTypedArray(n,this.buffer.buffer,this.buffer.byteOffset+i,r*s),o[e]=a),a}_getTypedArrayFromArray(e,n,s){const r=this._cachedTypedArrays;let i=r[e];return i||(i=Fn.createTypedArray(n,s),r[e]=i),i}}const uW={SCALAR:1,VEC2:2,VEC3:3,VEC4:4,MAT2:4,MAT3:9,MAT4:16},hW={SCALAR:(t,e)=>t[e],VEC2:(t,e)=>[t[2*e+0],t[2*e+1]],VEC3:(t,e)=>[t[3*e+0],t[3*e+1],t[3*e+2]],VEC4:(t,e)=>[t[4*e+0],t[4*e+1],t[4*e+2],t[4*e+3]],MAT2:(t,e)=>[t[4*e+0],t[4*e+1],t[4*e+2],t[4*e+3]],MAT3:(t,e)=>[t[9*e+0],t[9*e+1],t[9*e+2],t[9*e+3],t[9*e+4],t[9*e+5],t[9*e+6],t[9*e+7],t[9*e+8]],MAT4:(t,e)=>[t[16*e+0],t[16*e+1],t[16*e+2],t[16*e+3],t[16*e+4],t[16*e+5],t[16*e+6],t[16*e+7],t[16*e+8],t[16*e+9],t[16*e+10],t[16*e+11],t[16*e+12],t[16*e+13],t[16*e+14],t[16*e+15]]},fW={SCALAR:(t,e,n)=>{e[n]=t},VEC2:(t,e,n)=>{e[2*n+0]=t[0],e[2*n+1]=t[1]},VEC3:(t,e,n)=>{e[3*n+0]=t[0],e[3*n+1]=t[1],e[3*n+2]=t[2]},VEC4:(t,e,n)=>{e[4*n+0]=t[0],e[4*n+1]=t[1],e[4*n+2]=t[2],e[4*n+3]=t[3]},MAT2:(t,e,n)=>{e[4*n+0]=t[0],e[4*n+1]=t[1],e[4*n+2]=t[2],e[4*n+3]=t[3]},MAT3:(t,e,n)=>{e[9*n+0]=t[0],e[9*n+1]=t[1],e[9*n+2]=t[2],e[9*n+3]=t[3],e[9*n+4]=t[4],e[9*n+5]=t[5],e[9*n+6]=t[6],e[9*n+7]=t[7],e[9*n+8]=t[8],e[9*n+9]=t[9]},MAT4:(t,e,n)=>{e[16*n+0]=t[0],e[16*n+1]=t[1],e[16*n+2]=t[2],e[16*n+3]=t[3],e[16*n+4]=t[4],e[16*n+5]=t[5],e[16*n+6]=t[6],e[16*n+7]=t[7],e[16*n+8]=t[8],e[16*n+9]=t[9],e[16*n+10]=t[10],e[16*n+11]=t[11],e[16*n+12]=t[12],e[16*n+13]=t[13],e[16*n+14]=t[14],e[16*n+15]=t[15]}};function dW(t,e,n,s){const{componentType:r}=t;de(t.componentType);const i=typeof r=="string"?Fn.fromName(r):r,o=uW[t.type],a=hW[t.type],c=fW[t.type];return n+=t.byteOffset,{values:Fn.createTypedArray(i,e,n,o*s),type:i,size:o,unpacker:a,packer:c}}const On=t=>t!==void 0;function pW(t,e,n){if(!e)return null;let s=t.getExtension("3DTILES_batch_table_hierarchy");const r=e.HIERARCHY;return r&&(console.warn("3D Tile Parser: HIERARCHY is deprecated. Use 3DTILES_batch_table_hierarchy."),e.extensions=e.extensions||{},e.extensions["3DTILES_batch_table_hierarchy"]=r,s=r),s?gW(s,n):null}function gW(t,e){let n,s,r;const i=t.instancesLength,o=t.classes;let a=t.classIds,c=t.parentCounts,l=t.parentIds,u=i;On(a.byteOffset)&&(a.componentType=defaultValue(a.componentType,GL.UNSIGNED_SHORT),a.type=AttributeType.SCALAR,r=getBinaryAccessor(a),a=r.createArrayBufferView(e.buffer,e.byteOffset+a.byteOffset,i));let h;if(On(c))for(On(c.byteOffset)&&(c.componentType=defaultValue(c.componentType,GL.UNSIGNED_SHORT),c.type=AttributeType.SCALAR,r=getBinaryAccessor(c),c=r.createArrayBufferView(e.buffer,e.byteOffset+c.byteOffset,i)),h=new Uint16Array(i),u=0,n=0;n<i;++n)h[n]=u,u+=c[n];On(l)&&On(l.byteOffset)&&(l.componentType=defaultValue(l.componentType,GL.UNSIGNED_SHORT),l.type=AttributeType.SCALAR,r=getBinaryAccessor(l),l=r.createArrayBufferView(e.buffer,e.byteOffset+l.byteOffset,u));const f=o.length;for(n=0;n<f;++n){const E=o[n].length,m=o[n].instances,y=getBinaryProperties(E,m,e);o[n].instances=combine(y,m)}const d=new Array(f).fill(0),g=new Uint16Array(i);for(n=0;n<i;++n)s=a[n],g[n]=d[s],++d[s];const _={classes:o,classIds:a,classIndexes:g,parentCounts:c,parentIndexes:h,parentIds:l};return yW(_),_}function Do(t,e,n){if(!t)return;const s=t.parentCounts;return t.parentIds?n(t,e):s>0?_W(t,e,n):mW(t,e,n)}function _W(t,e,n){const s=t.classIds,r=t.parentCounts,i=t.parentIds,o=t.parentIndexes,a=s.length,c=scratchVisited;c.length=Math.max(c.length,a);const l=++marker,u=scratchStack;for(u.length=0,u.push(e);u.length>0;){if(e=u.pop(),c[e]===l)continue;c[e]=l;const h=n(t,e);if(On(h))return h;const f=r[e],d=o[e];for(let g=0;g<f;++g){const _=i[d+g];_!==e&&u.push(_)}}return null}function mW(t,e,n){let s=!0;for(;s;){const r=n(t,e);if(On(r))return r;const i=t.parentIds[e];s=i!==e,e=i}throw new Error("traverseHierarchySingleParent")}function yW(t){const n=t.classIds.length;for(let s=0;s<n;++s)aR(t,s,stack)}function aR(t,e,n){const s=t.parentCounts,r=t.parentIds,i=t.parentIndexes,a=t.classIds.length;if(!On(r))return;assert(e<a,`Parent index ${e} exceeds the total number of instances: ${a}`),assert(n.indexOf(e)===-1,"Circular dependency detected in the batch table hierarchy."),n.push(e);const c=On(s)?s[e]:1,l=On(s)?i[e]:e;for(let u=0;u<c;++u){const h=r[l+u];h!==e&&aR(t,h,n)}n.pop(e)}function ft(t){return t!=null}const fl=(t,e)=>t,AW={HIERARCHY:!0,extensions:!0,extras:!0};class cR{constructor(e,n,s,r={}){p(this,"json");p(this,"binary");p(this,"featureCount");p(this,"_extensions");p(this,"_properties");p(this,"_binaryProperties");p(this,"_hierarchy");var i;de(s>=0),this.json=e||{},this.binary=n,this.featureCount=s,this._extensions=((i=this.json)==null?void 0:i.extensions)||{},this._properties={};for(const o in this.json)AW[o]||(this._properties[o]=this.json[o]);this._binaryProperties=this._initializeBinaryProperties(),r["3DTILES_batch_table_hierarchy"]&&(this._hierarchy=pW(this,this.json,this.binary))}getExtension(e){return this.json&&this.json.extensions&&this.json.extensions[e]}memorySizeInBytes(){return 0}isClass(e,n){if(this._checkBatchId(e),de(typeof n=="string",n),this._hierarchy){const s=Do(this._hierarchy,e,(r,i)=>{const o=r.classIds[i];return r.classes[o].name===n});return ft(s)}return!1}isExactClass(e,n){return de(typeof n=="string",n),this.getExactClassName(e)===n}getExactClassName(e){if(this._checkBatchId(e),this._hierarchy){const n=this._hierarchy.classIds[e];return this._hierarchy.classes[n].name}}hasProperty(e,n){return this._checkBatchId(e),de(typeof n=="string",n),ft(this._properties[n])||this._hasPropertyInHierarchy(e,n)}getPropertyNames(e,n){this._checkBatchId(e),n=ft(n)?n:[],n.length=0;const s=Object.keys(this._properties);return n.push(...s),this._hierarchy&&this._getPropertyNamesInHierarchy(e,n),n}getProperty(e,n){if(this._checkBatchId(e),de(typeof n=="string",n),this._binaryProperties){const r=this._binaryProperties[n];if(ft(r))return this._getBinaryProperty(r,e)}const s=this._properties[n];if(ft(s))return fl(s[e]);if(this._hierarchy){const r=this._getHierarchyProperty(e,n);if(ft(r))return r}}setProperty(e,n,s){const r=this.featureCount;if(this._checkBatchId(e),de(typeof n=="string",n),this._binaryProperties){const o=this._binaryProperties[n];if(o){this._setBinaryProperty(o,e,s);return}}if(this._hierarchy&&this._setHierarchyProperty(this,e,n,s))return;let i=this._properties[n];ft(i)||(this._properties[n]=new Array(r),i=this._properties[n]),i[e]=fl(s)}_checkBatchId(e){if(!(e>=0&&e<this.featureCount))throw new Error("batchId not in range [0, featureCount - 1].")}_getBinaryProperty(e,n){return e.unpack(e.typedArray,n)}_setBinaryProperty(e,n,s){e.pack(s,e.typedArray,n)}_initializeBinaryProperties(){let e=null;for(const n in this._properties){const s=this._properties[n],r=this._initializeBinaryProperty(n,s);r&&(e=e||{},e[n]=r)}return e}_initializeBinaryProperty(e,n){if("byteOffset"in n){const s=n;de(this.binary,`Property ${e} requires a batch table binary.`),de(s.type,`Property ${e} requires a type.`);const r=dW(s,this.binary.buffer,this.binary.byteOffset|0,this.featureCount);return{typedArray:r.values,componentCount:r.size,unpack:r.unpacker,pack:r.packer}}return null}_hasPropertyInHierarchy(e,n){if(!this._hierarchy)return!1;const s=Do(this._hierarchy,e,(r,i)=>{const o=r.classIds[i],a=r.classes[o].instances;return ft(a[n])});return ft(s)}_getPropertyNamesInHierarchy(e,n){Do(this._hierarchy,e,(s,r)=>{const i=s.classIds[r],o=s.classes[i].instances;for(const a in o)o.hasOwnProperty(a)&&n.indexOf(a)===-1&&n.push(a)})}_getHierarchyProperty(e,n){return Do(this._hierarchy,e,(s,r)=>{const i=s.classIds[r],o=s.classes[i],a=s.classIndexes[r],c=o.instances[n];return ft(c)?ft(c.typedArray)?this._getBinaryProperty(c,a):fl(c[a]):null})}_setHierarchyProperty(e,n,s,r){const i=Do(this._hierarchy,n,(o,a)=>{const c=o.classIds[a],l=o.classes[c],u=o.classIndexes[a],h=l.instances[s];return ft(h)?(de(a===n,`Inherited property "${s}" is read-only.`),ft(h.typedArray)?this._setBinaryProperty(h,u,r):h[u]=fl(r),!0):!1});return ft(i)}}const jd=4;function Zh(t,e,n=0){const s=new DataView(e);if(t.magic=s.getUint32(n,!0),n+=jd,t.version=s.getUint32(n,!0),n+=jd,t.byteLength=s.getUint32(n,!0),n+=jd,t.version!==1)throw new Error(`3D Tile Version ${t.version} not supported`);return n}const Qr=4,lS="b3dm tile in legacy format.";function Ym(t,e,n){const s=new DataView(e);let r;t.header=t.header||{};let i=s.getUint32(n,!0);n+=Qr;let o=s.getUint32(n,!0);n+=Qr;let a=s.getUint32(n,!0);n+=Qr;let c=s.getUint32(n,!0);return n+=Qr,a>=570425344?(n-=Qr*2,r=i,a=o,c=0,i=0,o=0,console.warn(lS)):c>=570425344&&(n-=Qr,r=a,a=i,c=o,i=0,o=0,console.warn(lS)),t.header.featureTableJsonByteLength=i,t.header.featureTableBinaryByteLength=o,t.header.batchTableJsonByteLength=a,t.header.batchTableBinaryByteLength=c,t.header.batchLength=r,n}function Jm(t,e,n,s){return n=TW(t,e,n),n=EW(t,e,n),n}function TW(t,e,n,s){const{featureTableJsonByteLength:r,featureTableBinaryByteLength:i,batchLength:o}=t.header||{};if(t.featureTableJson={BATCH_LENGTH:o||0},r&&r>0){const a=oR(e,n,r);t.featureTableJson=JSON.parse(a)}return n+=r||0,t.featureTableBinary=new Uint8Array(e,n,i),n+=i||0,n}function EW(t,e,n,s){const{batchTableJsonByteLength:r,batchTableBinaryByteLength:i}=t.header||{};if(r&&r>0){const o=oR(e,n,r);t.batchTableJson=JSON.parse(o),n+=r,i&&i>0&&(t.batchTableBinary=new Uint8Array(e,n,i),t.batchTableBinary=new Uint8Array(t.batchTableBinary),n+=i)}return n}function lR(t,e,n){if(!e&&(!t||!t.batchIds||!n))return null;const{batchIds:s,isRGB565:r,pointCount:i=0}=t;if(s&&n){const o=new Uint8ClampedArray(i*3);for(let a=0;a<i;a++){const c=s[a],u=n.getProperty(c,"dimensions").map(h=>h*255);o[a*3]=u[0],o[a*3+1]=u[1],o[a*3+2]=u[2]}return{type:te.UNSIGNED_BYTE,value:o,size:3,normalized:!0}}if(e&&r){const o=new Uint8ClampedArray(i*3);for(let a=0;a<i;a++){const c=aW(e[a]);o[a*3]=c[0],o[a*3+1]=c[1],o[a*3+2]=c[2]}return{type:te.UNSIGNED_BYTE,value:o,size:3,normalized:!0}}return e&&e.length===i*3?{type:te.UNSIGNED_BYTE,value:e,size:3,normalized:!0}:{type:te.UNSIGNED_BYTE,value:e||new Uint8ClampedArray,size:4,normalized:!0}}const uS=new x;function SW(t,e){if(!e)return null;if(t.isOctEncoded16P){const n=new Float32Array((t.pointsLength||0)*3);for(let s=0;s<(t.pointsLength||0);s++)lW(e[s*2],e[s*2+1],uS),uS.toArray(n,s*3);return{type:te.FLOAT,size:2,value:n}}return{type:te.FLOAT,size:2,value:e}}function CW(t,e,n){return t.isQuantized?n["3d-tiles"]&&n["3d-tiles"].decodeQuantizedPositions?(t.isQuantized=!1,vW(t,e)):{type:te.UNSIGNED_SHORT,value:e,size:3,normalized:!0}:e}function vW(t,e){const n=new x,s=new Float32Array(t.pointCount*3);for(let r=0;r<t.pointCount;r++)n.set(e[r*3],e[r*3+1],e[r*3+2]).scale(1/t.quantizedRange).multiply(t.quantizedVolumeScale).add(t.quantizedVolumeOffset).toArray(s,r*3);return s}async function wW(t,e,n,s,r){n=Zh(t,e,n),n=Ym(t,e,n),n=Jm(t,e,n),bW(t);const{featureTable:i,batchTable:o}=RW(t);return await BW(t,i,o,s,r),IW(t,i,s),PW(t,i,o),xW(t,i),n}function bW(t){t.attributes={positions:null,colors:null,normals:null,batchIds:null},t.isQuantized=!1,t.isTranslucent=!1,t.isRGB565=!1,t.isOctEncoded16P=!1}function RW(t){const e=new Km(t.featureTableJson,t.featureTableBinary),n=e.getGlobalProperty("POINTS_LENGTH");if(!Number.isFinite(n))throw new Error("POINTS_LENGTH must be defined");e.featuresLength=n,t.featuresLength=n,t.pointsLength=n,t.pointCount=n,t.rtcCenter=e.getGlobalProperty("RTC_CENTER",te.FLOAT,3);const s=MW(t,e);return{featureTable:e,batchTable:s}}function IW(t,e,n){if(t.attributes=t.attributes||{positions:null,colors:null,normals:null,batchIds:null},!t.attributes.positions){if(e.hasProperty("POSITION"))t.attributes.positions=e.getPropertyArray("POSITION",te.FLOAT,3);else if(e.hasProperty("POSITION_QUANTIZED")){const s=e.getPropertyArray("POSITION_QUANTIZED",te.UNSIGNED_SHORT,3);if(t.isQuantized=!0,t.quantizedRange=65536-1,t.quantizedVolumeScale=e.getGlobalProperty("QUANTIZED_VOLUME_SCALE",te.FLOAT,3),!t.quantizedVolumeScale)throw new Error("QUANTIZED_VOLUME_SCALE must be defined for quantized positions.");if(t.quantizedVolumeOffset=e.getGlobalProperty("QUANTIZED_VOLUME_OFFSET",te.FLOAT,3),!t.quantizedVolumeOffset)throw new Error("QUANTIZED_VOLUME_OFFSET must be defined for quantized positions.");t.attributes.positions=CW(t,s,n)}}if(!t.attributes.positions)throw new Error("Either POSITION or POSITION_QUANTIZED must be defined.")}function PW(t,e,n){if(t.attributes=t.attributes||{positions:null,colors:null,normals:null,batchIds:null},!t.attributes.colors){let s=null;e.hasProperty("RGBA")?(s=e.getPropertyArray("RGBA",te.UNSIGNED_BYTE,4),t.isTranslucent=!0):e.hasProperty("RGB")?s=e.getPropertyArray("RGB",te.UNSIGNED_BYTE,3):e.hasProperty("RGB565")&&(s=e.getPropertyArray("RGB565",te.UNSIGNED_SHORT,1),t.isRGB565=!0),t.attributes.colors=lR(t,s,n)}e.hasProperty("CONSTANT_RGBA")&&(t.constantRGBA=e.getGlobalProperty("CONSTANT_RGBA",te.UNSIGNED_BYTE,4))}function xW(t,e){if(t.attributes=t.attributes||{positions:null,colors:null,normals:null,batchIds:null},!t.attributes.normals){let n=null;e.hasProperty("NORMAL")?n=e.getPropertyArray("NORMAL",te.FLOAT,3):e.hasProperty("NORMAL_OCT16P")&&(n=e.getPropertyArray("NORMAL_OCT16P",te.UNSIGNED_BYTE,2),t.isOctEncoded16P=!0),t.attributes.normals=SW(t,n)}}function MW(t,e){let n=null;if(!t.batchIds&&e.hasProperty("BATCH_ID")&&(t.batchIds=e.getPropertyArray("BATCH_ID",te.UNSIGNED_SHORT,1),t.batchIds)){const s=e.getGlobalProperty("BATCH_LENGTH");if(!s)throw new Error("Global property: BATCH_LENGTH must be defined when BATCH_ID is defined.");const{batchTableJson:r,batchTableBinary:i}=t;n=new cR(r,i,s)}return n}async function BW(t,e,n,s,r){let i,o,a;const c=t.batchTableJson&&t.batchTableJson.extensions&&t.batchTableJson.extensions["3DTILES_draco_point_compression"];c&&(a=c.properties);const l=e.getExtension("3DTILES_draco_point_compression");if(l){o=l.properties;const h=l.byteOffset,f=l.byteLength;if(!o||!Number.isFinite(h)||!f)throw new Error("Draco properties, byteOffset, and byteLength must be defined");i=(t.featureTableBinary||[]).slice(h,h+f),t.hasPositions=Number.isFinite(o.POSITION),t.hasColors=Number.isFinite(o.RGB)||Number.isFinite(o.RGBA),t.hasNormals=Number.isFinite(o.NORMAL),t.hasBatchIds=Number.isFinite(o.BATCH_ID),t.isTranslucent=Number.isFinite(o.RGBA)}if(!i)return!0;const u={buffer:i,properties:{...o,...a},featureTableProperties:o,batchTableProperties:a,dequantizeInShader:!1};return await OW(t,u,s,r)}async function OW(t,e,n,s){if(!s)return;const r={...n,draco:{...n==null?void 0:n.draco,extraAttributes:e.batchTableProperties||{}}};delete r["3d-tiles"];const i=await ro(e.buffer,$b,r,s),o=i.attributes.POSITION&&i.attributes.POSITION.value,a=i.attributes.COLOR_0&&i.attributes.COLOR_0.value,c=i.attributes.NORMAL&&i.attributes.NORMAL.value,l=i.attributes.BATCH_ID&&i.attributes.BATCH_ID.value,u=o&&i.attributes.POSITION.value.quantization,h=c&&i.attributes.NORMAL.value.quantization;if(u){const d=i.POSITION.data.quantization,g=d.range;t.quantizedVolumeScale=new x(g,g,g),t.quantizedVolumeOffset=new x(d.minValues),t.quantizedRange=(1<<d.quantizationBits)-1,t.isQuantizedDraco=!0}h&&(t.octEncodedRange=(1<<i.NORMAL.data.quantization.quantizationBits)-1,t.isOctEncodedDraco=!0);const f={};if(e.batchTableProperties)for(const d of Object.keys(e.batchTableProperties))i.attributes[d]&&i.attributes[d].value&&(f[d.toLowerCase()]=i.attributes[d].value);t.attributes={positions:o,colors:lR(t,a,void 0),normals:c,batchIds:l,...f}}const Qg={URI:0,EMBEDDED:1};function uR(t,e,n,s){t.rotateYtoZ=!0;const r=(t.byteOffset||0)+(t.byteLength||0)-n;if(r===0)throw new Error("glTF byte length must be greater than 0.");return t.gltfUpAxis=s!=null&&s["3d-tiles"]&&s["3d-tiles"].assetGltfUpAxis?s["3d-tiles"].assetGltfUpAxis:"Y",t.gltfArrayBuffer=nm(e,n,r),t.gltfByteOffset=0,t.gltfByteLength=r,n%4===0||console.warn(`${t.type}: embedded glb is not aligned to a 4-byte boundary.`),(t.byteOffset||0)+(t.byteLength||0)}async function hR(t,e,n,s){const r=(n==null?void 0:n["3d-tiles"])||{};if(NW(t,e),r.loadGLTF){if(!s)return;if(t.gltfUrl){const{fetch:i}=s,o=await i(t.gltfUrl,n);t.gltfArrayBuffer=await o.arrayBuffer(),t.gltfByteOffset=0}if(t.gltfArrayBuffer){const i=await ro(t.gltfArrayBuffer,Ga,n,s);t.gltf=$m(i),t.gpuMemoryUsageInBytes=Db(t.gltf),delete t.gltfArrayBuffer,delete t.gltfByteOffset,delete t.gltfByteLength}}}function NW(t,e,n){switch(e){case Qg.URI:if(t.gltfArrayBuffer){const s=new Uint8Array(t.gltfArrayBuffer,t.gltfByteOffset),i=new TextDecoder().decode(s);t.gltfUrl=i.replace(/[\s\0]+$/,"")}delete t.gltfArrayBuffer,delete t.gltfByteOffset,delete t.gltfByteLength;break;case Qg.EMBEDDED:break;default:throw new Error("b3dm: Illegal glTF format field")}}async function FW(t,e,n,s,r){var o;n=DW(t,e,n,s),await hR(t,Qg.EMBEDDED,s,r);const i=(o=t==null?void 0:t.gltf)==null?void 0:o.extensions;return i&&i.CESIUM_RTC&&(t.rtcCenter=i.CESIUM_RTC.center),n}function DW(t,e,n,s,r){n=Zh(t,e,n),n=Ym(t,e,n),n=Jm(t,e,n),n=uR(t,e,n,s);const i=new Km(t.featureTableJson,t.featureTableBinary);return t.rtcCenter=i.getGlobalProperty("RTC_CENTER",te.FLOAT,3),n}async function LW(t,e,n,s,r){return n=UW(t,e,n,s),await hR(t,t.gltfFormat||0,s,r),n}function UW(t,e,n,s,r){var l;if(n=Zh(t,e,n),t.version!==1)throw new Error(`Instanced 3D Model version ${t.version} is not supported`);n=Ym(t,e,n);const i=new DataView(e);if(t.gltfFormat=i.getUint32(n,!0),n+=4,n=Jm(t,e,n),n=uR(t,e,n,s),!((l=t==null?void 0:t.header)!=null&&l.featureTableJsonByteLength)||t.header.featureTableJsonByteLength===0)throw new Error("i3dm parser: featureTableJsonByteLength is zero.");const o=new Km(t.featureTableJson,t.featureTableBinary),a=o.getGlobalProperty("INSTANCES_LENGTH");if(o.featuresLength=a,!Number.isFinite(a))throw new Error("i3dm parser: INSTANCES_LENGTH must be defined");t.eastNorthUp=o.getGlobalProperty("EAST_NORTH_UP"),t.rtcCenter=o.getGlobalProperty("RTC_CENTER",te.FLOAT,3);const c=new cR(t.batchTableJson,t.batchTableBinary,a);return kW(t,o,c,a),n}function kW(t,e,n,s){const r=new Array(s),i=new x;new x,new x,new x;const o=new Ie,a=new Fa,c=new x,l={},u=new q,h=[],f=[],d=[],g=[];for(let _=0;_<s;_++){let E;if(e.hasProperty("POSITION"))E=e.getProperty("POSITION",te.FLOAT,3,_,i);else if(e.hasProperty("POSITION_QUANTIZED")){E=e.getProperty("POSITION_QUANTIZED",te.UNSIGNED_SHORT,3,_,i);const P=e.getGlobalProperty("QUANTIZED_VOLUME_OFFSET",te.FLOAT,3);if(!P)throw new Error("i3dm parser: QUANTIZED_VOLUME_OFFSET must be defined for quantized positions.");const B=e.getGlobalProperty("QUANTIZED_VOLUME_SCALE",te.FLOAT,3);if(!B)throw new Error("i3dm parser: QUANTIZED_VOLUME_SCALE must be defined for quantized positions.");const O=65535;for(let N=0;N<3;N++)E[N]=E[N]/O*B[N]+P[N]}if(!E)throw new Error("i3dm: POSITION or POSITION_QUANTIZED must be defined for each instance.");if(i.copy(E),l.translation=i,t.normalUp=e.getProperty("NORMAL_UP",te.FLOAT,3,_,h),t.normalRight=e.getProperty("NORMAL_RIGHT",te.FLOAT,3,_,f),t.normalUp){if(!t.normalRight)throw new Error("i3dm: Custom orientation requires both NORMAL_UP and NORMAL_RIGHT.");t.hasCustomOrientation=!0}else{if(t.octNormalUp=e.getProperty("NORMAL_UP_OCT32P",te.UNSIGNED_SHORT,2,_,h),t.octNormalRight=e.getProperty("NORMAL_RIGHT_OCT32P",te.UNSIGNED_SHORT,2,_,f),t.octNormalUp)throw t.octNormalRight?new Error("i3dm: oct-encoded orientation not implemented"):new Error("i3dm: oct-encoded orientation requires NORMAL_UP_OCT32P and NORMAL_RIGHT_OCT32P");t.eastNorthUp?(pe.WGS84.eastNorthUpToFixedFrame(i,u),u.getRotationMatrix3(o)):o.identity()}a.fromMatrix3(o),l.rotation=a,c.set(1,1,1);const m=e.getProperty("SCALE",te.FLOAT,1,_,d);Number.isFinite(m)&&c.multiplyByScalar(m);const y=e.getProperty("SCALE_NON_UNIFORM",te.FLOAT,3,_,h);y&&c.scale(y),l.scale=c;let A=e.getProperty("BATCH_ID",te.UNSIGNED_SHORT,1,_,g);A===void 0&&(A=_);const C=new q().fromQuaternion(l.rotation);u.identity(),u.translate(l.translation),u.multiplyRight(C),u.scale(l.scale);const b=u.clone();r[_]={modelMatrix:b,batchId:A}}t.instances=r}async function zW(t,e,n,s,r,i){n=Zh(t,e,n);const o=new DataView(e);for(t.tilesLength=o.getUint32(n,!0),n+=4,t.tiles=[];t.tiles.length<t.tilesLength&&(t.byteLength||0)-n>12;){const a={shape:"tile3d"};t.tiles.push(a),n=await i(e,n,s,r,a)}return n}async function VW(t,e,n,s){var r,i;if(t.rotateYtoZ=!0,t.gltfUpAxis=(r=n==null?void 0:n["3d-tiles"])!=null&&r.assetGltfUpAxis?n["3d-tiles"].assetGltfUpAxis:"Y",(i=n==null?void 0:n["3d-tiles"])!=null&&i.loadGLTF){if(!s)return e.byteLength;const o=await ro(e,Ga,n,s);t.gltf=$m(o),t.gpuMemoryUsageInBytes=Db(t.gltf)}else t.gltfArrayBuffer=e;return e.byteLength}async function fR(t,e=0,n,s,r={shape:"tile3d"}){switch(r.byteOffset=e,r.type=sW(t,e),r.type){case Fo.COMPOSITE:return await zW(r,t,e,n,s,fR);case Fo.BATCHED_3D_MODEL:return await FW(r,t,e,n,s);case Fo.GLTF:return await VW(r,t,n,s);case Fo.INSTANCED_3D_MODEL:return await LW(r,t,e,n,s);case Fo.POINT_CLOUD:return await wW(r,t,e,n,s);default:throw new Error(`3DTileLoader: unknown type ${r.type}`)}}const HW=1952609651,jW=1;async function WW(t,e,n){if(new Uint32Array(t.slice(0,4))[0]!==HW)throw new Error("Wrong subtree file magic number");if(new Uint32Array(t.slice(4,8))[0]!==jW)throw new Error("Wrong subtree file verson, must be 1");const i=hS(t.slice(8,16)),o=new Uint8Array(t,24,i),c=new TextDecoder("utf8").decode(o),l=JSON.parse(c),u=hS(t.slice(16,24));let h=new ArrayBuffer(0);if(u&&(h=t.slice(24+i)),await dl(l,l.tileAvailability,h,n),Array.isArray(l.contentAvailability))for(const f of l.contentAvailability)await dl(l,f,h,n);else await dl(l,l.contentAvailability,h,n);return await dl(l,l.childSubtreeAvailability,h,n),l}async function dl(t,e,n,s){const r=Number.isFinite(e.bitstream)?e.bitstream:e.bufferView;if(typeof r!="number")return;const i=t.bufferViews[r],o=t.buffers[i.buffer];if(!(s!=null&&s.baseUrl))throw new Error("Url is not provided");if(!s.fetch)throw new Error("fetch is not provided");if(o.uri){const c=`${(s==null?void 0:s.baseUrl)||""}/${o.uri}`,u=await(await s.fetch(c)).arrayBuffer();e.explicitBitstream=new Uint8Array(u,i.byteOffset,i.byteLength);return}const a=t.buffers.slice(0,i.buffer).reduce((c,l)=>c+l.byteLength,0);e.explicitBitstream=new Uint8Array(n.slice(a,a+o.byteLength),i.byteOffset,i.byteLength)}function hS(t){const e=new DataView(t),n=e.getUint32(0,!0),s=e.getUint32(4,!0);return n+2**32*s}const dR={dataType:null,batchType:null,id:"3d-tiles-subtree",name:"3D Tiles Subtree",module:"3d-tiles",version:iR,extensions:["subtree"],mimeTypes:["application/octet-stream"],tests:["subtree"],parse:WW,options:{}};/**
 * @license
 * Copyright 2009 The Closure Library Authors
 * Copyright 2020 Daniel Wirtz / The long.js Authors.
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *     http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 *
 * SPDX-License-Identifier: Apache-2.0
 */var Ht=null;try{Ht=new WebAssembly.Instance(new WebAssembly.Module(new Uint8Array([0,97,115,109,1,0,0,0,1,13,2,96,0,1,127,96,4,127,127,127,127,1,127,3,7,6,0,1,1,1,1,1,6,6,1,127,1,65,0,11,7,50,6,3,109,117,108,0,1,5,100,105,118,95,115,0,2,5,100,105,118,95,117,0,3,5,114,101,109,95,115,0,4,5,114,101,109,95,117,0,5,8,103,101,116,95,104,105,103,104,0,0,10,191,1,6,4,0,35,0,11,36,1,1,126,32,0,173,32,1,173,66,32,134,132,32,2,173,32,3,173,66,32,134,132,126,34,4,66,32,135,167,36,0,32,4,167,11,36,1,1,126,32,0,173,32,1,173,66,32,134,132,32,2,173,32,3,173,66,32,134,132,127,34,4,66,32,135,167,36,0,32,4,167,11,36,1,1,126,32,0,173,32,1,173,66,32,134,132,32,2,173,32,3,173,66,32,134,132,128,34,4,66,32,135,167,36,0,32,4,167,11,36,1,1,126,32,0,173,32,1,173,66,32,134,132,32,2,173,32,3,173,66,32,134,132,129,34,4,66,32,135,167,36,0,32,4,167,11,36,1,1,126,32,0,173,32,1,173,66,32,134,132,32,2,173,32,3,173,66,32,134,132,130,34,4,66,32,135,167,36,0,32,4,167,11])),{}).exports}catch{}function le(t,e,n){this.low=t|0,this.high=e|0,this.unsigned=!!n}le.prototype.__isLong__;Object.defineProperty(le.prototype,"__isLong__",{value:!0});function rt(t){return(t&&t.__isLong__)===!0}function fS(t){var e=Math.clz32(t&-t);return t?31-e:e}le.isLong=rt;var dS={},pS={};function Vr(t,e){var n,s,r;return e?(t>>>=0,(r=0<=t&&t<256)&&(s=pS[t],s)?s:(n=re(t,0,!0),r&&(pS[t]=n),n)):(t|=0,(r=-128<=t&&t<128)&&(s=dS[t],s)?s:(n=re(t,t<0?-1:0,!1),r&&(dS[t]=n),n))}le.fromInt=Vr;function jt(t,e){if(isNaN(t))return e?Qn:dn;if(e){if(t<0)return Qn;if(t>=pR)return mR}else{if(t<=-_S)return mt;if(t+1>=_S)return _R}return t<0?jt(-t,e).neg():re(t%eo|0,t/eo|0,e)}le.fromNumber=jt;function re(t,e,n){return new le(t,e,n)}le.fromBits=re;var Lu=Math.pow;function qm(t,e,n){if(t.length===0)throw Error("empty string");if(typeof e=="number"?(n=e,e=!1):e=!!e,t==="NaN"||t==="Infinity"||t==="+Infinity"||t==="-Infinity")return e?Qn:dn;if(n=n||10,n<2||36<n)throw RangeError("radix");var s;if((s=t.indexOf("-"))>0)throw Error("interior hyphen");if(s===0)return qm(t.substring(1),e,n).neg();for(var r=jt(Lu(n,8)),i=dn,o=0;o<t.length;o+=8){var a=Math.min(8,t.length-o),c=parseInt(t.substring(o,o+a),n);if(a<8){var l=jt(Lu(n,a));i=i.mul(l).add(jt(c))}else i=i.mul(r),i=i.add(jt(c))}return i.unsigned=e,i}le.fromString=qm;function An(t,e){return typeof t=="number"?jt(t,e):typeof t=="string"?qm(t,e):re(t.low,t.high,typeof e=="boolean"?e:t.unsigned)}le.fromValue=An;var gS=65536,GW=1<<24,eo=gS*gS,pR=eo*eo,_S=pR/2,mS=Vr(GW),dn=Vr(0);le.ZERO=dn;var Qn=Vr(0,!0);le.UZERO=Qn;var wi=Vr(1);le.ONE=wi;var gR=Vr(1,!0);le.UONE=gR;var e_=Vr(-1);le.NEG_ONE=e_;var _R=re(-1,2147483647,!1);le.MAX_VALUE=_R;var mR=re(-1,-1,!0);le.MAX_UNSIGNED_VALUE=mR;var mt=re(0,-2147483648,!1);le.MIN_VALUE=mt;var z=le.prototype;z.toInt=function(){return this.unsigned?this.low>>>0:this.low};z.toNumber=function(){return this.unsigned?(this.high>>>0)*eo+(this.low>>>0):this.high*eo+(this.low>>>0)};z.toString=function(e){if(e=e||10,e<2||36<e)throw RangeError("radix");if(this.isZero())return"0";if(this.isNegative())if(this.eq(mt)){var n=jt(e),s=this.div(n),r=s.mul(n).sub(this);return s.toString(e)+r.toInt().toString(e)}else return"-"+this.neg().toString(e);for(var i=jt(Lu(e,6),this.unsigned),o=this,a="";;){var c=o.div(i),l=o.sub(c.mul(i)).toInt()>>>0,u=l.toString(e);if(o=c,o.isZero())return u+a;for(;u.length<6;)u="0"+u;a=""+u+a}};z.getHighBits=function(){return this.high};z.getHighBitsUnsigned=function(){return this.high>>>0};z.getLowBits=function(){return this.low};z.getLowBitsUnsigned=function(){return this.low>>>0};z.getNumBitsAbs=function(){if(this.isNegative())return this.eq(mt)?64:this.neg().getNumBitsAbs();for(var e=this.high!=0?this.high:this.low,n=31;n>0&&!(e&1<<n);n--);return this.high!=0?n+33:n+1};z.isZero=function(){return this.high===0&&this.low===0};z.eqz=z.isZero;z.isNegative=function(){return!this.unsigned&&this.high<0};z.isPositive=function(){return this.unsigned||this.high>=0};z.isOdd=function(){return(this.low&1)===1};z.isEven=function(){return(this.low&1)===0};z.equals=function(e){return rt(e)||(e=An(e)),this.unsigned!==e.unsigned&&this.high>>>31===1&&e.high>>>31===1?!1:this.high===e.high&&this.low===e.low};z.eq=z.equals;z.notEquals=function(e){return!this.eq(e)};z.neq=z.notEquals;z.ne=z.notEquals;z.lessThan=function(e){return this.comp(e)<0};z.lt=z.lessThan;z.lessThanOrEqual=function(e){return this.comp(e)<=0};z.lte=z.lessThanOrEqual;z.le=z.lessThanOrEqual;z.greaterThan=function(e){return this.comp(e)>0};z.gt=z.greaterThan;z.greaterThanOrEqual=function(e){return this.comp(e)>=0};z.gte=z.greaterThanOrEqual;z.ge=z.greaterThanOrEqual;z.compare=function(e){if(rt(e)||(e=An(e)),this.eq(e))return 0;var n=this.isNegative(),s=e.isNegative();return n&&!s?-1:!n&&s?1:this.unsigned?e.high>>>0>this.high>>>0||e.high===this.high&&e.low>>>0>this.low>>>0?-1:1:this.sub(e).isNegative()?-1:1};z.comp=z.compare;z.negate=function(){return!this.unsigned&&this.eq(mt)?mt:this.not().add(wi)};z.neg=z.negate;z.add=function(e){rt(e)||(e=An(e));var n=this.high>>>16,s=this.high&65535,r=this.low>>>16,i=this.low&65535,o=e.high>>>16,a=e.high&65535,c=e.low>>>16,l=e.low&65535,u=0,h=0,f=0,d=0;return d+=i+l,f+=d>>>16,d&=65535,f+=r+c,h+=f>>>16,f&=65535,h+=s+a,u+=h>>>16,h&=65535,u+=n+o,u&=65535,re(f<<16|d,u<<16|h,this.unsigned)};z.subtract=function(e){return rt(e)||(e=An(e)),this.add(e.neg())};z.sub=z.subtract;z.multiply=function(e){if(this.isZero())return this;if(rt(e)||(e=An(e)),Ht){var n=Ht.mul(this.low,this.high,e.low,e.high);return re(n,Ht.get_high(),this.unsigned)}if(e.isZero())return this.unsigned?Qn:dn;if(this.eq(mt))return e.isOdd()?mt:dn;if(e.eq(mt))return this.isOdd()?mt:dn;if(this.isNegative())return e.isNegative()?this.neg().mul(e.neg()):this.neg().mul(e).neg();if(e.isNegative())return this.mul(e.neg()).neg();if(this.lt(mS)&&e.lt(mS))return jt(this.toNumber()*e.toNumber(),this.unsigned);var s=this.high>>>16,r=this.high&65535,i=this.low>>>16,o=this.low&65535,a=e.high>>>16,c=e.high&65535,l=e.low>>>16,u=e.low&65535,h=0,f=0,d=0,g=0;return g+=o*u,d+=g>>>16,g&=65535,d+=i*u,f+=d>>>16,d&=65535,d+=o*l,f+=d>>>16,d&=65535,f+=r*u,h+=f>>>16,f&=65535,f+=i*l,h+=f>>>16,f&=65535,f+=o*c,h+=f>>>16,f&=65535,h+=s*u+r*l+i*c+o*a,h&=65535,re(d<<16|g,h<<16|f,this.unsigned)};z.mul=z.multiply;z.divide=function(e){if(rt(e)||(e=An(e)),e.isZero())throw Error("division by zero");if(Ht){if(!this.unsigned&&this.high===-2147483648&&e.low===-1&&e.high===-1)return this;var n=(this.unsigned?Ht.div_u:Ht.div_s)(this.low,this.high,e.low,e.high);return re(n,Ht.get_high(),this.unsigned)}if(this.isZero())return this.unsigned?Qn:dn;var s,r,i;if(this.unsigned){if(e.unsigned||(e=e.toUnsigned()),e.gt(this))return Qn;if(e.gt(this.shru(1)))return gR;i=Qn}else{if(this.eq(mt)){if(e.eq(wi)||e.eq(e_))return mt;if(e.eq(mt))return wi;var o=this.shr(1);return s=o.div(e).shl(1),s.eq(dn)?e.isNegative()?wi:e_:(r=this.sub(e.mul(s)),i=s.add(r.div(e)),i)}else if(e.eq(mt))return this.unsigned?Qn:dn;if(this.isNegative())return e.isNegative()?this.neg().div(e.neg()):this.neg().div(e).neg();if(e.isNegative())return this.div(e.neg()).neg();i=dn}for(r=this;r.gte(e);){s=Math.max(1,Math.floor(r.toNumber()/e.toNumber()));for(var a=Math.ceil(Math.log(s)/Math.LN2),c=a<=48?1:Lu(2,a-48),l=jt(s),u=l.mul(e);u.isNegative()||u.gt(r);)s-=c,l=jt(s,this.unsigned),u=l.mul(e);l.isZero()&&(l=wi),i=i.add(l),r=r.sub(u)}return i};z.div=z.divide;z.modulo=function(e){if(rt(e)||(e=An(e)),Ht){var n=(this.unsigned?Ht.rem_u:Ht.rem_s)(this.low,this.high,e.low,e.high);return re(n,Ht.get_high(),this.unsigned)}return this.sub(this.div(e).mul(e))};z.mod=z.modulo;z.rem=z.modulo;z.not=function(){return re(~this.low,~this.high,this.unsigned)};z.countLeadingZeros=function(){return this.high?Math.clz32(this.high):Math.clz32(this.low)+32};z.clz=z.countLeadingZeros;z.countTrailingZeros=function(){return this.low?fS(this.low):fS(this.high)+32};z.ctz=z.countTrailingZeros;z.and=function(e){return rt(e)||(e=An(e)),re(this.low&e.low,this.high&e.high,this.unsigned)};z.or=function(e){return rt(e)||(e=An(e)),re(this.low|e.low,this.high|e.high,this.unsigned)};z.xor=function(e){return rt(e)||(e=An(e)),re(this.low^e.low,this.high^e.high,this.unsigned)};z.shiftLeft=function(e){return rt(e)&&(e=e.toInt()),(e&=63)===0?this:e<32?re(this.low<<e,this.high<<e|this.low>>>32-e,this.unsigned):re(0,this.low<<e-32,this.unsigned)};z.shl=z.shiftLeft;z.shiftRight=function(e){return rt(e)&&(e=e.toInt()),(e&=63)===0?this:e<32?re(this.low>>>e|this.high<<32-e,this.high>>e,this.unsigned):re(this.high>>e-32,this.high>=0?0:-1,this.unsigned)};z.shr=z.shiftRight;z.shiftRightUnsigned=function(e){return rt(e)&&(e=e.toInt()),(e&=63)===0?this:e<32?re(this.low>>>e|this.high<<32-e,this.high>>>e,this.unsigned):e===32?re(this.high,0,this.unsigned):re(this.high>>>e-32,0,this.unsigned)};z.shru=z.shiftRightUnsigned;z.shr_u=z.shiftRightUnsigned;z.rotateLeft=function(e){var n;return rt(e)&&(e=e.toInt()),(e&=63)===0?this:e===32?re(this.high,this.low,this.unsigned):e<32?(n=32-e,re(this.low<<e|this.high>>>n,this.high<<e|this.low>>>n,this.unsigned)):(e-=32,n=32-e,re(this.high<<e|this.low>>>n,this.low<<e|this.high>>>n,this.unsigned))};z.rotl=z.rotateLeft;z.rotateRight=function(e){var n;return rt(e)&&(e=e.toInt()),(e&=63)===0?this:e===32?re(this.high,this.low,this.unsigned):e<32?(n=32-e,re(this.high<<n|this.low>>>e,this.low<<n|this.high>>>e,this.unsigned)):(e-=32,n=32-e,re(this.low<<n|this.high>>>e,this.high<<n|this.low>>>e,this.unsigned))};z.rotr=z.rotateRight;z.toSigned=function(){return this.unsigned?re(this.low,this.high,!1):this};z.toUnsigned=function(){return this.unsigned?this:re(this.low,this.high,!0)};z.toBytes=function(e){return e?this.toBytesLE():this.toBytesBE()};z.toBytesLE=function(){var e=this.high,n=this.low;return[n&255,n>>>8&255,n>>>16&255,n>>>24,e&255,e>>>8&255,e>>>16&255,e>>>24]};z.toBytesBE=function(){var e=this.high,n=this.low;return[e>>>24,e>>>16&255,e>>>8&255,e&255,n>>>24,n>>>16&255,n>>>8&255,n&255]};le.fromBytes=function(e,n,s){return s?le.fromBytesLE(e,n):le.fromBytesBE(e,n)};le.fromBytesLE=function(e,n){return new le(e[0]|e[1]<<8|e[2]<<16|e[3]<<24,e[4]|e[5]<<8|e[6]<<16|e[7]<<24,n)};le.fromBytesBE=function(e,n){return new le(e[4]<<24|e[5]<<16|e[6]<<8|e[7],e[0]<<24|e[1]<<16|e[2]<<8|e[3],n)};const XW=16;function yR(t){t==="X"&&(t="");const e=t.padEnd(XW,"0");return le.fromString(e,!0,16)}function $W(t){if(t.isZero())return"X";let e=t.countTrailingZeros();const n=e%4;e=(e-n)/4;const s=e;e*=4;const i=t.shiftRightUnsigned(e).toString(16).replace(/0+$/,"");return Array(17-s-i.length).join("0")+i}function KW(t,e){const n=YW(t).shiftRightUnsigned(2);return t.add(le.fromNumber(2*e+1-4).multiply(n))}function YW(t){return t.and(t.not().add(1))}const JW=3,qW=30,ZW=2*qW+1,yS=180/Math.PI;function QW(t){if(t.length===0)throw new Error(`Invalid Hilbert quad key ${t}`);const e=t.split("/"),n=parseInt(e[0],10),s=e[1],r=s.length;let i=0;const o=[0,0];for(let a=r-1;a>=0;a--){i=r-a;const c=s[a];let l=0,u=0;c==="1"?u=1:c==="2"?(l=1,u=1):c==="3"&&(l=1);const h=Math.pow(2,i-1);tG(h,o,l,u),o[0]+=h*l,o[1]+=h*u}if(n%2===1){const a=o[0];o[0]=o[1],o[1]=a}return{face:n,ij:o,level:i}}function eG(t){if(t.isZero())return"";let e=t.toString(2);for(;e.length<JW+ZW;)e="0"+e;const n=e.lastIndexOf("1"),s=e.substring(0,3),r=e.substring(3,n),i=r.length/2,o=le.fromString(s,!0,2).toString(10);let a="";if(i!==0)for(a=le.fromString(r,!0,2).toString(4);a.length<i;)a="0"+a;return`${o}/${a}`}function AR(t,e,n){const s=1<<e;return[(t[0]+n[0])/s,(t[1]+n[1])/s]}function AS(t){return t>=.5?1/3*(4*t*t-1):1/3*(1-4*(1-t)*(1-t))}function TR(t){return[AS(t[0]),AS(t[1])]}function ER(t,[e,n]){switch(t){case 0:return[1,e,n];case 1:return[-e,1,n];case 2:return[-e,-n,1];case 3:return[-1,-n,-e];case 4:return[n,-1,-e];case 5:return[n,e,-1];default:throw new Error("Invalid face")}}function SR([t,e,n]){const s=Math.atan2(n,Math.sqrt(t*t+e*e));return[Math.atan2(e,t)*yS,s*yS]}function tG(t,e,n,s){if(s===0){n===1&&(e[0]=t-1-e[0],e[1]=t-1-e[1]);const r=e[0];e[0]=e[1],e[1]=r}}function nG(t){const e=AR(t.ij,t.level,[.5,.5]),n=TR(e),s=ER(t.face,n);return SR(s)}const sG=100;function TS(t){const{face:e,ij:n,level:s}=t,r=[[0,0],[0,1],[1,1],[1,0],[0,0]],i=Math.max(1,Math.ceil(sG*Math.pow(2,-s))),o=new Float64Array(4*i*2+2);let a=0,c=0;for(let l=0;l<4;l++){const u=r[l].slice(0),h=r[l+1],f=(h[0]-u[0])/i,d=(h[1]-u[1])/i;for(let g=0;g<i;g++){u[0]+=f,u[1]+=d;const _=AR(n,s,u),E=TR(_),m=ER(e,E),y=SR(m);Math.abs(y[1])>89.999&&(y[0]=c);const A=y[0]-c;y[0]+=A>180?-360:A<-180?360:0,o[a++]=y[0],o[a++]=y[1],c=y[0]}}return o[a++]=o[0],o[a++]=o[1],o}function Zm(t){const e=rG(t);return QW(e)}function rG(t){if(t.indexOf("/")>0)return t;const e=yR(t);return eG(e)}function iG(t){const e=Zm(t);return nG(e)}function oG(t){let e;if(t.face===2||t.face===5){let n=null,s=0;for(let r=0;r<4;r++){const i=`${t.face}/${r}`,o=Zm(i),a=TS(o);(typeof n>"u"||n===null)&&(n=new Float64Array(4*a.length)),n.set(a,s),s+=a.length}e=ES(n)}else{const n=TS(t);e=ES(n)}return e}function ES(t){if(t.length%2!==0)throw new Error("Invalid corners");const e=[],n=[];for(let s=0;s<t.length;s+=2)e.push(t[s]),n.push(t[s+1]);return e.sort((s,r)=>s-r),n.sort((s,r)=>s-r),{west:e[0],east:e[e.length-1],north:n[n.length-1],south:n[0]}}function aG(t,e){const n=(e==null?void 0:e.minimumHeight)||0,s=(e==null?void 0:e.maximumHeight)||0,r=Zm(t),i=oG(r),o=i.west,a=i.south,c=i.east,l=i.north,u=[];return u.push(new x(o,l,n)),u.push(new x(c,l,n)),u.push(new x(c,a,n)),u.push(new x(o,a,n)),u.push(new x(o,l,s)),u.push(new x(c,l,s)),u.push(new x(c,a,s)),u.push(new x(o,a,s)),u}function CR(t){const e=t.token,n={minimumHeight:t.minimumHeight,maximumHeight:t.maximumHeight},s=aG(e,n),r=iG(e),i=r[0],o=r[1],a=pe.WGS84.cartographicToCartesian([i,o,n.maximumHeight]),c=new x(a[0],a[1],a[2]);s.push(c);const l=Cb(s);return[...l.center,...l.halfAxes]}const cG=4,lG=8,uG={QUADTREE:cG,OCTREE:lG};function hG(t,e,n){if(t!=null&&t.box){const s=yR(t.s2VolumeInfo.token),r=KW(s,e),i=$W(r),o={...t.s2VolumeInfo};switch(o.token=i,n){case"OCTREE":const l=t.s2VolumeInfo,u=l.maximumHeight-l.minimumHeight,h=u/2,f=l.minimumHeight+u/2;l.minimumHeight=f-h,l.maximumHeight=f+h;break}return{box:CR(o),s2VolumeInfo:o}}}async function vR(t){const{implicitOptions:e,parentData:n={mortonIndex:0,x:0,y:0,z:0},childIndex:s=0,s2VolumeBox:r,loaderOptions:i}=t;let{subtree:o,level:a=0,globalData:c={level:0,mortonIndex:0,x:0,y:0,z:0}}=t;const{subdivisionScheme:l,subtreeLevels:u,maximumLevel:h,contentUrlTemplate:f,subtreesUriTemplate:d,basePath:g}=e,_={children:[],lodMetricValue:0,contentUrl:""};if(!h)return $1.once(`Missing 'maximumLevel' or 'availableLevels' property. The subtree ${f} won't be loaded...`),_;const E=a+c.level;if(E>h)return _;const m=uG[l],y=Math.log2(m),A=s&1,C=s>>1&1,b=s>>2&1,P=(m**a-1)/(m-1);let B=ir(n.mortonIndex,s,y),O=P+B,N=ir(n.x,A,1),F=ir(n.y,C,1),H=ir(n.z,b,1),X=!1;a>=u&&(X=Wd(o.childSubtreeAvailability,B));const G=ir(c.x,N,a),$=ir(c.y,F,a),Te=ir(c.z,H,a);if(X){const Y=`${g}/${d}`,se=t_(Y,E,G,$,Te);o=await os(se,dR,i),c={mortonIndex:B,x:N,y:F,z:H,level:a},B=0,O=0,N=0,F=0,H=0,a=0}if(!Wd(o.tileAvailability,O))return _;Wd(o.contentAvailability,O)&&(_.contentUrl=t_(f,E,G,$,Te));const V=a+1,K={mortonIndex:B,x:N,y:F,z:H};for(let Y=0;Y<m;Y++){const se=hG(r,Y,l),ae=await vR({subtree:o,implicitOptions:e,loaderOptions:i,parentData:K,childIndex:Y,level:V,globalData:{...c},s2VolumeBox:se});if(ae.contentUrl||ae.children.length){const us=E+1,Qs=fG(ae,us,{childTileX:N,childTileY:F,childTileZ:H},e,r);_.children.push(Qs)}}return _}function Wd(t,e){let n;return Array.isArray(t)?(n=t[0],t.length>1&&$1.once('Not supported extension "3DTILES_multiple_contents" has been detected')):n=t,"constant"in n?!!n.constant:n.explicitBitstream?gG(e,n.explicitBitstream):!1}function fG(t,e,n,s,r){const{basePath:i,refine:o,getRefine:a,lodMetricType:c,getTileType:l,rootLodMetricValue:u,rootBoundingVolume:h}=s,f=t.contentUrl&&t.contentUrl.replace(`${i}/`,""),d=u/2**e,g=r!=null&&r.box?{box:r.box}:h,_=dG(e,g,n);return{children:t.children,contentUrl:t.contentUrl,content:{uri:f},id:t.contentUrl,refine:a(o),type:l(t),lodMetricType:c,lodMetricValue:d,geometricError:d,transform:t.transform,boundingVolume:_}}function dG(t,e,n){if(e.region){const{childTileX:s,childTileY:r,childTileZ:i}=n,[o,a,c,l,u,h]=e.region,f=2**t,d=(c-o)/f,g=(l-a)/f,_=(h-u)/f,[E,m]=[o+d*s,o+d*(s+1)],[y,A]=[a+g*r,a+g*(r+1)],[C,b]=[u+_*i,u+_*(i+1)];return{region:[E,y,m,A,C,b]}}if(e.box)return e;throw new Error(`Unsupported bounding volume type ${JSON.stringify(e)}`)}function ir(t,e,n){return(t<<n)+e}function t_(t,e,n,s,r){const i=pG({level:e,x:n,y:s,z:r});return t.replace(/{level}|{x}|{y}|{z}/gi,o=>i[o])}function pG(t){const e={};for(const n in t)e[`{${n}}`]=t[n];return e}function gG(t,e){const n=Math.floor(t/8),s=t%8;return(e[n]>>s&1)===1}function Qm(t,e=""){if(!e)return Zn.EMPTY;const s=e.split("?")[0].split(".").pop();switch(s){case"pnts":return Zn.POINTCLOUD;case"i3dm":case"b3dm":case"glb":case"gltf":return Zn.SCENEGRAPH;default:return s||Zn.EMPTY}}function ey(t){switch(t){case"REPLACE":case"replace":return _n.REPLACE;case"ADD":case"add":return _n.ADD;default:return t}}function n_(t,e){if(/^[a-z][0-9a-z+.-]*:/i.test(e)){const s=new URL(t,`${e}/`);return decodeURI(s.toString())}else if(t.startsWith("/"))return t;return Tx(e,t)}function SS(t,e){var r;if(!t)return null;let n;if(t.content){const i=t.content.uri||((r=t.content)==null?void 0:r.url);typeof i<"u"&&(n=n_(i,e))}return{...t,id:n,contentUrl:n,lodMetricType:Qi.GEOMETRIC_ERROR,lodMetricValue:t.geometricError,transformMatrix:t.transform,type:Qm(t,n),refine:ey(t.refine)}}async function _G(t,e,n){let s=null;const r=vS(t.root);r&&t.root?s=await CS(t.root,t,e,r,n):s=SS(t.root,e);const i=[];for(i.push(s);i.length>0;){const o=i.pop()||{},a=o.children||[],c=[];for(const l of a){const u=vS(l);let h;u?h=await CS(l,t,e,u,n):h=SS(l,e),h&&(c.push(h),i.push(h))}o.children=c}return s}async function CS(t,e,n,s,r){var C,b,P;const{subdivisionScheme:i,maximumLevel:o,availableLevels:a,subtreeLevels:c,subtrees:{uri:l}}=s,u=t_(l,0,0,0,0),h=n_(u,n),f=await os(h,dR,r),d=(C=t.content)==null?void 0:C.uri,g=d?n_(d,n):"",_=(b=e==null?void 0:e.root)==null?void 0:b.refine,E=t.geometricError,m=(P=t.boundingVolume.extensions)==null?void 0:P["3DTILES_bounding_volume_S2"];if(m){const O={box:CR(m),s2VolumeInfo:m};t.boundingVolume=O}const y=t.boundingVolume,A={contentUrlTemplate:g,subtreesUriTemplate:l,subdivisionScheme:i,subtreeLevels:c,maximumLevel:Number.isFinite(a)?a-1:o,refine:_,basePath:n,lodMetricType:Qi.GEOMETRIC_ERROR,rootLodMetricValue:E,rootBoundingVolume:y,getTileType:Qm,getRefine:ey};return await mG(t,n,f,A,r)}async function mG(t,e,n,s,r){if(!t)return null;const{children:i,contentUrl:o}=await vR({subtree:n,implicitOptions:s,loaderOptions:r});let a,c=null;return o&&(a=o,c={uri:o.replace(`${e}/`,"")}),{...t,id:a,contentUrl:a,lodMetricType:Qi.GEOMETRIC_ERROR,lodMetricValue:t.geometricError,transformMatrix:t.transform,type:Qm(t,a),refine:ey(t.refine),content:c||t.content,children:i}}function vS(t){var e;return((e=t==null?void 0:t.extensions)==null?void 0:e["3DTILES_implicit_tiling"])||(t==null?void 0:t.implicitTiling)}const wR={dataType:null,batchType:null,id:"3d-tiles",name:"3D Tiles",module:"3d-tiles",version:iR,extensions:["cmpt","pnts","b3dm","i3dm"],mimeTypes:["application/octet-stream"],tests:["cmpt","pnts","b3dm","i3dm"],parse:yG,options:{"3d-tiles":{loadGLTF:!0,decodeQuantizedPositions:!1,isTileset:"auto",assetGltfUpAxis:null}}};async function yG(t,e={},n){const s=e["3d-tiles"]||{};let r;return s.isTileset==="auto"?r=(n==null?void 0:n.url)&&n.url.indexOf(".json")!==-1:r=s.isTileset,r?AG(t,e,n):TG(t,e,n)}async function AG(t,e,n){var c;const s=JSON.parse(new TextDecoder().decode(t)),r=(n==null?void 0:n.url)||"",i=EG(r),o=await _G(s,i,e||{});return{...s,shape:"tileset3d",loader:wR,url:r,queryString:(n==null?void 0:n.queryString)||"",basePath:i,root:o||s.root,type:dt.TILES3D,lodMetricType:Qi.GEOMETRIC_ERROR,lodMetricValue:((c=s.root)==null?void 0:c.geometricError)||0}}async function TG(t,e,n){const s={content:{shape:"tile3d",featureIds:null}};return await fR(t,0,e,n,s.content),s.content}function EG(t){return sm(t)}const wS=[0],SG={getPointColor:{type:"accessor",value:[0,0,0,255]},pointSize:1,data:"",loader:wR,onTilesetLoad:{type:"function",value:t=>{}},onTileLoad:{type:"function",value:t=>{}},onTileUnload:{type:"function",value:t=>{}},onTileError:{type:"function",value:(t,e,n)=>{}},_getMeshColor:{type:"function",value:t=>[255,255,255]}},_h=class _h extends Or{initializeState(){"onTileLoadFail"in this.props&&J.removed("onTileLoadFail","onTileError")(),this.state={layerMap:{},tileset3d:null,activeViewports:{},lastUpdatedViewports:null}}get isLoaded(){var e,n;return!!((n=(e=this.state)==null?void 0:e.tileset3d)!=null&&n.isLoaded()&&super.isLoaded)}shouldUpdateState({changeFlags:e}){return e.somethingChanged}updateState({props:e,oldProps:n,changeFlags:s}){if(e.data&&e.data!==n.data&&this._loadTileset(e.data),s.viewportChanged){const{activeViewports:r}=this.state;Object.keys(r).length&&(this._updateTileset(r),this.state.lastUpdatedViewports=r,this.state.activeViewports={})}if(s.propsChanged){const{layerMap:r}=this.state;for(const i in r)r[i].needsUpdate=!0}}activateViewport(e){const{activeViewports:n,lastUpdatedViewports:s}=this.state;this.internalState.viewport=e,n[e.id]=e;const r=s==null?void 0:s[e.id];(!r||!e.equals(r))&&(this.setChangeFlags({viewportChanged:!0}),this.setNeedsUpdate())}getPickingInfo({info:e,sourceLayer:n}){const s=n&&n.props.tile;return e.picked&&(e.object=s),e.sourceTile=s,e}filterSubLayer({layer:e,viewport:n}){const{tile:s}=e.props,{id:r}=n;return s.selected&&s.viewportIds.includes(r)}_updateAutoHighlight(e){const n=e.sourceTile,s=this.state.layerMap[n==null?void 0:n.id];s&&s.layer&&s.layer.updateAutoHighlight(e)}async _loadTileset(e){const{loadOptions:n={}}=this.props,s=this.props.loader||this.props.loaders,r=Array.isArray(s)?s[0]:s,i={loadOptions:{...n}};let o=e;if(r.preload){const l=await r.preload(e,n);l.url&&(o=l.url),l.headers&&(i.loadOptions.fetch={...i.loadOptions.fetch,headers:l.headers}),Object.assign(i,l)}const a=await os(o,r,i.loadOptions),c=new nW(a,{onTileLoad:this._onTileLoad.bind(this),onTileUnload:this._onTileUnload.bind(this),onTileError:this.props.onTileError,...i});this.setState({tileset3d:c,layerMap:{}}),this._updateTileset(this.state.activeViewports),this.props.onTilesetLoad(c)}_onTileLoad(e){const{lastUpdatedViewports:n}=this.state;this.props.onTileLoad(e),this._updateTileset(n),this.setNeedsUpdate()}_onTileUnload(e){delete this.state.layerMap[e.id],this.props.onTileUnload(e)}_updateTileset(e){if(!e)return;const{tileset3d:n}=this.state,{timeline:s}=this.context,r=Object.keys(e).length;!s||!r||!n||n.selectTiles(Object.values(e)).then(i=>{this.state.frameNumber!==i&&this.setState({frameNumber:i})})}_getSubLayer(e,n){if(!e.content)return null;switch(e.type){case Zn.POINTCLOUD:return this._makePointCloudLayer(e,n);case Zn.SCENEGRAPH:return this._make3DModelLayer(e);case Zn.MESH:return this._makeSimpleMeshLayer(e,n);default:throw new Error(`Tile3DLayer: Failed to render layer of type ${e.content.type}`)}}_makePointCloudLayer(e,n){const{attributes:s,pointCount:r,constantRGBA:i,cartographicOrigin:o,modelMatrix:a}=e.content,{positions:c,normals:l,colors:u}=s;if(!c)return null;const h=n&&n.props.data||{header:{vertexCount:r},attributes:{POSITION:c,NORMAL:l,COLOR_0:u}},{pointSize:f,getPointColor:d}=this.props,g=this.getSubLayerClass("pointcloud",bg);return new g({pointSize:f},this.getSubLayerProps({id:"pointcloud"}),{id:`${this.id}-pointcloud-${e.id}`,tile:e,data:h,coordinateSystem:Z.METER_OFFSETS,coordinateOrigin:o,modelMatrix:a,getColor:i||d,_offset:0})}_make3DModelLayer(e){const{gltf:n,instances:s,cartographicOrigin:r,modelMatrix:i}=e.content,o=this.getSubLayerClass("scenegraph",Kg);return new o({_lighting:"pbr"},this.getSubLayerProps({id:"scenegraph"}),{id:`${this.id}-scenegraph-${e.id}`,tile:e,data:s||wS,scenegraph:n,coordinateSystem:Z.METER_OFFSETS,coordinateOrigin:r,modelMatrix:i,getTransformMatrix:a=>a.modelMatrix,getPosition:[0,0,0],_offset:0})}_makeSimpleMeshLayer(e,n){const s=e.content,{attributes:r,indices:i,modelMatrix:o,cartographicOrigin:a,coordinateSystem:c=Z.METER_OFFSETS,material:l,featureIds:u}=s,{_getMeshColor:h}=this.props,f=n&&n.props.mesh||new Kt({topology:"triangle-list",attributes:CG(r),indices:i}),d=this.getSubLayerClass("mesh",Yg);return new d(this.getSubLayerProps({id:"mesh"}),{id:`${this.id}-mesh-${e.id}`,tile:e,mesh:f,data:wS,getColor:h(e),pbrMaterial:l,modelMatrix:o,coordinateOrigin:a,coordinateSystem:c,featureIds:u,_offset:0})}renderLayers(){const{tileset3d:e,layerMap:n}=this.state;return e?e.tiles.map(s=>{const r=n[s.id]=n[s.id]||{tile:s};let{layer:i}=r;return s.selected&&(i?r.needsUpdate&&(i=this._getSubLayer(s,i),r.needsUpdate=!1):i=this._getSubLayer(s)),r.layer=i,i}).filter(Boolean):null}};_h.defaultProps=SG,_h.layerName="Tile3DLayer";let s_=_h;function CG(t){const e={};return e.positions={...t.positions,value:new Float32Array(t.positions.value)},t.normals&&(e.normals=t.normals),t.texCoords&&(e.texCoords=t.texCoords),t.colors&&(e.colors=t.colors),t.uvRegions&&(e.uvRegions=t.uvRegions),e}function vG(t,e,n,s){const r=s?bG(s,t.POSITION.value):wG(e),i=new t.POSITION.value.constructor(r.length*6),o=new t.TEXCOORD_0.value.constructor(r.length*4),a=new e.constructor(r.length*6);for(let l=0;l<r.length;l++){const u=r[l];RG({edge:u,edgeIndex:l,attributes:t,skirtHeight:n,newPosition:i,newTexcoord0:o,newTriangles:a})}t.POSITION.value=zf(t.POSITION.value,i),t.TEXCOORD_0.value=zf(t.TEXCOORD_0.value,o);const c=e instanceof Array?e.concat(a):zf(e,a);return{attributes:t,triangles:c}}function wG(t){var r,i;const e=[];for(let o=0;o<t.length;o+=3)e.push([t[o],t[o+1]]),e.push([t[o+1],t[o+2]]),e.push([t[o+2],t[o]]);e.sort((o,a)=>Math.min(...o)-Math.min(...a)||Math.max(...o)-Math.max(...a));const n=[];let s=0;for(;s<e.length;)e[s][0]===((r=e[s+1])==null?void 0:r[1])&&e[s][1]===((i=e[s+1])==null?void 0:i[0])?s+=2:(n.push(e[s]),s++);return n}function bG(t,e){t.westIndices.sort((s,r)=>e[3*s+1]-e[3*r+1]),t.eastIndices.sort((s,r)=>e[3*r+1]-e[3*s+1]),t.southIndices.sort((s,r)=>e[3*r]-e[3*s]),t.northIndices.sort((s,r)=>e[3*s]-e[3*r]);const n=[];for(const s in t){const r=t[s];for(let i=0;i<r.length-1;i++)n.push([r[i],r[i+1]])}return n}function RG({edge:t,edgeIndex:e,attributes:n,skirtHeight:s,newPosition:r,newTexcoord0:i,newTriangles:o}){const a=n.POSITION.value.length,c=e*2,l=e*2+1;r.set(n.POSITION.value.subarray(t[0]*3,t[0]*3+3),c*3),r[c*3+2]=r[c*3+2]-s,r.set(n.POSITION.value.subarray(t[1]*3,t[1]*3+3),l*3),r[l*3+2]=r[l*3+2]-s,i.set(n.TEXCOORD_0.value.subarray(t[0]*2,t[0]*2+2),c*2),i.set(n.TEXCOORD_0.value.subarray(t[1]*2,t[1]*2+2),l*2);const u=e*2*3;o[u]=t[0],o[u+1]=a/3+l,o[u+2]=t[1],o[u+3]=a/3+l,o[u+4]=t[0],o[u+5]=a/3+c}class IG{constructor(e=257){this.gridSize=e;const n=e-1;if(n&n-1)throw new Error(`Expected grid size to be 2^n+1, got ${e}.`);this.numTriangles=n*n*2-2,this.numParentTriangles=this.numTriangles-n*n,this.indices=new Uint32Array(this.gridSize*this.gridSize),this.coords=new Uint16Array(this.numTriangles*4);for(let s=0;s<this.numTriangles;s++){let r=s+2,i=0,o=0,a=0,c=0,l=0,u=0;for(r&1?a=c=l=n:i=o=u=n;(r>>=1)>1;){const f=i+a>>1,d=o+c>>1;r&1?(a=i,c=o,i=l,o=u):(i=a,o=c,a=l,c=u),l=f,u=d}const h=s*4;this.coords[h+0]=i,this.coords[h+1]=o,this.coords[h+2]=a,this.coords[h+3]=c}}createTile(e){return new PG(e,this)}}class PG{constructor(e,n){const s=n.gridSize;if(e.length!==s*s)throw new Error(`Expected terrain data of length ${s*s} (${s} x ${s}), got ${e.length}.`);this.terrain=e,this.martini=n,this.errors=new Float32Array(e.length),this.update()}update(){const{numTriangles:e,numParentTriangles:n,coords:s,gridSize:r}=this.martini,{terrain:i,errors:o}=this;for(let a=e-1;a>=0;a--){const c=a*4,l=s[c+0],u=s[c+1],h=s[c+2],f=s[c+3],d=l+h>>1,g=u+f>>1,_=d+g-u,E=g+l-d,m=(i[u*r+l]+i[f*r+h])/2,y=g*r+d,A=Math.abs(m-i[y]);if(o[y]=Math.max(o[y],A),a<n){const C=(u+E>>1)*r+(l+_>>1),b=(f+E>>1)*r+(h+_>>1);o[y]=Math.max(o[y],o[C],o[b])}}}getMesh(e=0){const{gridSize:n,indices:s}=this.martini,{errors:r}=this;let i=0,o=0;const a=n-1;s.fill(0);function c(d,g,_,E,m,y){const A=d+_>>1,C=g+E>>1;Math.abs(d-m)+Math.abs(g-y)>1&&r[C*n+A]>e?(c(m,y,d,g,A,C),c(_,E,m,y,A,C)):(s[g*n+d]=s[g*n+d]||++i,s[E*n+_]=s[E*n+_]||++i,s[y*n+m]=s[y*n+m]||++i,o++)}c(0,0,a,a,a,0),c(a,a,0,0,0,a);const l=new Uint16Array(i*2),u=new Uint32Array(o*3);let h=0;function f(d,g,_,E,m,y){const A=d+_>>1,C=g+E>>1;if(Math.abs(d-m)+Math.abs(g-y)>1&&r[C*n+A]>e)f(m,y,d,g,A,C),f(_,E,m,y,A,C);else{const b=s[g*n+d]-1,P=s[E*n+_]-1,B=s[y*n+m]-1;l[2*b]=d,l[2*b+1]=g,l[2*P]=_,l[2*P+1]=E,l[2*B]=m,l[2*B+1]=y,u[h++]=b,u[h++]=P,u[h++]=B}}return f(0,0,a,a,a,0),f(a,a,0,0,0,a),{vertices:l,triangles:u}}}class xG{constructor(e,n,s=n){this.data=e,this.width=n,this.height=s,this.coords=[],this.triangles=[],this._halfedges=[],this._candidates=[],this._queueIndices=[],this._queue=[],this._errors=[],this._rms=[],this._pending=[],this._pendingLen=0,this._rmsSum=0;const r=n-1,i=s-1,o=this._addPoint(0,0),a=this._addPoint(r,0),c=this._addPoint(0,i),l=this._addPoint(r,i),u=this._addTriangle(l,o,c,-1,-1,-1);this._addTriangle(o,l,a,u,-1,-1),this._flush()}run(e=1){for(;this.getMaxError()>e;)this.refine()}refine(){this._step(),this._flush()}getMaxError(){return this._errors[0]}getRMSD(){return this._rmsSum>0?Math.sqrt(this._rmsSum/(this.width*this.height)):0}heightAt(e,n){return this.data[this.width*n+e]}_flush(){const e=this.coords;for(let n=0;n<this._pendingLen;n++){const s=this._pending[n],r=2*this.triangles[s*3+0],i=2*this.triangles[s*3+1],o=2*this.triangles[s*3+2];this._findCandidate(e[r],e[r+1],e[i],e[i+1],e[o],e[o+1],s)}this._pendingLen=0}_findCandidate(e,n,s,r,i,o,a){const c=Math.min(e,s,i),l=Math.min(n,r,o),u=Math.max(e,s,i),h=Math.max(n,r,o);let f=or(s,r,i,o,c,l),d=or(i,o,e,n,c,l),g=or(e,n,s,r,c,l);const _=r-n,E=e-s,m=o-r,y=s-i,A=n-o,C=i-e,b=or(e,n,s,r,i,o),P=this.heightAt(e,n)/b,B=this.heightAt(s,r)/b,O=this.heightAt(i,o)/b;let N=0,F=0,H=0,X=0;for(let G=l;G<=h;G++){let $=0;f<0&&m!==0&&($=Math.max($,Math.floor(-f/m))),d<0&&A!==0&&($=Math.max($,Math.floor(-d/A))),g<0&&_!==0&&($=Math.max($,Math.floor(-g/_)));let Te=f+m*$,Nt=d+A*$,Et=g+_*$,V=!1;for(let K=c+$;K<=u;K++){if(Te>=0&&Nt>=0&&Et>=0){V=!0;const Y=P*Te+B*Nt+O*Et,se=Math.abs(Y-this.heightAt(K,G));X+=se*se,se>N&&(N=se,F=K,H=G)}else if(V)break;Te+=m,Nt+=A,Et+=_}f+=y,d+=C,g+=E}(F===e&&H===n||F===s&&H===r||F===i&&H===o)&&(N=0),this._candidates[2*a]=F,this._candidates[2*a+1]=H,this._rms[a]=X,this._queuePush(a,N,X)}_step(){const e=this._queuePop(),n=e*3+0,s=e*3+1,r=e*3+2,i=this.triangles[n],o=this.triangles[s],a=this.triangles[r],c=this.coords[2*i],l=this.coords[2*i+1],u=this.coords[2*o],h=this.coords[2*o+1],f=this.coords[2*a],d=this.coords[2*a+1],g=this._candidates[2*e],_=this._candidates[2*e+1],E=this._addPoint(g,_);if(or(c,l,u,h,g,_)===0)this._handleCollinear(E,n);else if(or(u,h,f,d,g,_)===0)this._handleCollinear(E,s);else if(or(f,d,c,l,g,_)===0)this._handleCollinear(E,r);else{const m=this._halfedges[n],y=this._halfedges[s],A=this._halfedges[r],C=this._addTriangle(i,o,E,m,-1,-1,n),b=this._addTriangle(o,a,E,y,-1,C+1),P=this._addTriangle(a,i,E,A,C+2,b+1);this._legalize(C),this._legalize(b),this._legalize(P)}}_addPoint(e,n){const s=this.coords.length>>1;return this.coords.push(e,n),s}_addTriangle(e,n,s,r,i,o,a=this.triangles.length){const c=a/3;return this.triangles[a+0]=e,this.triangles[a+1]=n,this.triangles[a+2]=s,this._halfedges[a+0]=r,this._halfedges[a+1]=i,this._halfedges[a+2]=o,r>=0&&(this._halfedges[r]=a+0),i>=0&&(this._halfedges[i]=a+1),o>=0&&(this._halfedges[o]=a+2),this._candidates[2*c+0]=0,this._candidates[2*c+1]=0,this._queueIndices[c]=-1,this._rms[c]=0,this._pending[this._pendingLen++]=c,a}_legalize(e){const n=this._halfedges[e];if(n<0)return;const s=e-e%3,r=n-n%3,i=s+(e+1)%3,o=s+(e+2)%3,a=r+(n+2)%3,c=r+(n+1)%3,l=this.triangles[o],u=this.triangles[e],h=this.triangles[i],f=this.triangles[a],d=this.coords;if(!MG(d[2*l],d[2*l+1],d[2*u],d[2*u+1],d[2*h],d[2*h+1],d[2*f],d[2*f+1]))return;const g=this._halfedges[i],_=this._halfedges[o],E=this._halfedges[a],m=this._halfedges[c];this._queueRemove(s/3),this._queueRemove(r/3);const y=this._addTriangle(l,f,h,-1,E,g,s),A=this._addTriangle(f,l,u,y,_,m,r);this._legalize(y+1),this._legalize(A+2)}_handleCollinear(e,n){const s=n-n%3,r=s+(n+1)%3,i=s+(n+2)%3,o=this.triangles[i],a=this.triangles[n],c=this.triangles[r],l=this._halfedges[r],u=this._halfedges[i],h=this._halfedges[n];if(h<0){const P=this._addTriangle(e,o,a,-1,u,-1,s),B=this._addTriangle(o,e,c,P,-1,l);this._legalize(P+1),this._legalize(B+2);return}const f=h-h%3,d=f+(h+2)%3,g=f+(h+1)%3,_=this.triangles[d],E=this._halfedges[d],m=this._halfedges[g];this._queueRemove(f/3);const y=this._addTriangle(o,a,e,u,-1,-1,s),A=this._addTriangle(a,_,e,m,-1,y+1,f),C=this._addTriangle(_,c,e,E,-1,A+1),b=this._addTriangle(c,o,e,l,y+2,C+1);this._legalize(y),this._legalize(A),this._legalize(C),this._legalize(b)}_queuePush(e,n,s){const r=this._queue.length;this._queueIndices[e]=r,this._queue.push(e),this._errors.push(n),this._rmsSum+=s,this._queueUp(r)}_queuePop(){const e=this._queue.length-1;return this._queueSwap(0,e),this._queueDown(0,e),this._queuePopBack()}_queuePopBack(){const e=this._queue.pop();return this._errors.pop(),this._rmsSum-=this._rms[e],this._queueIndices[e]=-1,e}_queueRemove(e){const n=this._queueIndices[e];if(n<0){const r=this._pending.indexOf(e);if(r!==-1)this._pending[r]=this._pending[--this._pendingLen];else throw new Error("Broken triangulation (something went wrong).");return}const s=this._queue.length-1;s!==n&&(this._queueSwap(n,s),this._queueDown(n,s)||this._queueUp(n)),this._queuePopBack()}_queueLess(e,n){return this._errors[e]>this._errors[n]}_queueSwap(e,n){const s=this._queue[e],r=this._queue[n];this._queue[e]=r,this._queue[n]=s,this._queueIndices[s]=n,this._queueIndices[r]=e;const i=this._errors[e];this._errors[e]=this._errors[n],this._errors[n]=i}_queueUp(e){let n=e;for(;;){const s=n-1>>1;if(s===n||!this._queueLess(n,s))break;this._queueSwap(s,n),n=s}}_queueDown(e,n){let s=e;for(;;){const r=2*s+1;if(r>=n||r<0)break;const i=r+1;let o=r;if(i<n&&this._queueLess(i,r)&&(o=i),!this._queueLess(o,s))break;this._queueSwap(s,o),s=o}return s>e}}function or(t,e,n,s,r,i){return(n-r)*(e-i)-(s-i)*(t-r)}function MG(t,e,n,s,r,i,o,a){const c=t-o,l=e-a,u=n-o,h=s-a,f=r-o,d=i-a,g=c*c+l*l,_=u*u+h*h,E=f*f+d*d;return c*(h*E-_*d)-l*(u*E-_*f)+g*(u*d-h*f)<0}function BG(t,e){const{meshMaxError:n,bounds:s,elevationDecoder:r}=e,{data:i,width:o,height:a}=t;let c,l;switch(e.tesselator){case"martini":c=pl(i,o,a,r,e.tesselator),l=bS(n,o,c);break;case"delatin":c=pl(i,o,a,r,e.tesselator),l=RS(n,o,a,c);break;default:o===a&&!(a&o-1)?(c=pl(i,o,a,r,"martini"),l=bS(n,o,c)):(c=pl(i,o,a,r,"delatin"),l=RS(n,o,a,c));break}const{vertices:u}=l;let{triangles:h}=l,f=OG(u,c,o,a,s);const d=cm(f);if(e.skirtHeight){const{attributes:g,triangles:_}=vG(f,h,e.skirtHeight);f=g,h=_}return{loaderData:{header:{}},header:{vertexCount:h.length,boundingBox:d},mode:4,indices:{value:Uint32Array.from(h),size:1},attributes:f}}function bS(t,e,n){const s=e+1,i=new IG(s).createTile(n),{vertices:o,triangles:a}=i.getMesh(t);return{vertices:o,triangles:a}}function RS(t,e,n,s){const r=new xG(s,e+1,n+1);r.run(t);const{coords:i,triangles:o}=r;return{vertices:i,triangles:o}}function pl(t,e,n,s,r){const{rScaler:i,bScaler:o,gScaler:a,offset:c}=s,l=new Float32Array((e+1)*(n+1));for(let u=0,h=0;h<n;h++)for(let f=0;f<e;f++,u++){const d=u*4,g=t[d+0],_=t[d+1],E=t[d+2];l[u+h]=g*i+_*a+E*o+c}if(r==="martini"){for(let u=(e+1)*e,h=0;h<e;h++,u++)l[u]=l[u-e-1];for(let u=n,h=0;h<n+1;h++,u+=n+1)l[u]=l[u-1]}return l}function OG(t,e,n,s,r){const i=n+1,o=t.length/2,a=new Float32Array(o*3),c=new Float32Array(o*2),[l,u,h,f]=r||[0,0,n,s],d=(h-l)/n,g=(f-u)/s;for(let _=0;_<o;_++){const E=t[_*2],m=t[_*2+1],y=m*i+E;a[3*_+0]=E*d+l,a[3*_+1]=-m*g+f,a[3*_+2]=e[y],c[2*_+0]=E/n,c[2*_+1]=m/s}return{POSITION:{value:a,size:3},TEXCOORD_0:{value:c,size:2}}}const NG="4.2.0-beta.2",bR={dataType:null,batchType:null,name:"Terrain",id:"terrain",module:"terrain",version:NG,worker:!0,extensions:["png","pngraw","jpg","jpeg","gif","webp","bmp"],mimeTypes:["image/png","image/jpeg","image/gif","image/webp","image/bmp"],options:{terrain:{tesselator:"auto",bounds:void 0,meshMaxError:10,elevationDecoder:{rScaler:1,gScaler:0,bScaler:0,offset:0},skirtHeight:void 0}}},FG={...bR,parse:DG};async function DG(t,e,n){const s={...e,mimeType:"application/x.image",image:{...e==null?void 0:e.image,type:"data"}},r=await ro(t,[],s,n),i={...FG.options.terrain,...e==null?void 0:e.terrain};return BG(r,i)}const IS=[1],LG={...Ou.defaultProps,elevationData:Hg,texture:{...Hg,optional:!0},meshMaxError:{type:"number",value:4},bounds:{type:"array",value:null,optional:!0,compare:!0},color:{type:"color",value:[255,255,255]},elevationDecoder:{type:"object",value:{rScaler:1,gScaler:0,bScaler:0,offset:0}},workerUrl:"",wireframe:!1,material:!0,loaders:[bR]};function PS(t){return Array.isArray(t)?t.join(";"):t||""}const mh=class mh extends Or{updateState({props:e,oldProps:n}){const s=e.elevationData!==n.elevationData;if(s){const{elevationData:i}=e,o=i&&(Array.isArray(i)||i.includes("{x}")&&i.includes("{y}"));this.setState({isTiled:o})}const r=s||e.meshMaxError!==n.meshMaxError||e.elevationDecoder!==n.elevationDecoder||e.bounds!==n.bounds;if(!this.state.isTiled&&r){const i=this.loadTerrain(e);this.setState({terrain:i})}e.workerUrl&&J.removed("workerUrl","loadOptions.terrain.workerUrl")()}loadTerrain({elevationData:e,bounds:n,elevationDecoder:s,meshMaxError:r,signal:i}){if(!e)return null;let o=this.getLoadOptions();o={...o,terrain:{skirtHeight:this.state.isTiled?r*2:0,...o==null?void 0:o.terrain,bounds:n,meshMaxError:r,elevationDecoder:s}};const{fetch:a}=this.props;return a(e,{propName:"elevationData",layer:this,loadOptions:o,signal:i})}getTiledTerrainData(e){const{elevationData:n,fetch:s,texture:r,elevationDecoder:i,meshMaxError:o}=this.props,{viewport:a}=this.context,c=jg(n,e),l=r&&jg(r,e),{signal:u}=e;let h=[0,0],f=[0,0];if(a.isGeospatial){const E=e.bbox;h=a.projectFlat([E.west,E.south]),f=a.projectFlat([E.east,E.north])}else{const E=e.bbox;h=[E.left,E.bottom],f=[E.right,E.top]}const d=[h[0],h[1],f[0],f[1]],g=this.loadTerrain({elevationData:c,bounds:d,elevationDecoder:i,meshMaxError:o,signal:u}),_=l?s(l,{propName:"texture",layer:this,loaders:[],signal:u}).catch(E=>null):Promise.resolve(null);return Promise.all([g,_])}renderSubLayers(e){const n=this.getSubLayerClass("mesh",ja),{color:s,wireframe:r,material:i}=this.props,{data:o}=e;if(!o)return null;const[a,c]=o;return new n(e,{data:IS,mesh:a,texture:c,_instanced:!1,coordinateSystem:Z.CARTESIAN,getPosition:l=>[0,0,0],getColor:s,wireframe:r,material:i})}onViewportLoad(e){if(!e)return;const{zRange:n}=this.state,s=e.map(o=>o.content).filter(Boolean).map(o=>o[0].header.boundingBox.map(c=>c[2]));if(s.length===0)return;const r=Math.min(...s.map(o=>o[0])),i=Math.max(...s.map(o=>o[1]));(!n||r<n[0]||i>n[1])&&this.setState({zRange:[r,i]})}renderLayers(){const{color:e,material:n,elevationData:s,texture:r,wireframe:i,meshMaxError:o,elevationDecoder:a,tileSize:c,maxZoom:l,minZoom:u,extent:h,maxRequests:f,onTileLoad:d,onTileUnload:g,onTileError:_,maxCacheSize:E,maxCacheByteSize:m,refinementStrategy:y}=this.props;if(this.state.isTiled)return new Ou(this.getSubLayerProps({id:"tiles"}),{getTileData:this.getTiledTerrainData.bind(this),renderSubLayers:this.renderSubLayers.bind(this),updateTriggers:{getTileData:{elevationData:PS(s),texture:PS(r),meshMaxError:o,elevationDecoder:a}},onViewportLoad:this.onViewportLoad.bind(this),zRange:this.state.zRange||null,tileSize:c,maxZoom:l,minZoom:u,extent:h,maxRequests:f,onTileLoad:d,onTileUnload:g,onTileError:_,maxCacheSize:E,maxCacheByteSize:m,refinementStrategy:y});if(!s)return null;const A=this.getSubLayerClass("mesh",ja);return new A(this.getSubLayerProps({id:"mesh"}),{data:IS,mesh:this.state.terrain,texture:r,_instanced:!1,getPosition:C=>[0,0,0],getColor:e,material:n,wireframe:i})}};mh.defaultProps=LG,mh.layerName="TerrainLayer";let r_=mh;const RR="pk.eyJ1IjoiYmVydHRlbW1lIiwiYSI6ImNtMjA3M21zZjBjbWUya3IyZmYzeXhwbmQifQ.YmxccPvO-kGKmB7zX6LMvg",UG="https://geodan.github.io/pg2b3dm/sample_data/3dbag/sibbe/1.0/tileset.json",kG={latitude:50.843332,longitude:5.825286,pitch:45,maxPitch:60,bearing:0,minZoom:2,maxZoom:30,zoom:17},zG=`https://api.mapbox.com/v4/mapbox.terrain-rgb/{z}/{x}/{y}.png?access_token=${RR}`,VG=`https://api.mapbox.com/v4/mapbox.satellite/{z}/{x}/{y}@2x.jpg90?access_token=${RR}`,HG={rScaler:6553.6,gScaler:25.6,bScaler:.1,offset:-1e4+44};function jG({texture:t=VG,wireframe:e=!1,initialViewState:n=kG}){const s=new r_({id:"terrain",minZoom:0,maxZoom:23,strategy:"no-overlap",elevationDecoder:HG,elevationData:zG,texture:t,wireframe:e,color:[255,255,255]}),r=new s_({id:"tile-3d-layer",pointSize:2,data:UG});return kS.createElement(k6,{initialViewState:n,controller:!0,layers:[r,s]})}function WG(t){j1(t).render(kS.createElement(jG,null))}WG(document.getElementById("app"));
